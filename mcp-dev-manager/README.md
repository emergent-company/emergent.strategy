# MCP Dev Manager

A Model Context Protocol (MCP) server that exposes developer workflows for the Spec codebase. The server powers Claude Desktop (and other MCP-aware clients) so they can run the same npm scripts, check service health, and inspect logs without needing interactive shell access.

## Features

- **Script runner** – discover and execute any `dev-manager:*` script declared in the repository root `package.json`.
- **Test runner** – legacy helper for npm/Playwright/Vitest/Jest commands when a bespoke script is unavailable.
- **Service manager** – wrappers for Docker Compose, npm, PM2, or custom shell commands with output capture and timeouts.
- **Log browser** – list, tail, cat, or grep log files from common directories like `logs/` and `apps/**/test-results`.
- **Status checks** – summarize docker compose state, npm processes, PM2 status, and well-known development ports.

## Layout

```
mcp-dev-manager/
├── package.json          # Manifest with build/watch scripts and dependencies
├── tsconfig.json         # TypeScript compiler configuration
├── src/
│   ├── index.ts          # MCP server that registers tools
│   ├── tools/            # Tool implementations (run-script, run-tests, etc.)
│   └── utils/exec.ts     # Shared helpers for command execution and path safety
├── dist/                 # Compiled JS output (generated by `npm run build`)
├── verify-setup.sh       # Convenience script to install/build & print setup hints
└── test.js               # Minimal harness for manual smoke testing
```

## Prerequisites

- Node.js ≥ 18
- `PROJECT_ROOT` environment variable pointing at the repository root when launching the server (Claude Desktop passes this automatically).

## Setup

From the repository root:

```bash
cd mcp-dev-manager
npm install
npm run build
```

Optional health check:

```bash
./verify-setup.sh
```

The script ensures dependencies are present, compiles TypeScript, and prints the configuration snippet for Claude Desktop.

## Claude Desktop Integration

Add the server to `~/Library/Application Support/Claude/claude_desktop_config.json`:

```json
{
  "mcpServers": {
    "dev-manager": {
      "command": "node",
      "args": ["/ABSOLUTE/PATH/spec-server/mcp-dev-manager/dist/index.js"],
      "env": {
        "PROJECT_ROOT": "/ABSOLUTE/PATH/spec-server"
      }
    }
  }
}
```

Restart Claude Desktop after editing the config.

## Available Tools

| Tool | Purpose | Highlights |
| ---- | ------- | ---------- |
| `run_script` | Preferred entry point. Executes `dev-manager:*` npm scripts by name or `app`/`action` tuple. Rejects interactive commands. | Returns formatted stdout/stderr, suggestions when a script is missing, and troubleshooting hints on failure. |
| `list_scripts` | Enumerates all `dev-manager:*` scripts grouped by app. | Useful for discovery; output is Markdown. |
| `run_tests` | Legacy runner when no curated script exists. Supports npm, Playwright, Vitest, and Jest. | Accepts `spec`, `project`, `grep`, and custom working directories. |
| `manage_service` | Start/stop/restart/status for Docker Compose, npm scripts, PM2, or custom shell commands. | Validates working directories and prints executed command. |
| `browse_logs` | List/tail/cat/grep log files. | Guards against directory traversal and truncates oversize output. |
| `check_status` | Summaries for docker compose, npm processes, PM2, and key ports (3000/3001/5173/5175/5432/6379/8080). | Designed for quick health snapshots. |

All tool outputs are returned as Markdown blocks so Claude can render them directly in the chat transcript.

## Script Conventions

The root `package.json` exposes repo-specific automation via the `dev-manager:` prefix. Examples:

- `dev-manager:admin:e2e` – run admin Playwright suite with dependency preflight.
- `dev-manager:server:test:openapi` – run the OpenAPI regression spec.
- `dev-manager:docker:up` – bring up the local docker stack.
- `dev-manager:server:seed:extraction` – seed demo extraction data via `scripts/seed-extraction-demo.ts`.

The MCP server simply shells out to these scripts, so keep new automation discoverable by following the same naming pattern.

## Development Notes

- `npm run build` compiles sources and marks `dist/index.js` executable (shebang preserved).
- `npm run watch` runs the TypeScript compiler in watch mode during local development.
- `npm run inspector` launches the MCP Inspector targeting the compiled server.
- The utilities in `src/utils/exec.ts` enforce path validation, stdout/stderr truncation, and default timeouts to protect the MCP host.

## Troubleshooting

- **`PROJECT_ROOT` missing** – the server exits early; ensure the environment variable is set when running manually.
- **Interactive command rejected** – some scripts (Playwright headed/UI modes, long-running log tails) require a real terminal. Use `run_in_terminal` instead of MCP in those cases.
- **Docker/port checks fail** – the status tool relies on `docker compose`, `ps`, and `lsof` being available on the host.

## License

MIT
