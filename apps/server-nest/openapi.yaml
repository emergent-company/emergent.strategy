openapi: 3.0.0
paths:
  /health:
    get:
      operationId: HealthController_get
      parameters: []
      responses:
        '200':
          description: Health probe
          content:
            application/json:
              schema:
                example:
                  ok: true
                  model: gemini-pro
                  db: up
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags:
        - Health
  /auth/me:
    get:
      operationId: AuthController_me
      parameters: []
      responses:
        '200':
          description: Return current authenticated user (mock)
          content:
            application/json:
              schema:
                example:
                  sub: mock-user-id
                  email: demo@example.com
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Missing or invalid bearer token
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Unauthorized
        '403':
          description: Insufficient scope
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
                    missing_scopes: &ref_0
                      - org:read
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags:
        - Auth
      security:
        - bearer: []
      x-required-scopes: *ref_0
  /settings:
    get:
      operationId: SettingsController_list
      parameters: []
      responses:
        '200':
          description: List settings (placeholder)
          content:
            application/json:
              schema:
                example:
                  - key: theme
                    value: dark
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: &ref_1
        - Settings
  /settings/{key}:
    get:
      operationId: SettingsController_getOne
      parameters:
        - name: key
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Get a single setting (placeholder)
          content:
            application/json:
              schema:
                example:
                  key: theme
                  value: dark
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '404':
          description: Setting not found
          content:
            application/json:
              schema:
                example:
                  error:
                    code: not-found
                    message: Setting not found
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_1
  /orgs:
    get:
      operationId: OrgsController_list
      parameters: []
      responses:
        '200':
          description: List organizations
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/OrgDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid filter
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: &ref_2
        - Orgs
    post:
      operationId: OrgsController_create
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateOrgDto'
      responses:
        '201':
          description: Organization created (users may have at most 10 orgs)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrgDto'
        '400':
          description: Invalid body
          content:
            application/json:
              schema:
                example:
                  error:
                    code: validation-failed
                    message: Validation failed
                    details:
                      name:
                        - must be a string
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '409':
          description: Organization limit reached or duplicate name
          content:
            application/json:
              schema:
                oneOf:
                  - example:
                      error:
                        code: conflict
                        message: Organization limit reached (10)
                  - example:
                      error:
                        code: conflict
                        message: Organization name already exists
                        details:
                          name:
                            - already exists
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_2
  /orgs/{id}:
    get:
      operationId: OrgsController_getOne
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Get an organization
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrgDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '404':
          description: Org not found
          content:
            application/json:
              schema:
                example:
                  error:
                    code: not-found
                    message: Org not found
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_2
    delete:
      operationId: OrgsController_delete
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Organization deleted (projects, documents, chunks, conversations cascade)
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '404':
          description: Org not found
          content:
            application/json:
              schema:
                example:
                  error:
                    code: not-found
                    message: Org not found
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_2
  /projects:
    get:
      operationId: ProjectsController_list
      parameters:
        - name: limit
          required: true
          in: query
          schema:
            type: string
        - name: orgId
          required: false
          in: query
          description: Filter projects by organization id (must be explicit elsewhere when creating projects)
          schema:
            type: string
      responses:
        '200':
          description: List projects (must create at least one before ingesting documents)
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ProjectDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid filter
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
                    missing_scopes: &ref_3
                      - project:read
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: &ref_4
        - Projects
      security:
        - bearer: []
      x-required-scopes: *ref_3
    post:
      operationId: ProjectsController_create
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateProjectDto'
      responses:
        '201':
          description: Project created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProjectDto'
        '400':
          description: Validation / duplicate / org errors
          content:
            application/json:
              schema:
                example:
                  error:
                    code: duplicate
                    message: Project with this name exists in org
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
                    missing_scopes: &ref_5
                      - org:project:create
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_4
      security:
        - bearer: []
      x-required-scopes: *ref_5
  /projects/{id}:
    delete:
      operationId: ProjectsController_delete
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Deleted project
          content:
            application/json:
              schema:
                example:
                  status: deleted
        '400':
          description: Invalid id
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid id
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
                    missing_scopes: &ref_6
                      - org:project:delete
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_4
      security:
        - bearer: []
      x-required-scopes: *ref_6
  /search:
    get:
      operationId: SearchController_search
      parameters:
        - name: q
          required: true
          in: query
          description: Query string
          schema:
            example: vector index design
            type: string
        - name: limit
          required: false
          in: query
          description: Result limit (1..50)
          schema:
            minimum: 1
            maximum: 50
            default: 10
            type: number
        - name: mode
          required: false
          in: query
          schema:
            default: hybrid
            enum:
              - hybrid
              - lexical
              - vector
            type: string
      responses:
        '200':
          description: Hybrid / lexical / vector search over chunks
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SearchResponseDto'
        '400':
          description: Validation failed
          content:
            application/json:
              schema:
                example:
                  error:
                    code: validation-failed
                    message: Validation failed
                    details:
                      q:
                        - must be longer than or equal to 1 characters
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
                    missing_scopes: &ref_7
                      - documents:read
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags:
        - Search
      security:
        - bearer: []
      x-required-scopes: *ref_7
  /documents:
    get:
      operationId: DocumentsController_list
      parameters:
        - name: limit
          required: false
          in: query
          schema:
            type: number
            minimum: 1
            maximum: 500
            default: 100
        - name: cursor
          required: true
          in: query
          schema:
            type: string
      responses:
        '200':
          description: List ingested documents
          headers:
            x-next-cursor:
              description: Base64 cursor for next page
              schema:
                type: string
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DocumentDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid filter
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
                    missing_scopes: &ref_8
                      - documents:read
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: &ref_9
        - Documents
      security:
        - bearer: []
      x-required-scopes: *ref_8
    post:
      operationId: DocumentsController_create
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              properties:
                filename:
                  type: string
                projectId:
                  type: string
                  format: uuid
                content:
                  type: string
      responses:
        '200':
          description: Created document
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DocumentDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
                    missing_scopes: &ref_10
                      - documents:write
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_9
      security:
        - bearer: []
      x-required-scopes: *ref_10
  /documents/{id}:
    get:
      operationId: DocumentsController_get
      parameters:
        - name: id
          required: true
          in: path
          description: Document UUID
          schema:
            type: string
      responses:
        '200':
          description: Get a document
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DocumentDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid id
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
                    missing_scopes: &ref_11
                      - documents:read
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_9
      security:
        - bearer: []
      x-required-scopes: *ref_11
    delete:
      operationId: DocumentsController_delete
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: ''
      tags: *ref_9
      security:
        - bearer: []
      x-required-scopes:
        - documents:delete
  /chunks:
    get:
      operationId: ChunksController_list
      parameters:
        - name: documentId
          required: false
          in: query
          description: Filter by document UUID
          schema:
            type: string
      responses:
        '200':
          description: List chunks
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ChunkDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid filter
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
                    missing_scopes: &ref_12
                      - documents:read
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags:
        - Chunks
      security:
        - bearer: []
      x-required-scopes: *ref_12
  /ingest/upload:
    post:
      operationId: IngestionController_upload
      parameters: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/IngestionUploadDto'
      responses:
        '200':
          description: Upload a file for ingestion
          content:
            application/json:
              schema:
                example:
                  documentId: 11111111-2222-3333-4444-555555555555
                  chunks: 12
                  alreadyExists: false
        '400':
          description: Invalid upload payload
          content:
            application/json:
              schema:
                example:
                  error:
                    code: validation-failed
                    message: Validation failed
                    details:
                      filename:
                        - must be a string
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
                    missing_scopes: &ref_13
                      - documents:write
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: &ref_14
        - Ingestion
      security:
        - bearer: []
      x-required-scopes: *ref_13
  /ingest/url:
    post:
      operationId: IngestionController_ingestUrl
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IngestionUrlDto'
      responses:
        '200':
          description: Ingest a remote URL
          content:
            application/json:
              schema:
                example:
                  documentId: aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee
                  chunks: 8
                  alreadyExists: false
        '400':
          description: Invalid URL payload
          content:
            application/json:
              schema:
                example:
                  error:
                    code: validation-failed
                    message: Validation failed
                    details:
                      url:
                        - must be an URL address
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
                    missing_scopes: &ref_15
                      - documents:write
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_14
      security:
        - bearer: []
      x-required-scopes: *ref_15
  /chat/conversations:
    get:
      operationId: ChatController_listConversations
      parameters: []
      responses:
        '200':
          description: List chat conversations
          content:
            application/json:
              schema:
                example:
                  - id: 11111111-1111-4111-8111-111111111111
                    title: 2025-01-01 — Hello world
                    is_private: false
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
                    missing_scopes: &ref_16
                      - chat:use
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: &ref_17
        - Chat
      security:
        - bearer: []
      x-required-scopes: *ref_16
    post:
      operationId: ChatController_createConversation
      parameters: []
      responses:
        '200':
          description: Create a new conversation (201)
          content:
            application/json:
              schema:
                example:
                  conversationId: 11111111-1111-4111-8111-111111111111
                  id: 11111111-1111-4111-8111-111111111111
                  title: 2025-01-01 — New Conversation
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: message required
      tags: *ref_17
      security:
        - bearer: []
      x-required-scopes:
        - chat:use
  /chat/{id}:
    get:
      operationId: ChatController_getConversation
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Get a conversation with messages
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
                    missing_scopes: &ref_18
                      - chat:use
        '404':
          description: Conversation not found
          content:
            application/json:
              schema:
                example:
                  error:
                    code: not-found
                    message: Conversation not found
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_17
      security:
        - bearer: []
      x-required-scopes: *ref_18
    patch:
      operationId: ChatController_rename
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Rename conversation
          content:
            application/json:
              schema:
                example:
                  ok: true
                  id: c1
                  title: New Title
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: title required
        '404':
          description: Conversation not found
          content:
            application/json:
              schema:
                example:
                  error:
                    code: not-found
                    message: Conversation not found
      tags: *ref_17
      security:
        - bearer: []
      x-required-scopes:
        - chat:admin
    delete:
      operationId: ChatController_delete
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Delete conversation
          content:
            application/json:
              schema:
                example:
                  ok: true
                  id: c1
        '404':
          description: Conversation not found
          content:
            application/json:
              schema:
                example:
                  error:
                    code: not-found
                    message: Conversation not found
      tags: *ref_17
      security:
        - bearer: []
      x-required-scopes:
        - chat:admin
  /chat/{id}/stream:
    get:
      operationId: ChatController_streamGet
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: 'Chat streaming endpoint (SSE). Emits a sequence of JSON frames each prefixed by "data: ".'
          content:
            text/event-stream:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/GetChatStreamMetaFrame'
                  - $ref: '#/components/schemas/GetChatStreamTokenFrame'
                  - $ref: '#/components/schemas/GetChatStreamCitationsFrame'
                  - $ref: '#/components/schemas/GetChatStreamSummaryFrame'
                  - $ref: '#/components/schemas/GetChatStreamDoneFrame'
                  - $ref: '#/components/schemas/GetChatStreamErrorFrame'
              examples:
                meta:
                  value: |+
                    data: {"meta":{"chat_model_enabled":true,"google_key":true}}

                token:
                  value: |+
                    data: {"message":"token-0","index":0,"streaming":true}

                citations:
                  value: |+
                    data: {"citations":[{"documentId":"11111111-1111-4111-8111-111111111111"}]}

                summary:
                  value: |+
                    data: {"summary":true,"token_count":5,"citations_count":2}

                done:
                  value: |+
                    data: {"done":true,"message":"[DONE]"}

                error:
                  value: |+
                    data: {"error":{"code":"upstream-failed","message":"Simulated upstream model failure"},"done":true}

        '400':
          description: Missing project header
          content:
            text/event-stream:
              schema:
                example:
                  error:
                    code: bad-request
                    message: x-project-id header required
        '404':
          description: Conversation not found
          content:
            text/event-stream:
              schema:
                example:
                  error:
                    code: not-found
                    message: Conversation not found
      tags: *ref_17
      security:
        - bearer: []
      x-required-scopes:
        - chat:use
  /chat/stream:
    post:
      operationId: ChatController_streamPost
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChatRequestDto'
      responses:
        '200':
          description: >-
            Chat streaming endpoint (SSE). Each line is an SSE data frame beginning with "data: ", followed by one of
            the JSON event shapes.
          content:
            text/event-stream:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/ChatStreamMetaEvent'
                  - $ref: '#/components/schemas/ChatStreamTokenEvent'
                  - $ref: '#/components/schemas/ChatStreamErrorEvent'
                  - $ref: '#/components/schemas/ChatStreamDoneEvent'
                description: Union of possible chat stream events (serialized per line as SSE frame).
              examples:
                meta:
                  value: |+
                    data: {"type":"meta","conversationId":"11111111-1111-4111-8111-111111111111","citations":[]}

                token:
                  value: |+
                    data: {"type":"token","token":"Hello"}

                error:
                  value: |+
                    data: {"type":"error","error":"model key missing"}

                done:
                  value: |+
                    data: {"type":"done"}

        '400':
          description: Bad request
          content:
            text/event-stream:
              schema:
                example:
                  error:
                    code: bad-request
                    message: message required
        '401':
          description: Unauthorized
          content:
            text/event-stream:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            text/event-stream:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
                    missing_scopes: &ref_19
                      - chat:use
        '500':
          description: Internal server error
          content:
            text/event-stream:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_17
      security:
        - bearer: []
      x-required-scopes: *ref_19
  /invites:
    post:
      operationId: InvitesController_create
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateInviteDto'
      responses:
        '201':
          description: ''
      security:
        - bearer: []
      x-required-scopes:
        - org:invite:create
        - project:invite:create
  /invites/accept:
    post:
      operationId: InvitesController_accept
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AcceptInviteDto'
      responses:
        '201':
          description: ''
      security:
        - bearer: []
      x-required-scopes:
        - org:read
  /user/profile:
    get:
      operationId: UserProfileController_getSelf
      parameters: []
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserProfileDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: &ref_20
        - UserProfile
    put:
      operationId: UserProfileController_updateSelf
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateUserProfileDto'
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserProfileDto'
        '400':
          description: Validation error
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_20
  /user/profile/emails:
    get:
      operationId: UserProfileController_listEmails
      parameters: []
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AlternativeEmailDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_20
    post:
      operationId: UserProfileController_addEmail
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddAlternativeEmailDto'
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AlternativeEmailDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_20
  /user/profile/emails/{email}:
    delete:
      operationId: UserProfileController_removeEmail
      parameters:
        - name: email
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                example:
                  status: deleted
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_20
  /graph/objects:
    post:
      operationId: GraphObjectsController_create
      summary: Create a graph object (initial version)
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateGraphObjectDto'
      responses:
        '201':
          description: Created
        '400':
          description: Validation error
      tags: &ref_21
        - Graph
      security:
        - bearer: []
      x-required-scopes:
        - graph:write
  /graph/objects/search:
    get:
      operationId: GraphObjectsController_searchObjects
      summary: Search graph objects (basic filters)
      parameters:
        - name: type
          required: true
          in: query
          schema:
            type: string
        - name: key
          required: true
          in: query
          schema:
            type: string
        - name: label
          required: true
          in: query
          schema:
            type: string
        - name: limit
          required: true
          in: query
          schema:
            type: string
        - name: cursor
          required: true
          in: query
          schema:
            type: string
      responses:
        '200':
          description: ''
      tags: *ref_21
      security:
        - bearer: []
      x-required-scopes:
        - graph:read
  /graph/objects/{id}:
    get:
      operationId: GraphObjectsController_get
      summary: Get latest version of a graph object
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: ''
        '404':
          description: Not found
      tags: *ref_21
      security:
        - bearer: []
      x-required-scopes:
        - graph:read
    patch:
      operationId: GraphObjectsController_patch
      summary: Patch (create new version) of a graph object
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PatchGraphObjectDto'
      responses:
        '200':
          description: Version created
        '400':
          description: No effective change
        '404':
          description: Not found
      tags: *ref_21
      security:
        - bearer: []
      x-required-scopes:
        - graph:write
    delete:
      operationId: GraphObjectsController_deleteObject
      summary: Soft delete (tombstone) an object (creates new version with deleted_at)
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: ''
      tags: *ref_21
      security:
        - bearer: []
      x-required-scopes:
        - graph:write
  /graph/objects/{id}/restore:
    post:
      operationId: GraphObjectsController_restoreObject
      summary: Restore a soft-deleted object (creates new version clearing deleted_at)
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '201':
          description: Restored (new version created)
      tags: *ref_21
      security:
        - bearer: []
      x-required-scopes:
        - graph:write
  /graph/objects/{id}/history:
    get:
      operationId: GraphObjectsController_history
      summary: List version history for a graph object
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
        - name: limit
          required: true
          in: query
          schema:
            type: string
        - name: cursor
          required: true
          in: query
          schema:
            type: string
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ObjectHistoryResponseDto'
        '404':
          description: Not found
      tags: *ref_21
      security:
        - bearer: []
      x-required-scopes:
        - graph:read
  /graph/relationships:
    post:
      operationId: GraphObjectsController_createRel
      summary: Create a relationship (initial version) or new version if properties changed
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateGraphRelationshipDto'
      responses:
        '201':
          description: ''
      tags: *ref_21
      security:
        - bearer: []
      x-required-scopes:
        - graph:write
  /graph/relationships/{id}:
    get:
      operationId: GraphObjectsController_getRel
      summary: Get relationship by id
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: ''
      tags: *ref_21
      security:
        - bearer: []
      x-required-scopes:
        - graph:read
    patch:
      operationId: GraphObjectsController_patchRel
      summary: Patch (create new version) of a relationship (only head version allowed)
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PatchGraphRelationshipDto'
      responses:
        '200':
          description: ''
      tags: *ref_21
      security:
        - bearer: []
      x-required-scopes:
        - graph:write
    delete:
      operationId: GraphObjectsController_deleteRel
      summary: Soft delete a relationship (tombstone version)
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: ''
      tags: *ref_21
      security:
        - bearer: []
      x-required-scopes:
        - graph:write
  /graph/relationships/search:
    get:
      operationId: GraphObjectsController_searchRels
      summary: Search relationships (basic filters)
      parameters:
        - name: type
          required: true
          in: query
          schema:
            type: string
        - name: src_id
          required: true
          in: query
          schema:
            type: string
        - name: dst_id
          required: true
          in: query
          schema:
            type: string
        - name: limit
          required: true
          in: query
          schema:
            type: string
        - name: cursor
          required: true
          in: query
          schema:
            type: string
      responses:
        '200':
          description: ''
      tags: *ref_21
      security:
        - bearer: []
      x-required-scopes:
        - graph:read
  /graph/relationships/{id}/restore:
    post:
      operationId: GraphObjectsController_restoreRel
      summary: Restore a soft-deleted relationship
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '201':
          description: Restored (new version created)
      tags: *ref_21
      security:
        - bearer: []
      x-required-scopes:
        - graph:write
  /graph/relationships/{id}/history:
    get:
      operationId: GraphObjectsController_historyRel
      summary: List version history for a relationship
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
        - name: limit
          required: true
          in: query
          schema:
            type: string
        - name: cursor
          required: true
          in: query
          schema:
            type: string
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RelationshipHistoryResponseDto'
      tags: *ref_21
      security:
        - bearer: []
      x-required-scopes:
        - graph:read
  /graph/objects/{id}/edges:
    get:
      operationId: GraphObjectsController_edges
      summary: List relationships adjacent to an object
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
        - name: direction
          required: true
          in: query
          schema:
            type: string
        - name: limit
          required: true
          in: query
          schema:
            type: string
      responses:
        '200':
          description: ''
      tags: *ref_21
      security:
        - bearer: []
      x-required-scopes:
        - graph:read
  /graph/traverse:
    post:
      operationId: GraphObjectsController_traverse
      summary: Traverse the graph from one or more root object ids (bounded BFS)
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TraverseGraphDto'
      responses:
        '200':
          description: ''
      tags: *ref_21
      security:
        - bearer: []
      x-required-scopes:
        - graph:read
info:
  title: Spec Server API
  description: >-
    Generated OpenAPI spec (code-first). All protected operations include x-required-scopes and 403 examples with
    missing_scopes.
  version: 0.2.0
  contact: {}
tags: []
servers: []
components:
  securitySchemes:
    bearer:
      scheme: bearer
      bearerFormat: JWT
      type: http
  schemas:
    OrgDto:
      type: object
      properties:
        id:
          type: string
          example: org_1
        name:
          type: string
          example: Example Org
      required:
        - id
        - name
    CreateOrgDto:
      type: object
      properties: {}
    ProjectDto:
      type: object
      properties:
        id:
          type: string
          example: proj_1
        name:
          type: string
          example: Demo Project
        orgId:
          type: string
          example: org_1
      required:
        - id
        - name
        - orgId
    CreateProjectDto:
      type: object
      properties:
        name:
          type: string
          example: My Project
          description: Project name (unique per organization, case-insensitive)
        orgId:
          type: string
          description: Organization UUID (must belong to caller; no implicit default org)
      required:
        - name
        - orgId
    SearchResultDto:
      type: object
      properties:
        id:
          type: string
          example: mock-1
        snippet:
          type: string
          example: Result snippet for "foo" (#1, mode=hybrid)
        score:
          type: number
          example: 0.98
        source:
          type: string
          example: source.doc#L10
      required:
        - id
        - snippet
        - score
    SearchResponseDto:
      type: object
      properties:
        mode:
          type: string
          enum:
            - hybrid
            - lexical
            - vector
        results:
          type: array
          items:
            $ref: '#/components/schemas/SearchResultDto'
        warning:
          type: string
          example: Embeddings unavailable; fell back to lexical.
      required:
        - mode
        - results
    DocumentDto:
      type: object
      properties:
        id:
          type: string
          example: doc_1
        orgId:
          type: string
          example: 11111111-2222-3333-4444-555555555555
          nullable: true
        projectId:
          type: string
          example: aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee
          nullable: true
        name:
          type: string
          example: Spec.md
        sourceUrl:
          type: object
          nullable: true
          example: https://example.com/file.pdf
        mimeType:
          type: object
          nullable: true
          example: text/markdown
        createdAt:
          type: string
          example: '2025-01-01T00:00:00.000Z'
        updatedAt:
          type: string
          example: '2025-01-01T00:05:00.000Z'
        chunks:
          type: number
          example: 12
          description: Number of chunks associated with this document
      required:
        - id
        - name
        - createdAt
        - updatedAt
        - chunks
    ChunkDto:
      type: object
      properties:
        id:
          type: string
          example: chunk_1
        documentId:
          type: string
          example: doc_1
        documentTitle:
          type: string
          example: User Guide.pdf
          description: Best-effort document title derived from filename or source URL
        index:
          type: number
          example: 0
          description: Zero-based index of chunk inside the document
        size:
          type: number
          example: 512
          description: Size in characters
        hasEmbedding:
          type: boolean
          example: true
          description: Whether an embedding vector exists for this chunk
        text:
          type: string
          example: This is the chunk text...
          description: Plaintext content of the chunk (may be truncated client-side)
      required:
        - id
        - documentId
        - documentTitle
        - index
        - size
        - hasEmbedding
        - text
    IngestionUploadDto:
      type: object
      properties:
        filename:
          type: string
          description: Original filename (optional, will fallback to uploaded file name)
          example: spec.md
        mimeType:
          type: string
          description: Optional MIME type
          example: text/markdown
        orgId:
          type: string
          description: Optional organisation UUID to associate the document with
          example: 11111111-2222-3333-4444-555555555555
        projectId:
          type: string
          description: Project UUID that this document belongs to (required)
          example: aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee
      required:
        - projectId
    IngestionUrlDto:
      type: object
      properties:
        url:
          type: string
          description: Remote URL to ingest
          example: https://example.com/spec.md
        orgId:
          type: string
          description: Optional organisation UUID to associate the document with
          example: 11111111-2222-3333-4444-555555555555
        projectId:
          type: string
          description: Project UUID that this document belongs to (required)
          example: aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee
      required:
        - url
        - projectId
    ChatRequestDto:
      type: object
      properties: {}
    CitationDto:
      type: object
      properties: {}
    ChatStreamMetaEvent:
      type: object
      properties: {}
    ChatStreamTokenEvent:
      type: object
      properties: {}
    ChatStreamErrorEvent:
      type: object
      properties: {}
    ChatStreamDoneEvent:
      type: object
      properties: {}
    GetChatStreamMetaFrame:
      type: object
      properties: {}
    GetChatStreamTokenFrame:
      type: object
      properties: {}
    GetChatStreamCitationsFrame:
      type: object
      properties: {}
    GetChatStreamSummaryFrame:
      type: object
      properties: {}
    GetChatStreamDoneFrame:
      type: object
      properties: {}
    GetChatStreamErrorFrame:
      type: object
      properties: {}
    CreateInviteDto:
      type: object
      properties: {}
    AcceptInviteDto:
      type: object
      properties: {}
    UserProfileDto:
      type: object
      properties:
        subjectId:
          type: string
          description: Canonical internal user id (subject id, from identity provider)
          format: uuid
        firstName:
          type: object
        lastName:
          type: object
        displayName:
          type: object
          description: Display name fallback (explicit) or derived (first + last)
        phoneE164:
          type: object
          description: E.164 formatted phone number, leading + and digits
        avatarObjectKey:
          type: object
          description: Object storage key for avatar (if stored internally)
      required:
        - subjectId
    UpdateUserProfileDto:
      type: object
      properties: {}
    AlternativeEmailDto:
      type: object
      properties:
        email:
          type: string
          description: Email address (lowercased canonical form)
        verified:
          type: boolean
          description: Verification status
        createdAt:
          type: string
          description: ISO timestamp created
      required:
        - email
        - verified
        - createdAt
    AddAlternativeEmailDto:
      type: object
      properties: {}
    CreateGraphObjectDto:
      type: object
      properties: {}
    PatchGraphObjectDto:
      type: object
      properties: {}
    VersionedObjectDto:
      type: object
      properties:
        id:
          type: string
        org_id:
          type: object
          nullable: true
        project_id:
          type: object
          nullable: true
        canonical_id:
          type: string
        supersedes_id:
          type: object
          nullable: true
        version:
          type: number
        type:
          type: string
        key:
          type: object
          nullable: true
        properties:
          type: object
        labels:
          type: array
          items:
            type: string
        created_at:
          type: string
      required:
        - id
        - org_id
        - project_id
        - canonical_id
        - supersedes_id
        - version
        - type
        - key
        - properties
        - labels
        - created_at
    ObjectHistoryResponseDto:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/VersionedObjectDto'
        next_cursor:
          type: string
          description: Present when more pages available; pass as cursor query param
      required:
        - items
    CreateGraphRelationshipDto:
      type: object
      properties: {}
    PatchGraphRelationshipDto:
      type: object
      properties: {}
    VersionedRelationshipDto:
      type: object
      properties:
        id:
          type: string
        canonical_id:
          type: string
        supersedes_id:
          type: object
          nullable: true
        version:
          type: number
        type:
          type: string
        src_id:
          type: string
        dst_id:
          type: string
        properties:
          type: object
        created_at:
          type: string
        weight:
          type: object
          nullable: true
        valid_from:
          type: object
          nullable: true
        valid_to:
          type: object
          nullable: true
      required:
        - id
        - canonical_id
        - supersedes_id
        - version
        - type
        - src_id
        - dst_id
        - properties
        - created_at
        - weight
        - valid_from
        - valid_to
    RelationshipHistoryResponseDto:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/VersionedRelationshipDto'
        next_cursor:
          type: string
          description: Present when more pages available; pass as cursor query param
      required:
        - items
    TraverseGraphDto:
      type: object
      properties: {}
x-tagGroups:
  - name: Health & Auth
    tags:
      - Health
      - Auth
  - name: Organizations & Projects
    tags:
      - Orgs
      - Projects
  - name: Configuration
    tags:
      - Settings
  - name: Content & Ingestion
    tags:
      - Ingestion
      - Documents
      - Chunks
  - name: Search
    tags:
      - Search
  - name: Chat
    tags:
      - Chat
  - name: Knowledge Graph
    tags:
      - Graph
