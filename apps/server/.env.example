# =============================================================================
# SERVER .ENV - SERVER APPLICATION CONFIGURATION
# =============================================================================
#
# This file contains SAFE DEFAULTS for the NestJS server application.
# It is COMMITTED to the repository and should NOT contain secrets.
#
# ORGANIZATION:
# - apps/server/.env       → Server defaults (THIS FILE)
# - apps/server/.env.local → User overrides & secrets (GITIGNORED)
# - Root .env              → Workspace/shared variables
#
# LOADING PRECEDENCE:
# apps/server/.env.local > apps/server/.env > root .env.local > root .env
#
# SECRETS POLICY:
# - Keep real API keys/credentials in apps/server/.env.local
# - This file contains only safe defaults and placeholders
# =============================================================================

# -----------------------------------------------------------------------------
# Core Server Configuration
# -----------------------------------------------------------------------------
PORT=3002
NODE_ENV=development

# CORS Configuration
CORS_ORIGIN=http://localhost:5176

# -----------------------------------------------------------------------------
# Database Configuration (PostgreSQL)
# -----------------------------------------------------------------------------
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_USER=spec
POSTGRES_PASSWORD=spec
POSTGRES_DB=spec

# Database Behavior
DB_AUTOINIT=true
# SKIP_DB=1  # Uncomment to skip DB init (for builds/tests)
# SKIP_MIGRATIONS=1  # Uncomment to skip migrations

# E2E Testing
POSTGRES_DB_E2E=spec_e2e

# Row-Level Security (RLS)
# APP_RLS_PASSWORD=  # Set in .env.local if using RLS bypass
RLS_POLICY_STRICT=false

# -----------------------------------------------------------------------------
# Authentication & Authorization (Zitadel)
# -----------------------------------------------------------------------------
# OIDC Configuration
ZITADEL_ISSUER=http://localhost:8080

# Service Account Keys (PLACE REAL KEYS IN .env.local)
# ZITADEL_CLIENT_JWT=  # Service account JWT content
# ZITADEL_CLIENT_JWT_PATH=  # Or path to JWT file
# ZITADEL_API_JWT=  # API service account JWT content
# ZITADEL_API_JWT_PATH=  # Or path to JWT file

# Organization
# ZITADEL_MAIN_ORG_ID=  # Set in .env.local after bootstrap

# Development Only
SCOPES_DISABLED=0  # Set to 1 to bypass scope enforcement (dev only)
# DEBUG_AUTH_SCOPES=1  # Uncomment to debug auth scopes
# DEBUG_AUTH_CLAIMS=1  # Uncomment to debug auth claims
# DEBUG_TENANT=1  # Uncomment to debug tenant resolution

# -----------------------------------------------------------------------------
# Google Cloud Platform (GCP)
# -----------------------------------------------------------------------------
# Project Configuration
GCP_PROJECT_ID=spec-server

# API Keys (PLACE REAL KEYS IN .env.local)
# GOOGLE_API_KEY=  # Your Gemini API key from https://makersuite.google.com/app/apikey
# GOOGLE_APPLICATION_CREDENTIALS=  # Path to GCP credentials JSON

# Google OAuth (for integration scripts)
GOOGLE_REDIRECT_URL=http://localhost:3003/oauth/callback

# -----------------------------------------------------------------------------
# AI & LLM Configuration (Vertex AI / Gemini)
# -----------------------------------------------------------------------------
# Vertex AI
VERTEX_AI_LOCATION=us-central1
VERTEX_AI_MODEL=gemini-2.5-flash

# Embeddings
VERTEX_EMBEDDING_LOCATION=us-central1
VERTEX_EMBEDDING_MODEL=text-embedding-004
# VERTEX_EMBEDDING_PROJECT=  # Defaults to GCP_PROJECT_ID
EMBEDDING_PROVIDER=vertex
EMBEDDING_DIMENSION=1536
EMBEDDINGS_NETWORK_DISABLED=false

# Chat Model
CHAT_MODEL_ENABLED=true
# CHAT_SYSTEM_PROMPT=  # Optional custom system prompt

# -----------------------------------------------------------------------------
# Extraction Worker Configuration
# -----------------------------------------------------------------------------
# Worker Behavior
EXTRACTION_WORKER_ENABLED=false
EXTRACTION_WORKER_POLL_INTERVAL_MS=5000
EXTRACTION_WORKER_BATCH_SIZE=5

# Rate Limiting
EXTRACTION_RATE_LIMIT_RPM=60
EXTRACTION_RATE_LIMIT_TPM=30000

# Entity Linking Strategy
# Options: always_new | key_match | vector_similarity | user_review
EXTRACTION_ENTITY_LINKING_STRATEGY=always_new

# Confidence Thresholds (0.0-1.0)
EXTRACTION_CONFIDENCE_THRESHOLD_MIN=0.0
EXTRACTION_CONFIDENCE_THRESHOLD_REVIEW=0.7
EXTRACTION_CONFIDENCE_THRESHOLD_AUTO=0.85

# Template Pack
# EXTRACTION_DEFAULT_TEMPLATE_PACK_ID=  # UUID of default template pack

# Chunking Configuration
EXTRACTION_CHUNK_SIZE=100000
EXTRACTION_CHUNK_OVERLAP=2000

# Custom Prompts
# EXTRACTION_BASE_PROMPT=  # Optional base prompt override

# -----------------------------------------------------------------------------
# Observability (LangSmith)
# -----------------------------------------------------------------------------
# LangSmith Tracing (PLACE API KEY IN .env.local)
LANGSMITH_TRACING=false
# LANGSMITH_ENDPOINT=  # EU: https://eu.api.smith.langchain.com
# LANGSMITH_API_KEY=  # Format: lsv2_pt_...
# LANGSMITH_PROJECT=  # Project name

# LangChain (legacy)
# LANGCHAIN_TRACING_V2=  # Set to "true" to enable
# LANGCHAIN_ENDPOINT=
# LANGCHAIN_API_KEY=
# LANGCHAIN_PROJECT=

# -----------------------------------------------------------------------------
# Seeding & Testing
# -----------------------------------------------------------------------------
# Demo Data
ORGS_DEMO_SEED=false

# Bible Test Dataset
BIBLE_SEED_API_URL=http://localhost:3000
# BIBLE_SEED_ACCESS_TOKEN=  # Set in .env.local if needed
BIBLE_SEED_RATE_LIMIT_MS=100

# -----------------------------------------------------------------------------
# Logging & Debugging
# -----------------------------------------------------------------------------
# LOG_DIR=  # Custom log directory
# HTTP_LOG_PATH=  # Path for HTTP access logs
# ERROR_LOG_INCLUDE_STACK=1  # Include stack traces in errors

# Audit Logging
# AUDIT_INTERCEPTOR_ENABLED=1
# AUDIT_CONSOLE_LOGGING=1
# AUDIT_DATABASE_LOGGING=1

# Cache
# CACHE_CLEANUP_INTERVAL=  # Interval for cache cleanup

# -----------------------------------------------------------------------------
# NOTES
# -----------------------------------------------------------------------------
#
# WORKSPACE VARIABLES: See root .env.example
# - NAMESPACE, ports, test users
#
# ADMIN VARIABLES: See apps/admin/.env.example
# - Frontend configuration (VITE_*)
#
# USER SECRETS: Create apps/server/.env.local for real credentials
# Example apps/server/.env.local:
#   GOOGLE_API_KEY=AIza...
#   POSTGRES_PASSWORD=my-secure-password
#   ZITADEL_CLIENT_JWT=eyJhbGc...
#   LANGSMITH_API_KEY=lsv2_pt_...
#
