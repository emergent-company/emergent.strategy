openapi: 3.0.0
paths:
  /health:
    get:
      operationId: get
      parameters: []
      responses:
        '200':
          description: Health probe
          content:
            application/json:
              schema:
                example:
                  ok: true
                  model: text-embedding-004
                  db: up
                  embeddings: enabled
                  rls_policies_ok: true
                  rls_policy_count: 8
                  rls_policy_hash: policies:123:1a2b
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags:
        - Health
  /auth/me:
    get:
      operationId: me
      parameters: []
      responses:
        '200':
          description: Return current authenticated user
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserProfileDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Missing or invalid bearer token
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Unauthorized
        '403':
          description: Insufficient scope
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Forbidden
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: &ref_0
        - Auth
      security:
        - bearer: []
  /auth/test-passport:
    get:
      operationId: testPassport
      parameters: []
      responses:
        '200':
          description: Test passport-zitadel introspection
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Missing or invalid bearer token
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_0
      security:
        - bearer: []
  /user/profile:
    get:
      operationId: getSelf
      parameters: []
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserProfileDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: &ref_1
        - UserProfile
    put:
      operationId: updateSelf
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateUserProfileDto'
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserProfileDto'
        '400':
          description: Validation error
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_1
  /user/profile/emails:
    get:
      operationId: listEmails
      parameters: []
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AlternativeEmailDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_1
    post:
      operationId: addEmail
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddAlternativeEmailDto'
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AlternativeEmailDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_1
  /user/profile/emails/{email}:
    delete:
      operationId: removeEmail
      parameters:
        - name: email
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                example:
                  status: deleted
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_1
  /settings:
    get:
      operationId: list
      parameters: []
      responses:
        '200':
          description: List all settings
          content:
            application/json:
              schema:
                example:
                  - key: theme
                    value: dark
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: &ref_2
        - Settings
  /settings/{key}:
    get:
      operationId: getOne
      parameters:
        - name: key
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Get a single setting
          content:
            application/json:
              schema:
                example:
                  key: theme
                  value: dark
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '404':
          description: Setting not found
          content:
            application/json:
              schema:
                example:
                  error:
                    code: not-found
                    message: Setting not found
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_2
    put:
      operationId: update
      parameters:
        - name: key
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              example:
                value: dark
      responses:
        '200':
          description: Update or create a setting
          content:
            application/json:
              schema:
                example:
                  key: theme
                  value: dark
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_2
  /orgs:
    get:
      operationId: list
      parameters: []
      responses:
        '200':
          description: List organizations
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/OrgDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid filter
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: &ref_3
        - Orgs
    post:
      operationId: create
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateOrgDto'
      responses:
        '201':
          description: Organization created (users may have at most 10 orgs)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrgDto'
        '400':
          description: Invalid body
          content:
            application/json:
              schema:
                example:
                  error:
                    code: validation-failed
                    message: Validation failed
                    details:
                      name:
                        - must be a string
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '409':
          description: Organization limit reached or duplicate name
          content:
            application/json:
              schema:
                oneOf:
                  - example:
                      error:
                        code: conflict
                        message: Organization limit reached (10)
                  - example:
                      error:
                        code: conflict
                        message: Organization name already exists
                        details:
                          name:
                            - already exists
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_3
  /orgs/{id}:
    get:
      operationId: getOne
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Get an organization
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrgDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '404':
          description: Org not found
          content:
            application/json:
              schema:
                example:
                  error:
                    code: not-found
                    message: Org not found
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_3
    delete:
      operationId: delete
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: >-
            Organization deleted (projects, documents, chunks, conversations
            cascade)
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '404':
          description: Org not found
          content:
            application/json:
              schema:
                example:
                  error:
                    code: not-found
                    message: Org not found
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_3
  /projects:
    get:
      operationId: list
      parameters:
        - name: limit
          required: true
          in: query
          schema:
            type: string
        - name: orgId
          required: false
          in: query
          description: >-
            Filter projects by organization id (must be explicit elsewhere when
            creating projects)
          schema:
            type: string
      responses:
        '200':
          description: List projects (must create at least one before ingesting documents)
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ProjectDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid filter
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: &ref_4
        - Projects
    post:
      operationId: create
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateProjectDto'
      responses:
        '201':
          description: Project created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProjectDto'
        '400':
          description: Validation / duplicate / org errors
          content:
            application/json:
              schema:
                example:
                  error:
                    code: duplicate
                    message: Project with this name exists in org
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_4
  /projects/{id}:
    get:
      operationId: getById
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Get project by ID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProjectDto'
        '400':
          description: Invalid id
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid id
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_4
    patch:
      operationId: update
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateProjectDto'
      responses:
        '200':
          description: Project updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProjectDto'
        '400':
          description: Invalid id or validation error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid id
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_4
    delete:
      operationId: delete
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Deleted project
          content:
            application/json:
              schema:
                example:
                  status: deleted
        '400':
          description: Invalid id
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid id
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_4
  /template-packs:
    post:
      operationId: createTemplatePack
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTemplatePackDto'
      responses:
        '201':
          description: ''
    get:
      operationId: listTemplatePacks
      parameters: []
      responses:
        '200':
          description: ''
  /template-packs/{id}:
    get:
      operationId: getTemplatePack
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: ''
    delete:
      operationId: deleteTemplatePack
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '204':
          description: ''
  /template-packs/projects/{projectId}/available:
    get:
      operationId: getAvailableTemplates
      parameters:
        - name: projectId
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: ''
  /template-packs/projects/{projectId}/compiled-types:
    get:
      operationId: getCompiledObjectTypes
      parameters:
        - name: projectId
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: ''
  /template-packs/projects/{projectId}/installed:
    get:
      operationId: getInstalledTemplatePacks
      parameters:
        - name: projectId
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: ''
  /template-packs/projects/{projectId}/assign:
    post:
      operationId: assignTemplatePack
      parameters:
        - name: projectId
          required: true
          in: path
          schema:
            type: string
        - name: org_id
          required: true
          in: query
          schema:
            type: string
        - name: user_id
          required: true
          in: query
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AssignTemplatePackDto'
      responses:
        '201':
          description: ''
  /template-packs/projects/{projectId}/assignments/{assignmentId}:
    patch:
      operationId: updateTemplatePackAssignment
      parameters:
        - name: projectId
          required: true
          in: path
          schema:
            type: string
        - name: assignmentId
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTemplatePackAssignmentDto'
      responses:
        '200':
          description: ''
    delete:
      operationId: uninstallTemplatePack
      parameters:
        - name: projectId
          required: true
          in: path
          schema:
            type: string
        - name: assignmentId
          required: true
          in: path
          schema:
            type: string
      responses:
        '204':
          description: ''
  /search:
    get:
      operationId: search
      parameters:
        - name: q
          required: true
          in: query
          description: Query string
          schema:
            example: vector index design
            type: string
        - name: limit
          required: false
          in: query
          description: Result limit (1..50)
          schema:
            minimum: 1
            maximum: 50
            default: 10
            type: number
        - name: mode
          required: false
          in: query
          schema:
            default: hybrid
            enum:
              - hybrid
              - lexical
              - vector
            type: string
        - name: lexicalWeight
          required: false
          in: query
          description: >-
            Lexical weight for hybrid search (0-1). Only used when mode=hybrid.
            Weights are normalized to sum to 1.
          schema:
            minimum: 0
            maximum: 1
            default: 0.5
            example: 0.7
            type: number
        - name: vectorWeight
          required: false
          in: query
          description: >-
            Vector weight for hybrid search (0-1). Only used when mode=hybrid.
            Weights are normalized to sum to 1.
          schema:
            minimum: 0
            maximum: 1
            default: 0.5
            example: 0.3
            type: number
        - name: includePaths
          required: false
          in: query
          description: >-
            Include path summaries showing how results relate to other objects
            in the knowledge graph
          schema:
            default: false
            type: boolean
      responses:
        '200':
          description: Hybrid / lexical / vector search over chunks
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SearchResponseDto'
        '400':
          description: Validation failed
          content:
            application/json:
              schema:
                example:
                  error:
                    code: validation-failed
                    message: Validation failed
                    details:
                      q:
                        - must be longer than or equal to 1 characters
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags:
        - Search
  /documents:
    get:
      operationId: list
      parameters:
        - name: limit
          required: false
          in: query
          schema:
            type: number
            minimum: 1
            maximum: 500
            default: 100
        - name: cursor
          required: true
          in: query
          schema:
            type: string
      responses:
        '200':
          description: List ingested documents
          headers:
            x-next-cursor:
              description: Base64 cursor for next page
              schema:
                type: string
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DocumentDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid filter
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: &ref_5
        - Documents
    post:
      operationId: create
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              properties:
                filename:
                  type: string
                projectId:
                  type: string
                  format: uuid
                content:
                  type: string
      responses:
        '200':
          description: Created document
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DocumentDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_5
    delete:
      operationId: bulkDelete
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BulkDeleteRequestDto'
      responses:
        '200':
          description: Bulk delete documents with cascade
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BulkDeletionSummaryDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_5
  /documents/{id}:
    get:
      operationId: get
      parameters:
        - name: id
          required: true
          in: path
          description: Document UUID
          schema:
            type: string
      responses:
        '200':
          description: Get a document
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DocumentDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid id
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_5
    delete:
      operationId: delete
      parameters:
        - name: id
          required: true
          in: path
          description: Document UUID
          schema:
            type: string
      responses:
        '200':
          description: Delete a document with cascade
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeletionSummaryDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_5
  /documents/{id}/deletion-impact:
    get:
      operationId: getDeletionImpact
      parameters:
        - name: id
          required: true
          in: path
          description: Document UUID
          schema:
            type: string
      responses:
        '200':
          description: Get deletion impact analysis for a document
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeletionImpactDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_5
  /documents/deletion-impact:
    post:
      operationId: getBulkDeletionImpact
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BulkDeleteRequestDto'
      responses:
        '200':
          description: Get bulk deletion impact analysis
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BulkDeletionImpactDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_5
  /chunks:
    get:
      operationId: list
      parameters:
        - name: documentId
          required: false
          in: query
          description: Filter by document UUID
          schema:
            type: string
      responses:
        '200':
          description: List chunks
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ChunkDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid filter
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags:
        - Chunks
  /ingest/upload:
    post:
      operationId: upload
      parameters: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/IngestionUploadDto'
      responses:
        '200':
          description: Upload a file for ingestion
          content:
            application/json:
              schema:
                example:
                  documentId: 11111111-2222-3333-4444-555555555555
                  chunks: 12
                  alreadyExists: false
        '400':
          description: Invalid upload payload
          content:
            application/json:
              schema:
                example:
                  error:
                    code: validation-failed
                    message: Validation failed
                    details:
                      filename:
                        - must be a string
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: &ref_6
        - Ingestion
  /ingest/url:
    post:
      operationId: ingestUrl
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IngestionUrlDto'
      responses:
        '200':
          description: Ingest a remote URL
          content:
            application/json:
              schema:
                example:
                  documentId: aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee
                  chunks: 8
                  alreadyExists: false
        '400':
          description: Invalid URL payload
          content:
            application/json:
              schema:
                example:
                  error:
                    code: validation-failed
                    message: Validation failed
                    details:
                      url:
                        - must be an URL address
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_6
  /admin/extraction-jobs:
    post:
      operationId: createJob
      summary: Create extraction job
      description: >-
        Creates a new extraction job with pending status. Phase 2 will enqueue
        to worker queue.
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateExtractionJobDto'
      responses:
        '201':
          description: Job created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExtractionJobDto'
        '400':
          description: Invalid request data
        '401':
          description: Unauthorized
      tags: &ref_7
        - Extraction Jobs
      security: &ref_8
        - bearer: []
  /admin/extraction-jobs/projects/{projectId}:
    get:
      operationId: listJobs
      summary: List extraction jobs
      description: List extraction jobs for a project with optional filters and pagination
      parameters:
        - name: projectId
          required: true
          in: path
          description: Project ID
          schema:
            type: string
        - name: status
          required: false
          in: query
          description: Filter by status
          schema:
            enum:
              - pending
              - running
              - completed
              - requires_review
              - failed
              - cancelled
            type: string
        - name: source_type
          required: false
          in: query
          description: Filter by source type
          schema:
            enum:
              - document
              - api
              - manual
              - bulk_import
            type: string
        - name: source_id
          required: false
          in: query
          description: Filter by source ID
          schema:
            type: string
        - name: page
          required: false
          in: query
          description: Page number (1-indexed)
          schema:
            minimum: 1
            default: 1
            type: number
        - name: limit
          required: false
          in: query
          description: Items per page
          schema:
            minimum: 1
            default: 20
            type: number
      responses:
        '200':
          description: Jobs retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExtractionJobListDto'
        '401':
          description: Unauthorized
      tags: *ref_7
      security: *ref_8
  /admin/extraction-jobs/{jobId}:
    get:
      operationId: getJob
      summary: Get extraction job
      description: Get detailed information about a specific extraction job
      parameters:
        - name: jobId
          required: true
          in: path
          description: Job ID
          schema:
            type: string
      responses:
        '200':
          description: Job retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExtractionJobDto'
        '401':
          description: Unauthorized
        '404':
          description: Job not found
      tags: *ref_7
      security: *ref_8
    patch:
      operationId: updateJob
      summary: Update extraction job
      description: Update job status, progress, results, or errors
      parameters:
        - name: jobId
          required: true
          in: path
          description: Job ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateExtractionJobDto'
      responses:
        '200':
          description: Job updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExtractionJobDto'
        '400':
          description: Invalid update data
        '401':
          description: Unauthorized
        '404':
          description: Job not found
      tags: *ref_7
      security: *ref_8
    delete:
      operationId: deleteJob
      summary: Delete extraction job
      description: Delete a completed, failed, or cancelled extraction job
      parameters:
        - name: jobId
          required: true
          in: path
          description: Job ID
          schema:
            type: string
      responses:
        '204':
          description: Job deleted successfully
        '400':
          description: Cannot delete running/pending job
        '401':
          description: Unauthorized
        '404':
          description: Job not found
      tags: *ref_7
      security: *ref_8
  /admin/extraction-jobs/{jobId}/retry:
    post:
      operationId: retryJob
      summary: Retry a stuck or failed extraction job
      description: >-
        Resets a job stuck in running status or failed status back to pending
        for retry. Useful after server restarts that leave jobs orphaned.
      parameters:
        - name: jobId
          required: true
          in: path
          description: Job ID
          schema:
            type: string
      responses:
        '200':
          description: Job reset to pending for retry
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExtractionJobDto'
        '400':
          description: Cannot retry job with current status (only running/failed jobs)
        '401':
          description: Unauthorized
        '404':
          description: Job not found
      tags: *ref_7
      security: *ref_8
  /admin/extraction-jobs/{jobId}/cancel:
    post:
      operationId: cancelJob
      summary: Cancel extraction job
      description: Cancel a pending or running extraction job
      parameters:
        - name: jobId
          required: true
          in: path
          description: Job ID
          schema:
            type: string
      responses:
        '200':
          description: Job cancelled successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExtractionJobDto'
        '400':
          description: Job cannot be cancelled (already completed/failed)
        '401':
          description: Unauthorized
        '404':
          description: Job not found
      tags: *ref_7
      security: *ref_8
  /admin/extraction-jobs/projects/{projectId}/bulk-cancel:
    post:
      operationId: bulkCancelJobs
      summary: Cancel all pending/running jobs
      description: Bulk cancel all pending and running extraction jobs for a project
      parameters:
        - name: projectId
          required: true
          in: path
          description: Project ID
          schema:
            type: string
      responses:
        '200':
          description: Jobs cancelled successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  cancelled:
                    type: number
                    example: 5
                  message:
                    type: string
                    example: Cancelled 5 jobs
        '401':
          description: Unauthorized
      tags: *ref_7
      security: *ref_8
  /admin/extraction-jobs/projects/{projectId}/bulk-delete:
    delete:
      operationId: bulkDeleteJobs
      summary: Delete all completed/failed/cancelled jobs
      description: Bulk delete all extraction jobs that are completed, failed, or cancelled
      parameters:
        - name: projectId
          required: true
          in: path
          description: Project ID
          schema:
            type: string
      responses:
        '200':
          description: Jobs deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  deleted:
                    type: number
                    example: 10
                  message:
                    type: string
                    example: Deleted 10 jobs
        '401':
          description: Unauthorized
      tags: *ref_7
      security: *ref_8
  /admin/extraction-jobs/projects/{projectId}/bulk-retry:
    post:
      operationId: bulkRetryJobs
      summary: Retry all failed jobs
      description: Bulk retry all extraction jobs with failed status
      parameters:
        - name: projectId
          required: true
          in: path
          description: Project ID
          schema:
            type: string
      responses:
        '200':
          description: Jobs reset for retry successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  retried:
                    type: number
                    example: 3
                  message:
                    type: string
                    example: Retrying 3 jobs
        '401':
          description: Unauthorized
      tags: *ref_7
      security: *ref_8
  /admin/extraction-jobs/projects/{projectId}/statistics:
    get:
      operationId: getStatistics
      summary: Get job statistics
      description: Get aggregated statistics for extraction jobs in a project
      parameters:
        - name: projectId
          required: true
          in: path
          description: Project ID
          schema:
            type: string
      responses:
        '200':
          description: Statistics retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  total:
                    type: number
                    example: 150
                  by_status:
                    type: object
                    example:
                      pending: 5
                      running: 2
                      completed: 120
                      failed: 20
                      cancelled: 3
                  by_source_type:
                    type: object
                    example:
                      document: 100
                      api: 30
                      manual: 20
                  avg_duration_ms:
                    type: number
                    nullable: true
                    example: 45000
                  total_objects_created:
                    type: number
                    example: 5230
                  total_types_discovered:
                    type: number
                    example: 15
        '401':
          description: Unauthorized
      tags: *ref_7
      security: *ref_8
  /admin/extraction-jobs/_debug/available-models:
    get:
      operationId: listAvailableModels
      summary: List available Gemini models
      description: >-
        Query Google Gemini API to list all available models with their
        capabilities
      parameters: []
      responses:
        '200':
          description: Models retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  current_model:
                    type: string
                    example: gemini-1.5-flash-latest
                  available_models:
                    type: array
                    items:
                      type: object
                      properties:
                        name:
                          type: string
                          example: models/gemini-2.0-flash-exp
                        displayName:
                          type: string
                          example: Gemini 2.0 Flash
                        description:
                          type: string
                        supportedGenerationMethods:
                          type: array
                          items:
                            type: string
                        inputTokenLimit:
                          type: number
                        outputTokenLimit:
                          type: number
        '500':
          description: Failed to fetch models from API
      tags: *ref_7
      security: *ref_8
  /admin/extraction-jobs/{jobId}/logs:
    get:
      operationId: getExtractionLogs
      summary: Get detailed extraction logs
      description: >-
        Retrieve step-by-step logs for an extraction job including LLM
        interactions, errors, and performance metrics
      parameters:
        - name: jobId
          required: true
          in: path
          description: Extraction job UUID
          schema:
            type: string
      responses:
        '200':
          description: Logs retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  logs:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          format: uuid
                        logged_at:
                          type: string
                          format: date-time
                        step_index:
                          type: number
                        operation_type:
                          type: string
                          enum:
                            - llm_call
                            - chunk_processing
                            - object_creation
                            - relationship_creation
                            - suggestion_creation
                            - validation
                            - error
                        operation_name:
                          type: string
                          nullable: true
                        status:
                          type: string
                          enum:
                            - success
                            - error
                            - warning
                        input_data:
                          type: object
                          nullable: true
                        output_data:
                          type: object
                          nullable: true
                        error_message:
                          type: string
                          nullable: true
                        error_stack:
                          type: string
                          nullable: true
                        duration_ms:
                          type: number
                          nullable: true
                        tokens_used:
                          type: number
                          nullable: true
                        metadata:
                          type: object
                          nullable: true
                  summary:
                    type: object
                    properties:
                      totalSteps:
                        type: number
                      successSteps:
                        type: number
                      errorSteps:
                        type: number
                      warningSteps:
                        type: number
                      totalDurationMs:
                        type: number
                      totalTokensUsed:
                        type: number
                      operationCounts:
                        type: object
        '400':
          description: Invalid job ID format
        '403':
          description: Access denied to this extraction job
        '404':
          description: Extraction job not found
      tags: *ref_7
      security: *ref_8
  /graph/objects:
    post:
      operationId: create
      summary: Create a graph object (initial version)
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateGraphObjectDto'
      responses:
        '201':
          description: Created
        '400':
          description: Validation error
      tags: &ref_9
        - Graph
  /graph/objects/search:
    get:
      operationId: searchObjects
      summary: Search graph objects (basic filters)
      description: >-
        Supports pagination via created_at cursor. Optional order param
        (asc|desc) controls chronological direction (default asc). Desc returns
        newest first; cursor always set to last item created_at in current page.
      parameters:
        - name: type
          required: true
          in: query
          schema:
            type: string
        - name: key
          required: true
          in: query
          schema:
            type: string
        - name: label
          required: true
          in: query
          schema:
            type: string
        - name: limit
          required: true
          in: query
          schema:
            type: string
        - name: cursor
          required: true
          in: query
          schema:
            type: string
        - name: order
          required: false
          in: query
          description: >-
            Chronological direction (asc=oldestnewest, desc=newestoldest).
            Default asc.
          schema:
            enum:
              - asc
              - desc
            type: string
        - name: branch_id
          required: false
          in: query
          description: >-
            Filter objects by branch ID. Use "null" to search main branch
            (branch_id IS NULL). Omit to search all branches.
          schema:
            type: string
        - name: related_to_id
          required: false
          in: query
          description: Filter objects connected to this ID via any relationship.
          schema:
            type: string
        - name: ids
          required: false
          in: query
          description: Comma-separated list of object IDs to fetch.
          schema:
            type: string
      responses:
        '200':
          description: ''
      tags: *ref_9
  /graph/objects/fts:
    get:
      operationId: ftsSearch
      summary: Full-text search graph objects
      description: >-
        Websearch syntax over inline-populated tsvector (type, key, properties
        JSON). Returns newest heads ranked by ts_rank. Supports optional type,
        label, branch_id filters. Limit max 100.
      parameters:
        - name: q
          required: true
          in: query
          description: Search query (websearch syntax)
          schema:
            type: string
        - name: limit
          required: true
          in: query
          schema:
            type: string
        - name: type
          required: true
          in: query
          schema:
            type: string
        - name: label
          required: true
          in: query
          schema:
            type: string
        - name: branch_id
          required: true
          in: query
          schema:
            type: string
      responses:
        '200':
          description: ''
      tags: *ref_9
  /graph/objects/tags:
    get:
      operationId: getTags
      summary: Get all distinct tags from graph objects
      parameters: []
      responses:
        '200':
          description: List of distinct tags
          content:
            application/json:
              schema:
                type: array
                items:
                  type: string
      tags: *ref_9
  /graph/objects/{id}:
    get:
      operationId: get
      summary: Get latest version of a graph object
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: ''
        '404':
          description: Not found
      tags: *ref_9
    patch:
      operationId: patch
      summary: Patch (create new version) of a graph object
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PatchGraphObjectDto'
      responses:
        '200':
          description: Version created
        '400':
          description: No effective change
        '404':
          description: Not found
      tags: *ref_9
    delete:
      operationId: deleteObject
      summary: Soft delete (tombstone) an object (creates new version with deleted_at)
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: ''
      tags: *ref_9
  /graph/objects/bulk-update-status:
    post:
      operationId: bulkUpdateStatus
      summary: Update status for multiple objects
      description: >-
        Updates the status field for multiple objects in a single request.
        Creates a new version for each object. Returns summary of successes and
        failures.
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BulkUpdateStatusDto'
      responses:
        '200':
          description: Bulk update completed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: number
                    description: Number of successfully updated objects
                  failed:
                    type: number
                    description: Number of failed updates
                  results:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                        success:
                          type: boolean
                        error:
                          type: string
      tags: *ref_9
  /graph/objects/{id}/restore:
    post:
      operationId: restoreObject
      summary: Restore a soft-deleted object (creates new version clearing deleted_at)
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '201':
          description: Restored (new version created)
      tags: *ref_9
  /graph/objects/{id}/history:
    get:
      operationId: history
      summary: List version history for a graph object
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
        - name: limit
          required: true
          in: query
          schema:
            type: string
        - name: cursor
          required: true
          in: query
          schema:
            type: string
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ObjectHistoryResponseDto'
        '404':
          description: Not found
      tags: *ref_9
  /graph/relationships:
    post:
      operationId: createRel
      summary: >-
        Create a relationship (initial version) or new version if properties
        changed
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateGraphRelationshipDto'
      responses:
        '201':
          description: ''
      tags: *ref_9
  /graph/relationships/{id}:
    get:
      operationId: getRel
      summary: Get relationship by id
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: ''
      tags: *ref_9
    patch:
      operationId: patchRel
      summary: Patch (create new version) of a relationship (only head version allowed)
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PatchGraphRelationshipDto'
      responses:
        '200':
          description: ''
      tags: *ref_9
    delete:
      operationId: deleteRel
      summary: Soft delete a relationship (tombstone version)
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: ''
      tags: *ref_9
  /graph/relationships/search:
    get:
      operationId: searchRels
      summary: Search relationships (basic filters)
      description: >-
        Supports pagination via created_at cursor. Optional order param
        (asc|desc) for chronological direction (default asc).
      parameters:
        - name: type
          required: true
          in: query
          schema:
            type: string
        - name: src_id
          required: true
          in: query
          schema:
            type: string
        - name: dst_id
          required: true
          in: query
          schema:
            type: string
        - name: limit
          required: true
          in: query
          schema:
            type: string
        - name: cursor
          required: true
          in: query
          schema:
            type: string
        - name: order
          required: false
          in: query
          description: >-
            Chronological direction (asc=oldestnewest, desc=newestoldest).
            Default asc.
          schema:
            enum:
              - asc
              - desc
            type: string
      responses:
        '200':
          description: ''
      tags: *ref_9
  /graph/relationships/{id}/restore:
    post:
      operationId: restoreRel
      summary: Restore a soft-deleted relationship
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '201':
          description: Restored (new version created)
      tags: *ref_9
  /graph/relationships/{id}/history:
    get:
      operationId: historyRel
      summary: List version history for a relationship
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
        - name: limit
          required: true
          in: query
          schema:
            type: string
        - name: cursor
          required: true
          in: query
          schema:
            type: string
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RelationshipHistoryResponseDto'
      tags: *ref_9
  /graph/objects/{id}/edges:
    get:
      operationId: edges
      summary: List relationships adjacent to an object
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
        - name: direction
          required: true
          in: query
          schema:
            type: string
        - name: limit
          required: true
          in: query
          schema:
            type: string
      responses:
        '200':
          description: ''
      tags: *ref_9
  /graph/traverse:
    post:
      operationId: traverse
      summary: Traverse the graph from one or more root object ids (bounded BFS)
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TraverseGraphDto'
      responses:
        '200':
          description: ''
      tags: *ref_9
  /graph/expand:
    post:
      operationId: expand
      summary: >-
        Expand graph (single-pass bounded traversal with projection & edge
        property option)
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GraphExpandDto'
      responses:
        '200':
          description: ''
      tags: *ref_9
  /graph/objects/vector-search:
    post:
      operationId: vectorSearch
      summary: Vector similarity search
      description: >-
        Returns nearest neighbors (cosine distance) for provided query vector
        over embedding_vec. Threshold: use maxDistance (preferred) or legacy
        minScore (acts as maximum distance). When both are supplied, maxDistance
        takes precedence.
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VectorSearchDto'
      responses:
        '200':
          description: ''
      tags: *ref_9
  /graph/objects/{id}/similar:
    get:
      operationId: similar
      summary: Find objects similar to given object id using stored embedding_vec
      description: >-
        Supports same filters as POST /graph/objects/vector-search (type, orgId,
        projectId, branchId, keyPrefix, labelsAll, labelsAny,
        maxDistance|minScore, limit). maxDistance preferred; if both provided,
        maxDistance overrides minScore.
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
        - name: limit
          required: false
          in: query
          description: Limit number of neighbors (1-100); default 10
          schema:
            type: number
        - name: minScore
          required: false
          in: query
          description: >-
            Maximum cosine distance (lower is more similar). 0  d  2. Rows
            with distance > threshold filtered out.
          schema:
            type: number
        - name: maxDistance
          required: false
          in: query
          description: >-
            Alias for minScore (preferred name). 0  d  2. If both provided,
            maxDistance wins.
          schema:
            type: number
        - name: type
          required: false
          in: query
          description: Filter by object type
          schema:
            type: string
        - name: orgId
          required: false
          in: query
          description: Filter by org id (UUID)
          schema:
            type: string
        - name: projectId
          required: false
          in: query
          description: Filter by project id (UUID)
          schema:
            type: string
        - name: branchId
          required: false
          in: query
          description: Filter by branch id (UUID)
          schema:
            type: string
        - name: keyPrefix
          required: false
          in: query
          description: Filter by key prefix (ILIKE)
          schema:
            type: string
        - name: labelsAll
          required: false
          in: query
          description: Require all labels to be present on object
          schema:
            type: array
            items:
              type: string
        - name: labelsAny
          required: false
          in: query
          description: Require any of the labels to overlap
          schema:
            type: array
            items:
              type: string
      responses:
        '200':
          description: ''
      tags: *ref_9
  /graph/search-with-neighbors:
    post:
      operationId: searchWithNeighbors
      summary: Search graph objects with optional neighbor expansion
      description: >-

        Performs semantic search over graph objects and optionally retrieves
        their neighbors.


        **Search Strategy:**

        - Uses full-text search (FTS) to find primary results matching the query

        - Optionally expands each result to include:
          1. Semantically similar objects (via vector embeddings)
          2. Directly connected objects (via relationships)

        **Use Cases:**

        - Chat context retrieval (similar to document citations)

        - Discovery features ("related objects")

        - Rich detail views with context


        **Neighbor Sources:**

        - **Semantic**: Objects with similar embedding vectors (via
        searchSimilar)

        - **Relational**: Objects connected via graph relationships (depends_on,
        implements, etc.)


        **Example:**

        ```json

        {
          "query": "authentication patterns",
          "limit": 5,
          "includeNeighbors": true,
          "maxNeighbors": 3,
          "maxDistance": 0.5
        }

        ```
                
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SearchObjectsWithNeighborsDto'
      responses:
        '200':
          description: Search results with optional neighbors
          content:
            application/json:
              schema:
                type: object
                properties:
                  primaryResults:
                    type: array
                    description: Objects matching the search query
                    items:
                      type: object
                  neighbors:
                    type: object
                    description: Map of object ID to array of neighbor objects
                    additionalProperties:
                      type: array
                      items:
                        type: object
      tags: *ref_9
  /graph/embedding-policies:
    post:
      operationId: createEmbeddingPolicy
      summary: Create an embedding policy for a project and object type
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateEmbeddingPolicyDto'
      responses:
        '201':
          description: Policy created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EmbeddingPolicyResponseDto'
        '400':
          description: Validation error or duplicate policy
      tags: *ref_9
    get:
      operationId: listEmbeddingPolicies
      summary: List all embedding policies for a project
      parameters:
        - name: project_id
          required: true
          in: query
          description: Filter policies by project ID
          schema:
            type: string
        - name: object_type
          required: false
          in: query
          description: Filter policies by object type
          schema:
            type: string
      responses:
        '200':
          description: List of policies
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/EmbeddingPolicyResponseDto'
      tags: *ref_9
  /graph/embedding-policies/{id}:
    get:
      operationId: getEmbeddingPolicy
      summary: Get a specific embedding policy by ID
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
        - name: project_id
          required: true
          in: query
          description: Project ID for authorization
          schema:
            type: string
      responses:
        '200':
          description: Policy details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EmbeddingPolicyResponseDto'
        '404':
          description: Policy not found
      tags: *ref_9
    patch:
      operationId: updateEmbeddingPolicy
      summary: Update an embedding policy
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
        - name: project_id
          required: true
          in: query
          description: Project ID for authorization
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateEmbeddingPolicyDto'
      responses:
        '200':
          description: Policy updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EmbeddingPolicyResponseDto'
        '400':
          description: Validation error
        '404':
          description: Policy not found
      tags: *ref_9
    delete:
      operationId: deleteEmbeddingPolicy
      summary: Delete an embedding policy
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
        - name: project_id
          required: true
          in: query
          description: Project ID for authorization
          schema:
            type: string
      responses:
        '204':
          description: Policy deleted
        '404':
          description: Policy not found
      tags: *ref_9
  /graph/branches/{targetBranchId}/merge:
    post:
      operationId: mergeDryRun
      summary: Branch merge (dry-run or execute)
      description: >-
        Enumerate divergent canonical graph objects between source and target
        branches. Default is dry-run (no mutations). If `execute=true` and there
        are no conflicts: Added objects are cloned into target; Fast-forward
        objects are patched by adding only new properties (superset heuristic).
        Conflicts block apply. Classification statuses: added, unchanged,
        fast_forward, conflict.
      parameters:
        - name: targetBranchId
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BranchMergeRequestDto'
      responses:
        '200':
          description: >-
            Merge summary including classification counts, per-object statuses,
            and optional applied/applied_objects when executed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BranchMergeSummaryDto'
        '400':
          description: Missing sourceBranchId or validation error
        '404':
          description: Branch not found
      tags: *ref_9
  /graph/embeddings/object/{id}/status:
    get:
      operationId: getEmbeddingJobStatus
      summary: Get embedding job status for an object
      description: >-
        Returns the active embedding job status (pending or processing) for the
        specified object. Returns 404 if no active job exists.
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Active embedding job found
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    format: uuid
                  object_id:
                    type: string
                    format: uuid
                  status:
                    type: string
                    enum:
                      - pending
                      - processing
                  attempt_count:
                    type: number
                  priority:
                    type: number
                  scheduled_at:
                    type: string
                    format: date-time
                  started_at:
                    type: string
                    format: date-time
                    nullable: true
                  created_at:
                    type: string
                    format: date-time
                  updated_at:
                    type: string
                    format: date-time
        '404':
          description: No active job found for this object
      tags: &ref_10
        - Graph
  /graph/embeddings/object/{id}:
    post:
      operationId: triggerEmbeddingForObject
      summary: Trigger embedding generation for a single object
      description: >-
        Enqueues an embedding job for the specified graph object. The job will
        be processed asynchronously by the embedding worker. Idempotent: if a
        job is already pending/processing for this object, returns the existing
        job.
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
        - name: priority
          required: true
          in: query
          schema:
            type: string
      responses:
        '201':
          description: Embedding job created or found
        '404':
          description: Object not found
      tags: *ref_10
  /graph/embeddings/batch:
    post:
      operationId: triggerEmbeddingsBatch
      summary: Trigger embedding generation for multiple objects
      description: >-
        Enqueues embedding jobs for the specified graph objects. Jobs will be
        processed asynchronously by the embedding worker. Idempotent: if a job
        is already pending/processing for an object, that job is skipped.
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TriggerEmbeddingsBatchDto'
      responses:
        '201':
          description: Embedding jobs created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EmbeddingJobResponseDto'
      tags: *ref_10
  /graph/embeddings/regenerate-project:
    post:
      operationId: triggerEmbeddingsProject
      summary: Trigger embedding regeneration for all objects in a project
      description: >-
        Enqueues embedding jobs for all graph objects in the specified project.
        Optionally filter by object type. Use force=true to regenerate
        embeddings even if they already exist. Jobs will be processed
        asynchronously by the embedding worker.
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TriggerEmbeddingsProjectDto'
      responses:
        '201':
          description: Embedding jobs created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EmbeddingJobResponseDto'
        '400':
          description: Invalid project ID
      tags: *ref_10
  /graph/branches:
    post:
      operationId: create
      parameters: []
      responses:
        '201':
          description: ''
    get:
      operationId: list
      parameters:
        - name: project_id
          required: true
          in: query
          schema:
            type: string
      responses:
        '200':
          description: ''
  /product-versions:
    post:
      operationId: create
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateProductVersionDto'
      responses:
        '200':
          description: Create product version snapshot
          content:
            application/json:
              schema:
                example:
                  id: 11111111-1111-4111-8111-111111111111
                  name: v1.0.0
                  member_count: 42
        '400':
          description: Name exists
          content:
            application/json:
              schema:
                example:
                  error:
                    code: product_version_name_exists
                    message: Name already exists
      tags: &ref_11
        - Product Versions
    get:
      operationId: list
      parameters:
        - name: cursor
          required: false
          in: query
          description: >-
            Pagination cursor (created_at timestamp of last item from previous
            page)
          schema:
            type: string
        - name: limit
          required: false
          in: query
          description: Number of items per page (1-100, default 20)
          schema:
            type: number
      responses:
        '200':
          description: List product version snapshots for a project
          content:
            application/json:
              schema:
                example:
                  items:
                    - id: ...
                      name: v1.0.0
                      description: null
                      created_at: '2025-01-01T00:00:00Z'
                      member_count: 42
                      base_product_version_id: null
                  next_cursor: '2025-01-01T00:00:00Z'
      tags: *ref_11
  /product-versions/{id}:
    get:
      operationId: get
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Get product version snapshot
      tags: *ref_11
  /product-versions/{id}/diff/{otherId}:
    get:
      operationId: diff
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
        - name: otherId
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Diff two product version snapshots
          content:
            application/json:
              schema:
                example:
                  items:
                    - canonical_id: ...
                      change_type: modified
                      version_a_object_id: ...
                      version_b_object_id: ...
                  meta:
                    added: 5
                    removed: 2
                    modified: 10
                    unchanged: 100
      tags: *ref_11
  /tags:
    post:
      operationId: create
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTagDto'
      responses:
        '201':
          description: Create tag
          content:
            application/json:
              schema:
                example:
                  id: 11111111-1111-4111-8111-111111111111
                  name: stable
                  product_version_id: 22222222-2222-4222-8222-222222222222
                  description: Stable release
                  created_at: '2025-09-30T00:00:00Z'
        '400':
          description: Tag name exists or product version not found
          content:
            application/json:
              schema:
                example:
                  error:
                    code: tag_name_exists
                    message: Tag name already exists
      tags: &ref_12
        - Tags
    get:
      operationId: list
      parameters:
        - name: cursor
          required: false
          in: query
          description: Pagination cursor (created_at timestamp)
          schema:
            type: string
        - name: limit
          required: false
          in: query
          description: Number of items per page (1-100, default 20)
          schema:
            type: number
      responses:
        '200':
          description: List tags for a project
          content:
            application/json:
              schema:
                example:
                  items:
                    - id: ...
                      name: stable
                      product_version_id: ...
                      description: null
                      created_at: '2025-09-30T00:00:00Z'
                  next_cursor: '2025-09-30T00:00:00Z'
      tags: *ref_12
  /tags/{id}:
    get:
      operationId: get
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Get tag by ID
        '404':
          description: Tag not found
      tags: *ref_12
    put:
      operationId: update
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTagDto'
      responses:
        '200':
          description: Update tag
        '404':
          description: Tag not found
      tags: *ref_12
    delete:
      operationId: delete
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '204':
          description: Tag deleted
        '404':
          description: Tag not found
      tags: *ref_12
  /tags/by-name/{name}:
    get:
      operationId: getByName
      parameters:
        - name: name
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Get tag by name
        '404':
          description: Tag not found
      tags: *ref_12
  /type-registry/projects/{projectId}:
    get:
      operationId: getProjectTypes
      parameters:
        - name: projectId
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: ''
  /type-registry/projects/{projectId}/types/{typeName}:
    get:
      operationId: getType
      parameters:
        - name: projectId
          required: true
          in: path
          schema:
            type: string
        - name: typeName
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: ''
    patch:
      operationId: updateType
      parameters:
        - name: projectId
          required: true
          in: path
          schema:
            type: string
        - name: typeName
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateObjectTypeDto'
      responses:
        '200':
          description: ''
    delete:
      operationId: deleteType
      parameters:
        - name: projectId
          required: true
          in: path
          schema:
            type: string
        - name: typeName
          required: true
          in: path
          schema:
            type: string
      responses:
        '204':
          description: ''
  /type-registry/projects/{projectId}/types:
    post:
      operationId: createType
      parameters:
        - name: projectId
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateObjectTypeDto'
      responses:
        '201':
          description: ''
  /type-registry/projects/{projectId}/validate:
    post:
      operationId: validateData
      parameters:
        - name: projectId
          required: true
          in: path
          schema:
            type: string
      responses:
        '201':
          description: ''
  /type-registry/projects/{projectId}/types/{typeName}/schema:
    get:
      operationId: getTypeSchema
      parameters:
        - name: projectId
          required: true
          in: path
          schema:
            type: string
        - name: typeName
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: ''
  /type-registry/projects/{projectId}/types/{typeName}/toggle:
    patch:
      operationId: toggleType
      parameters:
        - name: projectId
          required: true
          in: path
          schema:
            type: string
        - name: typeName
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: ''
  /type-registry/projects/{projectId}/stats:
    get:
      operationId: getProjectStats
      parameters:
        - name: projectId
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: ''
  /notifications:
    get:
      operationId: getNotifications
      summary: Get notifications for current user
      parameters:
        - name: tab
          required: false
          in: query
          description: Filter by tab
          schema:
            enum:
              - important
              - other
              - snoozed
              - cleared
            type: string
        - name: category
          required: false
          in: query
          description: Filter by category (e.g., "import", "extraction")
          schema:
            type: string
        - name: unread_only
          required: false
          in: query
          description: Show only unread notifications
          schema:
            type: boolean
        - name: search
          required: false
          in: query
          description: Search in title and message
          schema:
            type: string
      responses:
        '200':
          description: List of notifications
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: &ref_13
        - Notifications
      security: &ref_14
        - bearer: []
    delete:
      operationId: clearAll
      summary: Clear all notifications in a tab
      parameters:
        - name: tab
          required: false
          in: query
          description: Tab to clear
          schema:
            enum:
              - important
              - other
            type: string
      responses:
        '200':
          description: All notifications cleared
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_13
      security: *ref_14
  /notifications/counts:
    get:
      operationId: getUnreadCounts
      summary: Get unread notification counts
      parameters: []
      responses:
        '200':
          description: Notification counts by tab
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_13
      security: *ref_14
  /notifications/stats:
    get:
      operationId: getStats
      summary: Get notification statistics (unread, dismissed, total)
      parameters: []
      responses:
        '200':
          description: Notification statistics
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_13
      security: *ref_14
  /notifications/{id}/read:
    post:
      operationId: markRead
      summary: Mark notification as read
      parameters:
        - name: id
          required: true
          in: path
          description: Notification ID
          schema:
            type: string
      responses:
        '200':
          description: Notification marked as read
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_13
      security: *ref_14
  /notifications/{id}/unread:
    post:
      operationId: markUnread
      summary: Mark notification as unread
      parameters:
        - name: id
          required: true
          in: path
          description: Notification ID
          schema:
            type: string
      responses:
        '200':
          description: Notification marked as unread
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_13
      security: *ref_14
  /notifications/{id}/dismiss:
    post:
      operationId: dismiss
      summary: Dismiss notification
      parameters:
        - name: id
          required: true
          in: path
          description: Notification ID
          schema:
            type: string
      responses:
        '200':
          description: Notification dismissed
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_13
      security: *ref_14
  /notifications/{id}:
    delete:
      operationId: clear
      summary: Clear notification (move to cleared tab)
      parameters:
        - name: id
          required: true
          in: path
          description: Notification ID
          schema:
            type: string
      responses:
        '200':
          description: Notification cleared
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_13
      security: *ref_14
  /notifications/{id}/unclear:
    post:
      operationId: unclear
      summary: Restore notification from cleared tab
      parameters:
        - name: id
          required: true
          in: path
          description: Notification ID
          schema:
            type: string
      responses:
        '200':
          description: Notification restored
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_13
      security: *ref_14
  /notifications/{id}/snooze:
    post:
      operationId: snooze
      summary: Snooze notification until a specific time
      parameters:
        - name: id
          required: true
          in: path
          description: Notification ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SnoozeNotificationDto'
      responses:
        '200':
          description: Notification snoozed
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_13
      security: *ref_14
  /notifications/{id}/unsnooze:
    post:
      operationId: unsnooze
      summary: Unsnooze notification
      parameters:
        - name: id
          required: true
          in: path
          description: Notification ID
          schema:
            type: string
      responses:
        '200':
          description: Notification unsnoozed
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_13
      security: *ref_14
  /monitoring/extraction-jobs:
    get:
      operationId: listExtractionJobs
      summary: List extraction jobs with metrics
      parameters:
        - name: type
          required: false
          in: query
          description: Type of resource to query (optional, inferred from endpoint path)
          schema:
            example: extraction_job
            enum:
              - extraction_job
              - chat_session
              - frontend_session
            type: string
        - name: limit
          required: false
          in: query
          description: Number of items to return
          schema:
            minimum: 1
            maximum: 100
            default: 50
            example: 50
            type: number
        - name: offset
          required: false
          in: query
          description: Number of items to skip
          schema:
            minimum: 0
            default: 0
            example: 0
            type: number
        - name: status
          required: false
          in: query
          description: Filter by status
          schema:
            example: completed
            type: string
        - name: date_from
          required: false
          in: query
          description: Filter by date from (ISO 8601)
          schema:
            example: '2025-10-01T00:00:00Z'
            type: string
        - name: date_to
          required: false
          in: query
          description: Filter by date to (ISO 8601)
          schema:
            example: '2025-10-31T23:59:59Z'
            type: string
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResourceListResponseDto'
      tags: &ref_15
        - monitoring
      security: &ref_16
        - bearer: []
  /monitoring/extraction-jobs/{id}:
    get:
      operationId: getExtractionJobDetail
      summary: Get extraction job details with logs and LLM calls
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResourceDetailResponseDto'
        '404':
          description: Job not found
      tags: *ref_15
      security: *ref_16
  /monitoring/extraction-jobs/{id}/logs:
    get:
      operationId: getExtractionJobLogs
      summary: Get process logs for extraction job
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
        - name: level
          required: false
          in: query
          description: Filter by log level
          schema:
            example: info
            enum:
              - debug
              - info
              - warn
              - error
              - fatal
            type: string
        - name: limit
          required: false
          in: query
          description: Number of log entries to return
          schema:
            minimum: 1
            maximum: 500
            default: 100
            example: 100
            type: number
        - name: offset
          required: false
          in: query
          description: Number of log entries to skip
          schema:
            minimum: 0
            default: 0
            example: 0
            type: number
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/LogEntryDto'
      tags: *ref_15
      security: *ref_16
  /monitoring/extraction-jobs/{id}/llm-calls:
    get:
      operationId: getExtractionJobLLMCalls
      summary: Get LLM calls for extraction job
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/LLMCallDto'
      tags: *ref_15
      security: *ref_16
  /chat/conversations:
    get:
      operationId: listConversations
      parameters: []
      responses:
        '200':
          description: List chat conversations
          content:
            application/json:
              schema:
                example:
                  - id: 11111111-1111-4111-8111-111111111111
                    title: 2025-01-01  Hello world
                    is_private: false
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: &ref_17
        - Chat
    post:
      operationId: createConversation
      parameters: []
      responses:
        '200':
          description: Create a new conversation (201)
          content:
            application/json:
              schema:
                example:
                  conversationId: 11111111-1111-4111-8111-111111111111
                  id: 11111111-1111-4111-8111-111111111111
                  title: 2025-01-01  New Conversation
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: message required
      tags: *ref_17
  /chat/{id}:
    get:
      operationId: getConversation
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Get a conversation with messages
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Forbidden
        '404':
          description: Conversation not found
          content:
            application/json:
              schema:
                example:
                  error:
                    code: not-found
                    message: Conversation not found
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_17
    patch:
      operationId: rename
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Rename conversation
          content:
            application/json:
              schema:
                example:
                  ok: true
                  id: c1
                  title: New Title
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: title required
        '404':
          description: Conversation not found
          content:
            application/json:
              schema:
                example:
                  error:
                    code: not-found
                    message: Conversation not found
      tags: *ref_17
    delete:
      operationId: delete
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Delete conversation
          content:
            application/json:
              schema:
                example:
                  ok: true
                  id: c1
        '404':
          description: Conversation not found
          content:
            application/json:
              schema:
                example:
                  error:
                    code: not-found
                    message: Conversation not found
      tags: *ref_17
  /chat/{id}/stream:
    get:
      operationId: streamGet
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: >-
            Chat streaming endpoint (SSE). Emits a sequence of JSON frames each
            prefixed by "data: ".
          content:
            text/event-stream:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/GetChatStreamMetaFrame'
                  - $ref: '#/components/schemas/GetChatStreamTokenFrame'
                  - $ref: '#/components/schemas/GetChatStreamCitationsFrame'
                  - $ref: '#/components/schemas/GetChatStreamSummaryFrame'
                  - $ref: '#/components/schemas/GetChatStreamDoneFrame'
                  - $ref: '#/components/schemas/GetChatStreamErrorFrame'
              examples:
                meta:
                  value: |+
                    data: {"meta":{"chat_model_enabled":true,"google_key":true}}

                token:
                  value: |+
                    data: {"message":"token-0","index":0,"streaming":true}

                citations:
                  value: >+
                    data:
                    {"citations":[{"documentId":"11111111-1111-4111-8111-111111111111"}]}

                summary:
                  value: |+
                    data: {"summary":true,"token_count":5,"citations_count":2}

                done:
                  value: |+
                    data: {"done":true,"message":"[DONE]"}

                error:
                  value: >+
                    data:
                    {"error":{"code":"upstream-failed","message":"Simulated
                    upstream model failure"},"done":true}

        '400':
          description: Missing project header
          content:
            text/event-stream:
              schema:
                example:
                  error:
                    code: bad-request
                    message: x-project-id header required
        '404':
          description: Conversation not found
          content:
            text/event-stream:
              schema:
                example:
                  error:
                    code: not-found
                    message: Conversation not found
      tags: *ref_17
  /chat/stream:
    post:
      operationId: streamPost
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChatRequestDto'
      responses:
        '200':
          description: >-
            Chat streaming endpoint (SSE). Each line is an SSE data frame
            beginning with "data: ", followed by one of the JSON event shapes.
          content:
            text/event-stream:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/ChatStreamMetaEvent'
                  - $ref: '#/components/schemas/ChatStreamTokenEvent'
                  - $ref: '#/components/schemas/ChatStreamMcpToolEvent'
                  - $ref: '#/components/schemas/ChatStreamErrorEvent'
                  - $ref: '#/components/schemas/ChatStreamDoneEvent'
                description: >-
                  Union of possible chat stream events (serialized per line as
                  SSE frame).
              examples:
                meta:
                  value: >+
                    data:
                    {"type":"meta","conversationId":"11111111-1111-4111-8111-111111111111","citations":[]}

                mcp_started:
                  value: >+
                    data:
                    {"type":"mcp_tool","tool":"schema_version","status":"started"}

                mcp_completed:
                  value: >+
                    data:
                    {"type":"mcp_tool","tool":"schema_version","status":"completed","result":{"version":"1.0.0"}}

                mcp_error:
                  value: >+
                    data:
                    {"type":"mcp_tool","tool":"schema_version","status":"error","error":"MCP
                    server unavailable"}

                token:
                  value: |+
                    data: {"type":"token","token":"Hello"}

                error:
                  value: |+
                    data: {"type":"error","error":"model key missing"}

                done:
                  value: |+
                    data: {"type":"done"}

        '400':
          description: Bad request
          content:
            text/event-stream:
              schema:
                example:
                  error:
                    code: bad-request
                    message: message required
        '401':
          description: Unauthorized
          content:
            text/event-stream:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            text/event-stream:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            text/event-stream:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_17
  /invites/with-user:
    post:
      operationId: createWithUser
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateInviteWithUserDto'
      responses:
        '201':
          description: ''
  /invites:
    post:
      operationId: create
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateInviteDto'
      responses:
        '201':
          description: ''
  /invites/accept:
    post:
      operationId: accept
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AcceptInviteDto'
      responses:
        '201':
          description: ''
  /graph/search:
    post:
      operationId: search
      parameters:
        - name: debug
          required: true
          in: query
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GraphSearchRequestDto'
      responses:
        '200':
          description: Graph hybrid search results (prototype)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GraphSearchResponseDto'
        '403':
          description: Missing required scope (e.g., debug scope)
          content:
            application/json:
              schema:
                example:
                  error:
                    code: insufficient_scope
                    message: Debug scope required
                    details:
                      missing:
                        - graph:search:debug
      tags:
        - Graph
      security:
        - bearer: []
  /search/unified:
    post:
      operationId: search
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UnifiedSearchRequestDto'
      responses:
        '200':
          description: Unified search results combining graph objects and document chunks
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UnifiedSearchResponseDto'
        '400':
          description: Validation failed
          content:
            application/json:
              schema:
                example:
                  error:
                    code: validation-failed
                    message: Validation failed
                    details:
                      query:
                        - query must be shorter than or equal to 800 characters
        '403':
          description: Missing required scope (e.g., debug scope)
          content:
            application/json:
              schema:
                example:
                  error:
                    code: insufficient_scope
                    message: Debug scope required for includeDebug=true
                    details:
                      missing:
                        - search:debug
      tags:
        - Search
      security:
        - bearer: []
  /discovery-jobs/projects/{projectId}/start:
    post:
      operationId: startDiscovery
      parameters:
        - name: projectId
          required: true
          in: path
          schema:
            type: string
      responses:
        '201':
          description: ''
  /discovery-jobs/{jobId}:
    get:
      operationId: getJobStatus
      parameters:
        - name: jobId
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: ''
    delete:
      operationId: cancelJob
      parameters:
        - name: jobId
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: ''
  /discovery-jobs/projects/{projectId}:
    get:
      operationId: listJobs
      parameters:
        - name: projectId
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: ''
  /discovery-jobs/{jobId}/finalize:
    post:
      operationId: finalizeDiscovery
      parameters:
        - name: jobId
          required: true
          in: path
          schema:
            type: string
      responses:
        '201':
          description: ''
  /integrations/available:
    get:
      operationId: listAvailableIntegrations
      summary: List available integration types
      description: >-
        Get a list of all integration types that can be configured (ClickUp,
        GitHub, etc.)
      parameters: []
      responses:
        '200':
          description: Available integrations retrieved successfully
        '401':
          description: Unauthorized
      tags: &ref_18
        - Integrations
      security: &ref_19
        - bearer: []
  /integrations:
    get:
      operationId: listIntegrations
      summary: List integrations
      description: List all integrations for a project with optional filters
      parameters: []
      responses:
        '200':
          description: Integrations retrieved successfully
        '401':
          description: Unauthorized
      tags: *ref_18
      security: *ref_19
    post:
      operationId: createIntegration
      summary: Create integration
      description: Create a new integration configuration with encrypted credentials
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateIntegrationDto'
      responses:
        '201':
          description: Integration created successfully
        '400':
          description: Invalid request data
        '401':
          description: Unauthorized
        '409':
          description: Integration already exists for this project
      tags: *ref_18
      security: *ref_19
  /integrations/{name}:
    get:
      operationId: getIntegration
      summary: Get integration
      description: Get detailed information about a specific integration
      parameters:
        - name: name
          required: true
          in: path
          description: Integration name (e.g., "clickup")
          schema:
            type: string
      responses:
        '200':
          description: Integration retrieved successfully
        '401':
          description: Unauthorized
        '404':
          description: Integration not found
      tags: *ref_18
      security: *ref_19
    put:
      operationId: updateIntegration
      summary: Update integration
      description: Update an existing integration configuration
      parameters:
        - name: name
          required: true
          in: path
          description: Integration name (e.g., "clickup")
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateIntegrationDto'
      responses:
        '200':
          description: Integration updated successfully
        '400':
          description: Invalid update data
        '401':
          description: Unauthorized
        '404':
          description: Integration not found
      tags: *ref_18
      security: *ref_19
    delete:
      operationId: deleteIntegration
      summary: Delete integration
      description: Delete an integration and all its associated data
      parameters:
        - name: name
          required: true
          in: path
          description: Integration name (e.g., "clickup")
          schema:
            type: string
      responses:
        '204':
          description: Integration deleted successfully
        '401':
          description: Unauthorized
        '404':
          description: Integration not found
      tags: *ref_18
      security: *ref_19
  /integrations/{name}/public:
    get:
      operationId: getPublicIntegrationInfo
      summary: Get public integration info
      description: Get non-sensitive information about an integration
      parameters:
        - name: name
          required: true
          in: path
          description: Integration name (e.g., "clickup")
          schema:
            type: string
      responses:
        '200':
          description: Public info retrieved successfully
        '401':
          description: Unauthorized
        '404':
          description: Integration not found
      tags: *ref_18
      security: *ref_19
  /integrations/{name}/test:
    post:
      operationId: testConnection
      summary: Test integration connection
      description: Test if the integration credentials are valid and the connection works
      parameters:
        - name: name
          required: true
          in: path
          description: Integration name (e.g., "clickup")
          schema:
            type: string
      responses:
        '200':
          description: Connection test completed
        '401':
          description: Unauthorized
        '404':
          description: Integration not found
      tags: *ref_18
      security: *ref_19
  /integrations/{name}/sync/stream:
    get:
      operationId: triggerSyncStream
      summary: Trigger integration sync with real-time progress (SSE)
      description: Starts a sync and streams progress updates via Server-Sent Events
      parameters:
        - name: name
          required: true
          in: path
          description: Integration name (e.g., "clickup")
          schema:
            type: string
      responses:
        '200':
          description: SSE stream started
      tags: *ref_18
      security: *ref_19
  /integrations/{name}/sync:
    post:
      operationId: triggerSync
      summary: Trigger integration sync
      description: Manually trigger a full import/sync from the integration
      parameters:
        - name: name
          required: true
          in: path
          description: Integration name (e.g., "clickup")
          schema:
            type: string
      responses:
        '200':
          description: Sync initiated successfully
        '400':
          description: Integration does not support import
        '401':
          description: Unauthorized
        '404':
          description: Integration not found
      tags: *ref_18
      security: *ref_19
  /integrations/clickup/structure:
    get:
      operationId: getClickUpWorkspaceStructure
      summary: Get ClickUp workspace structure
      description: >-
        Fetch hierarchical workspace structure (spaces, folders, lists) with
        task counts for list selection UI
      parameters: []
      responses:
        '200':
          description: Workspace structure retrieved successfully
        '401':
          description: Unauthorized
        '404':
          description: ClickUp integration not found or not configured
      tags: *ref_18
      security: *ref_19
  /integrations/clickup/spaces/{spaceId}:
    get:
      operationId: getClickUpSpace
      summary: Get ClickUp space details
      description: Fetch details for a specific ClickUp space by ID
      parameters:
        - name: spaceId
          required: true
          in: path
          description: ClickUp space ID
          schema:
            type: string
      responses:
        '200':
          description: Space details retrieved successfully
        '404':
          description: ClickUp integration not found or space not found
      tags: *ref_18
      security: *ref_19
  /integrations/clickup/folders/{folderId}:
    get:
      operationId: getClickUpFolder
      summary: Get ClickUp folder details
      description: Fetch details for a specific ClickUp folder by ID
      parameters:
        - name: folderId
          required: true
          in: path
          description: ClickUp folder ID
          schema:
            type: string
      responses:
        '200':
          description: Folder details retrieved successfully
        '404':
          description: ClickUp integration not found or folder not found
      tags: *ref_18
      security: *ref_19
  /mcp/schema/version:
    get:
      operationId: getSchemaVersion
      summary: Get current schema version hash
      description: >-
        Returns a hash representing the current state of all schemas. Agents can
        use this to determine if cached tools are still valid.
      parameters: []
      responses:
        '200':
          description: Current schema version information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SchemaVersionDto'
        '401':
          description: Missing or invalid bearer token
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Unauthorized
        '403':
          description: Insufficient scope - requires schema:read
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Forbidden
                    details:
                      missing:
                        - schema:read
      tags: &ref_20
        - MCP
      security: &ref_21
        - bearer: []
  /mcp/schema/changelog:
    get:
      operationId: getSchemaChangelog
      summary: Get schema change history
      description: Returns recent schema changes for debugging and tracking
      parameters:
        - name: since
          required: true
          in: query
          schema:
            type: string
        - name: limit
          required: true
          in: query
          schema:
            type: number
      responses:
        '200':
          description: Schema change history
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/SchemaChangeDto'
        '401':
          description: Missing or invalid bearer token
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Unauthorized
        '403':
          description: Insufficient scope - requires schema:read
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Forbidden
                    details:
                      missing:
                        - schema:read
      tags: *ref_20
      security: *ref_21
  /mcp/rpc:
    post:
      operationId: handleRpc
      summary: MCP JSON-RPC 2.0 Endpoint
      description: |-

        Model Context Protocol (MCP) server endpoint.

        **Protocol:** JSON-RPC 2.0
        **Methods:** initialize, tools/list, tools/call
        **Tools:** schema_version, schema_changelog, type_info

        **Example Initialize Request:**
        ```json
        {
          "jsonrpc": "2.0",
          "id": 1,
          "method": "initialize",
          "params": {
            "protocolVersion": "2025-06-18",
            "capabilities": {},
            "clientInfo": {
              "name": "example-client",
              "version": "1.0.0"
            }
          }
        }
        ```

        **Example tools/list Request:**
        ```json
        {
          "jsonrpc": "2.0",
          "id": 2,
          "method": "tools/list"
        }
        ```

        **Example tools/call Request:**
        ```json
        {
          "jsonrpc": "2.0",
          "id": 3,
          "method": "tools/call",
          "params": {
            "name": "schema_version",
            "arguments": {}
          }
        }
        ```
                
      parameters: []
      requestBody:
        required: true
        description: JSON-RPC 2.0 request
        content:
          application/json:
            schema:
              type: object
              required:
                - jsonrpc
                - method
              properties:
                jsonrpc:
                  type: string
                  enum:
                    - '2.0'
                  description: JSON-RPC version
                id:
                  oneOf:
                    - type: number
                    - type: string
                  description: Request ID (omit for notifications)
                method:
                  type: string
                  enum:
                    - initialize
                    - tools/list
                    - tools/call
                    - notifications/initialized
                  description: RPC method name
                params:
                  type: object
                  description: Method parameters
      responses:
        '200':
          description: JSON-RPC 2.0 response
          content:
            application/json:
              schema:
                oneOf:
                  - type: object
                    required:
                      - jsonrpc
                      - id
                      - result
                    properties:
                      jsonrpc:
                        type: string
                        enum:
                          - '2.0'
                      id:
                        oneOf:
                          - type: number
                          - type: string
                      result:
                        type: object
                  - type: object
                    required:
                      - jsonrpc
                      - id
                      - error
                    properties:
                      jsonrpc:
                        type: string
                        enum:
                          - '2.0'
                      id:
                        oneOf:
                          - type: number
                          - type: string
                          - type: 'null'
                      error:
                        type: object
                        required:
                          - code
                          - message
                        properties:
                          code:
                            type: number
                          message:
                            type: string
                          data:
                            type: object
      tags:
        - MCP Server (JSON-RPC 2.0)
      security:
        - bearer: []
  /user/orgs-and-projects:
    get:
      operationId: getOrgsAndProjects
      summary: Get user access tree (organizations and projects with roles)
      description: >-
        Returns hierarchical access tree with orgs and nested projects,
        including user roles at each level
      parameters: []
      responses:
        '200':
          description: Access tree retrieved successfully
          schema:
            example:
              - id: 550e8400-e29b-41d4-a716-446655440000
                name: Acme Corp
                role: org_admin
                projects:
                  - id: 550e8400-e29b-41d4-a716-446655440001
                    name: Product Docs
                    orgId: 550e8400-e29b-41d4-a716-446655440000
                    role: project_admin
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/OrgWithProjectsDto'
        '401':
          description: Unauthorized
      tags: &ref_22
        - user
      security: &ref_23
        - bearer: []
  /user/delete-account:
    post:
      operationId: deleteAccount
      summary: Delete user account and all data
      parameters: []
      responses:
        '200':
          description: Account deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  deleted:
                    type: object
                    properties:
                      organizations:
                        type: number
                      projects:
                        type: number
                      documents:
                        type: number
                      chunks:
                        type: number
                      embeddings:
                        type: number
                      extractionJobs:
                        type: number
                      graphObjects:
                        type: number
                      integrations:
                        type: number
                  duration_ms:
                    type: number
        '401':
          description: Unauthorized
      tags: *ref_22
      security: *ref_23
  /user/test-cleanup:
    post:
      operationId: testCleanup
      summary: Clean up test user data (test environments only)
      parameters: []
      responses:
        '200':
          description: Test data cleaned up successfully
        '403':
          description: Forbidden - not a test environment or test user
      tags: *ref_22
      security: *ref_23
  /chat-ui/conversations:
    get:
      operationId: getConversations
      parameters: []
      responses:
        '200':
          description: List user conversations
      tags: &ref_24
        - Chat UI
  /chat-ui/conversations/{id}:
    get:
      operationId: getConversation
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Get conversation details
      tags: *ref_24
    patch:
      operationId: updateConversation
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Update conversation title
      tags: *ref_24
    delete:
      operationId: deleteConversation
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Delete conversation
      tags: *ref_24
  /chat-ui/conversations/{id}/draft:
    patch:
      operationId: updateConversationDraft
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Update conversation draft text
      tags: *ref_24
  /chat-ui:
    post:
      operationId: chat
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChatRequestDto'
      responses:
        '200':
          description: Streaming chat response
          content:
            text/event-stream:
              schema:
                type: string
                description: Server-sent events stream
      tags: *ref_24
  /chat-sdk/conversations:
    post:
      operationId: createConversation
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateConversationDto'
      responses:
        '201':
          description: Create a new conversation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateConversationResponseDto'
      tags: &ref_25
        - Chat SDK
  /chat-sdk:
    post:
      operationId: chat
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChatSdkRequestDto'
      responses:
        '200':
          description: Vercel AI SDK streaming chat response
          content:
            text/event-stream:
              schema:
                type: string
                description: Vercel AI SDK UI Message protocol stream
      tags: *ref_25
info:
  title: Spec Server API
  description: >-
    Generated OpenAPI spec (NestJS). NOTE: Each Document MUST belong to a
    Project and each Project belongs to an Organization. Users with no
    accessible Projects must create one before using ingestion or search
    features.
  version: 0.2.0
  contact: {}
tags: []
servers: []
components:
  securitySchemes:
    bearer:
      scheme: bearer
      bearerFormat: JWT
      type: http
  schemas:
    UserProfileDto:
      type: object
      properties:
        id:
          type: string
          description: Internal UUID user id (primary key)
          format: uuid
        subjectId:
          type: string
          description: >-
            Canonical internal user id (subject id, from identity provider) -
            DEPRECATED: use id
          format: uuid
        zitadelUserId:
          type: object
          description: Zitadel user ID (external auth provider)
        firstName:
          type: object
        lastName:
          type: object
        displayName:
          type: object
          description: Display name fallback (explicit) or derived (first + last)
        phoneE164:
          type: object
          description: E.164 formatted phone number, leading + and digits
        avatarObjectKey:
          type: object
          description: Object storage key for avatar (if stored internally)
      required:
        - id
        - subjectId
    UpdateUserProfileDto:
      type: object
      properties: {}
    AlternativeEmailDto:
      type: object
      properties:
        email:
          type: string
          description: Email address (lowercased canonical form)
        verified:
          type: boolean
          description: Verification status
        createdAt:
          type: string
          description: ISO timestamp created
      required:
        - email
        - verified
        - createdAt
    AddAlternativeEmailDto:
      type: object
      properties: {}
    OrgDto:
      type: object
      properties:
        id:
          type: string
          example: org_1
        name:
          type: string
          example: Example Org
      required:
        - id
        - name
    CreateOrgDto:
      type: object
      properties: {}
    ProjectDto:
      type: object
      properties:
        id:
          type: string
          example: proj_1
        name:
          type: string
          example: Demo Project
        orgId:
          type: string
          example: org_1
        kb_purpose:
          type: string
          example: This knowledge base contains...
        chat_prompt_template:
          type: string
          example: |-
            You are a helpful assistant...

            {{GRAPH_CONTEXT}}

            {{MESSAGE}}
          description: Custom chat prompt template with placeholders
        auto_extract_objects:
          type: boolean
          example: false
          description: >-
            When true, automatically create extraction jobs when documents are
            uploaded
        auto_extract_config:
          type: object
          example:
            enabled_types:
              - Requirement
              - Decision
              - Feature
            min_confidence: 0.7
            duplicate_strategy: skip
            require_review: true
            notify_on_complete: true
            notification_channels:
              - inbox
          description: Configuration for automatic extraction jobs
      required:
        - id
        - name
        - orgId
    CreateProjectDto:
      type: object
      properties:
        name:
          type: string
          example: My Project
          description: Project name (unique per organization, case-insensitive)
        orgId:
          type: string
          description: Organization UUID (must belong to caller; no implicit default org)
      required:
        - name
        - orgId
    UpdateProjectDto:
      type: object
      properties:
        name:
          type: string
          example: Updated Project Name
          description: New project name (unique per organization)
        kb_purpose:
          type: string
          example: This knowledge base contains documentation about...
          description: >-
            Markdown description of the knowledge base purpose and domain. Used
            by auto-discovery to understand context.
        chat_prompt_template:
          type: string
          example: |-
            You are a helpful assistant specialized in {{DOMAIN}}.

            {{GRAPH_CONTEXT}}

            {{MESSAGE}}
          description: >-
            Custom chat prompt template. Supports placeholders:
            {{SYSTEM_PROMPT}}, {{MCP_CONTEXT}}, {{GRAPH_CONTEXT}}, {{MESSAGE}},
            {{MARKDOWN_RULES}}
        auto_extract_objects:
          type: boolean
          example: false
          description: >-
            Enable/disable automatic extraction of objects from uploaded
            documents
        auto_extract_config:
          type: object
          example:
            enabled_types:
              - Requirement
              - Decision
              - Feature
            min_confidence: 0.7
            duplicate_strategy: skip
            require_review: true
            notify_on_complete: true
            notification_channels:
              - inbox
          description: >-
            Configuration for automatic extraction (enabled_types,
            min_confidence, duplicate_strategy, require_review,
            notify_on_complete, notification_channels)
    CreateTemplatePackDto:
      type: object
      properties: {}
    AssignTemplatePackDto:
      type: object
      properties: {}
    UpdateTemplatePackAssignmentDto:
      type: object
      properties: {}
    SearchResultDto:
      type: object
      properties:
        id:
          type: string
          example: mock-1
        snippet:
          type: string
          example: Result snippet for "foo" (#1, mode=hybrid)
        score:
          type: number
          example: 0.98
        source:
          type: string
          example: source.doc#L10
        pathSummary:
          type: string
          example: >-
            Related: links to Requirement "REQ-1" via 'implements'; linked from
            Meeting "M3" via 'discussed_in'
          description: >-
            Human-readable summary of how this result relates to other objects
            in the knowledge graph
      required:
        - id
        - snippet
        - score
    SearchResponseDto:
      type: object
      properties:
        mode:
          type: string
          enum:
            - hybrid
            - lexical
            - vector
        results:
          type: array
          items:
            $ref: '#/components/schemas/SearchResultDto'
        warning:
          type: string
          example: Embeddings unavailable; fell back to lexical.
        query_time_ms:
          type: number
          description: Query execution time in milliseconds
          example: 142.5
        result_count:
          type: number
          description: Total number of results found before pagination/limits
          example: 50
      required:
        - mode
        - results
    DocumentDto:
      type: object
      properties:
        id:
          type: string
          example: doc_1
        orgId:
          type: string
          example: 11111111-2222-3333-4444-555555555555
          nullable: true
        projectId:
          type: string
          example: aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee
          nullable: true
        name:
          type: string
          example: Spec.md
        sourceUrl:
          type: object
          nullable: true
          example: https://example.com/file.pdf
        mimeType:
          type: object
          nullable: true
          example: text/markdown
        createdAt:
          type: string
          example: '2025-01-01T00:00:00.000Z'
        updatedAt:
          type: string
          example: '2025-01-01T00:05:00.000Z'
        content:
          type: object
          nullable: true
          example: |-
            # Document Title

            Document content here...
          description: The full text content of the document
        contentLength:
          type: object
          nullable: true
          example: 7332286
          description: The byte length of the content field
        chunks:
          type: number
          example: 12
          description: Number of chunks associated with this document
        parentDocumentId:
          type: object
          nullable: true
          example: aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee
          description: >-
            Parent document ID for hierarchical structures (e.g., ClickUp page
            hierarchy)
        integrationMetadata:
          type: object
          nullable: true
          example:
            source: clickup
            doc_id: 4bj41-33735
            workspace_id: '4573313'
          description: Integration-specific metadata (ClickUp IDs, creator info, etc.)
        extractionStatus:
          type: string
          nullable: true
          example: completed
          description: >-
            Status of the most recent extraction job for this document (pending,
            running, completed, failed)
          enum:
            - pending
            - running
            - completed
            - failed
        extractionCompletedAt:
          type: string
          nullable: true
          example: '2025-01-01T00:10:00.000Z'
          description: Timestamp when the most recent extraction job was completed
        extractionObjectsCount:
          type: number
          nullable: true
          example: 15
          description: Number of objects extracted in the most recent extraction job
      required:
        - id
        - name
        - createdAt
        - updatedAt
        - chunks
    DeletionImpactDto:
      type: object
      properties:
        document:
          type: object
          description: Document information
          example:
            id: 123e4567-e89b-12d3-a456-426614174000
            name: example.pdf
            createdAt: '2024-01-01T00:00:00Z'
        impact:
          type: object
          description: Impact summary of entities that will be deleted
          example:
            chunks: 42
            extractionJobs: 3
            graphObjects: 15
            graphRelationships: 8
            notifications: 1
      required:
        - document
        - impact
    BulkDeleteRequestDto:
      type: object
      properties:
        ids:
          description: Array of document IDs to delete
          example:
            - 123e4567-e89b-12d3-a456-426614174000
            - 123e4567-e89b-12d3-a456-426614174001
          minItems: 1
          type: array
          items:
            type: string
      required:
        - ids
    BulkDeletionImpactDto:
      type: object
      properties:
        totalDocuments:
          type: number
          description: Total number of documents to be deleted
          example: 5
        impact:
          type: object
          description: Aggregated impact summary across all documents
          example:
            chunks: 150
            extractionJobs: 12
            graphObjects: 48
            graphRelationships: 25
            notifications: 3
        documents:
          description: Optional per-document breakdown
          type: array
          items:
            $ref: '#/components/schemas/DeletionImpactDto'
      required:
        - totalDocuments
        - impact
    DeletionSummaryDto:
      type: object
      properties:
        status:
          type: string
          description: Deletion status
          example: deleted
          enum: &ref_26
            - deleted
            - partial
        summary:
          type: object
          description: Summary of deleted entities
          example: &ref_27
            chunks: 42
            extractionJobs: 3
            graphObjects: 15
            graphRelationships: 8
            notifications: 1
      required:
        - status
        - summary
    BulkDeletionSummaryDto:
      type: object
      properties:
        status:
          type: string
          description: Deletion status
          example: deleted
          enum: *ref_26
        summary:
          type: object
          description: Summary of deleted entities
          example: *ref_27
        deleted:
          type: number
          description: Number of documents successfully deleted
          example: 5
        notFound:
          description: Document IDs that could not be found or deleted
          example:
            - 123e4567-e89b-12d3-a456-426614174999
          type: array
          items:
            type: string
      required:
        - status
        - summary
        - deleted
    ChunkDto:
      type: object
      properties:
        id:
          type: string
          example: chunk_1
        documentId:
          type: string
          example: doc_1
        documentTitle:
          type: string
          example: User Guide.pdf
          description: Best-effort document title derived from filename or source URL
        index:
          type: number
          example: 0
          description: Zero-based index of chunk inside the document
        size:
          type: number
          example: 512
          description: Size in characters
        hasEmbedding:
          type: boolean
          example: true
          description: Whether an embedding vector exists for this chunk
        text:
          type: string
          example: This is the chunk text...
          description: Plaintext content of the chunk (may be truncated client-side)
      required:
        - id
        - documentId
        - documentTitle
        - index
        - size
        - hasEmbedding
        - text
    IngestionUploadDto:
      type: object
      properties:
        filename:
          type: string
          description: Original filename (optional, will fallback to uploaded file name)
          example: spec.md
        mimeType:
          type: string
          description: Optional MIME type
          example: text/markdown
        orgId:
          type: string
          description: Optional organisation UUID to associate the document with
          example: 11111111-2222-3333-4444-555555555555
        projectId:
          type: string
          description: Project UUID that this document belongs to (required)
          example: aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee
      required:
        - projectId
    IngestionUrlDto:
      type: object
      properties:
        url:
          type: string
          description: Remote URL to ingest
          example: https://example.com/spec.md
        orgId:
          type: string
          description: Optional organisation UUID to associate the document with
          example: 11111111-2222-3333-4444-555555555555
        projectId:
          type: string
          description: Project UUID that this document belongs to (required)
          example: aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee
      required:
        - url
        - projectId
    CreateExtractionJobDto:
      type: object
      properties:
        project_id:
          type: string
          description: Project ID
          example: 550e8400-e29b-41d4-a716-446655440001
        source_type:
          type: string
          description: Source type for extraction
          enum:
            - document
            - api
            - manual
            - bulk_import
          example: document
        source_id:
          type: string
          description: Source object ID (e.g., document ID)
          example: 550e8400-e29b-41d4-a716-446655440002
        source_metadata:
          type: object
          description: Additional source metadata
          example:
            filename: requirements.pdf
            filesize: 1024000
        extraction_config:
          type: object
          description: Extraction configuration
          example:
            target_types:
              - Requirement
              - Feature
            auto_create_types: true
            confidence_threshold: 0.7
        subject_id:
          type: string
          description: User subject ID (canonical internal user ID)
          example: 550e8400-e29b-41d4-a716-446655440003
      required:
        - project_id
        - source_type
        - extraction_config
    ExtractionJobDto:
      type: object
      properties:
        id:
          type: string
          description: Job ID
        project_id:
          type: string
          description: Project ID
        source_type:
          type: string
          description: Source type
          enum:
            - document
            - api
            - manual
            - bulk_import
        source_id:
          type: string
          description: Source ID
        source_metadata:
          type: object
          description: Source metadata
        extraction_config:
          type: object
          description: Extraction configuration
        status:
          type: string
          description: Job status
          enum:
            - pending
            - running
            - completed
            - requires_review
            - failed
            - cancelled
        total_items:
          type: number
          description: Total items to process
        processed_items:
          type: number
          description: Processed items count
        successful_items:
          type: number
          description: Successful items count
        failed_items:
          type: number
          description: Failed items count
        discovered_types:
          description: Discovered type names
          type: array
          items:
            type: string
        created_objects:
          description: Created object IDs
          type: array
          items:
            type: string
        error_message:
          type: string
          description: Error message
        error_details:
          type: object
          description: Error details
        debug_info:
          type: object
          description: Debug information (LLM requests/responses, intermediate results)
          example:
            llm_calls:
              - type: Requirement
                prompt: Extract requirements...
                response: LLM response data
                duration_ms: 1234
        started_at:
          format: date-time
          type: string
          description: Job start timestamp
        completed_at:
          format: date-time
          type: string
          description: Job completion timestamp
        created_at:
          format: date-time
          type: string
          description: Job creation timestamp
        subject_id:
          type: string
          description: User subject ID (canonical internal user ID)
        updated_at:
          format: date-time
          type: string
          description: Last update timestamp
      required:
        - id
        - project_id
        - source_type
        - source_metadata
        - extraction_config
        - status
        - total_items
        - processed_items
        - successful_items
        - failed_items
        - discovered_types
        - created_objects
        - created_at
        - updated_at
    ExtractionJobListDto:
      type: object
      properties:
        jobs:
          description: List of extraction jobs
          type: array
          items:
            $ref: '#/components/schemas/ExtractionJobDto'
        total:
          type: number
          description: Total count of jobs
        page:
          type: number
          description: Current page number
        limit:
          type: number
          description: Items per page
        total_pages:
          type: number
          description: Total pages
      required:
        - jobs
        - total
        - page
        - limit
        - total_pages
    UpdateExtractionJobDto:
      type: object
      properties:
        status:
          type: string
          description: Job status
          enum:
            - pending
            - running
            - completed
            - requires_review
            - failed
            - cancelled
          example: running
        total_items:
          type: number
          description: Total items to process
          example: 100
          minimum: 0
        processed_items:
          type: number
          description: Number of processed items
          example: 50
          minimum: 0
        successful_items:
          type: number
          description: Number of successful items
          example: 45
          minimum: 0
        failed_items:
          type: number
          description: Number of failed items
          example: 5
          minimum: 0
        discovered_types:
          description: Discovered type names
          example:
            - Requirement
            - Feature
          type: array
          items:
            type: string
        created_objects:
          description: Created object IDs
          example:
            - 550e8400-e29b-41d4-a716-446655440010
          type: array
          items:
            type: string
        error_message:
          type: string
          description: Error message (if failed)
          example: Failed to parse document
        error_details:
          type: object
          description: Detailed error information
          example:
            stack: ...
            context: ...
        debug_info:
          type: object
          description: Debug information (LLM requests/responses, intermediate results)
          example:
            llm_requests: []
            llm_responses: []
            processing_steps: []
    CreateGraphObjectDto:
      type: object
      properties: {}
    PatchGraphObjectDto:
      type: object
      properties: {}
    BulkUpdateStatusDto:
      type: object
      properties:
        ids:
          description: Array of object IDs to update
          example:
            - uuid1
            - uuid2
            - uuid3
          type: array
          items:
            type: string
        status:
          type: string
          description: New status value
          example: accepted
          maxLength: 64
      required:
        - ids
        - status
    VersionedObjectDto:
      type: object
      properties:
        id:
          type: string
        org_id:
          type: object
          nullable: true
        project_id:
          type: object
          nullable: true
        canonical_id:
          type: string
        supersedes_id:
          type: object
          nullable: true
        version:
          type: number
        type:
          type: string
        key:
          type: object
          nullable: true
        properties:
          type: object
        labels:
          type: array
          items:
            type: string
        created_at:
          type: string
      required:
        - id
        - org_id
        - project_id
        - canonical_id
        - supersedes_id
        - version
        - type
        - key
        - properties
        - labels
        - created_at
    ObjectHistoryResponseDto:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/VersionedObjectDto'
        next_cursor:
          type: string
          description: Present when more pages available; pass as cursor query param
      required:
        - items
    CreateGraphRelationshipDto:
      type: object
      properties: {}
    PatchGraphRelationshipDto:
      type: object
      properties: {}
    VersionedRelationshipDto:
      type: object
      properties:
        id:
          type: string
        canonical_id:
          type: string
        supersedes_id:
          type: object
          nullable: true
        version:
          type: number
        type:
          type: string
        src_id:
          type: string
        dst_id:
          type: string
        properties:
          type: object
        created_at:
          type: string
        weight:
          type: object
          nullable: true
        valid_from:
          type: object
          nullable: true
        valid_to:
          type: object
          nullable: true
      required:
        - id
        - canonical_id
        - supersedes_id
        - version
        - type
        - src_id
        - dst_id
        - properties
        - created_at
        - weight
        - valid_from
        - valid_to
    RelationshipHistoryResponseDto:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/VersionedRelationshipDto'
        next_cursor:
          type: string
          description: Present when more pages available; pass as cursor query param
      required:
        - items
    EdgePhaseDto:
      type: object
      properties:
        relationshipTypes:
          description: >-
            Relationship types to follow in this phase. If omitted, all types
            are allowed.
          example:
            - DEPENDS_ON
            - REQUIRES
          maxItems: 32
          type: array
          items:
            type: string
        direction:
          type: string
          description: 'Edge traversal direction: out (src->dst), in (dst<-src), or both'
          enum:
            - out
            - in
            - both
          example: out
        maxDepth:
          type: number
          description: >-
            Maximum depth (hops) to traverse in this phase, relative to phase
            start nodes
          minimum: 1
          maximum: 8
          example: 2
        objectTypes:
          description: >-
            Filter discovered nodes by object types. Only matching types
            included.
          example:
            - Implementation
            - TestCase
          maxItems: 64
          type: array
          items:
            type: string
        labels:
          description: >-
            Filter discovered nodes by labels. Nodes must have at least one
            matching label.
          example:
            - verified
            - high-priority
          maxItems: 64
          type: array
          items:
            type: string
      required:
        - direction
        - maxDepth
    PredicateDto:
      type: object
      properties:
        operator:
          type: string
          description: Comparison operator to apply
          enum:
            - equals
            - notEquals
            - greaterThan
            - lessThan
            - greaterThanOrEqual
            - lessThanOrEqual
            - contains
            - in
            - notIn
            - matches
            - exists
            - notExists
          example: equals
      required:
        - operator
    TemporalFilterDto:
      type: object
      properties:
        asOf:
          type: string
          description: >-
            Timestamp for point-in-time query (ISO 8601 format). Only
            nodes/edges valid at this timestamp are included.
          example: '2024-12-31T23:59:59Z'
          format: date-time
        field:
          type: string
          description: 'Which temporal field to use for filtering. Default: valid_from'
          enum:
            - valid_from
            - created_at
            - updated_at
          default: valid_from
          example: valid_from
      required:
        - asOf
    TraverseGraphDto:
      type: object
      properties:
        edgePhases:
          description: >-
            Define multiple sequential traversal phases with different
            constraints per phase. When provided, legacy
            direction/max_depth/relationship_types are ignored.
          maxItems: 8
          example:
            - relationshipTypes:
                - DEPENDS_ON
              direction: out
              maxDepth: 2
            - relationshipTypes:
                - IMPLEMENTED_BY
              direction: in
              maxDepth: 1
              objectTypes:
                - TestCase
          type: array
          items:
            $ref: '#/components/schemas/EdgePhaseDto'
        nodeFilter:
          description: >-
            Filter nodes by property values using JSON Pointer paths and
            comparison operators. Only nodes satisfying the predicate are
            included.
          example:
            path: /status
            operator: equals
            value: active
          allOf:
            - $ref: '#/components/schemas/PredicateDto'
        edgeFilter:
          description: >-
            Filter edges by property values. Only edges satisfying the predicate
            will be traversed.
          example:
            path: /confidence
            operator: greaterThan
            value: 0.7
          allOf:
            - $ref: '#/components/schemas/PredicateDto'
        returnPaths:
          type: boolean
          description: >-
            When true, include full paths from root nodes to each result node.
            Each path is an array of node IDs showing the traversal route.
          example: true
        maxPathsPerNode:
          type: number
          description: >-
            Maximum paths to track per node (used with returnPaths). Limits
            memory usage when a node is reachable via many routes.
          minimum: 1
          maximum: 100
          default: 10
          example: 10
        temporalFilter:
          description: >-
            Filter nodes and edges based on temporal validity. Enables
            point-in-time queries to see historical graph state.
          example:
            asOf: '2024-12-31T23:59:59Z'
            field: valid_from
          allOf:
            - $ref: '#/components/schemas/TemporalFilterDto'
        fieldStrategy:
          type: string
          description: >-
            Field pruning strategy to control response payload size. compact
            removes paths/phaseIndex (~25% reduction), minimal keeps only
            essential fields (~45% reduction).
          enum:
            - full
            - compact
            - minimal
          default: full
          example: compact
    GraphExpandDto:
      type: object
      properties: {}
    VectorSearchDto:
      type: object
      properties:
        vector:
          description: Query vector numbers
          type: array
          items:
            type: number
        limit:
          type: number
          description: Max results (default 10, max 100)
          minimum: 1
          maximum: 100
        minScore:
          type: number
          description: >-
            Optional max distance (cosine) filter (0  d  2; typical cosine
            range).
          minimum: 0
          maximum: 2
        maxDistance:
          type: number
          description: >-
            Alias for minScore (preferred). Same constraints (0  d  2). If
            both provided, maxDistance wins.
          minimum: 0
          maximum: 2
        type:
          type: string
          description: Filter by object type (exact match)
        orgId:
          type: string
          description: Filter by org id
          format: uuid
        projectId:
          type: string
          description: Filter by project id
          format: uuid
        branchId:
          type: string
          description: Filter by branch id
          format: uuid
        keyPrefix:
          type: string
          description: Optional key prefix match (ILIKE prefix%)
        labelsAll:
          description: >-
            Require all labels (array contains)  matches rows whose labels
            array contains every listed label
          type: array
          items:
            type: string
        labelsAny:
          description: >-
            Require any label (overlap)  matches rows whose labels array
            overlaps any listed label
          type: array
          items:
            type: string
      required:
        - vector
    SearchObjectsWithNeighborsDto:
      type: object
      properties:
        query:
          type: string
          description: Natural language query text to search for
          example: authentication and authorization patterns
        limit:
          type: number
          description: Maximum number of primary search results
          default: 10
          minimum: 1
          maximum: 100
        includeNeighbors:
          type: boolean
          description: Whether to include neighbors for each result
          default: false
        maxNeighbors:
          type: number
          description: Maximum number of neighbors per result
          default: 5
          minimum: 1
          maximum: 20
        maxDistance:
          type: number
          description: >-
            Maximum vector distance for similarity (0.0-2.0, lower = more
            similar)
          default: 0.5
          minimum: 0
          maximum: 2
        projectId:
          type: string
          description: Filter by project ID
        orgId:
          type: string
          description: Filter by organization ID
        branchId:
          type: string
          description: Filter by branch ID
        types:
          description: Filter by object types
          example:
            - Decision
            - Pattern
            - Document
          type: array
          items:
            type: string
        labels:
          description: Filter by labels
          example:
            - accepted
            - high-priority
          type: array
          items:
            type: string
      required:
        - query
    CreateEmbeddingPolicyDto:
      type: object
      properties:
        projectId:
          type: string
          description: Project ID this policy applies to
          example: 123e4567-e89b-12d3-a456-426614174000
        objectType:
          type: string
          description: >-
            Object type to apply policy to (e.g., "Document", "Requirement",
            "TestCase")
          example: Document
        enabled:
          type: boolean
          description: Whether embedding is enabled for this object type
          default: true
          example: true
        maxPropertySize:
          type: number
          description: >-
            Maximum property size in bytes. Objects with properties larger than
            this will not be embedded.
          example: 10000
        requiredLabels:
          description: Labels that must be present on the object for it to be embedded
          example:
            - public
            - approved
          type: array
          items:
            type: string
        excludedLabels:
          description: Labels that prevent embedding if present on the object
          example:
            - sensitive
            - draft
          type: array
          items:
            type: string
        relevantPaths:
          description: >-
            JSON Pointer paths to relevant properties. If specified, only these
            paths will be embedded (field masking).
          example:
            - /properties/title
            - /properties/description
          type: array
          items:
            type: string
        excludedStatuses:
          description: Status values that prevent embedding if present on the object
          example:
            - draft
            - archived
          type: array
          items:
            type: string
      required:
        - projectId
        - objectType
    EmbeddingPolicyResponseDto:
      type: object
      properties:
        id:
          type: string
          description: Policy ID
          example: 123e4567-e89b-12d3-a456-426614174000
        projectId:
          type: string
          description: Project ID
          example: 123e4567-e89b-12d3-a456-426614174001
        objectType:
          type: string
          description: Object type
          example: Document
        enabled:
          type: boolean
          description: Whether embedding is enabled
          example: true
        maxPropertySize:
          type: object
          description: Maximum property size in bytes
          example: 10000
          nullable: true
        requiredLabels:
          description: Required labels
          example:
            - public
          type: array
          items:
            type: string
        excludedLabels:
          description: Excluded labels
          example:
            - sensitive
          type: array
          items:
            type: string
        relevantPaths:
          description: Relevant property paths (JSON Pointers)
          example:
            - /properties/title
          type: array
          items:
            type: string
        excludedStatuses:
          description: Excluded status values
          example:
            - draft
          type: array
          items:
            type: string
        createdAt:
          format: date-time
          type: string
          description: Creation timestamp
          example: '2025-10-01T12:00:00Z'
        updatedAt:
          format: date-time
          type: string
          description: Last update timestamp
          example: '2025-10-01T12:30:00Z'
      required:
        - id
        - projectId
        - objectType
        - enabled
        - maxPropertySize
        - requiredLabels
        - excludedLabels
        - relevantPaths
        - excludedStatuses
        - createdAt
        - updatedAt
    UpdateEmbeddingPolicyDto:
      type: object
      properties:
        enabled:
          type: boolean
          description: Whether embedding is enabled for this object type
          example: false
        maxPropertySize:
          type: number
          description: >-
            Maximum property size in bytes. Objects with properties larger than
            this will not be embedded.
          example: 20000
        requiredLabels:
          description: Labels that must be present on the object for it to be embedded
          example:
            - verified
          type: array
          items:
            type: string
        excludedLabels:
          description: Labels that prevent embedding if present on the object
          example:
            - archived
          type: array
          items:
            type: string
        relevantPaths:
          description: JSON Pointer paths to relevant properties
          example:
            - /properties/summary
          type: array
          items:
            type: string
        excludedStatuses:
          description: Status values that prevent embedding
          example:
            - draft
          type: array
          items:
            type: string
    BranchMergeRequestDto:
      type: object
      properties:
        sourceBranchId:
          type: string
          description: Source branch to merge from
        execute:
          type: boolean
          description: >-
            If true, attempt to apply the merge (will fail with 409 if any
            conflicts). When false or omitted, performs a dry-run only.
        limit:
          type: number
          description: >-
            Optional enumeration limit override (must be <= server max).
            Primarily for testing.
      required:
        - sourceBranchId
    BranchMergeObjectSummaryDto:
      type: object
      properties:
        canonical_id:
          type: string
          description: Canonical object id
        status:
          type: string
          enum:
            - unchanged
            - added
            - fast_forward
            - conflict
        source_head_id:
          type: object
          description: Head version id on source branch
          nullable: true
        target_head_id:
          type: object
          description: Head version id on target branch
          nullable: true
        source_paths:
          description: Changed property paths on source since LCA
          type: array
          items:
            type: string
        target_paths:
          description: Changed property paths on target since LCA (empty if no divergence)
          type: array
          items:
            type: string
        conflicts:
          description: >-
            List of conflicting property paths (subset intersection of
            source/target paths with differing final values)
          type: array
          items:
            type: string
      required:
        - canonical_id
        - status
        - source_head_id
        - target_head_id
        - source_paths
        - target_paths
    BranchMergeRelationshipSummaryDto:
      type: object
      properties:
        canonical_id:
          type: string
          description: Canonical relationship id
        status:
          type: string
          enum:
            - unchanged
            - added
            - fast_forward
            - conflict
        source_head_id:
          type: object
          description: Head version id on source branch
          nullable: true
        target_head_id:
          type: object
          description: Head version id on target branch
          nullable: true
        source_src_id:
          type: object
          description: Source node id (src) on source head
          nullable: true
        source_dst_id:
          type: object
          description: Destination node id (dst) on source head
          nullable: true
        target_src_id:
          type: object
          description: Source node id (src) on target head
          nullable: true
        target_dst_id:
          type: object
          description: Destination node id (dst) on target head
          nullable: true
        source_paths:
          description: Changed property paths on source since LCA
          type: array
          items:
            type: string
        target_paths:
          description: Changed property paths on target since LCA (empty if no divergence)
          type: array
          items:
            type: string
        conflicts:
          description: >-
            List of conflicting property paths (subset intersection of
            source/target paths with differing final values)
          type: array
          items:
            type: string
      required:
        - canonical_id
        - status
        - source_head_id
        - target_head_id
        - source_src_id
        - source_dst_id
        - target_src_id
        - target_dst_id
        - source_paths
        - target_paths
    BranchMergeSummaryDto:
      type: object
      properties:
        targetBranchId:
          type: string
          description: Target branch the merge would apply to
        sourceBranchId:
          type: string
          description: Source branch provided in request
        dryRun:
          type: boolean
          description: True if this response is only a dry-run (always true in MVP)
        total_objects:
          type: number
          description: Total divergent canonical objects considered
        unchanged_count:
          type: number
          description: Count of objects unchanged after merge (no action needed)
        added_count:
          type: number
          description: Count of objects newly added by source branch
        fast_forward_count:
          type: number
          description: >-
            Count of objects that can be applied without conflict (fast-forward
            or safe merge)
        conflict_count:
          type: number
          description: Count of objects with conflicts requiring manual resolution
        objects:
          type: array
          items:
            $ref: '#/components/schemas/BranchMergeObjectSummaryDto'
        truncated:
          type: boolean
          description: Set when enumeration truncated due to limit cap
        hard_limit:
          type: number
          description: Server enforced hard limit (for client visibility)
        applied:
          type: boolean
          description: True when merge changes were applied (execute=true & no conflicts)
        applied_objects:
          type: number
          description: >-
            Number of objects mutated/created during apply (added +
            fast_forward)
        relationships_total:
          type: number
          description: Total divergent canonical relationships considered
        relationships_unchanged_count:
          type: number
          description: Count of relationships unchanged after merge (no action needed)
        relationships_added_count:
          type: number
          description: Count of relationships newly added by source branch
        relationships_fast_forward_count:
          type: number
          description: >-
            Count of relationships that can be applied without conflict
            (fast-forward or safe merge)
        relationships_conflict_count:
          type: number
          description: Count of relationships with conflicts requiring manual resolution
        relationships:
          type: array
          items:
            $ref: '#/components/schemas/BranchMergeRelationshipSummaryDto'
      required:
        - targetBranchId
        - sourceBranchId
        - dryRun
        - total_objects
        - unchanged_count
        - added_count
        - fast_forward_count
        - conflict_count
        - objects
    TriggerEmbeddingsBatchDto:
      type: object
      properties:
        objectIds:
          description: Array of object IDs to generate embeddings for
          example:
            - 123e4567-e89b-12d3-a456-426614174000
            - 123e4567-e89b-12d3-a456-426614174001
          type: array
          items:
            type: string
        priority:
          type: number
          description: Priority for embedding jobs (higher = processed first)
          example: 10
          default: 0
      required:
        - objectIds
    EmbeddingJobResponseDto:
      type: object
      properties:
        enqueued:
          type: number
          description: Number of jobs enqueued
          example: 10
        skipped:
          type: number
          description: Number of jobs that were already pending/processing
          example: 2
        jobIds:
          description: Array of job IDs that were created or found
          example:
            - job-1
            - job-2
          type: array
          items:
            type: string
      required:
        - enqueued
        - skipped
        - jobIds
    TriggerEmbeddingsProjectDto:
      type: object
      properties:
        projectId:
          type: string
          description: Project ID to regenerate embeddings for
          example: 123e4567-e89b-12d3-a456-426614174000
        objectType:
          type: string
          description: >-
            Object type filter (if specified, only regenerate embeddings for
            this type)
          example: Person
        priority:
          type: number
          description: Priority for embedding jobs (higher = processed first)
          example: 10
          default: 0
        force:
          type: boolean
          description: Force regeneration even if embedding already exists
          example: false
          default: false
      required:
        - projectId
    CreateProductVersionDto:
      type: object
      properties: {}
    CreateTagDto:
      type: object
      properties:
        name:
          type: string
          description: Tag name (unique within project)
          example: stable
        product_version_id:
          type: string
          description: Product version ID to tag
          example: 11111111-1111-4111-8111-111111111111
        description:
          type: string
          description: Optional tag description
          example: Stable release for production
      required:
        - name
        - product_version_id
    UpdateTagDto:
      type: object
      properties:
        description:
          type: string
          description: Updated tag description
          example: Updated stable release
    CreateObjectTypeDto:
      type: object
      properties: {}
    UpdateObjectTypeDto:
      type: object
      properties: {}
    SnoozeNotificationDto:
      type: object
      properties:
        until:
          type: string
          description: ISO 8601 datetime string for snooze until time
      required:
        - until
    ExtractionJobResourceDto:
      type: object
      properties:
        id:
          type: string
          example: 123e4567-e89b-12d3-a456-426614174000
        documentId:
          type: string
          example: doc_456
        status:
          type: string
          example: completed
          enum:
            - pending
            - processing
            - completed
            - failed
        totalItems:
          type: number
          example: 5
        processedItems:
          type: number
          example: 5
        successfulItems:
          type: number
          example: 5
        failedItems:
          type: number
          example: 0
        startedAt:
          type: string
          example: '2025-10-22T10:30:00Z'
        completedAt:
          type: string
          example: '2025-10-22T10:35:00Z'
        totalCostUsd:
          type: number
          example: 0.0125
      required:
        - id
        - documentId
        - status
        - totalItems
        - processedItems
        - successfulItems
        - failedItems
        - startedAt
    ResourceListResponseDto:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/ExtractionJobResourceDto'
        total:
          type: number
          example: 42
        limit:
          type: number
          example: 50
        offset:
          type: number
          example: 0
      required:
        - items
        - total
        - limit
        - offset
    LogEntryDto:
      type: object
      properties:
        id:
          type: string
          example: 123e4567-e89b-12d3-a456-426614174000
        processId:
          type: string
          example: job_123
        processType:
          type: string
          example: extraction_job
        level:
          type: string
          example: info
          enum:
            - debug
            - info
            - warn
            - error
            - fatal
        message:
          type: string
          example: Job processing started
        metadata:
          type: object
          example:
            step: extraction
            entity_count: 5
        timestamp:
          type: string
          example: '2025-10-22T10:30:00Z'
      required:
        - id
        - processId
        - processType
        - level
        - message
        - timestamp
    LLMCallDto:
      type: object
      properties:
        id:
          type: string
          example: 123e4567-e89b-12d3-a456-426614174000
        processId:
          type: string
          example: job_123
        processType:
          type: string
          example: extraction_job
        modelName:
          type: string
          example: gemini-1.5-pro
        requestPayload:
          type: object
          example:
            prompt: Extract entities from...
        responsePayload:
          type: object
          example:
            entities: []
        status:
          type: string
          example: success
          enum:
            - success
            - error
            - timeout
            - pending
        errorMessage:
          type: string
          example: Timeout after 30s
        inputTokens:
          type: number
          example: 1000
        outputTokens:
          type: number
          example: 500
        totalTokens:
          type: number
          example: 1500
        costUsd:
          type: number
          example: 0.00875
        startedAt:
          type: string
          example: '2025-10-22T10:30:00Z'
        completedAt:
          type: string
          example: '2025-10-22T10:30:05Z'
        durationMs:
          type: number
          example: 5000
      required:
        - id
        - processId
        - processType
        - modelName
        - requestPayload
        - status
        - startedAt
    ResourceDetailResponseDto:
      type: object
      properties:
        resource:
          $ref: '#/components/schemas/ExtractionJobResourceDto'
        recentLogs:
          type: array
          items:
            $ref: '#/components/schemas/LogEntryDto'
        llmCalls:
          type: array
          items:
            $ref: '#/components/schemas/LLMCallDto'
        metrics:
          type: object
          example:
            totalCost: 0.0125
            avgDuration: 5000
      required:
        - resource
        - recentLogs
        - llmCalls
    ChatRequestDto:
      type: object
      properties:
        messages:
          type: array
          description: Array of chat messages
          items:
            type: object
            properties:
              role:
                type: string
                enum:
                  - user
                  - assistant
                  - system
              content:
                type: string
        conversationId:
          type: string
          description: Conversation ID for maintaining state
      required:
        - messages
    CitationDto:
      type: object
      properties: {}
    GraphObjectDto:
      type: object
      properties: {}
    GraphObjectNeighborsDto:
      type: object
      properties: {}
    ChatStreamMetaEvent:
      type: object
      properties: {}
    ChatStreamTokenEvent:
      type: object
      properties: {}
    ChatStreamErrorEvent:
      type: object
      properties: {}
    ChatStreamDoneEvent:
      type: object
      properties: {}
    ChatStreamMcpToolEvent:
      type: object
      properties: {}
    GetChatStreamMetaFrame:
      type: object
      properties: {}
    GetChatStreamTokenFrame:
      type: object
      properties: {}
    GetChatStreamCitationsFrame:
      type: object
      properties: {}
    GetChatStreamGraphObjectsFrame:
      type: object
      properties: {}
    GetChatStreamGraphNeighborsFrame:
      type: object
      properties: {}
    GetChatStreamSummaryFrame:
      type: object
      properties: {}
    GetChatStreamDoneFrame:
      type: object
      properties: {}
    GetChatStreamErrorFrame:
      type: object
      properties: {}
    CreateInviteWithUserDto:
      type: object
      properties: {}
    CreateInviteDto:
      type: object
      properties: {}
    AcceptInviteDto:
      type: object
      properties: {}
    GraphSearchFiltersDto:
      type: object
      properties:
        objectTypes:
          type: array
          items:
            type: string
        excludeObjectTypes:
          type: array
          items:
            type: string
        labelsAny:
          type: array
          items:
            type: string
        updatedAfter:
          type: string
          example: '2025-09-01T00:00:00Z'
        updatedBefore:
          type: string
          example: '2025-09-20T00:00:00Z'
    GraphSearchNeighborDto:
      type: object
      properties:
        perPrimaryLimit:
          type: number
          minimum: 0
          default: 3
        globalLimit:
          type: number
          minimum: 0
          default: 50
        maxDepth:
          type: number
          minimum: 0
          default: 1
        edgeTypes:
          example:
            - decides
            - attended_by
          type: array
          items:
            type: string
    GraphSearchDocumentFusionDto:
      type: object
      properties:
        enabled:
          type: boolean
          default: false
        topK:
          type: number
          default: 8
          minimum: 1
          maximum: 50
        mode:
          type: string
          enum:
            - blend
            - rrf
            - sequential
          default: blend
        weight:
          type: number
          default: 0.35
          minimum: 0
          maximum: 1
    GraphSearchPaginationDto:
      type: object
      properties:
        cursor:
          type: object
          example: null
        limit:
          type: number
          minimum: 1
          maximum: 100
          default: 40
        direction:
          type: string
          enum:
            - forward
            - backward
          default: forward
          description: >-
            Pagination direction relative to cursor (forward = items after
            cursor, backward = items before cursor). Only meaningful when cursor
            is supplied.
    GraphSearchRequestDto:
      type: object
      properties:
        query:
          type: string
          description: Search query
          maxLength: 800
        limit:
          type: number
          minimum: 1
          maximum: 100
          default: 40
        intentOverride:
          type: string
          enum:
            - explain
            - locate_config
            - debug_error
            - roadmap
          example: explain
        channels:
          type: array
          items:
            type: string
            enum:
              - lexical
              - vector
              - neighbor_boost
              - doc
        rerank:
          type: object
          default: null
        maxTokenBudget:
          type: number
          minimum: 800
          maximum: 6000
          default: 3500
        includeCitations:
          type: boolean
          default: false
        includePathSummaries:
          type: boolean
          default: true
        includeDebug:
          type: boolean
          default: false
        filters:
          $ref: '#/components/schemas/GraphSearchFiltersDto'
        neighbor:
          $ref: '#/components/schemas/GraphSearchNeighborDto'
        documentFusion:
          $ref: '#/components/schemas/GraphSearchDocumentFusionDto'
        pagination:
          $ref: '#/components/schemas/GraphSearchPaginationDto'
        experimental:
          type: object
          description: Experimental feature flags container
      required:
        - query
    GraphSearchReasonDto:
      type: object
      properties:
        channel:
          type: string
          enum:
            - lexical
            - vector
            - neighbor_boost
            - doc
        score:
          type: number
          example: 0.42
      required:
        - channel
        - score
    GraphSearchCitationDto:
      type: object
      properties:
        span:
          type: string
          example: Decision depends on consistent flag rollout
        source_object_id:
          type: string
          example: b3d52c50-5101-4c6c-8d30-4a1f0f7645cb
        confidence:
          type: number
          example: 0.82
      required:
        - span
        - source_object_id
        - confidence
    GraphSearchItemDto:
      type: object
      properties:
        object_id:
          type: string
          example: af6b1db2-e7f9-4d2f-b3f4-5d8c0c61c9cd
        canonical_id:
          type: string
          example: af6b1db2-e7f9-4d2f-b3f4-5d8c0c61c9cd
        score:
          type: number
          example: 0.87123
        rank:
          type: number
          example: 1
        role:
          type: string
          enum:
            - primary
            - neighbor
            - reference
            - document_chunk
        fields:
          type: object
          example:
            title: Adopt Feature Flagging
            type: Decision
            status: active
        truncated_fields:
          example:
            - description
          type: array
          items:
            type: string
        reasons:
          type: array
          items:
            $ref: '#/components/schemas/GraphSearchReasonDto'
        citations:
          type: array
          items:
            $ref: '#/components/schemas/GraphSearchCitationDto'
        explanation:
          type: string
          example: High lexical match on ...
        cursor:
          type: string
          example: eyJzY29yZSI6MC44NzEyMywiaWQiOiJkb2MtMSJ9
      required:
        - object_id
        - canonical_id
        - score
        - rank
        - role
        - fields
        - reasons
    GraphSearchPathSummaryDto:
      type: object
      properties:
        path_id:
          type: string
          example: e7b7ff6e-ef5f-4b55-9580-5d3b45d0a123
        summary:
          type: string
          example: Meeting X decided Decision Y
        reasons:
          type: array
          items:
            $ref: '#/components/schemas/GraphSearchReasonDto'
      required:
        - path_id
        - summary
        - reasons
    GraphSearchEmbeddingModelMetaDto:
      type: object
      properties:
        model:
          type: string
          example: text-embedding-3-large
        version:
          type: number
          example: 2
        coverage_pct:
          type: number
          example: 91.4
      required:
        - model
        - version
        - coverage_pct
    GraphSearchRerankMetaDto:
      type: object
      properties:
        applied:
          type: boolean
          example: true
        model:
          type: string
          example: mini-cross-encoder-v1
        latency_ms:
          type: number
          example: 42
        pool:
          type: number
          example: 60
        timeout:
          type: boolean
          example: false
      required:
        - applied
    GraphSearchExpansionMetaDto:
      type: object
      properties:
        neighbors:
          type: number
          example: 42
        hub_sampled:
          type: boolean
          example: true
        hub_degree:
          type: number
          example: 1342
      required:
        - neighbors
        - hub_sampled
    GraphSearchRequestMetaDto:
      type: object
      properties:
        limit:
          type: number
          example: 40
          description: Effective page size after server cap
        requested_limit:
          type: number
          example: 100
          description: Original client requested limit before clamping
        channels:
          example:
            - lexical
            - vector
          type: array
          items:
            type: string
        rerank:
          type: object
          example: false
        direction:
          type: string
          example: forward
          enum:
            - forward
            - backward
          description: Pagination direction used for this page.
      required:
        - limit
    GraphSearchMetaDto:
      type: object
      properties:
        channels:
          example:
            - lexical
            - vector
          type: array
          items:
            type: string
        fusion:
          type: string
          example: weighted_sum:v2
        normalization_version:
          type: string
          example: zscore_v1
        lexical_considered:
          type: number
          example: 100
        vector_considered:
          type: number
          example: 100
        skipped_unembedded:
          type: number
          example: 12
        neighbor_expanded:
          type: number
          example: 47
        token_estimate:
          type: number
          example: 1450
        token_budget:
          type: number
          example: 3500
        truncation_notice:
          type: boolean
          example: false
        warnings:
          example:
            - embedding_version_backlog
          type: array
          items:
            type: string
        embedding_model:
          $ref: '#/components/schemas/GraphSearchEmbeddingModelMetaDto'
        rerank:
          $ref: '#/components/schemas/GraphSearchRerankMetaDto'
        expansion:
          $ref: '#/components/schemas/GraphSearchExpansionMetaDto'
        request:
          $ref: '#/components/schemas/GraphSearchRequestMetaDto'
        elapsed_ms:
          type: number
          example: 92
        total_estimate:
          type: number
          example: 8
          description: >-
            Total size of fused candidate pool prior to pagination (may be less
            than lexical_considered+vector_considered due to overlaps).
        nextCursor:
          type: object
          example: null
        prevCursor:
          type: object
          example: null
        hasNext:
          type: boolean
          example: true
        hasPrev:
          type: boolean
          example: false
        approx_position_start:
          type: number
          example: 41
          description: >-
            Approximate 1-based index of first item in this page relative to
            fused pool snapshot. 0 if page empty.
        approx_position_end:
          type: number
          example: 80
          description: >-
            Approximate 1-based index of last item in this page relative to
            fused pool snapshot. 0 if page empty.
      required:
        - channels
        - fusion
        - normalization_version
        - lexical_considered
        - vector_considered
        - skipped_unembedded
        - neighbor_expanded
        - token_estimate
        - token_budget
        - truncation_notice
        - embedding_model
        - rerank
        - expansion
        - request
        - elapsed_ms
        - total_estimate
        - hasNext
        - hasPrev
    GraphSearchDebugDto:
      type: object
      properties:
        normalization:
          type: object
          example:
            lexical:
              mean: 0.42
              std: 0.11
        gain_rejections:
          type: number
          example: 5
        marginal_gain_min:
          type: number
          example: 0.02
        edge_samples:
          example:
            - relation: decides
              edge_score: 0.63
              depth: 1
              hub_damping: 0.43
          type: array
          items:
            type: object
        feature_flags:
          type: object
          example:
            paths: true
            rerank: true
            citations: false
      required:
        - normalization
        - gain_rejections
        - marginal_gain_min
        - edge_samples
        - feature_flags
    GraphSearchResponseDto:
      type: object
      properties:
        query:
          type: string
          example: original query text
        intent:
          type: string
          enum:
            - explain
            - locate_config
            - debug_error
            - roadmap
        items:
          type: array
          items:
            $ref: '#/components/schemas/GraphSearchItemDto'
        path_summaries:
          type: array
          items:
            $ref: '#/components/schemas/GraphSearchPathSummaryDto'
        meta:
          $ref: '#/components/schemas/GraphSearchMetaDto'
        debug:
          $ref: '#/components/schemas/GraphSearchDebugDto'
      required:
        - query
        - items
        - meta
    UnifiedSearchWeightsDto:
      type: object
      properties:
        graphWeight:
          type: number
          description: Weight for graph search results (0-1)
          minimum: 0
          maximum: 1
          default: 0.5
          example: 0.6
        textWeight:
          type: number
          description: Weight for text search results (0-1)
          minimum: 0
          maximum: 1
          default: 0.5
          example: 0.4
    UnifiedSearchRelationshipOptionsDto:
      type: object
      properties:
        enabled:
          type: boolean
          description: Whether to include relationships for graph results
          default: true
        maxDepth:
          type: number
          description: Maximum depth for relationship traversal
          minimum: 0
          maximum: 3
          default: 1
        maxNeighbors:
          type: number
          description: Maximum number of neighbors per graph result
          minimum: 0
          maximum: 20
          default: 5
        direction:
          type: string
          description: Direction for relationship expansion
          enum:
            - in
            - out
            - both
          default: both
    UnifiedSearchRequestDto:
      type: object
      properties:
        query:
          type: string
          description: Natural language search query
          maxLength: 800
          example: hybrid search architecture decisions
        limit:
          type: number
          description: Maximum total number of results to return
          minimum: 1
          maximum: 100
          default: 20
        resultTypes:
          type: string
          description: Types of results to include
          enum:
            - graph
            - text
            - both
          default: both
        fusionStrategy:
          type: string
          description: Strategy for combining/fusing graph and text results
          enum:
            - weighted
            - rrf
            - interleave
            - graph_first
            - text_first
          default: weighted
        weights:
          description: Weights for combining graph and text scores
          allOf:
            - $ref: '#/components/schemas/UnifiedSearchWeightsDto'
        relationshipOptions:
          description: Options for expanding relationships in graph results
          allOf:
            - $ref: '#/components/schemas/UnifiedSearchRelationshipOptionsDto'
        includeDebug:
          type: boolean
          description: Whether to include debug metadata in response
          default: false
        maxTokenBudget:
          type: number
          description: Maximum token budget for field truncation (applies to graph results)
          minimum: 800
          maximum: 6000
          default: 3500
      required:
        - query
    UnifiedSearchMetadataDto:
      type: object
      properties:
        totalResults:
          type: number
          description: Total number of results across both types
          example: 27
        graphResultCount:
          type: number
          description: Number of graph results
          example: 12
        textResultCount:
          type: number
          description: Number of text results
          example: 15
        fusionStrategy:
          type: string
          description: Fusion strategy used
          example: weighted
        executionTime:
          type: object
          description: Query execution time breakdown (ms)
          example:
            graphSearchMs: 45.2
            textSearchMs: 67.3
            relationshipExpansionMs: 12.1
            fusionMs: 5.7
            totalMs: 130.3
      required:
        - totalResults
        - graphResultCount
        - textResultCount
        - fusionStrategy
        - executionTime
    UnifiedSearchDebugDto:
      type: object
      properties:
        graphSearch:
          type: object
          description: Raw graph search response
        textSearch:
          type: object
          description: Raw text search results
    UnifiedSearchResponseDto:
      type: object
      properties:
        results:
          description: Fused and ranked search results
          example:
            - type: graph
              object_id: af6b1db2-e7f9-4d2f-b3f4-5d8c0c61c9cd
              canonical_id: af6b1db2-e7f9-4d2f-b3f4-5d8c0c61c9cd
              score: 0.92
              rank: 1
              object_type: Decision
              key: dec-search-architecture
              fields:
                title: Adopt Hybrid Search
            - type: text
              id: chunk-123
              snippet: Hybrid search combines...
              score: 0.87
          type: array
          items:
            type: object
        metadata:
          description: Query metadata and performance metrics
          allOf:
            - $ref: '#/components/schemas/UnifiedSearchMetadataDto'
        debug:
          description: Debug information (only included with search:debug scope)
          allOf:
            - $ref: '#/components/schemas/UnifiedSearchDebugDto'
      required:
        - results
        - metadata
    CreateIntegrationDto:
      type: object
      properties: {}
    UpdateIntegrationDto:
      type: object
      properties: {}
    SchemaVersionDto:
      type: object
      properties:
        version:
          type: string
          description: Hash representing current schema state
          example: a1b2c3d4e5f6g7h8
        updated_at:
          type: string
          description: ISO timestamp of last schema update
          example: '2025-10-20T10:30:00.000Z'
        cache_hint_ttl:
          type: number
          description: Suggested cache TTL in seconds
          example: 300
      required:
        - version
        - updated_at
        - cache_hint_ttl
    SchemaChangeDto:
      type: object
      properties:
        pack_id:
          type: string
          description: Template pack ID
        version:
          type: string
          description: New version number
        schema_hash:
          type: string
          description: Schema hash for this version
        created_at:
          type: string
          description: ISO timestamp of change
        change_type:
          type: string
          description: Type of change
          enum:
            - created
            - updated
            - deleted
      required:
        - pack_id
        - version
        - schema_hash
        - created_at
    OrgWithProjectsDto:
      type: object
      properties:
        id:
          type: string
          description: Organization UUID
          example: 550e8400-e29b-41d4-a716-446655440000
        name:
          type: string
          description: Organization name
          example: Acme Corp
        role:
          type: string
          description: User role in organization
          example: org_admin
          enum:
            - org_admin
            - org_member
        projects:
          description: Projects within organization that user has access to
          items:
            type: array
          type: array
      required:
        - id
        - name
        - role
        - projects
    CreateConversationDto:
      type: object
      properties:
        title:
          type: string
          description: Optional initial title for the conversation
          example: New conversation
        projectId:
          type: string
          description: Optional project ID to associate with the conversation
    CreateConversationResponseDto:
      type: object
      properties:
        id:
          type: string
          description: The newly created conversation ID (UUID format)
          example: 321618f2-bf5a-44b9-bd02-e885ceed7f43
        title:
          type: string
          description: The conversation title
          example: New conversation
        createdAt:
          type: string
          description: Creation timestamp
          example: '2025-11-20T10:30:00.000Z'
      required:
        - id
        - title
        - createdAt
    TextPartDto:
      type: object
      properties:
        type:
          type: string
          description: Part type
          enum:
            - text
        text:
          type: string
          description: Text content
      required:
        - type
        - text
    MessageDto:
      type: object
      properties:
        id:
          type: string
          description: Message ID (optional)
        role:
          type: string
          description: Message role
          enum:
            - user
            - assistant
        content:
          type: string
          description: Message content (simple format)
        parts:
          description: Message parts (AI SDK format)
          type: array
          items:
            $ref: '#/components/schemas/TextPartDto'
      required:
        - role
    ChatSdkRequestDto:
      type: object
      properties:
        messages:
          description: Array of messages in the conversation
          type: array
          items:
            $ref: '#/components/schemas/MessageDto'
        conversationId:
          type: string
          description: Optional conversation ID to continue existing conversation
        projectId:
          type: string
          description: Optional project ID for scoped knowledge base search
      required:
        - messages
x-tagGroups:
  - name: Health & Auth
    tags:
      - Health
      - Auth
  - name: Organizations & Projects
    tags:
      - Orgs
      - Projects
  - name: Configuration
    tags:
      - Settings
  - name: Content & Ingestion
    tags:
      - Ingestion
      - Documents
      - Chunks
  - name: Search
    tags:
      - Search
  - name: Chat
    tags:
      - Chat
