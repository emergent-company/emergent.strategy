# Server Nest .env example
# Copy to .env and adjust values.

# --- Core Server ---
PORT=3002

# --- Postgres ---
DB_CONTAINER_NAME=spec-server-2-db-1
POSTGRES_HOST=localhost
POSTGRES_PORT=5437
POSTGRES_USER=spec
POSTGRES_PASSWORD=spec
POSTGRES_DB=spec
# Legacy PG* vars for compatibility
PGHOST=localhost
PGPORT=5437
PGUSER=spec
PGPASSWORD=spec
PGDATABASE=spec
DB_AUTOINIT=false
# Set to any non-empty value to skip DB init (used for some test contexts)
# SKIP_DB=1

# Seed demo orgs/projects (optional boolean: true/false)
ORGS_DEMO_SEED=false

# --- Embeddings (Google Vertex AI) ---
# Vertex AI uses Application Default Credentials (ADC) - no API key needed
# Set EMBEDDING_PROVIDER=vertex to enable, or leave unset/dummy for deterministic hashing
EMBEDDING_PROVIDER=vertex
VERTEX_EMBEDDING_MODEL=text-embedding-004
VERTEX_EMBEDDING_PROJECT=twentyfirst-io
VERTEX_EMBEDDING_LOCATION=us-central1
CHAT_MODEL_ENABLED=true

# To run real embeddings integration test:
# RUN_EMBEDDINGS_IT=true npx vitest run tests/embeddings.service.real.spec.ts

# --- Extraction Worker (Google Vertex AI) ---
VERTEX_AI_MODEL=gemini-2.5-flash-lite

GCP_PROJECT_ID=spec-server-dev
VERTEX_AI_LOCATION=us-central1
VERTEX_AI_PROJECT_ID=twentyfirst-io

GOOGLE_APPLICATION_CREDENTIALS="/Users/mcj/spec-server-vertex-ai-new.json"

# Extraction Rate Limits
# Free tier conservative estimates to avoid HTTP 429 errors
# Increase these values if you have paid Vertex AI tier
EXTRACTION_RATE_LIMIT_RPM=1000
EXTRACTION_RATE_LIMIT_TPM=3000000

# Zitadel OIDC Configuration
# Organization and Project from bootstrap script
ZITADEL_DOMAIN=localhost:8200
ZITADEL_ORG_ID=345644688004349955
ZITADEL_PROJECT_ID=345644688256008195

# OAuth OIDC Application
ZITADEL_OAUTH_CLIENT_ID=345644688558063619
ZITADEL_OAUTH_REDIRECT_URI=http://localhost:3002/auth/callback

# API Application
ZITADEL_API_CLIENT_ID=345644690655215619
ZITADEL_API_APP_JWT_PATH=./secrets/zitadel-api-app-key.json

# Service Accounts for dual authentication
ZITADEL_CLIENT_JWT_PATH=./secrets/zitadel-client-service-account.json
ZITADEL_API_JWT_PATH=./secrets/zitadel-api-service-account.json

# Legacy auth settings (can be removed once fully migrated)
AUTH_ISSUER=http://localhost:8200
AUTH_JWKS_URI=http://localhost:8200/oauth/v2/keys
# ^^^ Commented out to enable mock mode for development
# In mock mode, all authenticated users get full scope access

# --- Integration Settings Encryption ---
# 32-character key for AES-256 encryption of integration credentials
INTEGRATION_ENCRYPTION_KEY=gZXyEvwCaPpSngSmkUNr7gibNRkPTDom

# --- Scopes ---
# Disable scope verification for local development
SCOPES_DISABLED=1
# Enable extraction worker
EXTRACTION_WORKER_ENABLED=true
HTTP_LOG_PATH=./logs/http.log
