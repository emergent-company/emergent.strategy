openapi: 3.0.0
paths:
  /health:
    get:
      operationId: get
      parameters: []
      responses:
        '200':
          description: Health probe
          content:
            application/json:
              schema:
                example:
                  ok: true
                  model: text-embedding-004
                  db: up
                  embeddings: enabled
                  rls_policies_ok: true
                  rls_policy_count: 8
                  rls_policy_hash: policies:123:1a2b
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags:
        - Health
  /auth/me:
    get:
      operationId: me
      parameters: []
      responses:
        '200':
          description: Return current authenticated user
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserProfileDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Missing or invalid bearer token
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Unauthorized
        '403':
          description: Insufficient scope
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Forbidden
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: &ref_0
        - Auth
      security:
        - bearer: []
  /auth/test-passport:
    get:
      operationId: testPassport
      parameters: []
      responses:
        '200':
          description: Test passport-zitadel introspection
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Missing or invalid bearer token
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_0
      security:
        - bearer: []
  /user/profile:
    get:
      operationId: getSelf
      parameters: []
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserProfileDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: &ref_1
        - UserProfile
    put:
      operationId: updateSelf
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateUserProfileDto'
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserProfileDto'
        '400':
          description: Validation error
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_1
    delete:
      operationId: deleteAccount
      summary: Delete current user account
      description: >-
        Soft-deletes the user account and cascades to orgs/projects where user
        is sole owner. Deactivates user in Zitadel.
      parameters: []
      responses:
        '200':
          description: Account deletion summary
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeleteAccountResponseDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_1
  /user/profile/emails:
    get:
      operationId: listEmails
      parameters: []
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AlternativeEmailDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_1
    post:
      operationId: addEmail
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddAlternativeEmailDto'
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AlternativeEmailDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_1
  /user/profile/emails/{email}:
    delete:
      operationId: removeEmail
      parameters:
        - name: email
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                example:
                  status: deleted
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_1
  /admin/user-sync/status:
    get:
      operationId: getStatus
      summary: Get sync worker status
      description: Returns current status and statistics of the user profile sync worker
      parameters: []
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserSyncStatusResponseDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: &ref_2
        - Admin - User Sync
      security: &ref_3
        - bearer: []
  /admin/user-sync/trigger:
    post:
      operationId: triggerSync
      summary: Trigger sync batch
      description: >-
        Manually triggers a sync batch to process users with incomplete profile
        data
      parameters: []
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TriggerSyncResponseDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_2
      security: *ref_3
  /admin/user-sync/user/{userId}:
    post:
      operationId: syncUser
      summary: Sync specific user
      description: Manually sync a specific user by their internal ID
      parameters:
        - name: userId
          required: true
          in: path
          schema:
            format: uuid
            type: string
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserSyncResponseDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_2
      security: *ref_3
  /admin/user-sync/users-needing-sync:
    get:
      operationId: getUsersNeedingSync
      summary: List users needing sync
      description: >-
        Returns a list of users with incomplete profile data that need
        synchronization
      parameters:
        - name: limit
          required: false
          in: query
          description: 'Maximum number of users to return (default: 50)'
          schema:
            type: number
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UsersNeedingSyncResponseDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_2
      security: *ref_3
  /settings:
    get:
      operationId: list
      parameters: []
      responses:
        '200':
          description: List all settings
          content:
            application/json:
              schema:
                example:
                  - key: theme
                    value: dark
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: &ref_4
        - Settings
  /settings/{key}:
    get:
      operationId: getOne
      parameters:
        - name: key
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Get a single setting
          content:
            application/json:
              schema:
                example:
                  key: theme
                  value: dark
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '404':
          description: Setting not found
          content:
            application/json:
              schema:
                example:
                  error:
                    code: not-found
                    message: Setting not found
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_4
    put:
      operationId: update
      parameters:
        - name: key
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              example:
                value: dark
      responses:
        '200':
          description: Update or create a setting
          content:
            application/json:
              schema:
                example:
                  key: theme
                  value: dark
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_4
  /orgs:
    get:
      operationId: list
      parameters: []
      responses:
        '200':
          description: List organizations
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/OrgDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid filter
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: &ref_5
        - Orgs
    post:
      operationId: create
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateOrgDto'
      responses:
        '201':
          description: Organization created (users may have at most 10 orgs)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrgDto'
        '400':
          description: Invalid body
          content:
            application/json:
              schema:
                example:
                  error:
                    code: validation-failed
                    message: Validation failed
                    details:
                      name:
                        - must be a string
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '409':
          description: Organization limit reached or duplicate name
          content:
            application/json:
              schema:
                oneOf:
                  - example:
                      error:
                        code: conflict
                        message: Organization limit reached (10)
                  - example:
                      error:
                        code: conflict
                        message: Organization name already exists
                        details:
                          name:
                            - already exists
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_5
  /orgs/{id}:
    get:
      operationId: getOne
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Get an organization
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrgDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '404':
          description: Org not found
          content:
            application/json:
              schema:
                example:
                  error:
                    code: not-found
                    message: Org not found
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_5
    delete:
      operationId: delete
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: >-
            Organization deleted (projects, documents, chunks, conversations
            cascade)
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '404':
          description: Org not found
          content:
            application/json:
              schema:
                example:
                  error:
                    code: not-found
                    message: Org not found
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_5
  /projects:
    get:
      operationId: list
      parameters:
        - name: limit
          required: true
          in: query
          schema:
            type: string
        - name: orgId
          required: false
          in: query
          description: >-
            Filter projects by organization id (must be explicit elsewhere when
            creating projects)
          schema:
            type: string
      responses:
        '200':
          description: List projects (must create at least one before ingesting documents)
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ProjectDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid filter
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: &ref_6
        - Projects
    post:
      operationId: create
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateProjectDto'
      responses:
        '201':
          description: Project created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProjectDto'
        '400':
          description: Validation / duplicate / org errors
          content:
            application/json:
              schema:
                example:
                  error:
                    code: duplicate
                    message: Project with this name exists in org
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_6
  /projects/{id}:
    get:
      operationId: getById
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Get project by ID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProjectDto'
        '400':
          description: Invalid id
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid id
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_6
    patch:
      operationId: update
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateProjectDto'
      responses:
        '200':
          description: Project updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProjectDto'
        '400':
          description: Invalid id or validation error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid id
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_6
    delete:
      operationId: delete
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Deleted project
          content:
            application/json:
              schema:
                example:
                  status: deleted
        '400':
          description: Invalid id
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid id
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_6
  /projects/{id}/members:
    get:
      operationId: listMembers
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: List project members
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ProjectMemberDto'
        '400':
          description: Invalid project id
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid id
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_6
  /projects/{id}/members/{userId}:
    delete:
      operationId: removeMember
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
        - name: userId
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Member removed from project
          content:
            application/json:
              schema:
                example:
                  status: removed
        '400':
          description: Invalid id
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid id
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Cannot remove last admin
          content:
            application/json:
              schema:
                example:
                  error:
                    code: last-admin
                    message: >-
                      Cannot remove the last admin from the project. Assign
                      another admin first.
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_6
  /projects/{id}/invites:
    get:
      operationId: listInvites
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: List sent invitations for a project
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/SentInviteDto'
        '400':
          description: Invalid project id
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid id
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_6
  /template-packs:
    post:
      operationId: createTemplatePack
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTemplatePackDto'
      responses:
        '201':
          description: ''
    get:
      operationId: listTemplatePacks
      parameters: []
      responses:
        '200':
          description: ''
  /template-packs/{id}:
    get:
      operationId: getTemplatePack
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: ''
    delete:
      operationId: deleteTemplatePack
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '204':
          description: ''
  /template-packs/projects/{projectId}/available:
    get:
      operationId: getAvailableTemplates
      parameters:
        - name: projectId
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: ''
  /template-packs/projects/{projectId}/compiled-types:
    get:
      operationId: getCompiledObjectTypes
      parameters:
        - name: projectId
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: ''
  /template-packs/projects/{projectId}/installed:
    get:
      operationId: getInstalledTemplatePacks
      parameters:
        - name: projectId
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: ''
  /template-packs/projects/{projectId}/assign:
    post:
      operationId: assignTemplatePack
      parameters:
        - name: projectId
          required: true
          in: path
          schema:
            type: string
        - name: org_id
          required: true
          in: query
          schema:
            type: string
        - name: user_id
          required: true
          in: query
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AssignTemplatePackDto'
      responses:
        '201':
          description: ''
  /template-packs/projects/{projectId}/assignments/{assignmentId}:
    patch:
      operationId: updateTemplatePackAssignment
      parameters:
        - name: projectId
          required: true
          in: path
          schema:
            type: string
        - name: assignmentId
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTemplatePackAssignmentDto'
      responses:
        '200':
          description: ''
    delete:
      operationId: uninstallTemplatePack
      parameters:
        - name: projectId
          required: true
          in: path
          schema:
            type: string
        - name: assignmentId
          required: true
          in: path
          schema:
            type: string
      responses:
        '204':
          description: ''
  /template-packs/studio:
    post:
      operationId: createSession
      summary: Create a new studio session
      description: >-
        Creates a new studio session with an empty draft pack or cloned from an
        existing pack.
      parameters: []
      responses:
        '201':
          description: Studio session created
        '400':
          description: Invalid request
      tags: &ref_7
        - Template Pack Studio
  /template-packs/studio/{packId}:
    post:
      operationId: loadPackForEditing
      summary: Load existing pack into studio
      description: Creates a studio session by cloning an existing pack for editing.
      parameters:
        - name: packId
          required: true
          in: path
          schema:
            type: string
      responses:
        '201':
          description: Studio session created with cloned pack
        '404':
          description: Pack not found
      tags: *ref_7
  /template-packs/studio/session/{sessionId}:
    get:
      operationId: getSession
      summary: Get studio session state
      description: Returns the current state of a studio session.
      parameters:
        - name: sessionId
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Session state
        '404':
          description: Session not found
      tags: *ref_7
    delete:
      operationId: discardSession
      summary: Discard studio session
      description: Discards the session and its draft pack.
      parameters:
        - name: sessionId
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Session discarded
        '404':
          description: Session not found
      tags: *ref_7
  /template-packs/studio/sessions:
    get:
      operationId: getUserSessions
      summary: Get user studio sessions
      description: Returns active studio sessions for the current user.
      parameters: []
      responses:
        '200':
          description: List of active sessions
      tags: *ref_7
  /template-packs/studio/session/{sessionId}/chat:
    post:
      operationId: sendMessage
      summary: Send chat message to studio
      description: >-
        Sends a user message and streams the AI response with schema
        suggestions.
      parameters:
        - name: sessionId
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StudioMessageDto'
      responses:
        '200':
          description: Streaming response with AI suggestions
          content:
            text/event-stream:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/StudioStreamMetaEvent'
                  - $ref: '#/components/schemas/StudioStreamTokenEvent'
                  - $ref: '#/components/schemas/StudioStreamSuggestionsEvent'
                  - $ref: '#/components/schemas/StudioStreamErrorEvent'
                  - $ref: '#/components/schemas/StudioStreamDoneEvent'
        '400':
          description: Invalid request
        '403':
          description: Access denied
        '404':
          description: Session not found
      tags: *ref_7
  /template-packs/studio/session/{sessionId}/apply:
    post:
      operationId: applySuggestion
      summary: Apply a suggestion
      description: Applies a schema suggestion to the draft pack.
      parameters:
        - name: sessionId
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ApplyStudioSuggestionDto'
      responses:
        '200':
          description: Suggestion applied successfully
        '400':
          description: Invalid request
        '404':
          description: Session or suggestion not found
      tags: *ref_7
  /template-packs/studio/session/{sessionId}/reject:
    post:
      operationId: rejectSuggestion
      summary: Reject a suggestion
      description: Marks a suggestion as rejected.
      parameters:
        - name: sessionId
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RejectStudioSuggestionDto'
      responses:
        '200':
          description: Suggestion rejected
        '404':
          description: Session or suggestion not found
      tags: *ref_7
  /template-packs/studio/session/{sessionId}/save:
    post:
      operationId: savePack
      summary: Save the template pack
      description: Finalizes and publishes the draft pack.
      parameters:
        - name: sessionId
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Pack saved successfully
        '400':
          description: Invalid request or validation error
        '404':
          description: Session not found
      tags: *ref_7
  /template-packs/studio/session/{sessionId}/messages:
    get:
      operationId: getMessages
      summary: Get session messages
      description: Returns all messages in the studio session.
      parameters:
        - name: sessionId
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: List of messages
        '404':
          description: Session not found
      tags: *ref_7
  /template-packs/studio/cleanup/empty-drafts:
    delete:
      operationId: cleanupEmptyDrafts
      summary: Clean up empty draft packs
      description: Removes draft template packs that have no messages (orphaned drafts).
      parameters: []
      responses:
        '200':
          description: Cleanup result
          content:
            application/json:
              schema:
                type: object
                properties:
                  cleaned:
                    type: number
                    description: Number of drafts cleaned
      tags: *ref_7
  /chat-ui/conversations:
    get:
      operationId: getConversations
      parameters: []
      responses:
        '200':
          description: List user conversations
      tags: &ref_8
        - Chat UI
  /chat-ui/conversations/{id}:
    get:
      operationId: getConversation
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Get conversation details
      tags: *ref_8
    patch:
      operationId: updateConversation
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Update conversation title
      tags: *ref_8
    delete:
      operationId: deleteConversation
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Delete conversation
      tags: *ref_8
  /chat-ui/conversations/{id}/messages:
    get:
      operationId: getConversationMessages
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
        - name: limit
          required: true
          in: query
          schema:
            type: string
        - name: beforeId
          required: true
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Get paginated conversation messages
      tags: *ref_8
  /chat-ui/conversations/{id}/draft:
    patch:
      operationId: updateConversationDraft
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Update conversation draft text
      tags: *ref_8
  /chat-ui/conversations/{id}/tools:
    patch:
      operationId: updateConversationTools
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Update conversation enabled tools
      tags: *ref_8
  /chat-ui:
    post:
      operationId: chat
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChatRequestDto'
      responses:
        '200':
          description: Streaming chat response
          content:
            text/event-stream:
              schema:
                type: string
                description: Server-sent events stream
      tags: *ref_8
  /invites/with-user:
    post:
      operationId: createWithUser
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateInviteWithUserDto'
      responses:
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: &ref_9
        - Invites
  /invites:
    post:
      operationId: create
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateInviteDto'
      responses:
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_9
  /invites/accept:
    post:
      operationId: accept
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AcceptInviteDto'
      responses:
        '200':
          description: Invitation accepted
          content:
            application/json:
              schema:
                example:
                  status: accepted
        '400':
          description: Invalid state or token
          content:
            application/json:
              schema:
                example:
                  error:
                    code: invalid-state
                    message: Invite not pending
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_9
  /invites/pending:
    get:
      operationId: listPending
      parameters: []
      responses:
        '200':
          description: List of pending invitations for the current user
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PendingInviteDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_9
  /invites/{id}/decline:
    post:
      operationId: decline
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Invitation declined
          content:
            application/json:
              schema:
                example:
                  status: declined
        '400':
          description: Invalid state
          content:
            application/json:
              schema:
                example:
                  error:
                    code: invalid-state
                    message: Invitation is already accepted
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Not your invitation
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: This invitation is not for you
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_9
  /invites/{id}:
    delete:
      operationId: cancel
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Invitation cancelled
          content:
            application/json:
              schema:
                example:
                  status: revoked
        '400':
          description: Invalid state
          content:
            application/json:
              schema:
                example:
                  error:
                    code: invalid-state
                    message: 'Cannot cancel invitation with status: accepted'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_9
  /search:
    get:
      operationId: search
      parameters:
        - name: q
          required: true
          in: query
          description: Query string
          schema:
            example: vector index design
            type: string
        - name: limit
          required: false
          in: query
          description: Result limit (1..50)
          schema:
            minimum: 1
            maximum: 50
            default: 10
            type: number
        - name: mode
          required: false
          in: query
          schema:
            default: hybrid
            enum:
              - hybrid
              - lexical
              - vector
            type: string
        - name: lexicalWeight
          required: false
          in: query
          description: >-
            Lexical weight for hybrid search (0-1). Only used when mode=hybrid.
            Weights are normalized to sum to 1.
          schema:
            minimum: 0
            maximum: 1
            default: 0.5
            example: 0.7
            type: number
        - name: vectorWeight
          required: false
          in: query
          description: >-
            Vector weight for hybrid search (0-1). Only used when mode=hybrid.
            Weights are normalized to sum to 1.
          schema:
            minimum: 0
            maximum: 1
            default: 0.5
            example: 0.3
            type: number
        - name: includePaths
          required: false
          in: query
          description: >-
            Include path summaries showing how results relate to other objects
            in the knowledge graph
          schema:
            default: false
            type: boolean
      responses:
        '200':
          description: Hybrid / lexical / vector search over chunks
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SearchResponseDto'
        '400':
          description: Validation failed
          content:
            application/json:
              schema:
                example:
                  error:
                    code: validation-failed
                    message: Validation failed
                    details:
                      q:
                        - must be longer than or equal to 1 characters
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags:
        - Search
  /documents:
    get:
      operationId: list
      parameters:
        - name: limit
          required: false
          in: query
          schema:
            type: number
            minimum: 1
            maximum: 500
            default: 100
        - name: cursor
          required: true
          in: query
          schema:
            type: string
      responses:
        '200':
          description: List ingested documents
          headers:
            x-next-cursor:
              description: Base64 cursor for next page
              schema:
                type: string
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DocumentDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid filter
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: &ref_10
        - Documents
    post:
      operationId: create
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              properties:
                filename:
                  type: string
                projectId:
                  type: string
                  format: uuid
                content:
                  type: string
      responses:
        '200':
          description: Created document
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DocumentDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_10
    delete:
      operationId: bulkDelete
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BulkDeleteRequestDto'
      responses:
        '200':
          description: Bulk delete documents with cascade
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BulkDeletionSummaryDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_10
  /documents/{id}:
    get:
      operationId: get
      parameters:
        - name: id
          required: true
          in: path
          description: Document UUID
          schema:
            type: string
      responses:
        '200':
          description: Get a document
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DocumentDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid id
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_10
    delete:
      operationId: delete
      parameters:
        - name: id
          required: true
          in: path
          description: Document UUID
          schema:
            type: string
      responses:
        '200':
          description: Delete a document with cascade
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeletionSummaryDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_10
  /documents/{id}/deletion-impact:
    get:
      operationId: getDeletionImpact
      parameters:
        - name: id
          required: true
          in: path
          description: Document UUID
          schema:
            type: string
      responses:
        '200':
          description: Get deletion impact analysis for a document
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeletionImpactDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_10
  /documents/deletion-impact:
    post:
      operationId: getBulkDeletionImpact
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BulkDeleteRequestDto'
      responses:
        '200':
          description: Get bulk deletion impact analysis
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BulkDeletionImpactDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_10
  /documents/{id}/recreate-chunks:
    post:
      operationId: recreateChunks
      parameters:
        - name: id
          required: true
          in: path
          description: Document UUID
          schema:
            type: string
      responses:
        '200':
          description: Recreate chunks for a document using project chunking config
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  summary:
                    type: object
                    properties:
                      oldChunks:
                        type: number
                        example: 5
                      newChunks:
                        type: number
                        example: 7
                      strategy:
                        type: string
                        example: sentence
                      config:
                        type: object
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_10
  /chunks:
    get:
      operationId: list
      parameters:
        - name: documentId
          required: false
          in: query
          description: Filter by document UUID
          schema:
            type: string
      responses:
        '200':
          description: List chunks
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ChunkDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid filter
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: &ref_11
        - Chunks
    delete:
      operationId: bulkDelete
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                ids:
                  type: array
                  items:
                    type: string
                    format: uuid
                  description: Array of chunk UUIDs to delete
              required:
                - ids
      responses:
        '200':
          description: Bulk delete chunks
          content:
            application/json:
              schema:
                example:
                  totalDeleted: 3
                  totalFailed: 0
                  results:
                    - chunkId: uuid-1
                      success: true
                    - chunkId: uuid-2
                      success: true
                    - chunkId: uuid-3
                      success: true
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: ids array is required
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_11
  /chunks/{id}:
    delete:
      operationId: delete
      parameters:
        - name: id
          required: true
          in: path
          description: Chunk UUID
          schema:
            type: string
      responses:
        '200':
          description: Chunk deleted successfully
          content:
            application/json:
              schema:
                example:
                  success: true
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid chunk ID
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '404':
          description: Chunk not found
          content:
            application/json:
              schema:
                example:
                  error:
                    code: not-found
                    message: Chunk not found
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_11
  /chunks/by-document/{documentId}:
    delete:
      operationId: deleteByDocument
      parameters:
        - name: documentId
          required: true
          in: path
          description: Document UUID
          schema:
            type: string
      responses:
        '200':
          description: Delete all chunks for a document
          content:
            application/json:
              schema:
                example:
                  documentId: uuid
                  documentTitle: document.pdf
                  chunksDeleted: 15
                  success: true
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid document ID
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '404':
          description: Document not found
          content:
            application/json:
              schema:
                example:
                  error:
                    code: not-found
                    message: Document not found
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_11
  /chunks/by-documents:
    delete:
      operationId: bulkDeleteByDocuments
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                documentIds:
                  type: array
                  items:
                    type: string
                    format: uuid
                  description: Array of document UUIDs to delete chunks for
              required:
                - documentIds
      responses:
        '200':
          description: Delete all chunks for multiple documents
          content:
            application/json:
              schema:
                example:
                  totalDocuments: 2
                  totalChunksDeleted: 30
                  totalFailed: 0
                  results:
                    - documentId: uuid-1
                      documentTitle: doc1.pdf
                      chunksDeleted: 15
                      success: true
                    - documentId: uuid-2
                      documentTitle: doc2.pdf
                      chunksDeleted: 15
                      success: true
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: documentIds array is required
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_11
  /ingest/upload:
    post:
      operationId: upload
      parameters: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/IngestionUploadDto'
      responses:
        '200':
          description: Upload a file for ingestion
          content:
            application/json:
              schema:
                example:
                  documentId: 11111111-2222-3333-4444-555555555555
                  chunks: 12
                  alreadyExists: false
        '400':
          description: Invalid upload payload
          content:
            application/json:
              schema:
                example:
                  error:
                    code: validation-failed
                    message: Validation failed
                    details:
                      filename:
                        - must be a string
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: &ref_12
        - Ingestion
  /ingest/url:
    post:
      operationId: ingestUrl
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IngestionUrlDto'
      responses:
        '200':
          description: Ingest a remote URL
          content:
            application/json:
              schema:
                example:
                  documentId: aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee
                  chunks: 8
                  alreadyExists: false
        '400':
          description: Invalid URL payload
          content:
            application/json:
              schema:
                example:
                  error:
                    code: validation-failed
                    message: Validation failed
                    details:
                      url:
                        - must be an URL address
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_12
  /ingest/upload-batch:
    post:
      operationId: uploadBatch
      summary: Batch upload multiple documents
      description: >-
        Upload multiple files in a single batch request for efficient document
        ingestion.
            
        **Limits:**

        - Maximum 100 files per batch

        - Maximum 10MB per file

        - Only text-based files are accepted (txt, md, html, json)


        **Processing:**

        - Files are processed concurrently (3 at a time)

        - Each file is checked for duplicates independently

        - Binary files are rejected with an error


        **Response:**

        - Returns a summary with counts and individual results for each file

        - Files can have status: 'success', 'duplicate', or 'failed'

        - Failed files include an error message explaining the failure
      parameters: []
      requestBody:
        required: true
        description: Upload multiple files for batch ingestion (max 100 files)
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - files
                - projectId
              properties:
                files:
                  type: array
                  items:
                    type: string
                    format: binary
                  description: Array of files to upload (max 100 files, 10MB each)
                projectId:
                  type: string
                  format: uuid
                  description: Project UUID that all documents belong to (required)
                  example: aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee
                orgId:
                  type: string
                  format: uuid
                  description: Optional organisation UUID to associate documents with
                  example: 11111111-2222-3333-4444-555555555555
      responses:
        '200':
          description: Batch upload completed with summary and individual results
          content:
            application/json:
              schema:
                example:
                  summary:
                    total: 5
                    successful: 3
                    duplicates: 1
                    failed: 1
                  results:
                    - filename: doc1.md
                      status: success
                      documentId: 11111111-2222-3333-4444-555555555555
                      chunks: 12
                    - filename: doc2.txt
                      status: duplicate
                      documentId: 22222222-3333-4444-5555-666666666666
                    - filename: doc3.bin
                      status: failed
                      error: Binary or unsupported file type
        '400':
          description: Invalid batch upload payload
          content:
            application/json:
              schema:
                example:
                  error:
                    code: batch-limit-exceeded
                    message: Maximum 100 files allowed per batch
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_12
  /admin/extraction-jobs:
    post:
      operationId: createJob
      summary: Create extraction job
      description: >-
        Creates a new extraction job with queued status. Phase 2 will enqueue to
        worker queue.
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateExtractionJobDto'
      responses:
        '201':
          description: Job created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExtractionJobDto'
        '400':
          description: Invalid request data
        '401':
          description: Unauthorized
      tags: &ref_13
        - Extraction Jobs
      security: &ref_14
        - bearer: []
  /admin/extraction-jobs/projects/{projectId}:
    get:
      operationId: listJobs
      summary: List extraction jobs
      description: List extraction jobs for a project with optional filters and pagination
      parameters:
        - name: projectId
          required: true
          in: path
          description: Project ID
          schema:
            type: string
        - name: status
          required: false
          in: query
          description: Filter by status
          schema:
            enum:
              - queued
              - running
              - completed
              - requires_review
              - failed
              - cancelled
            type: string
        - name: source_type
          required: false
          in: query
          description: Filter by source type
          schema:
            enum:
              - document
              - api
              - manual
              - bulk_import
            type: string
        - name: source_id
          required: false
          in: query
          description: Filter by source ID
          schema:
            type: string
        - name: page
          required: false
          in: query
          description: Page number (1-indexed)
          schema:
            minimum: 1
            default: 1
            type: number
        - name: limit
          required: false
          in: query
          description: Items per page
          schema:
            minimum: 1
            default: 20
            type: number
      responses:
        '200':
          description: Jobs retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExtractionJobListDto'
        '401':
          description: Unauthorized
      tags: *ref_13
      security: *ref_14
  /admin/extraction-jobs/{jobId}:
    get:
      operationId: getJob
      summary: Get extraction job
      description: Get detailed information about a specific extraction job
      parameters:
        - name: jobId
          required: true
          in: path
          description: Job ID
          schema:
            type: string
      responses:
        '200':
          description: Job retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExtractionJobDto'
        '401':
          description: Unauthorized
        '404':
          description: Job not found
      tags: *ref_13
      security: *ref_14
    patch:
      operationId: updateJob
      summary: Update extraction job
      description: Update job status, progress, results, or errors
      parameters:
        - name: jobId
          required: true
          in: path
          description: Job ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateExtractionJobDto'
      responses:
        '200':
          description: Job updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExtractionJobDto'
        '400':
          description: Invalid update data
        '401':
          description: Unauthorized
        '404':
          description: Job not found
      tags: *ref_13
      security: *ref_14
    delete:
      operationId: deleteJob
      summary: Delete extraction job
      description: Delete a completed, failed, or cancelled extraction job
      parameters:
        - name: jobId
          required: true
          in: path
          description: Job ID
          schema:
            type: string
      responses:
        '204':
          description: Job deleted successfully
        '400':
          description: Cannot delete running/queued job
        '401':
          description: Unauthorized
        '404':
          description: Job not found
      tags: *ref_13
      security: *ref_14
  /admin/extraction-jobs/{jobId}/retry:
    post:
      operationId: retryJob
      summary: Retry a stuck or failed extraction job
      description: >-
        Resets a job stuck in running status or failed status back to queued for
        retry. Useful after server restarts that leave jobs orphaned.
      parameters:
        - name: jobId
          required: true
          in: path
          description: Job ID
          schema:
            type: string
      responses:
        '200':
          description: Job reset to queued for retry
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExtractionJobDto'
        '400':
          description: Cannot retry job with current status (only running/failed jobs)
        '401':
          description: Unauthorized
        '404':
          description: Job not found
      tags: *ref_13
      security: *ref_14
  /admin/extraction-jobs/{jobId}/cancel:
    post:
      operationId: cancelJob
      summary: Cancel extraction job
      description: Cancel a queued or running extraction job
      parameters:
        - name: jobId
          required: true
          in: path
          description: Job ID
          schema:
            type: string
      responses:
        '200':
          description: Job cancelled successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExtractionJobDto'
        '400':
          description: Job cannot be cancelled (already completed/failed)
        '401':
          description: Unauthorized
        '404':
          description: Job not found
      tags: *ref_13
      security: *ref_14
  /admin/extraction-jobs/projects/{projectId}/bulk-cancel:
    post:
      operationId: bulkCancelJobs
      summary: Cancel all queued/running jobs
      description: Bulk cancel all queued and running extraction jobs for a project
      parameters:
        - name: projectId
          required: true
          in: path
          description: Project ID
          schema:
            type: string
      responses:
        '200':
          description: Jobs cancelled successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  cancelled:
                    type: number
                    example: 5
                  message:
                    type: string
                    example: Cancelled 5 jobs
        '401':
          description: Unauthorized
      tags: *ref_13
      security: *ref_14
  /admin/extraction-jobs/projects/{projectId}/bulk-delete:
    delete:
      operationId: bulkDeleteJobs
      summary: Delete all completed/failed/cancelled jobs
      description: Bulk delete all extraction jobs that are completed, failed, or cancelled
      parameters:
        - name: projectId
          required: true
          in: path
          description: Project ID
          schema:
            type: string
      responses:
        '200':
          description: Jobs deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  deleted:
                    type: number
                    example: 10
                  message:
                    type: string
                    example: Deleted 10 jobs
        '401':
          description: Unauthorized
      tags: *ref_13
      security: *ref_14
  /admin/extraction-jobs/projects/{projectId}/bulk-retry:
    post:
      operationId: bulkRetryJobs
      summary: Retry all failed jobs
      description: Bulk retry all extraction jobs with failed status
      parameters:
        - name: projectId
          required: true
          in: path
          description: Project ID
          schema:
            type: string
      responses:
        '200':
          description: Jobs reset for retry successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  retried:
                    type: number
                    example: 3
                  message:
                    type: string
                    example: Retrying 3 jobs
        '401':
          description: Unauthorized
      tags: *ref_13
      security: *ref_14
  /admin/extraction-jobs/projects/{projectId}/statistics:
    get:
      operationId: getStatistics
      summary: Get job statistics
      description: Get aggregated statistics for extraction jobs in a project
      parameters:
        - name: projectId
          required: true
          in: path
          description: Project ID
          schema:
            type: string
      responses:
        '200':
          description: Statistics retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  total:
                    type: number
                    example: 150
                  by_status:
                    type: object
                    example:
                      queued: 5
                      running: 2
                      completed: 120
                      failed: 20
                      cancelled: 3
                  by_source_type:
                    type: object
                    example:
                      document: 100
                      api: 30
                      manual: 20
                  avg_duration_ms:
                    type: number
                    nullable: true
                    example: 45000
                  total_objects_created:
                    type: number
                    example: 5230
                  total_types_discovered:
                    type: number
                    example: 15
        '401':
          description: Unauthorized
      tags: *ref_13
      security: *ref_14
  /admin/extraction-jobs/_debug/available-models:
    get:
      operationId: listAvailableModels
      summary: List available Gemini models
      description: >-
        Query Google Gemini API to list all available models with their
        capabilities
      parameters: []
      responses:
        '200':
          description: Models retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  current_model:
                    type: string
                    example: gemini-1.5-flash-latest
                  available_models:
                    type: array
                    items:
                      type: object
                      properties:
                        name:
                          type: string
                          example: models/gemini-2.0-flash-exp
                        displayName:
                          type: string
                          example: Gemini 2.0 Flash
                        description:
                          type: string
                        supportedGenerationMethods:
                          type: array
                          items:
                            type: string
                        inputTokenLimit:
                          type: number
                        outputTokenLimit:
                          type: number
        '500':
          description: Failed to fetch models from API
      tags: *ref_13
      security: *ref_14
  /admin/extraction-jobs/{jobId}/logs:
    get:
      operationId: getExtractionLogs
      summary: Get detailed extraction logs
      description: >-
        Retrieve step-by-step logs for an extraction job including LLM
        interactions, errors, and performance metrics
      parameters:
        - name: jobId
          required: true
          in: path
          description: Extraction job UUID
          schema:
            type: string
      responses:
        '200':
          description: Logs retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  logs:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          format: uuid
                        logged_at:
                          type: string
                          format: date-time
                        step_index:
                          type: number
                        operation_type:
                          type: string
                          enum:
                            - llm_call
                            - chunk_processing
                            - object_creation
                            - relationship_creation
                            - suggestion_creation
                            - validation
                            - error
                        operation_name:
                          type: string
                          nullable: true
                        status:
                          type: string
                          enum:
                            - success
                            - error
                            - warning
                        input_data:
                          type: object
                          nullable: true
                        output_data:
                          type: object
                          nullable: true
                        error_message:
                          type: string
                          nullable: true
                        error_stack:
                          type: string
                          nullable: true
                        duration_ms:
                          type: number
                          nullable: true
                        tokens_used:
                          type: number
                          nullable: true
                        metadata:
                          type: object
                          nullable: true
                  summary:
                    type: object
                    properties:
                      totalSteps:
                        type: number
                      successSteps:
                        type: number
                      errorSteps:
                        type: number
                      warningSteps:
                        type: number
                      totalDurationMs:
                        type: number
                      totalTokensUsed:
                        type: number
                      operationCounts:
                        type: object
        '400':
          description: Invalid job ID format
        '403':
          description: Access denied to this extraction job
        '404':
          description: Extraction job not found
      tags: *ref_13
      security: *ref_14
  /graph/objects:
    post:
      operationId: create
      summary: Create a graph object (initial version)
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateGraphObjectDto'
      responses:
        '201':
          description: Created
        '400':
          description: Validation error
      tags: &ref_15
        - Graph
  /graph/objects/search:
    get:
      operationId: searchObjects
      summary: Search graph objects (basic filters)
      description: >-
        Supports pagination via created_at cursor. Optional order param
        (asc|desc) controls chronological direction (default asc). Desc returns
        newest first; cursor always set to last item created_at in current page.
      parameters:
        - name: type
          required: true
          in: query
          schema:
            type: string
        - name: key
          required: true
          in: query
          schema:
            type: string
        - name: label
          required: true
          in: query
          schema:
            type: string
        - name: limit
          required: true
          in: query
          schema:
            type: string
        - name: cursor
          required: true
          in: query
          schema:
            type: string
        - name: order
          required: false
          in: query
          description: >-
            Chronological direction (asc=oldestnewest, desc=newestoldest).
            Default asc.
          schema:
            enum:
              - asc
              - desc
            type: string
        - name: branch_id
          required: false
          in: query
          description: >-
            Filter objects by branch ID. Use "null" to search main branch
            (branch_id IS NULL). Omit to search all branches.
          schema:
            type: string
        - name: related_to_id
          required: false
          in: query
          description: Filter objects connected to this ID via any relationship.
          schema:
            type: string
        - name: ids
          required: false
          in: query
          description: Comma-separated list of object IDs to fetch.
          schema:
            type: string
        - name: extraction_job_id
          required: false
          in: query
          description: Filter objects by extraction job ID.
          schema:
            type: string
      responses:
        '200':
          description: ''
      tags: *ref_15
  /graph/objects/fts:
    get:
      operationId: ftsSearch
      summary: Full-text search graph objects
      description: >-
        Websearch syntax over inline-populated tsvector (type, key, properties
        JSON). Returns newest heads ranked by ts_rank. Supports optional type,
        label, branch_id filters. Limit max 100.
      parameters:
        - name: q
          required: true
          in: query
          description: Search query (websearch syntax)
          schema:
            type: string
        - name: limit
          required: true
          in: query
          schema:
            type: string
        - name: type
          required: true
          in: query
          schema:
            type: string
        - name: label
          required: true
          in: query
          schema:
            type: string
        - name: branch_id
          required: true
          in: query
          schema:
            type: string
      responses:
        '200':
          description: ''
      tags: *ref_15
  /graph/objects/tags:
    get:
      operationId: getTags
      summary: Get all distinct tags from graph objects
      parameters: []
      responses:
        '200':
          description: List of distinct tags
          content:
            application/json:
              schema:
                type: array
                items:
                  type: string
      tags: *ref_15
  /graph/objects/{id}:
    get:
      operationId: get
      summary: Get a graph object by ID
      description: >-
        Returns the object with the given ID. Use resolveHead=true to resolve to
        the HEAD version when the ID refers to an old version in the version
        chain.
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
        - name: resolveHead
          required: false
          in: query
          description: >-
            If true, resolves to the HEAD version (latest) when the ID refers to
            an older version. Useful when you have a stale ID but need the
            current version.
          schema:
            type: boolean
      responses:
        '200':
          description: ''
        '404':
          description: Not found
      tags: *ref_15
    patch:
      operationId: patch
      summary: Patch (create new version) of a graph object
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PatchGraphObjectDto'
      responses:
        '200':
          description: Version created
        '400':
          description: No effective change
        '404':
          description: Not found
      tags: *ref_15
    delete:
      operationId: deleteObject
      summary: Soft delete (tombstone) an object (creates new version with deleted_at)
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: ''
      tags: *ref_15
  /graph/objects/bulk-update-status:
    post:
      operationId: bulkUpdateStatus
      summary: Update status for multiple objects
      description: >-
        Updates the status field for multiple objects in a single request.
        Creates a new version for each object. Returns summary of successes and
        failures.
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BulkUpdateStatusDto'
      responses:
        '200':
          description: Bulk update completed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: number
                    description: Number of successfully updated objects
                  failed:
                    type: number
                    description: Number of failed updates
                  results:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                        success:
                          type: boolean
                        error:
                          type: string
      tags: *ref_15
  /graph/objects/{id}/restore:
    post:
      operationId: restoreObject
      summary: Restore a soft-deleted object (creates new version clearing deleted_at)
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '201':
          description: Restored (new version created)
      tags: *ref_15
  /graph/objects/{id}/history:
    get:
      operationId: history
      summary: List version history for a graph object
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
        - name: limit
          required: true
          in: query
          schema:
            type: string
        - name: cursor
          required: true
          in: query
          schema:
            type: string
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ObjectHistoryResponseDto'
        '404':
          description: Not found
      tags: *ref_15
  /graph/relationships:
    post:
      operationId: createRel
      summary: >-
        Create a relationship (initial version) or new version if properties
        changed
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateGraphRelationshipDto'
      responses:
        '201':
          description: ''
      tags: *ref_15
  /graph/relationships/{id}:
    get:
      operationId: getRel
      summary: Get relationship by id
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: ''
      tags: *ref_15
    patch:
      operationId: patchRel
      summary: Patch (create new version) of a relationship (only head version allowed)
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PatchGraphRelationshipDto'
      responses:
        '200':
          description: ''
      tags: *ref_15
    delete:
      operationId: deleteRel
      summary: Soft delete a relationship (tombstone version)
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: ''
      tags: *ref_15
  /graph/relationships/search:
    get:
      operationId: searchRels
      summary: Search relationships (basic filters)
      description: >-
        Supports pagination via created_at cursor. Optional order param
        (asc|desc) for chronological direction (default asc).
      parameters:
        - name: type
          required: true
          in: query
          schema:
            type: string
        - name: src_id
          required: true
          in: query
          schema:
            type: string
        - name: dst_id
          required: true
          in: query
          schema:
            type: string
        - name: limit
          required: true
          in: query
          schema:
            type: string
        - name: cursor
          required: true
          in: query
          schema:
            type: string
        - name: order
          required: false
          in: query
          description: >-
            Chronological direction (asc=oldestnewest, desc=newestoldest).
            Default asc.
          schema:
            enum:
              - asc
              - desc
            type: string
      responses:
        '200':
          description: ''
      tags: *ref_15
  /graph/relationships/{id}/restore:
    post:
      operationId: restoreRel
      summary: Restore a soft-deleted relationship
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '201':
          description: Restored (new version created)
      tags: *ref_15
  /graph/relationships/{id}/history:
    get:
      operationId: historyRel
      summary: List version history for a relationship
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
        - name: limit
          required: true
          in: query
          schema:
            type: string
        - name: cursor
          required: true
          in: query
          schema:
            type: string
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RelationshipHistoryResponseDto'
      tags: *ref_15
  /graph/objects/{id}/edges:
    get:
      operationId: edges
      summary: List relationships adjacent to an object
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
        - name: direction
          required: true
          in: query
          schema:
            type: string
        - name: limit
          required: true
          in: query
          schema:
            type: string
      responses:
        '200':
          description: ''
      tags: *ref_15
  /graph/traverse:
    post:
      operationId: traverse
      summary: Traverse the graph from one or more root object ids (bounded BFS)
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TraverseGraphDto'
      responses:
        '200':
          description: ''
      tags: *ref_15
  /graph/expand:
    post:
      operationId: expand
      summary: >-
        Expand graph (single-pass bounded traversal with projection & edge
        property option)
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GraphExpandDto'
      responses:
        '200':
          description: ''
      tags: *ref_15
  /graph/objects/vector-search:
    post:
      operationId: vectorSearch
      summary: Vector similarity search
      description: >-
        Returns nearest neighbors (cosine distance) for provided query vector
        over embedding_v2. Threshold: use maxDistance (preferred) or legacy
        minScore (acts as maximum distance). When both are supplied, maxDistance
        takes precedence.
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VectorSearchDto'
      responses:
        '200':
          description: ''
      tags: *ref_15
  /graph/objects/{id}/similar:
    get:
      operationId: similar
      summary: Find objects similar to given object id using stored embedding_v2
      description: >-
        Supports same filters as POST /graph/objects/vector-search (type, orgId,
        projectId, branchId, keyPrefix, labelsAll, labelsAny,
        maxDistance|minScore, limit). maxDistance preferred; if both provided,
        maxDistance overrides minScore.
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
        - name: limit
          required: false
          in: query
          description: Limit number of neighbors (1-100); default 10
          schema:
            type: number
        - name: minScore
          required: false
          in: query
          description: >-
            Maximum cosine distance (lower is more similar). 0  d  2. Rows
            with distance > threshold filtered out.
          schema:
            type: number
        - name: maxDistance
          required: false
          in: query
          description: >-
            Alias for minScore (preferred name). 0  d  2. If both provided,
            maxDistance wins.
          schema:
            type: number
        - name: type
          required: false
          in: query
          description: Filter by object type
          schema:
            type: string
        - name: orgId
          required: false
          in: query
          description: Filter by org id (UUID)
          schema:
            type: string
        - name: projectId
          required: false
          in: query
          description: Filter by project id (UUID)
          schema:
            type: string
        - name: branchId
          required: false
          in: query
          description: Filter by branch id (UUID)
          schema:
            type: string
        - name: keyPrefix
          required: false
          in: query
          description: Filter by key prefix (ILIKE)
          schema:
            type: string
        - name: labelsAll
          required: false
          in: query
          description: Require all labels to be present on object
          schema:
            type: array
            items:
              type: string
        - name: labelsAny
          required: false
          in: query
          description: Require any of the labels to overlap
          schema:
            type: array
            items:
              type: string
      responses:
        '200':
          description: ''
      tags: *ref_15
  /graph/search-with-neighbors:
    post:
      operationId: searchWithNeighbors
      summary: Search graph objects with optional neighbor expansion
      description: >-

        Performs semantic search over graph objects and optionally retrieves
        their neighbors.


        **Search Strategy:**

        - Uses full-text search (FTS) to find primary results matching the query

        - Optionally expands each result to include:
          1. Semantically similar objects (via vector embeddings)
          2. Directly connected objects (via relationships)

        **Use Cases:**

        - Chat context retrieval (similar to document citations)

        - Discovery features ("related objects")

        - Rich detail views with context


        **Neighbor Sources:**

        - **Semantic**: Objects with similar embedding vectors (via
        searchSimilar)

        - **Relational**: Objects connected via graph relationships (depends_on,
        implements, etc.)


        **Example:**

        ```json

        {
          "query": "authentication patterns",
          "limit": 5,
          "includeNeighbors": true,
          "maxNeighbors": 3,
          "maxDistance": 0.5
        }

        ```
                
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SearchObjectsWithNeighborsDto'
      responses:
        '200':
          description: Search results with optional neighbors
          content:
            application/json:
              schema:
                type: object
                properties:
                  primaryResults:
                    type: array
                    description: Objects matching the search query
                    items:
                      type: object
                  neighbors:
                    type: object
                    description: Map of object ID to array of neighbor objects
                    additionalProperties:
                      type: array
                      items:
                        type: object
      tags: *ref_15
  /graph/embedding-policies:
    post:
      operationId: createEmbeddingPolicy
      summary: Create an embedding policy for a project and object type
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateEmbeddingPolicyDto'
      responses:
        '201':
          description: Policy created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EmbeddingPolicyResponseDto'
        '400':
          description: Validation error or duplicate policy
      tags: *ref_15
    get:
      operationId: listEmbeddingPolicies
      summary: List all embedding policies for a project
      parameters:
        - name: project_id
          required: true
          in: query
          description: Filter policies by project ID
          schema:
            type: string
        - name: object_type
          required: false
          in: query
          description: Filter policies by object type
          schema:
            type: string
      responses:
        '200':
          description: List of policies
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/EmbeddingPolicyResponseDto'
      tags: *ref_15
  /graph/embedding-policies/{id}:
    get:
      operationId: getEmbeddingPolicy
      summary: Get a specific embedding policy by ID
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
        - name: project_id
          required: true
          in: query
          description: Project ID for authorization
          schema:
            type: string
      responses:
        '200':
          description: Policy details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EmbeddingPolicyResponseDto'
        '404':
          description: Policy not found
      tags: *ref_15
    patch:
      operationId: updateEmbeddingPolicy
      summary: Update an embedding policy
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
        - name: project_id
          required: true
          in: query
          description: Project ID for authorization
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateEmbeddingPolicyDto'
      responses:
        '200':
          description: Policy updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EmbeddingPolicyResponseDto'
        '400':
          description: Validation error
        '404':
          description: Policy not found
      tags: *ref_15
    delete:
      operationId: deleteEmbeddingPolicy
      summary: Delete an embedding policy
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
        - name: project_id
          required: true
          in: query
          description: Project ID for authorization
          schema:
            type: string
      responses:
        '204':
          description: Policy deleted
        '404':
          description: Policy not found
      tags: *ref_15
  /graph/branches/{targetBranchId}/merge:
    post:
      operationId: mergeDryRun
      summary: Branch merge (dry-run or execute)
      description: >-
        Enumerate divergent canonical graph objects between source and target
        branches. Default is dry-run (no mutations). If `execute=true` and there
        are no conflicts: Added objects are cloned into target; Fast-forward
        objects are patched by adding only new properties (superset heuristic).
        Conflicts block apply. Classification statuses: added, unchanged,
        fast_forward, conflict.
      parameters:
        - name: targetBranchId
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BranchMergeRequestDto'
      responses:
        '200':
          description: >-
            Merge summary including classification counts, per-object statuses,
            and optional applied/applied_objects when executed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BranchMergeSummaryDto'
        '400':
          description: Missing sourceBranchId or validation error
        '404':
          description: Branch not found
      tags: *ref_15
  /graph/embeddings/object/{id}/status:
    get:
      operationId: getEmbeddingJobStatus
      summary: Get embedding job status for an object
      description: >-
        Returns the active embedding job status (pending or processing) for the
        specified object. Returns 404 if no active job exists.
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Active embedding job found
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    format: uuid
                  object_id:
                    type: string
                    format: uuid
                  status:
                    type: string
                    enum:
                      - pending
                      - processing
                  attempt_count:
                    type: number
                  priority:
                    type: number
                  scheduled_at:
                    type: string
                    format: date-time
                  started_at:
                    type: string
                    format: date-time
                    nullable: true
                  created_at:
                    type: string
                    format: date-time
                  updated_at:
                    type: string
                    format: date-time
        '404':
          description: No active job found for this object
      tags: &ref_16
        - Graph
  /graph/embeddings/object/{id}:
    post:
      operationId: triggerEmbeddingForObject
      summary: Trigger embedding generation for a single object
      description: >-
        Enqueues an embedding job for the specified graph object. The job will
        be processed asynchronously by the embedding worker. Idempotent: if a
        job is already pending/processing for this object, returns the existing
        job.
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
        - name: priority
          required: true
          in: query
          schema:
            type: string
      responses:
        '201':
          description: Embedding job created or found
        '404':
          description: Object not found
      tags: *ref_16
  /graph/embeddings/batch:
    post:
      operationId: triggerEmbeddingsBatch
      summary: Trigger embedding generation for multiple objects
      description: >-
        Enqueues embedding jobs for the specified graph objects. Jobs will be
        processed asynchronously by the embedding worker. Idempotent: if a job
        is already pending/processing for an object, that job is skipped.
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TriggerEmbeddingsBatchDto'
      responses:
        '201':
          description: Embedding jobs created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EmbeddingJobResponseDto'
      tags: *ref_16
  /graph/embeddings/regenerate-project:
    post:
      operationId: triggerEmbeddingsProject
      summary: Trigger embedding regeneration for all objects in a project
      description: >-
        Enqueues embedding jobs for all graph objects in the specified project.
        Optionally filter by object type. Use force=true to regenerate
        embeddings even if they already exist. Jobs will be processed
        asynchronously by the embedding worker.
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TriggerEmbeddingsProjectDto'
      responses:
        '201':
          description: Embedding jobs created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EmbeddingJobResponseDto'
        '400':
          description: Invalid project ID
      tags: *ref_16
  /graph/branches:
    post:
      operationId: create
      parameters: []
      responses:
        '201':
          description: ''
    get:
      operationId: list
      parameters:
        - name: project_id
          required: true
          in: query
          schema:
            type: string
      responses:
        '200':
          description: ''
  /product-versions:
    post:
      operationId: create
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateProductVersionDto'
      responses:
        '200':
          description: Create product version snapshot
          content:
            application/json:
              schema:
                example:
                  id: 11111111-1111-4111-8111-111111111111
                  name: v1.0.0
                  member_count: 42
        '400':
          description: Name exists
          content:
            application/json:
              schema:
                example:
                  error:
                    code: product_version_name_exists
                    message: Name already exists
      tags: &ref_17
        - Product Versions
    get:
      operationId: list
      parameters:
        - name: cursor
          required: false
          in: query
          description: >-
            Pagination cursor (created_at timestamp of last item from previous
            page)
          schema:
            type: string
        - name: limit
          required: false
          in: query
          description: Number of items per page (1-100, default 20)
          schema:
            type: number
      responses:
        '200':
          description: List product version snapshots for a project
          content:
            application/json:
              schema:
                example:
                  items:
                    - id: ...
                      name: v1.0.0
                      description: null
                      created_at: '2025-01-01T00:00:00Z'
                      member_count: 42
                      base_product_version_id: null
                  next_cursor: '2025-01-01T00:00:00Z'
      tags: *ref_17
  /product-versions/{id}:
    get:
      operationId: get
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Get product version snapshot
      tags: *ref_17
  /product-versions/{id}/diff/{otherId}:
    get:
      operationId: diff
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
        - name: otherId
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Diff two product version snapshots
          content:
            application/json:
              schema:
                example:
                  items:
                    - canonical_id: ...
                      change_type: modified
                      version_a_object_id: ...
                      version_b_object_id: ...
                  meta:
                    added: 5
                    removed: 2
                    modified: 10
                    unchanged: 100
      tags: *ref_17
  /tags:
    post:
      operationId: create
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTagDto'
      responses:
        '201':
          description: Create tag
          content:
            application/json:
              schema:
                example:
                  id: 11111111-1111-4111-8111-111111111111
                  name: stable
                  product_version_id: 22222222-2222-4222-8222-222222222222
                  description: Stable release
                  created_at: '2025-09-30T00:00:00Z'
        '400':
          description: Tag name exists or product version not found
          content:
            application/json:
              schema:
                example:
                  error:
                    code: tag_name_exists
                    message: Tag name already exists
      tags: &ref_18
        - Tags
    get:
      operationId: list
      parameters:
        - name: cursor
          required: false
          in: query
          description: Pagination cursor (created_at timestamp)
          schema:
            type: string
        - name: limit
          required: false
          in: query
          description: Number of items per page (1-100, default 20)
          schema:
            type: number
      responses:
        '200':
          description: List tags for a project
          content:
            application/json:
              schema:
                example:
                  items:
                    - id: ...
                      name: stable
                      product_version_id: ...
                      description: null
                      created_at: '2025-09-30T00:00:00Z'
                  next_cursor: '2025-09-30T00:00:00Z'
      tags: *ref_18
  /tags/{id}:
    get:
      operationId: get
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Get tag by ID
        '404':
          description: Tag not found
      tags: *ref_18
    put:
      operationId: update
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTagDto'
      responses:
        '200':
          description: Update tag
        '404':
          description: Tag not found
      tags: *ref_18
    delete:
      operationId: delete
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '204':
          description: Tag deleted
        '404':
          description: Tag not found
      tags: *ref_18
  /tags/by-name/{name}:
    get:
      operationId: getByName
      parameters:
        - name: name
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Get tag by name
        '404':
          description: Tag not found
      tags: *ref_18
  /type-registry/projects/{projectId}:
    get:
      operationId: getProjectTypes
      parameters:
        - name: projectId
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: ''
  /type-registry/projects/{projectId}/types/{typeName}:
    get:
      operationId: getType
      parameters:
        - name: projectId
          required: true
          in: path
          schema:
            type: string
        - name: typeName
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: ''
    patch:
      operationId: updateType
      parameters:
        - name: projectId
          required: true
          in: path
          schema:
            type: string
        - name: typeName
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateObjectTypeDto'
      responses:
        '200':
          description: ''
    delete:
      operationId: deleteType
      parameters:
        - name: projectId
          required: true
          in: path
          schema:
            type: string
        - name: typeName
          required: true
          in: path
          schema:
            type: string
      responses:
        '204':
          description: ''
  /type-registry/projects/{projectId}/types:
    post:
      operationId: createType
      parameters:
        - name: projectId
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateObjectTypeDto'
      responses:
        '201':
          description: ''
  /type-registry/projects/{projectId}/validate:
    post:
      operationId: validateData
      parameters:
        - name: projectId
          required: true
          in: path
          schema:
            type: string
      responses:
        '201':
          description: ''
  /type-registry/projects/{projectId}/types/{typeName}/schema:
    get:
      operationId: getTypeSchema
      parameters:
        - name: projectId
          required: true
          in: path
          schema:
            type: string
        - name: typeName
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: ''
  /type-registry/projects/{projectId}/types/{typeName}/toggle:
    patch:
      operationId: toggleType
      parameters:
        - name: projectId
          required: true
          in: path
          schema:
            type: string
        - name: typeName
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: ''
  /type-registry/projects/{projectId}/stats:
    get:
      operationId: getProjectStats
      parameters:
        - name: projectId
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: ''
  /tasks:
    get:
      operationId: getTasks
      summary: Get tasks for a project
      parameters:
        - name: project_id
          required: true
          in: query
          description: Project ID to get tasks for
          schema:
            type: string
        - name: type
          required: false
          in: query
          description: Filter by type (e.g., "merge_suggestion")
          schema:
            type: string
        - name: page
          required: false
          in: query
          description: Page number (1-based)
          schema:
            type: number
        - name: limit
          required: false
          in: query
          description: Page size (default 50)
          schema:
            type: number
        - name: status
          required: false
          in: query
          description: Filter by status
          schema:
            enum:
              - pending
              - accepted
              - rejected
              - cancelled
            type: string
      responses:
        '200':
          description: List of tasks
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: &ref_19
        - Tasks
      security: &ref_20
        - bearer: []
  /tasks/counts:
    get:
      operationId: getCounts
      summary: Get task counts by status for a project
      parameters:
        - name: project_id
          required: true
          in: query
          description: Project ID
          schema:
            type: string
      responses:
        '200':
          description: Task counts
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_19
      security: *ref_20
  /tasks/{id}:
    get:
      operationId: getTask
      summary: Get a single task by ID
      parameters:
        - name: id
          required: true
          in: path
          description: Task ID
          schema:
            type: string
      responses:
        '200':
          description: Task details
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_19
      security: *ref_20
  /tasks/{id}/merge-suggestion:
    get:
      operationId: getMergeSuggestion
      summary: Get LLM-powered merge suggestion for a merge_suggestion task
      description: >-
        Generates an AI-powered suggestion for how to merge two similar objects.
        Only applicable to tasks of type "merge_suggestion".
      parameters:
        - name: id
          required: true
          in: path
          description: Task ID
          schema:
            type: string
      responses:
        '200':
          description: Merge suggestion with property-level recommendations
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_19
      security: *ref_20
  /tasks/{id}/resolve:
    post:
      operationId: resolve
      summary: Resolve a task (accept or reject)
      description: >-
        Resolves a pending task and marks any linked notifications as read. For
        merge_suggestion tasks that are accepted, this also executes the merge
        operation.
      parameters:
        - name: id
          required: true
          in: path
          description: Task ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ResolveTaskDto'
      responses:
        '200':
          description: Task resolved
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_19
      security: *ref_20
  /tasks/{id}/cancel:
    post:
      operationId: cancel
      summary: Cancel a task
      description: Cancels a pending task. Only applicable to pending tasks.
      parameters:
        - name: id
          required: true
          in: path
          description: Task ID
          schema:
            type: string
      responses:
        '200':
          description: Task cancelled
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_19
      security: *ref_20
  /tasks/{id}/merge-chat:
    get:
      operationId: getMergeChat
      summary: Get or create merge chat conversation for a task
      description: >-
        Loads an existing merge chat conversation or creates a new one for a
        merge_suggestion task.
      parameters:
        - name: id
          required: true
          in: path
          description: Task ID
          schema:
            type: string
        - name: x-project-id
          required: true
          in: header
          schema:
            type: string
      responses:
        '200':
          description: Merge chat conversation with messages
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_19
      security: *ref_20
    post:
      operationId: sendMergeChatMessage
      summary: Send a message to the merge chat
      description: Sends a user message and streams the AI response for merge assistance.
      parameters:
        - name: id
          required: true
          in: path
          description: Task ID
          schema:
            type: string
        - name: x-project-id
          required: true
          in: header
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MergeChatSendDto'
      responses:
        '200':
          description: Server-sent events stream with AI response
          content:
            text/event-stream:
              schema:
                type: string
                description: Server-sent events stream
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_19
      security: *ref_20
  /tasks/{id}/merge-chat/messages:
    get:
      operationId: getMergeChatMessages
      summary: Get messages for a merge chat conversation
      description: Returns messages for the merge chat (used for polling).
      parameters:
        - name: id
          required: true
          in: path
          description: Task ID
          schema:
            type: string
        - name: x-project-id
          required: true
          in: header
          schema:
            type: string
      responses:
        '200':
          description: Array of messages
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_19
      security: *ref_20
  /tasks/{id}/merge-chat/apply:
    post:
      operationId: applyMergeSuggestion
      summary: Apply a merge suggestion
      description: >-
        Accepts a merge suggestion, marking it as applied and updating the merge
        preview.
      parameters:
        - name: id
          required: true
          in: path
          description: Task ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MergeChatApplyDto'
      responses:
        '200':
          description: Result of applying the suggestion
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_19
      security: *ref_20
  /tasks/{id}/merge-chat/reject:
    post:
      operationId: rejectMergeSuggestion
      summary: Reject a merge suggestion
      description: Rejects a merge suggestion with an optional reason.
      parameters:
        - name: id
          required: true
          in: path
          description: Task ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MergeChatRejectDto'
      responses:
        '200':
          description: Result of rejecting the suggestion
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_19
      security: *ref_20
  /notifications:
    get:
      operationId: getNotifications
      summary: Get notifications for current user
      parameters:
        - name: tab
          required: false
          in: query
          description: Filter by tab
          schema:
            enum:
              - important
              - other
              - snoozed
              - cleared
            type: string
        - name: category
          required: false
          in: query
          description: Filter by category (e.g., "import", "extraction")
          schema:
            type: string
        - name: unread_only
          required: false
          in: query
          description: Show only unread notifications
          schema:
            type: boolean
        - name: search
          required: false
          in: query
          description: Search in title and message
          schema:
            type: string
      responses:
        '200':
          description: List of notifications
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: &ref_21
        - Notifications
      security: &ref_22
        - bearer: []
    delete:
      operationId: clearAll
      summary: Clear all notifications in a tab
      parameters:
        - name: tab
          required: false
          in: query
          description: Tab to clear
          schema:
            enum:
              - important
              - other
            type: string
      responses:
        '200':
          description: All notifications cleared
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_21
      security: *ref_22
  /notifications/counts:
    get:
      operationId: getUnreadCounts
      summary: Get unread notification counts
      parameters: []
      responses:
        '200':
          description: Notification counts by tab
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_21
      security: *ref_22
  /notifications/stats:
    get:
      operationId: getStats
      summary: Get notification statistics (unread, dismissed, total)
      parameters: []
      responses:
        '200':
          description: Notification statistics
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_21
      security: *ref_22
  /notifications/{id}/read:
    post:
      operationId: markRead
      summary: Mark notification as read
      parameters:
        - name: id
          required: true
          in: path
          description: Notification ID
          schema:
            type: string
      responses:
        '200':
          description: Notification marked as read
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_21
      security: *ref_22
  /notifications/{id}/unread:
    post:
      operationId: markUnread
      summary: Mark notification as unread
      parameters:
        - name: id
          required: true
          in: path
          description: Notification ID
          schema:
            type: string
      responses:
        '200':
          description: Notification marked as unread
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_21
      security: *ref_22
  /notifications/{id}/dismiss:
    post:
      operationId: dismiss
      summary: Dismiss notification
      parameters:
        - name: id
          required: true
          in: path
          description: Notification ID
          schema:
            type: string
      responses:
        '200':
          description: Notification dismissed
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_21
      security: *ref_22
  /notifications/{id}:
    delete:
      operationId: clear
      summary: Clear notification (move to cleared tab)
      parameters:
        - name: id
          required: true
          in: path
          description: Notification ID
          schema:
            type: string
      responses:
        '200':
          description: Notification cleared
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_21
      security: *ref_22
  /notifications/{id}/unclear:
    post:
      operationId: unclear
      summary: Restore notification from cleared tab
      parameters:
        - name: id
          required: true
          in: path
          description: Notification ID
          schema:
            type: string
      responses:
        '200':
          description: Notification restored
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_21
      security: *ref_22
  /notifications/{id}/snooze:
    post:
      operationId: snooze
      summary: Snooze notification until a specific time
      parameters:
        - name: id
          required: true
          in: path
          description: Notification ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SnoozeNotificationDto'
      responses:
        '200':
          description: Notification snoozed
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_21
      security: *ref_22
  /notifications/{id}/unsnooze:
    post:
      operationId: unsnooze
      summary: Unsnooze notification
      parameters:
        - name: id
          required: true
          in: path
          description: Notification ID
          schema:
            type: string
      responses:
        '200':
          description: Notification unsnoozed
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_21
      security: *ref_22
  /notifications/{id}/resolve:
    post:
      operationId: resolve
      summary: Resolve an actionable notification (accept or reject)
      description: >-
        Used for notifications that require user action (e.g., merge
        suggestions). Once resolved, the notification no longer counts toward
        pending limits.
      parameters:
        - name: id
          required: true
          in: path
          description: Notification ID
          schema:
            type: string
      responses:
        '200':
          description: Notification resolved
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_21
      security: *ref_22
  /monitoring/extraction-jobs:
    get:
      operationId: listExtractionJobs
      summary: List extraction jobs with metrics
      parameters:
        - name: type
          required: false
          in: query
          description: Type of resource to query (optional, inferred from endpoint path)
          schema:
            example: extraction_job
            enum:
              - extraction_job
              - chat_session
              - frontend_session
            type: string
        - name: limit
          required: false
          in: query
          description: Number of items to return
          schema:
            minimum: 1
            maximum: 100
            default: 50
            example: 50
            type: number
        - name: offset
          required: false
          in: query
          description: Number of items to skip
          schema:
            minimum: 0
            default: 0
            example: 0
            type: number
        - name: status
          required: false
          in: query
          description: Filter by status
          schema:
            example: completed
            type: string
        - name: date_from
          required: false
          in: query
          description: Filter by date from (ISO 8601)
          schema:
            example: '2025-10-01T00:00:00Z'
            type: string
        - name: date_to
          required: false
          in: query
          description: Filter by date to (ISO 8601)
          schema:
            example: '2025-10-31T23:59:59Z'
            type: string
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResourceListResponseDto'
      tags: &ref_23
        - monitoring
      security: &ref_24
        - bearer: []
  /monitoring/extraction-jobs/{id}:
    get:
      operationId: getExtractionJobDetail
      summary: Get extraction job details with logs and LLM calls
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResourceDetailResponseDto'
        '404':
          description: Job not found
      tags: *ref_23
      security: *ref_24
  /monitoring/extraction-jobs/{id}/logs:
    get:
      operationId: getExtractionJobLogs
      summary: Get process logs for extraction job
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
        - name: level
          required: false
          in: query
          description: Filter by log level
          schema:
            example: info
            enum:
              - debug
              - info
              - warn
              - error
              - fatal
            type: string
        - name: limit
          required: false
          in: query
          description: Number of log entries to return
          schema:
            minimum: 1
            maximum: 500
            default: 100
            example: 100
            type: number
        - name: offset
          required: false
          in: query
          description: Number of log entries to skip
          schema:
            minimum: 0
            default: 0
            example: 0
            type: number
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/LogEntryDto'
      tags: *ref_23
      security: *ref_24
  /monitoring/extraction-jobs/{id}/llm-calls:
    get:
      operationId: getExtractionJobLLMCalls
      summary: Get LLM calls for extraction job
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/LLMCallDto'
      tags: *ref_23
      security: *ref_24
  /prompts/{name}:
    get:
      operationId: getPrompt
      summary: Get a prompt by name
      description: >-
        Fetches a prompt from Langfuse by name. Returns the production-labeled
        version by default.
      parameters:
        - name: name
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Prompt found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PromptResponse'
        '404':
          description: Prompt not found
      tags: &ref_25
        - Prompts
    put:
      operationId: updatePrompt
      summary: Update a prompt
      description: >-
        Creates a new version of the prompt in Langfuse with the provided
        content.
      parameters:
        - name: name
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdatePromptDto'
      responses:
        '200':
          description: Prompt updated successfully
        '400':
          description: Invalid request
      tags: *ref_25
  /objects/{objectId}/refinement-chat:
    get:
      operationId: getOrCreateConversation
      summary: Get or create refinement conversation for an object
      description: >-
        Returns the existing refinement conversation for the object, or creates
        a new one if none exists.
      parameters:
        - name: objectId
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Refinement conversation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RefinementConversationDto'
        '403':
          description: Access denied
        '404':
          description: Object not found
      tags: &ref_26
        - Object Refinement
    post:
      operationId: sendMessage
      summary: Send a message to refinement chat
      description: >-
        Sends a user message and streams the AI response with refinement
        suggestions.
      parameters:
        - name: objectId
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefinementMessageDto'
      responses:
        '200':
          description: Streaming response with AI suggestions
          content:
            text/event-stream:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/RefinementStreamMetaEvent'
                  - $ref: '#/components/schemas/RefinementStreamTokenEvent'
                  - $ref: '#/components/schemas/RefinementStreamSuggestionsEvent'
                  - $ref: '#/components/schemas/RefinementStreamErrorEvent'
                  - $ref: '#/components/schemas/RefinementStreamDoneEvent'
        '400':
          description: Invalid request
        '403':
          description: Access denied
        '404':
          description: Object not found
      tags: *ref_26
  /objects/{objectId}/refinement-chat/apply:
    post:
      operationId: applySuggestion
      summary: Apply a suggestion to the object
      description: >-
        Applies a specific suggestion from an assistant message to modify the
        object.
      parameters:
        - name: objectId
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ApplySuggestionDto'
      responses:
        '200':
          description: Result of applying the suggestion
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApplySuggestionResultDto'
        '400':
          description: Invalid request or version conflict
        '403':
          description: Access denied
        '404':
          description: Object or suggestion not found
      tags: *ref_26
  /objects/{objectId}/refinement-chat/reject:
    post:
      operationId: rejectSuggestion
      summary: Reject a suggestion
      description: Marks a suggestion as rejected with an optional reason.
      parameters:
        - name: objectId
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RejectSuggestionDto'
      responses:
        '200':
          description: Suggestion rejected successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  error:
                    type: string
        '403':
          description: Access denied
        '404':
          description: Suggestion not found
      tags: *ref_26
  /objects/{objectId}/refinement-chat/messages:
    get:
      operationId: getMessages
      summary: Get messages for refinement conversation
      description: Returns all messages in the refinement conversation for an object.
      parameters:
        - name: objectId
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: List of messages
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/RefinementChatMessageDto'
        '404':
          description: Conversation not found
      tags: *ref_26
  /search/unified:
    post:
      operationId: search
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UnifiedSearchRequestDto'
      responses:
        '200':
          description: Unified search results combining graph objects and document chunks
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UnifiedSearchResponseDto'
        '400':
          description: Validation failed
          content:
            application/json:
              schema:
                example:
                  error:
                    code: validation-failed
                    message: Validation failed
                    details:
                      query:
                        - query must be shorter than or equal to 800 characters
        '403':
          description: Missing required scope (e.g., debug scope)
          content:
            application/json:
              schema:
                example:
                  error:
                    code: insufficient_scope
                    message: Debug scope required for includeDebug=true
                    details:
                      missing:
                        - search:debug
      tags:
        - Search
      security:
        - bearer: []
  /graph/search:
    post:
      operationId: search
      parameters:
        - name: debug
          required: true
          in: query
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GraphSearchRequestDto'
      responses:
        '200':
          description: Graph hybrid search results (prototype)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GraphSearchResponseDto'
        '403':
          description: Missing required scope (e.g., debug scope)
          content:
            application/json:
              schema:
                example:
                  error:
                    code: insufficient_scope
                    message: Debug scope required
                    details:
                      missing:
                        - graph:search:debug
      tags:
        - Graph
      security:
        - bearer: []
  /chat/conversations:
    get:
      operationId: listConversations
      parameters: []
      responses:
        '200':
          description: List chat conversations
          content:
            application/json:
              schema:
                example:
                  - id: 11111111-1111-4111-8111-111111111111
                    title: 2025-01-01  Hello world
                    is_private: false
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: &ref_27
        - Chat
    post:
      operationId: createConversation
      parameters: []
      responses:
        '200':
          description: Create a new conversation (201)
          content:
            application/json:
              schema:
                example:
                  conversationId: 11111111-1111-4111-8111-111111111111
                  id: 11111111-1111-4111-8111-111111111111
                  title: 2025-01-01  New Conversation
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: message required
      tags: *ref_27
  /chat/{id}:
    get:
      operationId: getConversation
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Get a conversation with messages
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Forbidden
        '404':
          description: Conversation not found
          content:
            application/json:
              schema:
                example:
                  error:
                    code: not-found
                    message: Conversation not found
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_27
    patch:
      operationId: rename
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Rename conversation
          content:
            application/json:
              schema:
                example:
                  ok: true
                  id: c1
                  title: New Title
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: title required
        '404':
          description: Conversation not found
          content:
            application/json:
              schema:
                example:
                  error:
                    code: not-found
                    message: Conversation not found
      tags: *ref_27
    delete:
      operationId: delete
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Delete conversation
          content:
            application/json:
              schema:
                example:
                  ok: true
                  id: c1
        '404':
          description: Conversation not found
          content:
            application/json:
              schema:
                example:
                  error:
                    code: not-found
                    message: Conversation not found
      tags: *ref_27
  /chat/{id}/stream:
    get:
      operationId: streamGet
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: >-
            Chat streaming endpoint (SSE). Emits a sequence of JSON frames each
            prefixed by "data: ".
          content:
            text/event-stream:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/GetChatStreamMetaFrame'
                  - $ref: '#/components/schemas/GetChatStreamTokenFrame'
                  - $ref: '#/components/schemas/GetChatStreamCitationsFrame'
                  - $ref: '#/components/schemas/GetChatStreamSummaryFrame'
                  - $ref: '#/components/schemas/GetChatStreamDoneFrame'
                  - $ref: '#/components/schemas/GetChatStreamErrorFrame'
              examples:
                meta:
                  value: |+
                    data: {"meta":{"chat_model_enabled":true,"google_key":true}}

                token:
                  value: |+
                    data: {"message":"token-0","index":0,"streaming":true}

                citations:
                  value: >+
                    data:
                    {"citations":[{"documentId":"11111111-1111-4111-8111-111111111111"}]}

                summary:
                  value: |+
                    data: {"summary":true,"token_count":5,"citations_count":2}

                done:
                  value: |+
                    data: {"done":true,"message":"[DONE]"}

                error:
                  value: >+
                    data:
                    {"error":{"code":"upstream-failed","message":"Simulated
                    upstream model failure"},"done":true}

        '400':
          description: Missing project header
          content:
            text/event-stream:
              schema:
                example:
                  error:
                    code: bad-request
                    message: x-project-id header required
        '404':
          description: Conversation not found
          content:
            text/event-stream:
              schema:
                example:
                  error:
                    code: not-found
                    message: Conversation not found
      tags: *ref_27
  /chat/stream:
    post:
      operationId: streamPost
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChatRequestDto'
      responses:
        '200':
          description: >-
            Chat streaming endpoint (SSE). Each line is an SSE data frame
            beginning with "data: ", followed by one of the JSON event shapes.
          content:
            text/event-stream:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/ChatStreamMetaEvent'
                  - $ref: '#/components/schemas/ChatStreamTokenEvent'
                  - $ref: '#/components/schemas/ChatStreamMcpToolEvent'
                  - $ref: '#/components/schemas/ChatStreamErrorEvent'
                  - $ref: '#/components/schemas/ChatStreamDoneEvent'
                description: >-
                  Union of possible chat stream events (serialized per line as
                  SSE frame).
              examples:
                meta:
                  value: >+
                    data:
                    {"type":"meta","conversationId":"11111111-1111-4111-8111-111111111111","citations":[]}

                mcp_started:
                  value: >+
                    data:
                    {"type":"mcp_tool","tool":"schema_version","status":"started"}

                mcp_completed:
                  value: >+
                    data:
                    {"type":"mcp_tool","tool":"schema_version","status":"completed","result":{"version":"1.0.0"}}

                mcp_error:
                  value: >+
                    data:
                    {"type":"mcp_tool","tool":"schema_version","status":"error","error":"MCP
                    server unavailable"}

                token:
                  value: |+
                    data: {"type":"token","token":"Hello"}

                error:
                  value: |+
                    data: {"type":"error","error":"model key missing"}

                done:
                  value: |+
                    data: {"type":"done"}

        '400':
          description: Bad request
          content:
            text/event-stream:
              schema:
                example:
                  error:
                    code: bad-request
                    message: message required
        '401':
          description: Unauthorized
          content:
            text/event-stream:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            text/event-stream:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            text/event-stream:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_27
  /discovery-jobs/projects/{projectId}/start:
    post:
      operationId: startDiscovery
      parameters:
        - name: projectId
          required: true
          in: path
          schema:
            type: string
      responses:
        '201':
          description: ''
  /discovery-jobs/{jobId}:
    get:
      operationId: getJobStatus
      parameters:
        - name: jobId
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: ''
    delete:
      operationId: cancelJob
      parameters:
        - name: jobId
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: ''
  /discovery-jobs/projects/{projectId}:
    get:
      operationId: listJobs
      parameters:
        - name: projectId
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: ''
  /discovery-jobs/{jobId}/finalize:
    post:
      operationId: finalizeDiscovery
      parameters:
        - name: jobId
          required: true
          in: path
          schema:
            type: string
      responses:
        '201':
          description: ''
  /integrations/available:
    get:
      operationId: listAvailableIntegrations
      summary: List available integration types
      description: >-
        Get a list of all integration types that can be configured (ClickUp,
        GitHub, etc.)
      parameters: []
      responses:
        '200':
          description: Available integrations retrieved successfully
        '401':
          description: Unauthorized
      tags: &ref_28
        - Integrations
      security: &ref_29
        - bearer: []
  /integrations:
    get:
      operationId: listIntegrations
      summary: List integrations
      description: List all integrations for a project with optional filters
      parameters: []
      responses:
        '200':
          description: Integrations retrieved successfully
        '401':
          description: Unauthorized
      tags: *ref_28
      security: *ref_29
    post:
      operationId: createIntegration
      summary: Create integration
      description: Create a new integration configuration with encrypted credentials
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateIntegrationDto'
      responses:
        '201':
          description: Integration created successfully
        '400':
          description: Invalid request data
        '401':
          description: Unauthorized
        '409':
          description: Integration already exists for this project
      tags: *ref_28
      security: *ref_29
  /integrations/{name}:
    get:
      operationId: getIntegration
      summary: Get integration
      description: Get detailed information about a specific integration
      parameters:
        - name: name
          required: true
          in: path
          description: Integration name (e.g., "clickup")
          schema:
            type: string
      responses:
        '200':
          description: Integration retrieved successfully
        '401':
          description: Unauthorized
        '404':
          description: Integration not found
      tags: *ref_28
      security: *ref_29
    put:
      operationId: updateIntegration
      summary: Update integration
      description: Update an existing integration configuration
      parameters:
        - name: name
          required: true
          in: path
          description: Integration name (e.g., "clickup")
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateIntegrationDto'
      responses:
        '200':
          description: Integration updated successfully
        '400':
          description: Invalid update data
        '401':
          description: Unauthorized
        '404':
          description: Integration not found
      tags: *ref_28
      security: *ref_29
    delete:
      operationId: deleteIntegration
      summary: Delete integration
      description: Delete an integration and all its associated data
      parameters:
        - name: name
          required: true
          in: path
          description: Integration name (e.g., "clickup")
          schema:
            type: string
      responses:
        '204':
          description: Integration deleted successfully
        '401':
          description: Unauthorized
        '404':
          description: Integration not found
      tags: *ref_28
      security: *ref_29
  /integrations/{name}/public:
    get:
      operationId: getPublicIntegrationInfo
      summary: Get public integration info
      description: Get non-sensitive information about an integration
      parameters:
        - name: name
          required: true
          in: path
          description: Integration name (e.g., "clickup")
          schema:
            type: string
      responses:
        '200':
          description: Public info retrieved successfully
        '401':
          description: Unauthorized
        '404':
          description: Integration not found
      tags: *ref_28
      security: *ref_29
  /integrations/{name}/test:
    post:
      operationId: testConnection
      summary: Test integration connection
      description: Test if the integration credentials are valid and the connection works
      parameters:
        - name: name
          required: true
          in: path
          description: Integration name (e.g., "clickup")
          schema:
            type: string
      responses:
        '200':
          description: Connection test completed
        '401':
          description: Unauthorized
        '404':
          description: Integration not found
      tags: *ref_28
      security: *ref_29
  /integrations/{name}/sync/stream:
    get:
      operationId: triggerSyncStream
      summary: Trigger integration sync with real-time progress (SSE)
      description: Starts a sync and streams progress updates via Server-Sent Events
      parameters:
        - name: name
          required: true
          in: path
          description: Integration name (e.g., "clickup")
          schema:
            type: string
      responses:
        '200':
          description: SSE stream started
      tags: *ref_28
      security: *ref_29
  /integrations/{name}/sync:
    post:
      operationId: triggerSync
      summary: Trigger integration sync
      description: Manually trigger a full import/sync from the integration
      parameters:
        - name: name
          required: true
          in: path
          description: Integration name (e.g., "clickup")
          schema:
            type: string
      responses:
        '200':
          description: Sync initiated successfully
        '400':
          description: Integration does not support import
        '401':
          description: Unauthorized
        '404':
          description: Integration not found
      tags: *ref_28
      security: *ref_29
  /integrations/clickup/structure:
    get:
      operationId: getClickUpWorkspaceStructure
      summary: Get ClickUp workspace structure
      description: >-
        Fetch hierarchical workspace structure (spaces, folders, lists) with
        task counts for list selection UI
      parameters: []
      responses:
        '200':
          description: Workspace structure retrieved successfully
        '401':
          description: Unauthorized
        '404':
          description: ClickUp integration not found or not configured
      tags: *ref_28
      security: *ref_29
  /integrations/clickup/spaces/{spaceId}:
    get:
      operationId: getClickUpSpace
      summary: Get ClickUp space details
      description: Fetch details for a specific ClickUp space by ID
      parameters:
        - name: spaceId
          required: true
          in: path
          description: ClickUp space ID
          schema:
            type: string
      responses:
        '200':
          description: Space details retrieved successfully
        '404':
          description: ClickUp integration not found or space not found
      tags: *ref_28
      security: *ref_29
  /integrations/clickup/folders/{folderId}:
    get:
      operationId: getClickUpFolder
      summary: Get ClickUp folder details
      description: Fetch details for a specific ClickUp folder by ID
      parameters:
        - name: folderId
          required: true
          in: path
          description: ClickUp folder ID
          schema:
            type: string
      responses:
        '200':
          description: Folder details retrieved successfully
        '404':
          description: ClickUp integration not found or folder not found
      tags: *ref_28
      security: *ref_29
  /mcp/schema/version:
    get:
      operationId: getSchemaVersion
      summary: Get current schema version hash
      description: >-
        Returns a hash representing the current state of all schemas. Agents can
        use this to determine if cached tools are still valid.
      parameters: []
      responses:
        '200':
          description: Current schema version information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SchemaVersionDto'
        '401':
          description: Missing or invalid bearer token
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Unauthorized
        '403':
          description: Insufficient scope - requires schema:read
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Forbidden
                    details:
                      missing:
                        - schema:read
      tags: &ref_30
        - MCP
      security: &ref_31
        - bearer: []
  /mcp/schema/changelog:
    get:
      operationId: getSchemaChangelog
      summary: Get schema change history
      description: Returns recent schema changes for debugging and tracking
      parameters:
        - name: since
          required: true
          in: query
          schema:
            type: string
        - name: limit
          required: true
          in: query
          schema:
            type: number
      responses:
        '200':
          description: Schema change history
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/SchemaChangeDto'
        '401':
          description: Missing or invalid bearer token
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Unauthorized
        '403':
          description: Insufficient scope - requires schema:read
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Forbidden
                    details:
                      missing:
                        - schema:read
      tags: *ref_30
      security: *ref_31
  /mcp/rpc:
    post:
      operationId: handleRpc
      summary: MCP JSON-RPC 2.0 Endpoint
      description: >-

        Model Context Protocol (MCP) server endpoint.


        **Protocol:** JSON-RPC 2.0

        **Methods:** initialize, tools/list, tools/call

        **Tools:** schema_version, schema_changelog, type_info,
        list_entity_types, query_entities


        **Project Context:**

        Project-specific tools (list_entity_types, query_entities) require a
        project ID.

        You can provide it either:

        1. In the initialize params: `"project_id": "uuid"`

        2. Via X-Project-Id header


        **Example Initialize Request (with project):**

        ```json

        {
          "jsonrpc": "2.0",
          "id": 1,
          "method": "initialize",
          "params": {
            "protocolVersion": "2025-06-18",
            "capabilities": {},
            "clientInfo": {
              "name": "example-client",
              "version": "1.0.0"
            },
            "project_id": "1e37ab78-f4af-4e61-9b71-5e263139525b"
          }
        }

        ```


        **Example tools/list Request:**

        ```json

        {
          "jsonrpc": "2.0",
          "id": 2,
          "method": "tools/list"
        }

        ```


        **Example tools/call Request:**

        ```json

        {
          "jsonrpc": "2.0",
          "id": 3,
          "method": "tools/call",
          "params": {
            "name": "schema_version",
            "arguments": {}
          }
        }

        ```
                
      parameters: []
      requestBody:
        required: true
        description: JSON-RPC 2.0 request
        content:
          application/json:
            schema:
              type: object
              required:
                - jsonrpc
                - method
              properties:
                jsonrpc:
                  type: string
                  enum:
                    - '2.0'
                  description: JSON-RPC version
                id:
                  oneOf:
                    - type: number
                    - type: string
                  description: Request ID (omit for notifications)
                method:
                  type: string
                  enum:
                    - initialize
                    - tools/list
                    - tools/call
                    - notifications/initialized
                  description: RPC method name
                params:
                  type: object
                  description: Method parameters
      responses:
        '200':
          description: JSON-RPC 2.0 response
          content:
            application/json:
              schema:
                oneOf:
                  - type: object
                    required:
                      - jsonrpc
                      - id
                      - result
                    properties:
                      jsonrpc:
                        type: string
                        enum:
                          - '2.0'
                      id:
                        oneOf:
                          - type: number
                          - type: string
                      result:
                        type: object
                  - type: object
                    required:
                      - jsonrpc
                      - id
                      - error
                    properties:
                      jsonrpc:
                        type: string
                        enum:
                          - '2.0'
                      id:
                        oneOf:
                          - type: number
                          - type: string
                          - type: 'null'
                      error:
                        type: object
                        required:
                          - code
                          - message
                        properties:
                          code:
                            type: number
                          message:
                            type: string
                          data:
                            type: object
      tags:
        - MCP Server (JSON-RPC 2.0)
      security:
        - bearer: []
  /user/orgs-and-projects:
    get:
      operationId: getOrgsAndProjects
      summary: Get user access tree (organizations and projects with roles)
      description: >-
        Returns hierarchical access tree with orgs and nested projects,
        including user roles at each level
      parameters: []
      responses:
        '200':
          description: Access tree retrieved successfully
          schema:
            example:
              - id: 550e8400-e29b-41d4-a716-446655440000
                name: Acme Corp
                role: org_admin
                projects:
                  - id: 550e8400-e29b-41d4-a716-446655440001
                    name: Product Docs
                    orgId: 550e8400-e29b-41d4-a716-446655440000
                    role: project_admin
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/OrgWithProjectsDto'
        '401':
          description: Unauthorized
      tags: &ref_32
        - user
      security: &ref_33
        - bearer: []
  /user/delete-account:
    post:
      operationId: deleteAccount
      summary: Delete user account and all data
      parameters: []
      responses:
        '200':
          description: Account deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  deleted:
                    type: object
                    properties:
                      organizations:
                        type: number
                      projects:
                        type: number
                      documents:
                        type: number
                      chunks:
                        type: number
                      embeddings:
                        type: number
                      extractionJobs:
                        type: number
                      graphObjects:
                        type: number
                      integrations:
                        type: number
                  duration_ms:
                    type: number
        '401':
          description: Unauthorized
      tags: *ref_32
      security: *ref_33
  /user/test-cleanup:
    post:
      operationId: testCleanup
      summary: Clean up test user data (test environments only)
      parameters: []
      responses:
        '200':
          description: Test data cleaned up successfully
        '403':
          description: Forbidden - not a test environment or test user
      tags: *ref_32
      security: *ref_33
  /chat-sdk/conversations:
    post:
      operationId: createConversation
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateConversationDto'
      responses:
        '201':
          description: Create a new conversation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateConversationResponseDto'
      tags: &ref_34
        - Chat SDK
  /chat-sdk/tools:
    get:
      operationId: getTools
      parameters: []
      responses:
        '200':
          description: List available chat tools with metadata
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ToolDefinitionsResponseDto'
      tags: *ref_34
  /chat-sdk:
    post:
      operationId: chat
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChatSdkRequestDto'
      responses:
        '200':
          description: Vercel AI SDK streaming chat response
          content:
            text/event-stream:
              schema:
                type: string
                description: Vercel AI SDK UI Message protocol stream
      tags: *ref_34
  /external-sources/import:
    post:
      operationId: importFromUrl
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ImportExternalSourceDto'
      responses:
        '201':
          description: Import result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ImportResultDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: &ref_35
        - External Sources
  /external-sources:
    get:
      operationId: list
      parameters:
        - name: limit
          required: false
          in: query
          description: 'Maximum number of results (default: 50, max: 100)'
          schema:
            type: number
            minimum: 1
            maximum: 100
            default: 50
        - name: cursor
          required: false
          in: query
          description: Pagination cursor from previous response
          schema:
            type: string
        - name: status
          required: false
          in: query
          description: Filter by status
          schema:
            enum:
              - active
              - error
              - disabled
            type: string
      responses:
        '200':
          description: List of external sources
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExternalSourceListDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_35
  /external-sources/{id}:
    get:
      operationId: getById
      parameters:
        - name: id
          required: true
          in: path
          description: External source UUID
          schema:
            type: string
      responses:
        '200':
          description: External source details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExternalSourceResponseDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_35
    patch:
      operationId: update
      parameters:
        - name: id
          required: true
          in: path
          description: External source UUID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateExternalSourceDto'
      responses:
        '200':
          description: Updated external source
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExternalSourceResponseDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_35
    delete:
      operationId: delete
      parameters:
        - name: id
          required: true
          in: path
          description: External source UUID
          schema:
            type: string
      responses:
        '200':
          description: External source deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: External source deleted
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_35
  /external-sources/{id}/sync:
    post:
      operationId: triggerSync
      parameters:
        - name: id
          required: true
          in: path
          description: External source UUID
          schema:
            type: string
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TriggerSyncDto'
      responses:
        '200':
          description: Sync result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SyncResultDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_35
  /user-activity/record:
    post:
      operationId: recordActivity
      summary: Record user activity (view or edit of a resource)
      description: >-
        Records that the current user accessed a document or object. Uses upsert
        to update existing records.
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RecordActivityDto'
      responses:
        '200':
          description: Activity recorded successfully
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: &ref_36
        - User Activity
      security: &ref_37
        - bearer: []
  /user-activity/recent:
    get:
      operationId: getRecentItems
      summary: Get recent items for the current user
      description: >-
        Returns recently accessed objects and documents for the current user in
        the current project.
      parameters: []
      responses:
        '200':
          description: Recent items retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RecentItemsResponseDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_36
      security: *ref_37
    delete:
      operationId: clearAllRecentItems
      summary: Clear all recent items
      description: Removes all recent items for the current user in the current project.
      parameters: []
      responses:
        '204':
          description: All items cleared successfully
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_36
      security: *ref_37
  /user-activity/recent/{type}:
    get:
      operationId: getRecentItemsByType
      summary: Get recent items by type
      description: >-
        Returns recently accessed items of a specific type (documents or
        objects).
      parameters:
        - name: type
          required: true
          in: path
          description: Type of resource to retrieve
          schema:
            enum:
              - document
              - object
            type: string
      responses:
        '200':
          description: Recent items retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/RecentItemDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_36
      security: *ref_37
  /user-activity/recent/{type}/{resourceId}:
    delete:
      operationId: removeRecentItem
      summary: Remove a specific item from recent items
      description: Removes a specific document or object from the recent items list.
      parameters:
        - name: type
          required: true
          in: path
          description: Type of resource
          schema:
            enum:
              - document
              - object
            type: string
        - name: resourceId
          required: true
          in: path
          description: UUID of the resource to remove
          schema:
            type: string
      responses:
        '204':
          description: Item removed successfully
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_36
      security: *ref_37
  /admin/agents:
    get:
      operationId: listAgents
      summary: List all agents
      parameters: []
      responses:
        '200':
          description: List of agent configurations
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: &ref_38
        - Agents
      security: &ref_39
        - bearer: []
  /admin/agents/{id}:
    get:
      operationId: getAgent
      summary: Get agent by ID
      parameters:
        - name: id
          required: true
          in: path
          schema:
            format: uuid
            type: string
      responses:
        '200':
          description: Agent configuration
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_38
      security: *ref_39
    patch:
      operationId: updateAgent
      summary: Update agent configuration
      parameters:
        - name: id
          required: true
          in: path
          schema:
            format: uuid
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                enabled:
                  type: boolean
                cronSchedule:
                  type: string
                config:
                  type: object
      responses:
        '200':
          description: Updated agent configuration
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_38
      security: *ref_39
  /admin/agents/{id}/runs:
    get:
      operationId: getAgentRuns
      summary: Get recent runs for an agent
      parameters:
        - name: id
          required: true
          in: path
          schema:
            format: uuid
            type: string
      responses:
        '200':
          description: List of agent runs
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_38
      security: *ref_39
  /admin/agents/{id}/trigger:
    post:
      operationId: triggerAgent
      summary: Trigger an immediate run of the agent
      parameters:
        - name: id
          required: true
          in: path
          schema:
            format: uuid
            type: string
      responses:
        '200':
          description: Agent triggered successfully
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_38
      security: *ref_39
  /events/stream:
    get:
      operationId: stream
      summary: Subscribe to real-time entity updates (SSE)
      description: >-
        Establishes a Server-Sent Events connection for receiving real-time
        updates. Events are scoped to the project specified in the projectId
        query parameter. Note: EventSource API does not support custom headers,
        so projectId must be passed as a query param.
      parameters:
        - name: projectId
          required: true
          in: query
          description: Project ID to receive events for
          schema:
            type: string
      responses:
        '200':
          description: SSE stream established
          content:
            text/event-stream:
              schema:
                type: string
                example: |+
                  event: connected
                  data: {"connectionId":"abc","projectId":"proj_123"}

        '400':
          description: Missing projectId query parameter
        '401':
          description: Unauthorized
      tags: &ref_40
        - Events
      security:
        - bearer: []
  /events/connections/count:
    get:
      operationId: getConnectionsCount
      summary: Get active SSE connections count
      parameters: []
      responses:
        '200':
          description: Connection count
      tags: *ref_40
      security:
        - bearer: []
  /logs/client:
    post:
      operationId: submitLogs
      summary: Submit browser client logs
      description: >-
        Receives batched console logs from browser clients for server-side
        storage. Used for debugging client-side errors.
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ClientLogsRequestDto'
      responses:
        '200':
          description: Logs received successfully
          content:
            application/json:
              schema:
                example:
                  ok: true
                  written: 5
      tags:
        - Logs
  /users/search:
    get:
      operationId: searchByEmail
      summary: Search users by email
      description: >-
        Search for existing users by email address for invitation purposes.
        Returns up to 10 matches.
      parameters:
        - name: email
          required: true
          in: query
          description: Email address to search for (partial match, min 2 characters)
          schema:
            type: string
      responses:
        '200':
          description: List of matching users
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserSearchResponseDto'
        '400':
          description: Invalid search query
      tags:
        - users
  /releases:
    get:
      operationId: list
      parameters:
        - name: limit
          required: false
          in: query
          description: 'Number of releases to return (default: 20, max: 100)'
          schema:
            type: number
            minimum: 1
            maximum: 100
            default: 20
        - name: offset
          required: false
          in: query
          description: Number of releases to skip (for pagination)
          schema:
            type: number
            minimum: 0
            default: 0
      responses:
        '200':
          description: List of releases
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ReleaseListItemDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: &ref_41
        - Releases
    post:
      operationId: create
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateReleaseDto'
      responses:
        '201':
          description: Release created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateReleaseResponseDto'
        '400':
          description: Invalid request or no commits found
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_41
  /releases/preview:
    post:
      operationId: preview
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PreviewReleaseDto'
      responses:
        '200':
          description: Preview commits for a date range without creating a release
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PreviewReleaseResponseDto'
        '400':
          description: Invalid date range or no commits found
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_41
  /releases/latest:
    get:
      operationId: getLatest
      parameters: []
      responses:
        '200':
          description: Latest release details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReleaseDetailDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '404':
          description: No releases found
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_41
  /releases/{version}:
    get:
      operationId: getByVersion
      parameters:
        - name: version
          required: true
          in: path
          description: Release version (e.g., v2025.12.19)
          schema:
            example: v2025.12.19
            type: string
      responses:
        '200':
          description: Release details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReleaseDetailDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '404':
          description: Release not found
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_41
    delete:
      operationId: deleteRelease
      parameters:
        - name: version
          required: true
          in: path
          description: Release version (e.g., v2025.12.19)
          schema:
            example: v2025.12.19
            type: string
      responses:
        '200':
          description: Release deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
        '400':
          description: Cannot delete published release
        '404':
          description: Release not found
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_41
  /releases/{version}/email-preview:
    get:
      operationId: getEmailPreview
      parameters:
        - name: version
          required: true
          in: path
          description: Release version (e.g., v2025.12.19)
          schema:
            example: v2025.12.19
            type: string
        - name: recipientName
          required: false
          in: query
          description: 'Name to use in email greeting (default: "User")'
          schema:
            type: string
      responses:
        '200':
          description: Rendered email HTML preview
          content:
            application/json:
              schema:
                type: object
                properties:
                  html:
                    type: string
                    description: Rendered email HTML
                  version:
                    type: string
                    description: Release version
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '404':
          description: Release not found
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_41
  /releases/{version}/send:
    post:
      operationId: sendNotifications
      parameters:
        - name: version
          required: true
          in: path
          description: Release version or ID
          schema:
            example: v2025.12.19
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SendNotificationsDto'
      responses:
        '200':
          description: Notifications sent successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SendNotificationsResponseDto'
        '400':
          description: Invalid targeting options
        '404':
          description: Release not found
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_41
  /user/email-preferences:
    get:
      operationId: getPreferences
      summary: Get email preferences for current user
      parameters: []
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EmailPreferencesDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: &ref_42
        - UserProfile
    put:
      operationId: updatePreferences
      summary: Update email preferences for current user
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateEmailPreferencesDto'
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EmailPreferencesDto'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                example:
                  error:
                    code: bad-request
                    message: Invalid request
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                example:
                  error:
                    code: unauthorized
                    message: Missing or invalid credentials
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                example:
                  error:
                    code: forbidden
                    message: Insufficient permissions
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                example:
                  error:
                    code: internal
                    message: Unexpected error
      tags: *ref_42
  /unsubscribe/{token}:
    get:
      operationId: getUnsubscribeInfo
      summary: Get unsubscribe info for token
      description: >-
        Public endpoint to get masked email and current preferences for
        unsubscribe page
      parameters:
        - name: token
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UnsubscribeInfoDto'
        '404':
          description: Invalid or expired token
      tags: &ref_43
        - Unsubscribe
    post:
      operationId: unsubscribe
      summary: Unsubscribe from emails
      description: Public endpoint to unsubscribe from emails using token
      parameters:
        - name: token
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UnsubscribeBodyDto'
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UnsubscribeResultDto'
      tags: *ref_43
  /superadmin/me:
    get:
      operationId: checkSuperadminStatus
      summary: Check superadmin status
      description: Returns whether the current authenticated user is a superadmin
      parameters: []
      responses:
        '200':
          description: Superadmin status
          content:
            application/json:
              schema:
                type: object
                properties:
                  isSuperadmin:
                    type: boolean
      tags: &ref_44
        - superadmin
      security: &ref_45
        - bearer: []
  /superadmin/users:
    get:
      operationId: listUsers
      summary: List all users
      description: >-
        Returns paginated list of all users with their organization memberships
        and last activity
      parameters:
        - name: page
          required: false
          in: query
          description: Page number (1-indexed)
          schema:
            minimum: 1
            default: 1
            type: number
        - name: limit
          required: false
          in: query
          description: Number of items per page
          schema:
            minimum: 1
            maximum: 100
            default: 20
            type: number
        - name: search
          required: false
          in: query
          description: Search by name or email (partial match)
          schema:
            type: string
        - name: orgId
          required: false
          in: query
          description: Filter by organization ID
          schema:
            type: string
      responses:
        '200':
          description: List of users
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListUsersResponseDto'
        '403':
          description: Superadmin access required
      tags: *ref_44
      security: *ref_45
  /superadmin/organizations:
    get:
      operationId: listOrganizations
      summary: List all organizations
      description: >-
        Returns paginated list of all organizations with member and project
        counts
      parameters:
        - name: page
          required: false
          in: query
          description: Page number (1-indexed)
          schema:
            minimum: 1
            default: 1
            type: number
        - name: limit
          required: false
          in: query
          description: Number of items per page
          schema:
            minimum: 1
            maximum: 100
            default: 20
            type: number
      responses:
        '200':
          description: List of organizations
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListOrganizationsResponseDto'
        '403':
          description: Superadmin access required
      tags: *ref_44
      security: *ref_45
  /superadmin/projects:
    get:
      operationId: listProjects
      summary: List all projects
      description: >-
        Returns paginated list of all projects with document counts, optionally
        filtered by organization
      parameters:
        - name: page
          required: false
          in: query
          description: Page number (1-indexed)
          schema:
            minimum: 1
            default: 1
            type: number
        - name: limit
          required: false
          in: query
          description: Number of items per page
          schema:
            minimum: 1
            maximum: 100
            default: 20
            type: number
        - name: orgId
          required: false
          in: query
          description: Filter by organization ID
          schema:
            type: string
      responses:
        '200':
          description: List of projects
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListProjectsResponseDto'
        '403':
          description: Superadmin access required
      tags: *ref_44
      security: *ref_45
  /superadmin/email-jobs:
    get:
      operationId: listEmailJobs
      summary: List email jobs
      description: >-
        Returns paginated list of email jobs with optional filters for status,
        recipient, and date range
      parameters:
        - name: page
          required: false
          in: query
          description: Page number (1-indexed)
          schema:
            minimum: 1
            default: 1
            type: number
        - name: limit
          required: false
          in: query
          description: Number of items per page
          schema:
            minimum: 1
            maximum: 100
            default: 20
            type: number
        - name: status
          required: false
          in: query
          description: Filter by status
          schema:
            enum:
              - pending
              - processing
              - sent
              - failed
            type: string
        - name: recipient
          required: false
          in: query
          description: Filter by recipient email (partial match)
          schema:
            type: string
        - name: fromDate
          required: false
          in: query
          description: Filter by start date (ISO 8601)
          schema:
            example: '2025-01-01T00:00:00Z'
            type: string
        - name: toDate
          required: false
          in: query
          description: Filter by end date (ISO 8601)
          schema:
            example: '2025-12-31T23:59:59Z'
            type: string
      responses:
        '200':
          description: List of email jobs
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListEmailJobsResponseDto'
        '403':
          description: Superadmin access required
      tags: *ref_44
      security: *ref_45
  /superadmin/email-jobs/{id}/preview:
    get:
      operationId: previewEmailJob
      summary: Preview email job
      description: Renders the email template with stored data and returns HTML content
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Rendered HTML email content
          content:
            text/html:
              schema:
                type: string
        '403':
          description: Superadmin access required
        '404':
          description: Email job not found
      tags: *ref_44
      security: *ref_45
  /superadmin/email-jobs/{id}/preview-json:
    get:
      operationId: previewEmailJobJson
      summary: Preview email job as JSON
      description: Renders the email template and returns metadata along with HTML content
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Email preview with metadata
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EmailJobPreviewResponseDto'
        '403':
          description: Superadmin access required
        '404':
          description: Email job not found
      tags: *ref_44
      security: *ref_45
  /superadmin/users/{id}:
    delete:
      operationId: deleteUser
      summary: Delete a user
      description: Soft deletes a user by setting deletedAt timestamp
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: User deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
        '403':
          description: Superadmin access required
        '404':
          description: User not found
      tags: *ref_44
      security: *ref_45
  /superadmin/organizations/{id}:
    delete:
      operationId: deleteOrganization
      summary: Delete an organization
      description: Soft deletes an organization by setting deletedAt timestamp
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Organization deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
        '403':
          description: Superadmin access required
        '404':
          description: Organization not found
      tags: *ref_44
      security: *ref_45
  /superadmin/projects/{id}:
    delete:
      operationId: deleteProject
      summary: Delete a project
      description: Soft deletes a project by setting deletedAt timestamp
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Project deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
        '403':
          description: Superadmin access required
        '404':
          description: Project not found
      tags: *ref_44
      security: *ref_45
  /superadmin/system-config:
    get:
      operationId: getSystemConfig
      summary: Get system configuration
      description: >-
        Returns external service links, deployment information, and environment
        variables for the super admin dashboard
      parameters:
        - name: reveal
          required: false
          in: query
          description: Set to true to reveal sensitive values
          schema:
            default: false
            type: boolean
      responses:
        '200':
          description: System configuration
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SystemConfigResponseDto'
        '403':
          description: Superadmin access required
      tags: *ref_44
      security: *ref_45
  /superadmin/email-templates:
    get:
      operationId: listTemplates
      summary: List email templates
      description: Returns all email templates with their customization status
      parameters: []
      responses:
        '200':
          description: List of email templates
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListEmailTemplatesResponseDto'
        '403':
          description: Superadmin access required
      tags: &ref_46
        - superadmin
      security: &ref_47
        - bearer: []
  /superadmin/email-templates/{id}:
    get:
      operationId: getTemplate
      summary: Get email template
      description: Returns a single email template with full content and metadata
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Email template details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EmailTemplateDetailDto'
        '403':
          description: Superadmin access required
        '404':
          description: Template not found
      tags: *ref_46
      security: *ref_47
    put:
      operationId: updateTemplate
      summary: Update email template
      description: >-
        Updates the template content. Creates a new version and marks the
        template as customized.
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateEmailTemplateDto'
      responses:
        '200':
          description: Template updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UpdateEmailTemplateResponseDto'
        '400':
          description: Invalid MJML content
        '403':
          description: Superadmin access required
        '404':
          description: Template not found
      tags: *ref_46
      security: *ref_47
  /superadmin/email-templates/{id}/preview:
    post:
      operationId: previewTemplate
      summary: Preview email template
      description: Renders the template with sample data or provided override data
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PreviewEmailTemplateDto'
      responses:
        '200':
          description: Rendered template preview
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PreviewEmailTemplateResponseDto'
        '403':
          description: Superadmin access required
        '404':
          description: Template not found
      tags: *ref_46
      security: *ref_47
  /superadmin/email-templates/preview-mjml:
    post:
      operationId: previewMjml
      summary: Preview arbitrary MJML content
      description: >-
        Renders arbitrary MJML content with optional data context. Useful for
        previewing proposed changes before applying them.
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PreviewMjmlDto'
      responses:
        '200':
          description: Rendered template preview
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PreviewMjmlResponseDto'
        '400':
          description: Invalid MJML content
        '403':
          description: Superadmin access required
      tags: *ref_46
      security: *ref_47
  /superadmin/email-templates/{id}/versions:
    get:
      operationId: listVersions
      summary: List template versions
      description: Returns version history for a template with pagination
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
        - name: page
          required: false
          in: query
          description: Page number (1-indexed)
          schema:
            minimum: 1
            default: 1
            type: number
        - name: limit
          required: false
          in: query
          description: Number of items per page
          schema:
            minimum: 1
            maximum: 100
            default: 20
            type: number
      responses:
        '200':
          description: List of template versions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListEmailTemplateVersionsResponseDto'
        '403':
          description: Superadmin access required
        '404':
          description: Template not found
      tags: *ref_46
      security: *ref_47
  /superadmin/email-templates/{id}/rollback:
    post:
      operationId: rollbackToVersion
      summary: Rollback template to version
      description: Creates a new version by copying content from a previous version
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RollbackEmailTemplateDto'
      responses:
        '200':
          description: Rollback successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RollbackEmailTemplateResponseDto'
        '403':
          description: Superadmin access required
        '404':
          description: Template or version not found
      tags: *ref_46
      security: *ref_47
  /superadmin/email-templates/{id}/reset:
    post:
      operationId: resetToDefault
      summary: Reset template to default
      description: >-
        Loads the file-based template content and creates a new version, marking
        template as not customized
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Reset successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResetEmailTemplateResponseDto'
        '403':
          description: Superadmin access required
        '404':
          description: Template not found
      tags: *ref_46
      security: *ref_47
  /superadmin/email-templates/{id}/refinement-chat:
    get:
      operationId: getRefinementConversation
      summary: Get refinement conversation for template
      description: >-
        Returns the existing refinement conversation for the template, or
        creates a new one if none exists.
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Refinement conversation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EmailTemplateRefinementConversationDto'
        '403':
          description: Superadmin access required
        '404':
          description: Template not found
      tags: *ref_46
      security: *ref_47
    post:
      operationId: sendRefinementMessage
      summary: Send message to refinement chat
      description: >-
        Sends a user message and streams the AI response with template
        modification suggestions.
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EmailTemplateRefinementMessageDto'
      responses:
        '200':
          description: Streaming response with AI suggestions
        '403':
          description: Superadmin access required
        '404':
          description: Template not found
      tags: *ref_46
      security: *ref_47
  /superadmin/email-templates/{id}/refinement-chat/apply:
    post:
      operationId: applySuggestion
      summary: Apply a suggestion from refinement chat
      description: >-
        Applies a specific suggestion to update the template content. Creates a
        new version.
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ApplyEmailTemplateSuggestionDto'
      responses:
        '200':
          description: Result of applying the suggestion
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApplyEmailTemplateSuggestionResultDto'
        '400':
          description: Invalid suggestion
        '403':
          description: Superadmin access required
        '404':
          description: Template not found
      tags: *ref_46
      security: *ref_47
info:
  title: Spec Server API
  description: >-
    Generated OpenAPI spec (NestJS). NOTE: Each Document MUST belong to a
    Project and each Project belongs to an Organization. Users with no
    accessible Projects must create one before using ingestion or search
    features.
  version: 0.2.0
  contact: {}
tags: []
servers: []
components:
  securitySchemes:
    bearer:
      scheme: bearer
      bearerFormat: JWT
      type: http
  schemas:
    UserProfileDto:
      type: object
      properties:
        id:
          type: string
          description: Internal UUID user id (primary key)
          format: uuid
        subjectId:
          type: string
          description: >-
            Canonical internal user id (subject id, from identity provider) -
            DEPRECATED: use id
          format: uuid
        zitadelUserId:
          type: object
          description: Zitadel user ID (external auth provider)
        firstName:
          type: object
        lastName:
          type: object
        displayName:
          type: object
          description: Display name fallback (explicit) or derived (first + last)
        phoneE164:
          type: object
          description: E.164 formatted phone number, leading + and digits
        avatarObjectKey:
          type: object
          description: Object storage key for avatar (if stored internally)
      required:
        - id
        - subjectId
    UpdateUserProfileDto:
      type: object
      properties: {}
    DeleteAccountResponseDto:
      type: object
      properties:
        deletedOrgs:
          description: IDs of organizations that were soft-deleted
          type: array
          items:
            type: string
        deletedProjects:
          description: IDs of projects that were soft-deleted
          type: array
          items:
            type: string
        removedMemberships:
          type: number
          description: Number of memberships removed (org + project)
      required:
        - deletedOrgs
        - deletedProjects
        - removedMemberships
    AlternativeEmailDto:
      type: object
      properties:
        email:
          type: string
          description: Email address (lowercased canonical form)
        verified:
          type: boolean
          description: Verification status
        createdAt:
          type: string
          description: ISO timestamp created
      required:
        - email
        - verified
        - createdAt
    AddAlternativeEmailDto:
      type: object
      properties: {}
    UserSyncStatsDto:
      type: object
      properties:
        processed:
          type: number
          description: Total users processed since worker start
        succeeded:
          type: number
          description: Total successful syncs since worker start
        failed:
          type: number
          description: Total failed syncs since worker start
        lastSyncAt:
          type: string
          description: Timestamp of last sync batch
          format: date-time
        running:
          type: boolean
          description: Whether the worker is currently running
      required:
        - processed
        - succeeded
        - failed
        - running
    UserSyncStatusResponseDto:
      type: object
      properties:
        success:
          type: boolean
        data:
          $ref: '#/components/schemas/UserSyncStatsDto'
      required:
        - success
        - data
    TriggerSyncResponseDto:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
          description: Status message
      required:
        - success
        - message
    UserSyncResultDto:
      type: object
      properties:
        userId:
          type: string
          description: Internal user ID
        zitadelUserId:
          type: string
          description: Zitadel user ID
        success:
          type: boolean
          description: Whether sync was successful
        updatedFields:
          description: Fields that were updated
          example:
            - firstName
            - lastName
            - email
          type: array
          items:
            type: string
        error:
          type: string
          description: Error message if sync failed
      required:
        - userId
        - zitadelUserId
        - success
        - updatedFields
    UserSyncResponseDto:
      type: object
      properties:
        success:
          type: boolean
        data:
          $ref: '#/components/schemas/UserSyncResultDto'
        error:
          type: string
          description: Error message if user not found
      required:
        - success
    UserNeedingSyncDto:
      type: object
      properties:
        id:
          type: string
          description: Internal user ID
        zitadelUserId:
          type: string
          description: Zitadel user ID
        firstName:
          type: object
          description: First name (null if needs sync)
        lastName:
          type: object
          description: Last name (null if needs sync)
        displayName:
          type: object
          description: Display name (null if needs sync)
        lastSyncedAt:
          type: object
          description: Last sync timestamp
        hasEmail:
          type: boolean
          description: Whether user has email in local DB
      required:
        - id
        - zitadelUserId
        - hasEmail
    UsersNeedingSyncResponseDto:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: array
          items:
            $ref: '#/components/schemas/UserNeedingSyncDto'
        total:
          type: number
          description: Total count of users needing sync
      required:
        - success
        - data
        - total
    OrgDto:
      type: object
      properties:
        id:
          type: string
          example: org_1
        name:
          type: string
          example: Example Org
      required:
        - id
        - name
    CreateOrgDto:
      type: object
      properties: {}
    ProjectDto:
      type: object
      properties:
        id:
          type: string
          example: proj_1
        name:
          type: string
          example: Demo Project
        orgId:
          type: string
          example: org_1
        kb_purpose:
          type: string
          example: This knowledge base contains...
        chat_prompt_template:
          type: string
          example: |-
            You are a helpful assistant...

            {{GRAPH_CONTEXT}}

            {{MESSAGE}}
          description: Custom chat prompt template with placeholders
        auto_extract_objects:
          type: boolean
          example: false
          description: >-
            When true, automatically create extraction jobs when documents are
            uploaded
        auto_extract_config:
          type: object
          example:
            enabled_types:
              - Requirement
              - Decision
              - Feature
            min_confidence: 0.7
            require_review: true
            notify_on_complete: true
            notification_channels:
              - inbox
          description: Configuration for automatic extraction jobs
        chunking_config:
          type: object
          example:
            strategy: sentence
            maxChunkSize: 7500
            minChunkSize: 3000
            overlap: 200
          description: >-
            Default document chunking configuration for this project. Used when
            ingesting documents without explicit chunking options. Aligned with
            LLM extraction batch size (1:4 ratio).
        allow_parallel_extraction:
          type: boolean
          example: false
          description: >-
            When true, allows multiple extraction jobs to run in parallel for
            this project. When false (default), jobs are queued and run one at a
            time.
        extraction_config:
          type: object
          example:
            chunkSize: 30000
            method: function_calling
            timeoutSeconds: 180
          description: >-
            LLM extraction configuration for this project. Controls chunk size,
            extraction method, and timeouts.
      required:
        - id
        - name
        - orgId
    CreateProjectDto:
      type: object
      properties:
        name:
          type: string
          example: My Project
          description: Project name (unique per organization, case-insensitive)
        orgId:
          type: string
          description: Organization UUID (must belong to caller; no implicit default org)
      required:
        - name
        - orgId
    UpdateProjectDto:
      type: object
      properties:
        name:
          type: string
          example: Updated Project Name
          description: New project name (unique per organization)
        kb_purpose:
          type: string
          example: This knowledge base contains documentation about...
          description: >-
            Markdown description of the knowledge base purpose and domain. Used
            by auto-discovery to understand context.
        chat_prompt_template:
          type: string
          example: |-
            You are a helpful assistant specialized in {{DOMAIN}}.

            {{GRAPH_CONTEXT}}

            {{MESSAGE}}
          description: >-
            Custom chat prompt template. Supports placeholders:
            {{SYSTEM_PROMPT}}, {{MCP_CONTEXT}}, {{GRAPH_CONTEXT}}, {{MESSAGE}},
            {{MARKDOWN_RULES}}
        auto_extract_objects:
          type: boolean
          example: false
          description: >-
            Enable/disable automatic extraction of objects from uploaded
            documents
        auto_extract_config:
          type: object
          example:
            enabled_types:
              - Requirement
              - Decision
              - Feature
            min_confidence: 0.7
            require_review: true
            notify_on_complete: true
            notification_channels:
              - inbox
          description: >-
            Configuration for automatic extraction (enabled_types,
            min_confidence, require_review, notify_on_complete,
            notification_channels)
        chunking_config:
          type: object
          example:
            strategy: sentence
            maxChunkSize: 7500
            minChunkSize: 3000
            overlap: 200
          description: >-
            Default document chunking configuration. Strategy options: character
            (fixed boundaries), sentence (preserves sentences), paragraph
            (preserves paragraphs/sections). Chunk sizes should align with LLM
            extraction batch size (1:4 ratio).
        allow_parallel_extraction:
          type: boolean
          example: false
          description: >-
            When true, allows multiple extraction jobs to run in parallel for
            this project. When false (default), jobs are queued and run one at a
            time.
        extraction_config:
          type: object
          example:
            chunkSize: 30000
            method: function_calling
            timeoutSeconds: 180
          description: >-
            LLM extraction configuration. Controls chunk size (5000-100000
            chars), extraction method (function_calling or responseSchema), and
            per-call timeout (60-600 seconds).
    ProjectMemberDto:
      type: object
      properties:
        id:
          type: string
          description: User ID (internal UUID)
        email:
          type: string
          description: Email address
        displayName:
          type: string
          description: Display name
        firstName:
          type: string
          description: First name
        lastName:
          type: string
          description: Last name
        avatarUrl:
          type: string
          description: Avatar URL
        role:
          type: string
          description: Role in the project
          enum:
            - project_admin
            - project_user
        joinedAt:
          format: date-time
          type: string
          description: Date when user joined the project
      required:
        - id
        - email
        - role
        - joinedAt
    SentInviteDto:
      type: object
      properties:
        id:
          type: string
          description: Invitation ID
        email:
          type: string
          description: Email address invited
        role:
          type: string
          description: Role offered
        status:
          type: string
          description: 'Status: pending, accepted, declined, revoked, expired'
        createdAt:
          format: date-time
          type: string
          description: When the invitation was created
        expiresAt:
          format: date-time
          type: string
          description: When the invitation expires
      required:
        - id
        - email
        - role
        - status
        - createdAt
    CreateTemplatePackDto:
      type: object
      properties: {}
    AssignTemplatePackDto:
      type: object
      properties: {}
    UpdateTemplatePackAssignmentDto:
      type: object
      properties: {}
    StudioStreamMetaEvent:
      type: object
      properties: {}
    StudioStreamTokenEvent:
      type: object
      properties: {}
    StudioStreamSuggestionsEvent:
      type: object
      properties: {}
    StudioStreamErrorEvent:
      type: object
      properties: {}
    StudioStreamDoneEvent:
      type: object
      properties: {}
    StudioMessageDto:
      type: object
      properties: {}
    ApplyStudioSuggestionDto:
      type: object
      properties: {}
    RejectStudioSuggestionDto:
      type: object
      properties: {}
    ChatRequestDto:
      type: object
      properties: {}
    CreateInviteWithUserDto:
      type: object
      properties:
        email:
          type: string
          description: Email address
        firstName:
          type: string
          description: First name
        lastName:
          type: string
          description: Last name
        organizationId:
          type: string
          description: Organization ID (optional)
        projectId:
          type: string
          description: Project ID (optional)
        role:
          type: string
          description: Role for the invited user
          enum:
            - org_admin
            - project_admin
            - project_user
      required:
        - email
        - firstName
        - lastName
        - role
    CreateInviteDto:
      type: object
      properties:
        orgId:
          type: string
          description: Organization ID
        projectId:
          type: string
          description: Project ID (optional)
        email:
          type: string
          description: Email address to invite
        role:
          type: string
          description: Role for the invited user
          enum:
            - org_admin
            - project_admin
            - project_user
      required:
        - orgId
        - email
        - role
    AcceptInviteDto:
      type: object
      properties:
        token:
          type: string
          description: Invitation token
      required:
        - token
    PendingInviteDto:
      type: object
      properties:
        id:
          type: string
          description: Invitation ID
        projectId:
          type: string
          description: Project ID (if project invite)
        projectName:
          type: string
          description: Project name (if project invite)
        organizationId:
          type: string
          description: Organization ID
        organizationName:
          type: string
          description: Organization name
        role:
          type: string
          description: Role being offered
        token:
          type: string
          description: Invitation token
        createdAt:
          format: date-time
          type: string
          description: When the invitation was created
        expiresAt:
          format: date-time
          type: string
          description: When the invitation expires
      required:
        - id
        - organizationId
        - role
        - token
        - createdAt
    SearchResultDto:
      type: object
      properties:
        id:
          type: string
          example: mock-1
        snippet:
          type: string
          example: Result snippet for "foo" (#1, mode=hybrid)
        score:
          type: number
          example: 0.98
        source:
          type: string
          example: source.doc#L10
        pathSummary:
          type: string
          example: >-
            Related: links to Requirement "REQ-1" via 'implements'; linked from
            Meeting "M3" via 'discussed_in'
          description: >-
            Human-readable summary of how this result relates to other objects
            in the knowledge graph
      required:
        - id
        - snippet
        - score
    SearchResponseDto:
      type: object
      properties:
        mode:
          type: string
          enum:
            - hybrid
            - lexical
            - vector
        results:
          type: array
          items:
            $ref: '#/components/schemas/SearchResultDto'
        warning:
          type: string
          example: Embeddings unavailable; fell back to lexical.
        query_time_ms:
          type: number
          description: Query execution time in milliseconds
          example: 142.5
        result_count:
          type: number
          description: Total number of results found before pagination/limits
          example: 50
      required:
        - mode
        - results
    DocumentDto:
      type: object
      properties:
        id:
          type: string
          example: doc_1
        orgId:
          type: string
          example: 11111111-2222-3333-4444-555555555555
          nullable: true
        projectId:
          type: string
          example: aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee
          nullable: true
        name:
          type: string
          example: Spec.md
        sourceUrl:
          type: object
          nullable: true
          example: https://example.com/file.pdf
        mimeType:
          type: object
          nullable: true
          example: text/markdown
        createdAt:
          type: string
          example: '2025-01-01T00:00:00.000Z'
        updatedAt:
          type: string
          example: '2025-01-01T00:05:00.000Z'
        content:
          type: object
          nullable: true
          example: |-
            # Document Title

            Document content here...
          description: The full text content of the document
        contentLength:
          type: object
          nullable: true
          example: 7332286
          description: The byte length of the content field
        chunks:
          type: number
          example: 12
          description: Number of chunks associated with this document
        totalChars:
          type: number
          example: 15420
          description: Total character count of all chunks in this document
        embeddedChunks:
          type: number
          example: 10
          description: Number of chunks that have embeddings generated
        parentDocumentId:
          type: object
          nullable: true
          example: aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee
          description: >-
            Parent document ID for hierarchical structures (e.g., ClickUp page
            hierarchy)
        integrationMetadata:
          type: object
          nullable: true
          example:
            source: clickup
            doc_id: 4bj41-33735
            workspace_id: '4573313'
          description: Integration-specific metadata (ClickUp IDs, creator info, etc.)
        extractionStatus:
          type: string
          nullable: true
          example: completed
          description: >-
            Status of the most recent extraction job for this document (pending,
            running, completed, failed)
          enum:
            - pending
            - running
            - completed
            - failed
        extractionCompletedAt:
          type: string
          nullable: true
          example: '2025-01-01T00:10:00.000Z'
          description: Timestamp when the most recent extraction job was completed
        extractionObjectsCount:
          type: number
          nullable: true
          example: 15
          description: Number of objects extracted in the most recent extraction job
      required:
        - id
        - name
        - createdAt
        - updatedAt
        - chunks
    DeletionImpactDto:
      type: object
      properties:
        document:
          type: object
          description: Document information
          example:
            id: 123e4567-e89b-12d3-a456-426614174000
            name: example.pdf
            createdAt: '2024-01-01T00:00:00Z'
        impact:
          type: object
          description: Impact summary of entities that will be deleted
          example:
            chunks: 42
            extractionJobs: 3
            graphObjects: 15
            graphRelationships: 8
            notifications: 1
      required:
        - document
        - impact
    BulkDeleteRequestDto:
      type: object
      properties:
        ids:
          description: Array of document IDs to delete
          example:
            - 123e4567-e89b-12d3-a456-426614174000
            - 123e4567-e89b-12d3-a456-426614174001
          minItems: 1
          type: array
          items:
            type: string
      required:
        - ids
    BulkDeletionImpactDto:
      type: object
      properties:
        totalDocuments:
          type: number
          description: Total number of documents to be deleted
          example: 5
        impact:
          type: object
          description: Aggregated impact summary across all documents
          example:
            chunks: 150
            extractionJobs: 12
            graphObjects: 48
            graphRelationships: 25
            notifications: 3
        documents:
          description: Optional per-document breakdown
          type: array
          items:
            $ref: '#/components/schemas/DeletionImpactDto'
      required:
        - totalDocuments
        - impact
    DeletionSummaryDto:
      type: object
      properties:
        status:
          type: string
          description: Deletion status
          example: deleted
          enum: &ref_48
            - deleted
            - partial
        summary:
          type: object
          description: Summary of deleted entities
          example: &ref_49
            chunks: 42
            extractionJobs: 3
            graphObjects: 15
            graphRelationships: 8
            notifications: 1
      required:
        - status
        - summary
    BulkDeletionSummaryDto:
      type: object
      properties:
        status:
          type: string
          description: Deletion status
          example: deleted
          enum: *ref_48
        summary:
          type: object
          description: Summary of deleted entities
          example: *ref_49
        deleted:
          type: number
          description: Number of documents successfully deleted
          example: 5
        notFound:
          description: Document IDs that could not be found or deleted
          example:
            - 123e4567-e89b-12d3-a456-426614174999
          type: array
          items:
            type: string
      required:
        - status
        - summary
        - deleted
    ChunkDto:
      type: object
      properties:
        id:
          type: string
          example: chunk_1
        documentId:
          type: string
          example: doc_1
        documentTitle:
          type: string
          example: User Guide.pdf
          description: Best-effort document title derived from filename or source URL
        index:
          type: number
          example: 0
          description: Zero-based index of chunk inside the document
        size:
          type: number
          example: 512
          description: Size in characters
        hasEmbedding:
          type: boolean
          example: true
          description: Whether an embedding vector exists for this chunk
        text:
          type: string
          example: This is the chunk text...
          description: Plaintext content of the chunk (may be truncated client-side)
        createdAt:
          type: string
        totalChars:
          type: number
          description: Total characters across all chunks in document
        chunkCount:
          type: number
          description: Total number of chunks in document
        embeddedChunks:
          type: number
          description: Number of embedded chunks in document
      required:
        - id
        - documentId
        - documentTitle
        - index
        - size
        - hasEmbedding
        - text
    ChunkingOptionsDto:
      type: object
      properties:
        maxChunkSize:
          type: number
          description: 'Maximum characters per chunk (default: 1200)'
          minimum: 100
          maximum: 10000
          default: 1200
          example: 1200
        minChunkSize:
          type: number
          description: 'Minimum characters per chunk to prevent tiny chunks (default: 100)'
          minimum: 10
          maximum: 1000
          default: 100
          example: 100
    IngestionUploadDto:
      type: object
      properties:
        filename:
          type: string
          description: Original filename (optional, will fallback to uploaded file name)
          example: spec.md
        mimeType:
          type: string
          description: Optional MIME type
          example: text/markdown
        orgId:
          type: string
          description: Optional organisation UUID to associate the document with
          example: 11111111-2222-3333-4444-555555555555
        projectId:
          type: string
          description: Project UUID that this document belongs to (required)
          example: aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee
        chunkingStrategy:
          type: string
          description: >-
            Chunking strategy for splitting text into chunks. Options: character
            (default), sentence, paragraph
          enum: &ref_50
            - character
            - sentence
            - paragraph
          default: character
          example: sentence
        chunkingOptions:
          description: Configuration options for the chunking strategy
          allOf:
            - $ref: '#/components/schemas/ChunkingOptionsDto'
      required:
        - projectId
    IngestionUrlDto:
      type: object
      properties:
        url:
          type: string
          description: Remote URL to ingest
          example: https://example.com/spec.md
        orgId:
          type: string
          description: Optional organisation UUID to associate the document with
          example: 11111111-2222-3333-4444-555555555555
        projectId:
          type: string
          description: Project UUID that this document belongs to (required)
          example: aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee
        chunkingStrategy:
          type: string
          description: >-
            Chunking strategy for splitting text into chunks. Options: character
            (default), sentence, paragraph
          enum: *ref_50
          default: character
          example: sentence
        chunkingOptions:
          description: Configuration options for the chunking strategy
          allOf:
            - $ref: '#/components/schemas/ChunkingOptionsDto'
      required:
        - url
        - projectId
    CreateExtractionJobDto:
      type: object
      properties:
        project_id:
          type: string
          description: Project ID
          example: 550e8400-e29b-41d4-a716-446655440001
        source_type:
          type: string
          description: Source type for extraction
          enum:
            - document
            - api
            - manual
            - bulk_import
          example: document
        source_id:
          type: string
          description: Source object ID (e.g., document ID)
          example: 550e8400-e29b-41d4-a716-446655440002
        source_metadata:
          type: object
          description: Additional source metadata
          example:
            filename: requirements.pdf
            filesize: 1024000
        extraction_config:
          type: object
          description: Extraction configuration
          example:
            target_types:
              - Requirement
              - Feature
            auto_create_types: true
            confidence_threshold: 0.7
        subject_id:
          type: string
          description: User subject ID (canonical internal user ID)
          example: 550e8400-e29b-41d4-a716-446655440003
      required:
        - project_id
        - source_type
        - extraction_config
    ExtractionJobDto:
      type: object
      properties:
        id:
          type: string
          description: Job ID
        project_id:
          type: string
          description: Project ID
        source_type:
          type: string
          description: Source type
          enum:
            - document
            - api
            - manual
            - bulk_import
        source_id:
          type: string
          description: Source ID
        source_metadata:
          type: object
          description: Source metadata
        extraction_config:
          type: object
          description: Extraction configuration
        status:
          type: string
          description: Job status
          enum:
            - queued
            - running
            - completed
            - requires_review
            - failed
            - cancelled
        total_items:
          type: number
          description: Total items to process
        processed_items:
          type: number
          description: Processed items count
        successful_items:
          type: number
          description: Successful items count
        failed_items:
          type: number
          description: Failed items count
        discovered_types:
          description: Discovered type names
          type: array
          items:
            type: string
        created_objects:
          description: Created object IDs
          type: array
          items:
            type: string
        error_message:
          type: string
          description: Error message
        error_details:
          type: object
          description: Error details
        debug_info:
          type: object
          description: Debug information (LLM requests/responses, intermediate results)
          example:
            llm_calls:
              - type: Requirement
                prompt: Extract requirements...
                response: LLM response data
                duration_ms: 1234
        started_at:
          format: date-time
          type: string
          description: Job start timestamp
        completed_at:
          format: date-time
          type: string
          description: Job completion timestamp
        created_at:
          format: date-time
          type: string
          description: Job creation timestamp
        subject_id:
          type: string
          description: User subject ID (canonical internal user ID)
        updated_at:
          format: date-time
          type: string
          description: Last update timestamp
      required:
        - id
        - project_id
        - source_type
        - source_metadata
        - extraction_config
        - status
        - total_items
        - processed_items
        - successful_items
        - failed_items
        - discovered_types
        - created_objects
        - created_at
        - updated_at
    ExtractionJobListDto:
      type: object
      properties:
        jobs:
          description: List of extraction jobs
          type: array
          items:
            $ref: '#/components/schemas/ExtractionJobDto'
        total:
          type: number
          description: Total count of jobs
        page:
          type: number
          description: Current page number
        limit:
          type: number
          description: Items per page
        total_pages:
          type: number
          description: Total pages
      required:
        - jobs
        - total
        - page
        - limit
        - total_pages
    UpdateExtractionJobDto:
      type: object
      properties:
        status:
          type: string
          description: Job status
          enum:
            - queued
            - running
            - completed
            - requires_review
            - failed
            - cancelled
          example: running
        total_items:
          type: number
          description: Total items to process
          example: 100
          minimum: 0
        processed_items:
          type: number
          description: Number of processed items
          example: 50
          minimum: 0
        successful_items:
          type: number
          description: Number of successful items
          example: 45
          minimum: 0
        failed_items:
          type: number
          description: Number of failed items
          example: 5
          minimum: 0
        discovered_types:
          description: Discovered type names
          example:
            - Requirement
            - Feature
          type: array
          items:
            type: string
        created_objects:
          description: Created object IDs
          example:
            - 550e8400-e29b-41d4-a716-446655440010
          type: array
          items:
            type: string
        error_message:
          type: string
          description: Error message (if failed)
          example: Failed to parse document
        error_details:
          type: object
          description: Detailed error information
          example:
            stack: ...
            context: ...
        debug_info:
          type: object
          description: Debug information (LLM requests/responses, intermediate results)
          example:
            llm_requests: []
            llm_responses: []
            processing_steps: []
    CreateGraphObjectDto:
      type: object
      properties: {}
    PatchGraphObjectDto:
      type: object
      properties: {}
    BulkUpdateStatusDto:
      type: object
      properties:
        ids:
          description: Array of object IDs to update
          example:
            - uuid1
            - uuid2
            - uuid3
          type: array
          items:
            type: string
        status:
          type: string
          description: New status value
          example: accepted
          maxLength: 64
      required:
        - ids
        - status
    VersionedObjectDto:
      type: object
      properties:
        id:
          type: string
        org_id:
          type: object
          nullable: true
        project_id:
          type: object
          nullable: true
        canonical_id:
          type: string
        supersedes_id:
          type: object
          nullable: true
        version:
          type: number
        type:
          type: string
        key:
          type: object
          nullable: true
        properties:
          type: object
        labels:
          type: array
          items:
            type: string
        created_at:
          type: string
      required:
        - id
        - org_id
        - project_id
        - canonical_id
        - supersedes_id
        - version
        - type
        - key
        - properties
        - labels
        - created_at
    ObjectHistoryResponseDto:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/VersionedObjectDto'
        next_cursor:
          type: string
          description: Present when more pages available; pass as cursor query param
      required:
        - items
    CreateGraphRelationshipDto:
      type: object
      properties: {}
    PatchGraphRelationshipDto:
      type: object
      properties: {}
    VersionedRelationshipDto:
      type: object
      properties:
        id:
          type: string
        canonical_id:
          type: string
        supersedes_id:
          type: object
          nullable: true
        version:
          type: number
        type:
          type: string
        src_id:
          type: string
        dst_id:
          type: string
        properties:
          type: object
        created_at:
          type: string
        weight:
          type: object
          nullable: true
        valid_from:
          type: object
          nullable: true
        valid_to:
          type: object
          nullable: true
      required:
        - id
        - canonical_id
        - supersedes_id
        - version
        - type
        - src_id
        - dst_id
        - properties
        - created_at
        - weight
        - valid_from
        - valid_to
    RelationshipHistoryResponseDto:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/VersionedRelationshipDto'
        next_cursor:
          type: string
          description: Present when more pages available; pass as cursor query param
      required:
        - items
    EdgePhaseDto:
      type: object
      properties:
        relationshipTypes:
          description: >-
            Relationship types to follow in this phase. If omitted, all types
            are allowed.
          example:
            - DEPENDS_ON
            - REQUIRES
          maxItems: 32
          type: array
          items:
            type: string
        direction:
          type: string
          description: 'Edge traversal direction: out (src->dst), in (dst<-src), or both'
          enum:
            - out
            - in
            - both
          example: out
        maxDepth:
          type: number
          description: >-
            Maximum depth (hops) to traverse in this phase, relative to phase
            start nodes
          minimum: 1
          maximum: 8
          example: 2
        objectTypes:
          description: >-
            Filter discovered nodes by object types. Only matching types
            included.
          example:
            - Implementation
            - TestCase
          maxItems: 64
          type: array
          items:
            type: string
        labels:
          description: >-
            Filter discovered nodes by labels. Nodes must have at least one
            matching label.
          example:
            - verified
            - high-priority
          maxItems: 64
          type: array
          items:
            type: string
      required:
        - direction
        - maxDepth
    PredicateDto:
      type: object
      properties:
        operator:
          type: string
          description: Comparison operator to apply
          enum:
            - equals
            - notEquals
            - greaterThan
            - lessThan
            - greaterThanOrEqual
            - lessThanOrEqual
            - contains
            - in
            - notIn
            - matches
            - exists
            - notExists
          example: equals
      required:
        - operator
    TemporalFilterDto:
      type: object
      properties:
        asOf:
          type: string
          description: >-
            Timestamp for point-in-time query (ISO 8601 format). Only
            nodes/edges valid at this timestamp are included.
          example: '2024-12-31T23:59:59Z'
          format: date-time
        field:
          type: string
          description: 'Which temporal field to use for filtering. Default: valid_from'
          enum:
            - valid_from
            - created_at
            - updated_at
          default: valid_from
          example: valid_from
      required:
        - asOf
    TraverseGraphDto:
      type: object
      properties:
        edgePhases:
          description: >-
            Define multiple sequential traversal phases with different
            constraints per phase. When provided, legacy
            direction/max_depth/relationship_types are ignored.
          maxItems: 8
          example:
            - relationshipTypes:
                - DEPENDS_ON
              direction: out
              maxDepth: 2
            - relationshipTypes:
                - IMPLEMENTED_BY
              direction: in
              maxDepth: 1
              objectTypes:
                - TestCase
          type: array
          items:
            $ref: '#/components/schemas/EdgePhaseDto'
        nodeFilter:
          description: >-
            Filter nodes by property values using JSON Pointer paths and
            comparison operators. Only nodes satisfying the predicate are
            included.
          example:
            path: /status
            operator: equals
            value: active
          allOf:
            - $ref: '#/components/schemas/PredicateDto'
        edgeFilter:
          description: >-
            Filter edges by property values. Only edges satisfying the predicate
            will be traversed.
          example:
            path: /confidence
            operator: greaterThan
            value: 0.7
          allOf:
            - $ref: '#/components/schemas/PredicateDto'
        returnPaths:
          type: boolean
          description: >-
            When true, include full paths from root nodes to each result node.
            Each path is an array of node IDs showing the traversal route.
          example: true
        maxPathsPerNode:
          type: number
          description: >-
            Maximum paths to track per node (used with returnPaths). Limits
            memory usage when a node is reachable via many routes.
          minimum: 1
          maximum: 100
          default: 10
          example: 10
        temporalFilter:
          description: >-
            Filter nodes and edges based on temporal validity. Enables
            point-in-time queries to see historical graph state.
          example:
            asOf: '2024-12-31T23:59:59Z'
            field: valid_from
          allOf:
            - $ref: '#/components/schemas/TemporalFilterDto'
        fieldStrategy:
          type: string
          description: >-
            Field pruning strategy to control response payload size. compact
            removes paths/phaseIndex (~25% reduction), minimal keeps only
            essential fields (~45% reduction).
          enum:
            - full
            - compact
            - minimal
          default: full
          example: compact
    GraphExpandDto:
      type: object
      properties: {}
    VectorSearchDto:
      type: object
      properties:
        vector:
          description: Query vector numbers
          type: array
          items:
            type: number
        limit:
          type: number
          description: Max results (default 10, max 100)
          minimum: 1
          maximum: 100
        minScore:
          type: number
          description: >-
            Optional max distance (cosine) filter (0  d  2; typical cosine
            range).
          minimum: 0
          maximum: 2
        maxDistance:
          type: number
          description: >-
            Alias for minScore (preferred). Same constraints (0  d  2). If
            both provided, maxDistance wins.
          minimum: 0
          maximum: 2
        type:
          type: string
          description: Filter by object type (exact match)
        orgId:
          type: string
          description: Filter by org id
          format: uuid
        projectId:
          type: string
          description: Filter by project id
          format: uuid
        branchId:
          type: string
          description: Filter by branch id
          format: uuid
        keyPrefix:
          type: string
          description: Optional key prefix match (ILIKE prefix%)
        labelsAll:
          description: >-
            Require all labels (array contains)  matches rows whose labels
            array contains every listed label
          type: array
          items:
            type: string
        labelsAny:
          description: >-
            Require any label (overlap)  matches rows whose labels array
            overlaps any listed label
          type: array
          items:
            type: string
      required:
        - vector
    SearchObjectsWithNeighborsDto:
      type: object
      properties:
        query:
          type: string
          description: Natural language query text to search for
          example: authentication and authorization patterns
        limit:
          type: number
          description: Maximum number of primary search results
          default: 10
          minimum: 1
          maximum: 100
        includeNeighbors:
          type: boolean
          description: Whether to include neighbors for each result
          default: false
        maxNeighbors:
          type: number
          description: Maximum number of neighbors per result
          default: 5
          minimum: 1
          maximum: 20
        maxDistance:
          type: number
          description: >-
            Maximum vector distance for similarity (0.0-2.0, lower = more
            similar)
          default: 0.5
          minimum: 0
          maximum: 2
        projectId:
          type: string
          description: Filter by project ID
        orgId:
          type: string
          description: Filter by organization ID
        branchId:
          type: string
          description: Filter by branch ID
        types:
          description: Filter by object types
          example:
            - Decision
            - Pattern
            - Document
          type: array
          items:
            type: string
        labels:
          description: Filter by labels
          example:
            - accepted
            - high-priority
          type: array
          items:
            type: string
      required:
        - query
    CreateEmbeddingPolicyDto:
      type: object
      properties:
        projectId:
          type: string
          description: Project ID this policy applies to
          example: 123e4567-e89b-12d3-a456-426614174000
        objectType:
          type: string
          description: >-
            Object type to apply policy to (e.g., "Document", "Requirement",
            "TestCase")
          example: Document
        enabled:
          type: boolean
          description: Whether embedding is enabled for this object type
          default: true
          example: true
        maxPropertySize:
          type: number
          description: >-
            Maximum property size in bytes. Objects with properties larger than
            this will not be embedded.
          example: 10000
        requiredLabels:
          description: Labels that must be present on the object for it to be embedded
          example:
            - public
            - approved
          type: array
          items:
            type: string
        excludedLabels:
          description: Labels that prevent embedding if present on the object
          example:
            - sensitive
            - draft
          type: array
          items:
            type: string
        relevantPaths:
          description: >-
            JSON Pointer paths to relevant properties. If specified, only these
            paths will be embedded (field masking).
          example:
            - /properties/title
            - /properties/description
          type: array
          items:
            type: string
        excludedStatuses:
          description: Status values that prevent embedding if present on the object
          example:
            - draft
            - archived
          type: array
          items:
            type: string
      required:
        - projectId
        - objectType
    EmbeddingPolicyResponseDto:
      type: object
      properties:
        id:
          type: string
          description: Policy ID
          example: 123e4567-e89b-12d3-a456-426614174000
        projectId:
          type: string
          description: Project ID
          example: 123e4567-e89b-12d3-a456-426614174001
        objectType:
          type: string
          description: Object type
          example: Document
        enabled:
          type: boolean
          description: Whether embedding is enabled
          example: true
        maxPropertySize:
          type: object
          description: Maximum property size in bytes
          example: 10000
          nullable: true
        requiredLabels:
          description: Required labels
          example:
            - public
          type: array
          items:
            type: string
        excludedLabels:
          description: Excluded labels
          example:
            - sensitive
          type: array
          items:
            type: string
        relevantPaths:
          description: Relevant property paths (JSON Pointers)
          example:
            - /properties/title
          type: array
          items:
            type: string
        excludedStatuses:
          description: Excluded status values
          example:
            - draft
          type: array
          items:
            type: string
        createdAt:
          format: date-time
          type: string
          description: Creation timestamp
          example: '2025-10-01T12:00:00Z'
        updatedAt:
          format: date-time
          type: string
          description: Last update timestamp
          example: '2025-10-01T12:30:00Z'
      required:
        - id
        - projectId
        - objectType
        - enabled
        - maxPropertySize
        - requiredLabels
        - excludedLabels
        - relevantPaths
        - excludedStatuses
        - createdAt
        - updatedAt
    UpdateEmbeddingPolicyDto:
      type: object
      properties:
        enabled:
          type: boolean
          description: Whether embedding is enabled for this object type
          example: false
        maxPropertySize:
          type: number
          description: >-
            Maximum property size in bytes. Objects with properties larger than
            this will not be embedded.
          example: 20000
        requiredLabels:
          description: Labels that must be present on the object for it to be embedded
          example:
            - verified
          type: array
          items:
            type: string
        excludedLabels:
          description: Labels that prevent embedding if present on the object
          example:
            - archived
          type: array
          items:
            type: string
        relevantPaths:
          description: JSON Pointer paths to relevant properties
          example:
            - /properties/summary
          type: array
          items:
            type: string
        excludedStatuses:
          description: Status values that prevent embedding
          example:
            - draft
          type: array
          items:
            type: string
    BranchMergeRequestDto:
      type: object
      properties:
        sourceBranchId:
          type: string
          description: Source branch to merge from
        execute:
          type: boolean
          description: >-
            If true, attempt to apply the merge (will fail with 409 if any
            conflicts). When false or omitted, performs a dry-run only.
        limit:
          type: number
          description: >-
            Optional enumeration limit override (must be <= server max).
            Primarily for testing.
      required:
        - sourceBranchId
    BranchMergeObjectSummaryDto:
      type: object
      properties:
        canonical_id:
          type: string
          description: Canonical object id
        status:
          type: string
          enum:
            - unchanged
            - added
            - fast_forward
            - conflict
        source_head_id:
          type: object
          description: Head version id on source branch
          nullable: true
        target_head_id:
          type: object
          description: Head version id on target branch
          nullable: true
        source_paths:
          description: Changed property paths on source since LCA
          type: array
          items:
            type: string
        target_paths:
          description: Changed property paths on target since LCA (empty if no divergence)
          type: array
          items:
            type: string
        conflicts:
          description: >-
            List of conflicting property paths (subset intersection of
            source/target paths with differing final values)
          type: array
          items:
            type: string
      required:
        - canonical_id
        - status
        - source_head_id
        - target_head_id
        - source_paths
        - target_paths
    BranchMergeRelationshipSummaryDto:
      type: object
      properties:
        canonical_id:
          type: string
          description: Canonical relationship id
        status:
          type: string
          enum:
            - unchanged
            - added
            - fast_forward
            - conflict
        source_head_id:
          type: object
          description: Head version id on source branch
          nullable: true
        target_head_id:
          type: object
          description: Head version id on target branch
          nullable: true
        source_src_id:
          type: object
          description: Source node id (src) on source head
          nullable: true
        source_dst_id:
          type: object
          description: Destination node id (dst) on source head
          nullable: true
        target_src_id:
          type: object
          description: Source node id (src) on target head
          nullable: true
        target_dst_id:
          type: object
          description: Destination node id (dst) on target head
          nullable: true
        source_paths:
          description: Changed property paths on source since LCA
          type: array
          items:
            type: string
        target_paths:
          description: Changed property paths on target since LCA (empty if no divergence)
          type: array
          items:
            type: string
        conflicts:
          description: >-
            List of conflicting property paths (subset intersection of
            source/target paths with differing final values)
          type: array
          items:
            type: string
      required:
        - canonical_id
        - status
        - source_head_id
        - target_head_id
        - source_src_id
        - source_dst_id
        - target_src_id
        - target_dst_id
        - source_paths
        - target_paths
    BranchMergeSummaryDto:
      type: object
      properties:
        targetBranchId:
          type: string
          description: Target branch the merge would apply to
        sourceBranchId:
          type: string
          description: Source branch provided in request
        dryRun:
          type: boolean
          description: True if this response is only a dry-run (always true in MVP)
        total_objects:
          type: number
          description: Total divergent canonical objects considered
        unchanged_count:
          type: number
          description: Count of objects unchanged after merge (no action needed)
        added_count:
          type: number
          description: Count of objects newly added by source branch
        fast_forward_count:
          type: number
          description: >-
            Count of objects that can be applied without conflict (fast-forward
            or safe merge)
        conflict_count:
          type: number
          description: Count of objects with conflicts requiring manual resolution
        objects:
          type: array
          items:
            $ref: '#/components/schemas/BranchMergeObjectSummaryDto'
        truncated:
          type: boolean
          description: Set when enumeration truncated due to limit cap
        hard_limit:
          type: number
          description: Server enforced hard limit (for client visibility)
        applied:
          type: boolean
          description: True when merge changes were applied (execute=true & no conflicts)
        applied_objects:
          type: number
          description: >-
            Number of objects mutated/created during apply (added +
            fast_forward)
        relationships_total:
          type: number
          description: Total divergent canonical relationships considered
        relationships_unchanged_count:
          type: number
          description: Count of relationships unchanged after merge (no action needed)
        relationships_added_count:
          type: number
          description: Count of relationships newly added by source branch
        relationships_fast_forward_count:
          type: number
          description: >-
            Count of relationships that can be applied without conflict
            (fast-forward or safe merge)
        relationships_conflict_count:
          type: number
          description: Count of relationships with conflicts requiring manual resolution
        relationships:
          type: array
          items:
            $ref: '#/components/schemas/BranchMergeRelationshipSummaryDto'
      required:
        - targetBranchId
        - sourceBranchId
        - dryRun
        - total_objects
        - unchanged_count
        - added_count
        - fast_forward_count
        - conflict_count
        - objects
    TriggerEmbeddingsBatchDto:
      type: object
      properties:
        objectIds:
          description: Array of object IDs to generate embeddings for
          example:
            - 123e4567-e89b-12d3-a456-426614174000
            - 123e4567-e89b-12d3-a456-426614174001
          type: array
          items:
            type: string
        priority:
          type: number
          description: Priority for embedding jobs (higher = processed first)
          example: 10
          default: 0
      required:
        - objectIds
    EmbeddingJobResponseDto:
      type: object
      properties:
        enqueued:
          type: number
          description: Number of jobs enqueued
          example: 10
        skipped:
          type: number
          description: Number of jobs that were already pending/processing
          example: 2
        jobIds:
          description: Array of job IDs that were created or found
          example:
            - job-1
            - job-2
          type: array
          items:
            type: string
      required:
        - enqueued
        - skipped
        - jobIds
    TriggerEmbeddingsProjectDto:
      type: object
      properties:
        projectId:
          type: string
          description: Project ID to regenerate embeddings for
          example: 123e4567-e89b-12d3-a456-426614174000
        objectType:
          type: string
          description: >-
            Object type filter (if specified, only regenerate embeddings for
            this type)
          example: Person
        priority:
          type: number
          description: Priority for embedding jobs (higher = processed first)
          example: 10
          default: 0
        force:
          type: boolean
          description: Force regeneration even if embedding already exists
          example: false
          default: false
      required:
        - projectId
    CreateProductVersionDto:
      type: object
      properties: {}
    CreateTagDto:
      type: object
      properties:
        name:
          type: string
          description: Tag name (unique within project)
          example: stable
        product_version_id:
          type: string
          description: Product version ID to tag
          example: 11111111-1111-4111-8111-111111111111
        description:
          type: string
          description: Optional tag description
          example: Stable release for production
      required:
        - name
        - product_version_id
    UpdateTagDto:
      type: object
      properties:
        description:
          type: string
          description: Updated tag description
          example: Updated stable release
    CreateObjectTypeDto:
      type: object
      properties: {}
    UpdateObjectTypeDto:
      type: object
      properties: {}
    ResolveTaskDto:
      type: object
      properties:
        status:
          type: string
          description: Resolution status
          enum:
            - accepted
            - rejected
        notes:
          type: string
          description: Optional notes about the resolution
      required:
        - status
    MergeChatSendDto:
      type: object
      properties:
        content:
          type: string
          description: Message content
        sourceObjectId:
          type: string
          description: Source object ID
        targetObjectId:
          type: string
          description: Target object ID
      required:
        - content
        - sourceObjectId
        - targetObjectId
    MergeChatApplyDto:
      type: object
      properties:
        messageId:
          type: string
          description: Message ID containing the suggestion
        suggestionIndex:
          type: number
          description: Index of the suggestion within the message
      required:
        - messageId
        - suggestionIndex
    MergeChatRejectDto:
      type: object
      properties:
        messageId:
          type: string
          description: Message ID containing the suggestion
        suggestionIndex:
          type: number
          description: Index of the suggestion within the message
        reason:
          type: string
          description: Reason for rejection
      required:
        - messageId
        - suggestionIndex
    SnoozeNotificationDto:
      type: object
      properties:
        until:
          type: string
          description: ISO 8601 datetime string for snooze until time
      required:
        - until
    ExtractionJobResourceDto:
      type: object
      properties:
        id:
          type: string
          example: 123e4567-e89b-12d3-a456-426614174000
        documentId:
          type: string
          example: doc_456
        status:
          type: string
          example: completed
          enum:
            - pending
            - processing
            - completed
            - failed
        totalItems:
          type: number
          example: 5
        processedItems:
          type: number
          example: 5
        successfulItems:
          type: number
          example: 5
        failedItems:
          type: number
          example: 0
        startedAt:
          type: string
          example: '2025-10-22T10:30:00Z'
        completedAt:
          type: string
          example: '2025-10-22T10:35:00Z'
        totalCostUsd:
          type: number
          example: 0.0125
      required:
        - id
        - documentId
        - status
        - totalItems
        - processedItems
        - successfulItems
        - failedItems
        - startedAt
    ResourceListResponseDto:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/ExtractionJobResourceDto'
        total:
          type: number
          example: 42
        limit:
          type: number
          example: 50
        offset:
          type: number
          example: 0
      required:
        - items
        - total
        - limit
        - offset
    LogEntryDto:
      type: object
      properties:
        id:
          type: string
          example: 123e4567-e89b-12d3-a456-426614174000
        processId:
          type: string
          example: job_123
        processType:
          type: string
          example: extraction_job
        level:
          type: string
          example: info
          enum:
            - debug
            - info
            - warn
            - error
            - fatal
        message:
          type: string
          example: Job processing started
        metadata:
          type: object
          example:
            step: extraction
            entity_count: 5
        timestamp:
          type: string
          example: '2025-10-22T10:30:00Z'
      required:
        - id
        - processId
        - processType
        - level
        - message
        - timestamp
    LLMCallDto:
      type: object
      properties:
        id:
          type: string
          example: 123e4567-e89b-12d3-a456-426614174000
        processId:
          type: string
          example: job_123
        processType:
          type: string
          example: extraction_job
        modelName:
          type: string
          example: gemini-1.5-pro
        requestPayload:
          type: object
          example:
            prompt: Extract entities from...
        responsePayload:
          type: object
          example:
            entities: []
        status:
          type: string
          example: success
          enum:
            - success
            - error
            - timeout
            - pending
        errorMessage:
          type: string
          example: Timeout after 30s
        inputTokens:
          type: number
          example: 1000
        outputTokens:
          type: number
          example: 500
        totalTokens:
          type: number
          example: 1500
        costUsd:
          type: number
          example: 0.00875
        startedAt:
          type: string
          example: '2025-10-22T10:30:00Z'
        completedAt:
          type: string
          example: '2025-10-22T10:30:05Z'
        durationMs:
          type: number
          example: 5000
      required:
        - id
        - processId
        - processType
        - modelName
        - requestPayload
        - status
        - startedAt
    ResourceDetailResponseDto:
      type: object
      properties:
        resource:
          $ref: '#/components/schemas/ExtractionJobResourceDto'
        recentLogs:
          type: array
          items:
            $ref: '#/components/schemas/LogEntryDto'
        llmCalls:
          type: array
          items:
            $ref: '#/components/schemas/LLMCallDto'
        metrics:
          type: object
          example:
            totalCost: 0.0125
            avgDuration: 5000
      required:
        - resource
        - recentLogs
        - llmCalls
    PromptResponse:
      type: object
      properties: {}
    UpdatePromptDto:
      type: object
      properties: {}
    RefinementStreamMetaEvent:
      type: object
      properties: {}
    RefinementStreamTokenEvent:
      type: object
      properties: {}
    RefinementStreamSuggestionsEvent:
      type: object
      properties: {}
    RefinementStreamErrorEvent:
      type: object
      properties: {}
    RefinementStreamDoneEvent:
      type: object
      properties: {}
    RefinementConversationDto:
      type: object
      properties:
        id:
          type: string
          description: Conversation ID
        objectId:
          type: string
          description: Object ID this conversation is for
        title:
          type: string
          description: Conversation title
        createdAt:
          format: date-time
          type: string
          description: When the conversation was created
        updatedAt:
          format: date-time
          type: string
          description: When the conversation was last updated
        messageCount:
          type: number
          description: Number of messages in the conversation
      required:
        - id
        - objectId
        - title
        - createdAt
        - updatedAt
        - messageCount
    RefinementMessageDto:
      type: object
      properties:
        content:
          type: string
          description: The message content from the user
      required:
        - content
    ApplySuggestionDto:
      type: object
      properties:
        messageId:
          type: string
          description: The message ID containing the suggestion
        suggestionIndex:
          type: number
          description: Index of the suggestion in the message
        expectedVersion:
          type: number
          description: Current object version for optimistic locking
      required:
        - messageId
        - suggestionIndex
        - expectedVersion
    ApplySuggestionResultDto:
      type: object
      properties:
        success:
          type: boolean
          description: Whether the suggestion was successfully applied
        error:
          type: string
          description: Error message if failed
        newVersion:
          type: number
          description: New version number after applying
        affectedId:
          type: string
          description: ID of the affected entity
      required:
        - success
    RejectSuggestionDto:
      type: object
      properties:
        messageId:
          type: string
          description: The message ID containing the suggestion
        suggestionIndex:
          type: number
          description: Index of the suggestion in the message
        reason:
          type: string
          description: Optional reason for rejection
      required:
        - messageId
        - suggestionIndex
    RefinementChatMessageDto:
      type: object
      properties:
        id:
          type: string
          description: Message ID
        role:
          type: string
          description: Role of the message sender
          enum:
            - user
            - assistant
        content:
          type: string
          description: Message content
        userId:
          type: string
          description: User ID who sent the message (for user messages)
        userName:
          type: string
          description: Display name of the user
        suggestions:
          description: Suggestions in this message (for assistant messages)
          type: array
          items:
            type: string
        createdAt:
          format: date-time
          type: string
          description: When the message was created
      required:
        - id
        - role
        - content
        - userId
        - userName
        - suggestions
        - createdAt
    UnifiedSearchWeightsDto:
      type: object
      properties:
        graphWeight:
          type: number
          description: Weight for graph search results (0-1)
          minimum: 0
          maximum: 1
          default: 0.5
          example: 0.6
        textWeight:
          type: number
          description: Weight for text search results (0-1)
          minimum: 0
          maximum: 1
          default: 0.5
          example: 0.4
    UnifiedSearchRelationshipOptionsDto:
      type: object
      properties:
        enabled:
          type: boolean
          description: Whether to include relationships for graph results
          default: true
        maxDepth:
          type: number
          description: Maximum depth for relationship traversal
          minimum: 0
          maximum: 3
          default: 1
        maxNeighbors:
          type: number
          description: Maximum number of neighbors per graph result
          minimum: 0
          maximum: 20
          default: 5
        direction:
          type: string
          description: Direction for relationship expansion
          enum:
            - in
            - out
            - both
          default: both
    UnifiedSearchRequestDto:
      type: object
      properties:
        query:
          type: string
          description: Natural language search query
          maxLength: 800
          example: hybrid search architecture decisions
        limit:
          type: number
          description: Maximum total number of results to return
          minimum: 1
          maximum: 100
          default: 20
        resultTypes:
          type: string
          description: Types of results to include
          enum:
            - graph
            - text
            - both
          default: both
        fusionStrategy:
          type: string
          description: Strategy for combining/fusing graph and text results
          enum:
            - weighted
            - rrf
            - interleave
            - graph_first
            - text_first
          default: weighted
        weights:
          description: Weights for combining graph and text scores
          allOf:
            - $ref: '#/components/schemas/UnifiedSearchWeightsDto'
        relationshipOptions:
          description: Options for expanding relationships in graph results
          allOf:
            - $ref: '#/components/schemas/UnifiedSearchRelationshipOptionsDto'
        includeDebug:
          type: boolean
          description: Whether to include debug metadata in response
          default: false
        maxTokenBudget:
          type: number
          description: Maximum token budget for field truncation (applies to graph results)
          minimum: 800
          maximum: 6000
          default: 3500
      required:
        - query
    UnifiedSearchMetadataDto:
      type: object
      properties:
        totalResults:
          type: number
          description: Total number of results across both types
          example: 27
        graphResultCount:
          type: number
          description: Number of graph results
          example: 12
        textResultCount:
          type: number
          description: Number of text results
          example: 15
        fusionStrategy:
          type: string
          description: Fusion strategy used
          example: weighted
        executionTime:
          type: object
          description: Query execution time breakdown (ms)
          example:
            graphSearchMs: 45.2
            textSearchMs: 67.3
            relationshipExpansionMs: 12.1
            fusionMs: 5.7
            totalMs: 130.3
      required:
        - totalResults
        - graphResultCount
        - textResultCount
        - fusionStrategy
        - executionTime
    UnifiedSearchDebugDto:
      type: object
      properties:
        graphSearch:
          type: object
          description: Raw graph search response
        textSearch:
          type: object
          description: Raw text search results
    UnifiedSearchResponseDto:
      type: object
      properties:
        results:
          description: Fused and ranked search results
          example:
            - type: graph
              object_id: af6b1db2-e7f9-4d2f-b3f4-5d8c0c61c9cd
              canonical_id: af6b1db2-e7f9-4d2f-b3f4-5d8c0c61c9cd
              score: 0.92
              rank: 1
              object_type: Decision
              key: dec-search-architecture
              fields:
                title: Adopt Hybrid Search
            - type: text
              id: chunk-123
              snippet: Hybrid search combines...
              score: 0.87
          type: array
          items:
            type: object
        metadata:
          description: Query metadata and performance metrics
          allOf:
            - $ref: '#/components/schemas/UnifiedSearchMetadataDto'
        debug:
          description: Debug information (only included with search:debug scope)
          allOf:
            - $ref: '#/components/schemas/UnifiedSearchDebugDto'
      required:
        - results
        - metadata
    GraphSearchFiltersDto:
      type: object
      properties:
        objectTypes:
          type: array
          items:
            type: string
        excludeObjectTypes:
          type: array
          items:
            type: string
        labelsAny:
          type: array
          items:
            type: string
        updatedAfter:
          type: string
          example: '2025-09-01T00:00:00Z'
        updatedBefore:
          type: string
          example: '2025-09-20T00:00:00Z'
    GraphSearchNeighborDto:
      type: object
      properties:
        perPrimaryLimit:
          type: number
          minimum: 0
          default: 3
        globalLimit:
          type: number
          minimum: 0
          default: 50
        maxDepth:
          type: number
          minimum: 0
          default: 1
        edgeTypes:
          example:
            - decides
            - attended_by
          type: array
          items:
            type: string
    GraphSearchDocumentFusionDto:
      type: object
      properties:
        enabled:
          type: boolean
          default: false
        topK:
          type: number
          default: 8
          minimum: 1
          maximum: 50
        mode:
          type: string
          enum:
            - blend
            - rrf
            - sequential
          default: blend
        weight:
          type: number
          default: 0.35
          minimum: 0
          maximum: 1
    GraphSearchPaginationDto:
      type: object
      properties:
        cursor:
          type: object
          example: null
        limit:
          type: number
          minimum: 1
          maximum: 100
          default: 40
        direction:
          type: string
          enum:
            - forward
            - backward
          default: forward
          description: >-
            Pagination direction relative to cursor (forward = items after
            cursor, backward = items before cursor). Only meaningful when cursor
            is supplied.
    GraphSearchRequestDto:
      type: object
      properties:
        query:
          type: string
          description: Search query
          maxLength: 800
        limit:
          type: number
          minimum: 1
          maximum: 100
          default: 40
        intentOverride:
          type: string
          enum:
            - explain
            - locate_config
            - debug_error
            - roadmap
          example: explain
        channels:
          type: array
          items:
            type: string
            enum:
              - lexical
              - vector
              - neighbor_boost
              - doc
        rerank:
          type: object
          default: null
        maxTokenBudget:
          type: number
          minimum: 800
          maximum: 6000
          default: 3500
        includeCitations:
          type: boolean
          default: false
        includePathSummaries:
          type: boolean
          default: true
        includeDebug:
          type: boolean
          default: false
        filters:
          $ref: '#/components/schemas/GraphSearchFiltersDto'
        neighbor:
          $ref: '#/components/schemas/GraphSearchNeighborDto'
        documentFusion:
          $ref: '#/components/schemas/GraphSearchDocumentFusionDto'
        pagination:
          $ref: '#/components/schemas/GraphSearchPaginationDto'
        experimental:
          type: object
          description: Experimental feature flags container
      required:
        - query
    GraphSearchReasonDto:
      type: object
      properties:
        channel:
          type: string
          enum:
            - lexical
            - vector
            - neighbor_boost
            - doc
        score:
          type: number
          example: 0.42
      required:
        - channel
        - score
    GraphSearchCitationDto:
      type: object
      properties:
        span:
          type: string
          example: Decision depends on consistent flag rollout
        source_object_id:
          type: string
          example: b3d52c50-5101-4c6c-8d30-4a1f0f7645cb
        confidence:
          type: number
          example: 0.82
      required:
        - span
        - source_object_id
        - confidence
    GraphSearchItemDto:
      type: object
      properties:
        object_id:
          type: string
          example: af6b1db2-e7f9-4d2f-b3f4-5d8c0c61c9cd
        canonical_id:
          type: string
          example: af6b1db2-e7f9-4d2f-b3f4-5d8c0c61c9cd
        score:
          type: number
          example: 0.87123
        rank:
          type: number
          example: 1
        role:
          type: string
          enum:
            - primary
            - neighbor
            - reference
            - document_chunk
        fields:
          type: object
          example:
            title: Adopt Feature Flagging
            type: Decision
            status: active
        truncated_fields:
          example:
            - description
          type: array
          items:
            type: string
        reasons:
          type: array
          items:
            $ref: '#/components/schemas/GraphSearchReasonDto'
        citations:
          type: array
          items:
            $ref: '#/components/schemas/GraphSearchCitationDto'
        explanation:
          type: string
          example: High lexical match on ...
        cursor:
          type: string
          example: eyJzY29yZSI6MC44NzEyMywiaWQiOiJkb2MtMSJ9
      required:
        - object_id
        - canonical_id
        - score
        - rank
        - role
        - fields
        - reasons
    GraphSearchPathSummaryDto:
      type: object
      properties:
        path_id:
          type: string
          example: e7b7ff6e-ef5f-4b55-9580-5d3b45d0a123
        summary:
          type: string
          example: Meeting X decided Decision Y
        reasons:
          type: array
          items:
            $ref: '#/components/schemas/GraphSearchReasonDto'
      required:
        - path_id
        - summary
        - reasons
    GraphSearchEmbeddingModelMetaDto:
      type: object
      properties:
        model:
          type: string
          example: text-embedding-3-large
        version:
          type: number
          example: 2
        coverage_pct:
          type: number
          example: 91.4
      required:
        - model
        - version
        - coverage_pct
    GraphSearchRerankMetaDto:
      type: object
      properties:
        applied:
          type: boolean
          example: true
        model:
          type: string
          example: mini-cross-encoder-v1
        latency_ms:
          type: number
          example: 42
        pool:
          type: number
          example: 60
        timeout:
          type: boolean
          example: false
      required:
        - applied
    GraphSearchExpansionMetaDto:
      type: object
      properties:
        neighbors:
          type: number
          example: 42
        hub_sampled:
          type: boolean
          example: true
        hub_degree:
          type: number
          example: 1342
      required:
        - neighbors
        - hub_sampled
    GraphSearchRequestMetaDto:
      type: object
      properties:
        limit:
          type: number
          example: 40
          description: Effective page size after server cap
        requested_limit:
          type: number
          example: 100
          description: Original client requested limit before clamping
        channels:
          example:
            - lexical
            - vector
          type: array
          items:
            type: string
        rerank:
          type: object
          example: false
        direction:
          type: string
          example: forward
          enum:
            - forward
            - backward
          description: Pagination direction used for this page.
      required:
        - limit
    GraphSearchMetaDto:
      type: object
      properties:
        channels:
          example:
            - lexical
            - vector
          type: array
          items:
            type: string
        fusion:
          type: string
          example: weighted_sum:v2
        normalization_version:
          type: string
          example: zscore_v1
        lexical_considered:
          type: number
          example: 100
        vector_considered:
          type: number
          example: 100
        skipped_unembedded:
          type: number
          example: 12
        neighbor_expanded:
          type: number
          example: 47
        token_estimate:
          type: number
          example: 1450
        token_budget:
          type: number
          example: 3500
        truncation_notice:
          type: boolean
          example: false
        warnings:
          example:
            - embedding_version_backlog
          type: array
          items:
            type: string
        embedding_model:
          $ref: '#/components/schemas/GraphSearchEmbeddingModelMetaDto'
        rerank:
          $ref: '#/components/schemas/GraphSearchRerankMetaDto'
        expansion:
          $ref: '#/components/schemas/GraphSearchExpansionMetaDto'
        request:
          $ref: '#/components/schemas/GraphSearchRequestMetaDto'
        elapsed_ms:
          type: number
          example: 92
        total_estimate:
          type: number
          example: 8
          description: >-
            Total size of fused candidate pool prior to pagination (may be less
            than lexical_considered+vector_considered due to overlaps).
        nextCursor:
          type: object
          example: null
        prevCursor:
          type: object
          example: null
        hasNext:
          type: boolean
          example: true
        hasPrev:
          type: boolean
          example: false
        approx_position_start:
          type: number
          example: 41
          description: >-
            Approximate 1-based index of first item in this page relative to
            fused pool snapshot. 0 if page empty.
        approx_position_end:
          type: number
          example: 80
          description: >-
            Approximate 1-based index of last item in this page relative to
            fused pool snapshot. 0 if page empty.
      required:
        - channels
        - fusion
        - normalization_version
        - lexical_considered
        - vector_considered
        - skipped_unembedded
        - neighbor_expanded
        - token_estimate
        - token_budget
        - truncation_notice
        - embedding_model
        - rerank
        - expansion
        - request
        - elapsed_ms
        - total_estimate
        - hasNext
        - hasPrev
    GraphSearchDebugDto:
      type: object
      properties:
        normalization:
          type: object
          example:
            lexical:
              mean: 0.42
              std: 0.11
        gain_rejections:
          type: number
          example: 5
        marginal_gain_min:
          type: number
          example: 0.02
        edge_samples:
          example:
            - relation: decides
              edge_score: 0.63
              depth: 1
              hub_damping: 0.43
          type: array
          items:
            type: object
        feature_flags:
          type: object
          example:
            paths: true
            rerank: true
            citations: false
      required:
        - normalization
        - gain_rejections
        - marginal_gain_min
        - edge_samples
        - feature_flags
    GraphSearchResponseDto:
      type: object
      properties:
        query:
          type: string
          example: original query text
        intent:
          type: string
          enum:
            - explain
            - locate_config
            - debug_error
            - roadmap
        items:
          type: array
          items:
            $ref: '#/components/schemas/GraphSearchItemDto'
        path_summaries:
          type: array
          items:
            $ref: '#/components/schemas/GraphSearchPathSummaryDto'
        meta:
          $ref: '#/components/schemas/GraphSearchMetaDto'
        debug:
          $ref: '#/components/schemas/GraphSearchDebugDto'
      required:
        - query
        - items
        - meta
    CitationDto:
      type: object
      properties: {}
    GraphObjectDto:
      type: object
      properties: {}
    GraphObjectNeighborsDto:
      type: object
      properties: {}
    ChatStreamMetaEvent:
      type: object
      properties: {}
    ChatStreamTokenEvent:
      type: object
      properties: {}
    ChatStreamErrorEvent:
      type: object
      properties: {}
    ChatStreamDoneEvent:
      type: object
      properties: {}
    ChatStreamMcpToolEvent:
      type: object
      properties: {}
    GetChatStreamMetaFrame:
      type: object
      properties: {}
    GetChatStreamTokenFrame:
      type: object
      properties: {}
    GetChatStreamCitationsFrame:
      type: object
      properties: {}
    GetChatStreamGraphObjectsFrame:
      type: object
      properties: {}
    GetChatStreamGraphNeighborsFrame:
      type: object
      properties: {}
    GetChatStreamSummaryFrame:
      type: object
      properties: {}
    GetChatStreamDoneFrame:
      type: object
      properties: {}
    GetChatStreamErrorFrame:
      type: object
      properties: {}
    CreateIntegrationDto:
      type: object
      properties: {}
    UpdateIntegrationDto:
      type: object
      properties: {}
    SchemaVersionDto:
      type: object
      properties:
        version:
          type: string
          description: Hash representing current schema state
          example: a1b2c3d4e5f6g7h8
        updated_at:
          type: string
          description: ISO timestamp of last schema update
          example: '2025-10-20T10:30:00.000Z'
        cache_hint_ttl:
          type: number
          description: Suggested cache TTL in seconds
          example: 300
      required:
        - version
        - updated_at
        - cache_hint_ttl
    SchemaChangeDto:
      type: object
      properties:
        pack_id:
          type: string
          description: Template pack ID
        version:
          type: string
          description: New version number
        schema_hash:
          type: string
          description: Schema hash for this version
        created_at:
          type: string
          description: ISO timestamp of change
        change_type:
          type: string
          description: Type of change
          enum:
            - created
            - updated
            - deleted
      required:
        - pack_id
        - version
        - schema_hash
        - created_at
    OrgWithProjectsDto:
      type: object
      properties:
        id:
          type: string
          description: Organization UUID
          example: 550e8400-e29b-41d4-a716-446655440000
        name:
          type: string
          description: Organization name
          example: Acme Corp
        role:
          type: string
          description: User role in organization
          example: org_admin
          enum:
            - org_admin
            - org_member
        projects:
          description: Projects within organization that user has access to
          items:
            type: array
          type: array
      required:
        - id
        - name
        - role
        - projects
    CreateConversationDto:
      type: object
      properties:
        title:
          type: string
          description: Optional initial title for the conversation
          example: New conversation
        projectId:
          type: string
          description: Optional project ID to associate with the conversation
    CreateConversationResponseDto:
      type: object
      properties:
        id:
          type: string
          description: The newly created conversation ID (UUID format)
          example: 321618f2-bf5a-44b9-bd02-e885ceed7f43
        title:
          type: string
          description: The conversation title
          example: New conversation
        createdAt:
          type: string
          description: Creation timestamp
          example: '2025-11-20T10:30:00.000Z'
      required:
        - id
        - title
        - createdAt
    ToolDefinitionDto:
      type: object
      properties:
        name:
          type: string
          description: Tool name (identifier)
          example: search_knowledge_base
        description:
          type: string
          description: Human-readable description
          example: Search documents and knowledge graph
        icon:
          type: string
          description: Iconify icon class
          example: lucide--search
        group:
          type: string
          description: Group identifier
          example: knowledge-base
        groupLabel:
          type: string
          description: Human-readable group label
          example: Knowledge Base
        groupIcon:
          type: string
          description: Iconify icon for the group
          example: lucide--database
      required:
        - name
        - description
        - icon
        - group
        - groupLabel
        - groupIcon
    ToolDefinitionsResponseDto:
      type: object
      properties:
        tools:
          description: Array of tool definitions with metadata
          type: array
          items:
            $ref: '#/components/schemas/ToolDefinitionDto'
      required:
        - tools
    TextPartDto:
      type: object
      properties:
        type:
          type: string
          description: Part type
          enum:
            - text
        text:
          type: string
          description: Text content
      required:
        - type
        - text
    MessageDto:
      type: object
      properties:
        id:
          type: string
          description: Message ID (optional)
        role:
          type: string
          description: Message role
          enum:
            - user
            - assistant
        content:
          type: string
          description: Message content (simple format)
        parts:
          description: Message parts (AI SDK format)
          type: array
          items:
            $ref: '#/components/schemas/TextPartDto'
      required:
        - role
    ChatSdkRequestDto:
      type: object
      properties:
        messages:
          description: Array of messages in the conversation
          type: array
          items:
            $ref: '#/components/schemas/MessageDto'
        conversationId:
          type: string
          description: Optional conversation ID to continue existing conversation
        projectId:
          type: string
          description: Optional project ID for scoped knowledge base search
        enabledTools:
          description: >-
            Array of enabled tool names. If null, all tools are enabled
            (default). If empty array, no tools are enabled.
          nullable: true
          type: array
          items:
            type: string
      required:
        - messages
    ImportExternalSourceDto:
      type: object
      properties:
        url:
          type: string
          description: URL of the external source to import
          example: https://docs.google.com/document/d/1abc123xyz/edit
        syncPolicy:
          type: string
          description: Sync policy for the source
          enum:
            - manual
            - on_access
            - periodic
            - webhook
          default: manual
        syncIntervalMinutes:
          type: number
          description: Sync interval in minutes (for periodic sync policy)
          minimum: 5
          maximum: 43200
        immediate:
          type: boolean
          description: >-
            Process immediately (true) or queue for background processing
            (false)
          default: true
        metadata:
          type: object
          description: Custom metadata to attach to the external source
      required:
        - url
    ImportResultDto:
      type: object
      properties:
        success:
          type: boolean
          description: Whether the import was successful
        externalSourceId:
          type: string
          description: External source ID (if created/found)
        documentId:
          type: string
          description: Document ID (if created immediately)
        status:
          type: string
          description: Import status
          enum:
            - created
            - duplicate
            - queued
            - error
            - updated
        jobId:
          type: string
          description: Job ID (if queued for background)
        error:
          type: string
          description: Error message (if failed)
        details:
          type: object
          description: Additional details
      required:
        - success
        - status
    ExternalSourceResponseDto:
      type: object
      properties:
        id:
          type: string
          description: Unique identifier
        projectId:
          type: string
          description: Project ID
        providerType:
          type: string
          description: Provider type
          enum:
            - google_drive
            - dropbox
            - url
            - notion
            - confluence
        externalId:
          type: string
          description: External ID (provider-specific)
        originalUrl:
          type: string
          description: Original URL as provided
        normalizedUrl:
          type: string
          description: Normalized URL for deduplication
        displayName:
          type: object
          description: Display name
        mimeType:
          type: object
          description: MIME type
        syncPolicy:
          type: string
          description: Sync policy
          enum:
            - manual
            - on_access
            - periodic
            - webhook
        syncIntervalMinutes:
          type: object
          description: Sync interval in minutes
        lastCheckedAt:
          type: object
          description: Last time source was checked
        lastSyncedAt:
          type: object
          description: Last successful sync time
        status:
          type: string
          description: Current status
          enum:
            - active
            - error
            - disabled
        errorCount:
          type: number
          description: Number of consecutive errors
        lastError:
          type: object
          description: Last error message
        lastErrorAt:
          type: object
          description: Last error timestamp
        createdAt:
          format: date-time
          type: string
          description: Creation timestamp
        updatedAt:
          format: date-time
          type: string
          description: Last update timestamp
        documentCount:
          type: number
          description: Number of documents from this source
        latestDocumentId:
          type: string
          description: Latest document ID
      required:
        - id
        - projectId
        - providerType
        - externalId
        - originalUrl
        - normalizedUrl
        - syncPolicy
        - status
        - errorCount
        - createdAt
        - updatedAt
    ExternalSourceListDto:
      type: object
      properties:
        items:
          description: List of external sources
          type: array
          items:
            $ref: '#/components/schemas/ExternalSourceResponseDto'
        total:
          type: number
          description: Total count
        nextCursor:
          type: object
          description: Cursor for next page
      required:
        - items
        - total
    TriggerSyncDto:
      type: object
      properties:
        force:
          type: boolean
          description: Force re-fetch even if no changes detected
          default: false
    SyncResultDto:
      type: object
      properties:
        success:
          type: boolean
          description: Whether sync was successful
        updated:
          type: boolean
          description: Whether content was updated
        documentId:
          type: string
          description: New document ID (if updated)
        error:
          type: string
          description: Error message (if failed)
        newEtag:
          type: string
          description: New ETag (if available)
        modifiedAt:
          format: date-time
          type: string
          description: Content modification time
      required:
        - success
        - updated
    UpdateExternalSourceDto:
      type: object
      properties:
        syncPolicy:
          type: string
          description: Sync policy for the source
          enum:
            - manual
            - on_access
            - periodic
            - webhook
        syncIntervalMinutes:
          type: number
          description: Sync interval in minutes (for periodic sync policy)
          minimum: 5
          maximum: 43200
        displayName:
          type: string
          description: Display name for the source
        status:
          type: string
          description: Enable or disable the source
          enum:
            - active
            - disabled
    RecordActivityDto:
      type: object
      properties:
        resourceType:
          type: string
          description: Type of resource being accessed
          enum:
            - document
            - object
          example: document
        resourceId:
          type: string
          description: UUID of the document or graph object
          example: 123e4567-e89b-12d3-a456-426614174000
        resourceName:
          type: string
          description: Display name of the resource (filename or object name)
          example: requirements.pdf
          maxLength: 500
        resourceSubtype:
          type: string
          description: >-
            Additional type info: MIME type for documents, object type for
            objects
          example: application/pdf
          maxLength: 100
        actionType:
          type: string
          description: Type of action performed
          enum:
            - viewed
            - edited
          example: viewed
      required:
        - resourceType
        - resourceId
        - actionType
    RecentItemDto:
      type: object
      properties:
        id:
          type: string
          description: Unique identifier
        resourceType:
          type: string
          description: Type of resource
          enum:
            - document
            - object
        resourceId:
          type: string
          description: UUID of the resource
        resourceName:
          type: object
          description: Display name of the resource
          nullable: true
        resourceSubtype:
          type: object
          description: Additional type info (MIME type or object type)
          nullable: true
        actionType:
          type: string
          description: Type of last action
          enum:
            - viewed
            - edited
        accessedAt:
          format: date-time
          type: string
          description: When the resource was last accessed
      required:
        - id
        - resourceType
        - resourceId
        - resourceName
        - resourceSubtype
        - actionType
        - accessedAt
    RecentItemsResponseDto:
      type: object
      properties:
        objects:
          description: List of recent objects
          type: array
          items:
            $ref: '#/components/schemas/RecentItemDto'
        documents:
          description: List of recent documents
          type: array
          items:
            $ref: '#/components/schemas/RecentItemDto'
      required:
        - objects
        - documents
    ClientLogEntryDto:
      type: object
      properties:
        timestamp:
          type: string
          description: ISO timestamp when log was created
        level:
          type: string
          description: Log level
          enum:
            - error
            - warn
            - info
            - debug
        message:
          type: string
          description: Log message
        stack:
          type: string
          description: Stack trace if available
        url:
          type: string
          description: Browser URL where log was captured
        userAgent:
          type: string
          description: User agent string
        extra:
          type: object
          description: Additional metadata
      required:
        - timestamp
        - level
        - message
    ClientLogsRequestDto:
      type: object
      properties:
        logs:
          description: Array of log entries from browser
          type: array
          items:
            $ref: '#/components/schemas/ClientLogEntryDto'
      required:
        - logs
    UserSearchResultDto:
      type: object
      properties:
        id:
          type: string
          description: User ID (internal UUID)
        email:
          type: string
          description: Email address
        displayName:
          type: string
          description: Display name
        firstName:
          type: string
          description: First name
        lastName:
          type: string
          description: Last name
        avatarUrl:
          type: string
          description: Avatar URL
      required:
        - id
        - email
    UserSearchResponseDto:
      type: object
      properties:
        users:
          type: array
          items:
            $ref: '#/components/schemas/UserSearchResultDto'
      required:
        - users
    ReleaseListItemDto:
      type: object
      properties:
        id:
          type: string
          description: Release ID
        version:
          type: string
          description: Release version
          example: v2025.01.15
        commitCount:
          type: number
          description: Number of commits in release
        status:
          type: string
          description: Release status
          enum:
            - draft
            - published
        createdAt:
          format: date-time
          type: string
          description: Creation timestamp
      required:
        - id
        - version
        - commitCount
        - status
        - createdAt
    CreateReleaseDto:
      type: object
      properties:
        fromCommit:
          type: string
          description: Starting commit (defaults to last notified commit)
        toCommit:
          type: string
          description: Ending commit (defaults to HEAD)
        rawCommits:
          type: boolean
          description: Use raw commit messages instead of LLM-generated changelog
          default: false
        since:
          type: string
          description: Date to get commits since (e.g., "2024-12-01", "1 week ago")
        until:
          type: string
          description: Date to get commits until (defaults to now)
    CreateReleaseResponseDto:
      type: object
      properties:
        success:
          type: boolean
          description: Whether the release was created successfully
        releaseId:
          type: string
          description: Release ID
        version:
          type: string
          description: Release version
        error:
          type: string
          description: Error message if creation failed
      required:
        - success
    PreviewReleaseDto:
      type: object
      properties:
        since:
          type: string
          description: Date to get commits since (e.g., "2024-12-01", "1 week ago")
        until:
          type: string
          description: Date to get commits until (defaults to now)
        rawCommits:
          type: boolean
          description: Use raw commit categorization instead of LLM
          default: true
      required:
        - since
    GitCommitDto:
      type: object
      properties:
        hash:
          type: string
          description: Full commit hash
        shortHash:
          type: string
          description: Short commit hash
        subject:
          type: string
          description: Commit subject line
        body:
          type: string
          description: Commit body
        authorName:
          type: string
          description: Author name
        authorEmail:
          type: string
          description: Author email
        date:
          format: date-time
          type: string
          description: Commit date
      required:
        - hash
        - shortHash
        - subject
        - body
        - authorName
        - authorEmail
        - date
    PreviewReleaseResponseDto:
      type: object
      properties:
        version:
          type: string
          description: Generated version string
        commitCount:
          type: number
          description: Number of commits found
        fromCommit:
          type: string
          description: Starting commit/date reference
        toCommit:
          type: string
          description: Ending commit/date reference
        commits:
          description: List of commits
          type: array
          items:
            $ref: '#/components/schemas/GitCommitDto'
        changelog:
          type: object
          description: Structured changelog preview
      required:
        - version
        - commitCount
        - fromCommit
        - toCommit
        - commits
        - changelog
    ReleaseDetailDto:
      type: object
      properties:
        id:
          type: string
          description: Release ID
        version:
          type: string
          description: Release version
          example: v2025.01.15
        fromCommit:
          type: string
          description: Starting commit hash
        toCommit:
          type: string
          description: Ending commit hash
        commitCount:
          type: number
          description: Number of commits in release
        status:
          type: string
          description: Release status
          enum:
            - draft
            - published
        changelogJson:
          type: object
          description: Structured changelog data
          nullable: true
        createdAt:
          format: date-time
          type: string
          description: Creation timestamp
      required:
        - id
        - version
        - fromCommit
        - toCommit
        - commitCount
        - status
        - changelogJson
        - createdAt
    SendNotificationsDto:
      type: object
      properties:
        userId:
          type: string
          description: Target a single user by ID
        projectId:
          type: string
          description: Target all members of a project
        allUsers:
          type: boolean
          description: Target all users
          default: false
        dryRun:
          type: boolean
          description: Preview mode - do not actually send
          default: false
        force:
          type: boolean
          description: Force send even if within debounce window
          default: false
        resend:
          type: boolean
          description: Resend to users who already received this release
          default: false
    RecipientResultDto:
      type: object
      properties:
        userId:
          type: string
          description: User ID
        email:
          type: string
          description: User email
        displayName:
          type: string
          description: User display name
        emailSent:
          type: boolean
          description: Whether email was sent
        inAppSent:
          type: boolean
          description: Whether in-app notification was sent
        skipped:
          type: boolean
          description: Whether user was skipped
        skipReason:
          type: string
          description: Reason for skipping
      required:
        - userId
        - emailSent
        - inAppSent
        - skipped
    SendNotificationsResponseDto:
      type: object
      properties:
        success:
          type: boolean
          description: Whether the operation was successful
        releaseId:
          type: string
          description: Release ID
        version:
          type: string
          description: Release version
        recipientCount:
          type: number
          description: Number of recipients targeted
        emailsSent:
          type: number
          description: Number of emails sent successfully
        emailsFailed:
          type: number
          description: Number of emails that failed
        inAppSent:
          type: number
          description: Number of in-app notifications sent
        skippedUsers:
          type: number
          description: Number of users skipped
        dryRun:
          type: boolean
          description: Whether this was a dry run
        error:
          type: string
          description: Error message if operation failed
        recipients:
          description: Per-recipient results (only in dry run or on request)
          type: array
          items:
            $ref: '#/components/schemas/RecipientResultDto'
      required:
        - success
        - recipientCount
        - emailsSent
        - emailsFailed
        - inAppSent
        - skippedUsers
        - dryRun
    EmailPreferencesDto:
      type: object
      properties:
        userId:
          type: string
          description: User ID
        releaseEmailsEnabled:
          type: boolean
          description: Whether user receives release notification emails
          default: true
        marketingEmailsEnabled:
          type: boolean
          description: Whether user receives marketing emails
          default: true
        updatedAt:
          type: string
          description: When preferences were last updated
      required:
        - userId
        - releaseEmailsEnabled
        - marketingEmailsEnabled
        - updatedAt
    UpdateEmailPreferencesDto:
      type: object
      properties:
        releaseEmailsEnabled:
          type: boolean
          description: Enable/disable release notification emails
        marketingEmailsEnabled:
          type: boolean
          description: Enable/disable marketing emails
    UnsubscribeInfoDto:
      type: object
      properties:
        email:
          type: string
          description: Email address associated with this token
        releaseEmailsEnabled:
          type: boolean
          description: Current release emails preference
        marketingEmailsEnabled:
          type: boolean
          description: Current marketing emails preference
      required:
        - email
        - releaseEmailsEnabled
        - marketingEmailsEnabled
    UnsubscribeBodyDto:
      type: object
      properties: {}
    UnsubscribeResultDto:
      type: object
      properties:
        success:
          type: boolean
          description: Whether unsubscribe was successful
        emailType:
          type: string
          description: Type of email unsubscribed from
        message:
          type: string
          description: Message describing the result
      required:
        - success
        - emailType
    UserOrgMembershipDto:
      type: object
      properties:
        orgId:
          type: string
          description: Organization ID
        orgName:
          type: string
          description: Organization name
        role:
          type: string
          description: Role in the organization
        joinedAt:
          format: date-time
          type: string
          description: When the user joined
      required:
        - orgId
        - orgName
        - role
        - joinedAt
    SuperadminUserDto:
      type: object
      properties:
        id:
          type: string
          description: User profile ID
        zitadelUserId:
          type: string
          description: Zitadel user ID
        firstName:
          type: object
          description: First name
        lastName:
          type: object
          description: Last name
        displayName:
          type: object
          description: Display name
        primaryEmail:
          type: object
          description: Primary email address
        lastActivityAt:
          type: object
          description: Last activity timestamp
        createdAt:
          format: date-time
          type: string
          description: Account created timestamp
        organizations:
          description: Organizations the user belongs to
          type: array
          items:
            $ref: '#/components/schemas/UserOrgMembershipDto'
      required:
        - id
        - zitadelUserId
        - createdAt
        - organizations
    PaginationMetaDto:
      type: object
      properties: {}
    ListUsersResponseDto:
      type: object
      properties:
        users:
          type: array
          items:
            $ref: '#/components/schemas/SuperadminUserDto'
        meta:
          $ref: '#/components/schemas/PaginationMetaDto'
      required:
        - users
        - meta
    SuperadminOrgDto:
      type: object
      properties:
        id:
          type: string
          description: Organization ID
        name:
          type: string
          description: Organization name
        memberCount:
          type: number
          description: Number of members
        projectCount:
          type: number
          description: Number of projects
        createdAt:
          format: date-time
          type: string
          description: When the organization was created
        deletedAt:
          type: object
          description: When the organization was deleted
      required:
        - id
        - name
        - memberCount
        - projectCount
        - createdAt
    ListOrganizationsResponseDto:
      type: object
      properties:
        organizations:
          type: array
          items:
            $ref: '#/components/schemas/SuperadminOrgDto'
        meta:
          $ref: '#/components/schemas/PaginationMetaDto'
      required:
        - organizations
        - meta
    SuperadminProjectDto:
      type: object
      properties:
        id:
          type: string
          description: Project ID
        name:
          type: string
          description: Project name
        organizationId:
          type: string
          description: Organization ID
        organizationName:
          type: string
          description: Organization name
        documentCount:
          type: number
          description: Number of documents
        createdAt:
          format: date-time
          type: string
          description: When the project was created
        deletedAt:
          type: object
          description: When the project was deleted
      required:
        - id
        - name
        - organizationId
        - organizationName
        - documentCount
        - createdAt
    ListProjectsResponseDto:
      type: object
      properties:
        projects:
          type: array
          items:
            $ref: '#/components/schemas/SuperadminProjectDto'
        meta:
          $ref: '#/components/schemas/PaginationMetaDto'
      required:
        - projects
        - meta
    SuperadminEmailJobDto:
      type: object
      properties:
        id:
          type: string
          description: Email job ID
        templateName:
          type: string
          description: Email template name
        toEmail:
          type: string
          description: Recipient email address
        toName:
          type: object
          description: Recipient name
        subject:
          type: string
          description: Email subject
        status:
          type: string
          description: Job status
          enum:
            - pending
            - processing
            - sent
            - failed
        attempts:
          type: number
          description: Number of send attempts
        maxAttempts:
          type: number
          description: Maximum send attempts
        lastError:
          type: object
          description: Last error message if failed
        createdAt:
          format: date-time
          type: string
          description: When the job was created
        processedAt:
          type: object
          description: When the job was processed
        sourceType:
          type: object
          description: Source type (e.g., invitation)
        sourceId:
          type: object
          description: Source entity ID
        deliveryStatus:
          type: string
          description: Delivery status from Mailgun events
          enum:
            - pending
            - delivered
            - opened
            - clicked
            - bounced
            - soft_bounced
            - complained
            - unsubscribed
            - failed
        deliveryStatusAt:
          type: object
          description: When the delivery status event occurred
      required:
        - id
        - templateName
        - toEmail
        - subject
        - status
        - attempts
        - maxAttempts
        - createdAt
    ListEmailJobsResponseDto:
      type: object
      properties:
        emailJobs:
          type: array
          items:
            $ref: '#/components/schemas/SuperadminEmailJobDto'
        meta:
          $ref: '#/components/schemas/PaginationMetaDto'
      required:
        - emailJobs
        - meta
    EmailJobPreviewResponseDto:
      type: object
      properties:
        html:
          type: string
          description: Rendered HTML content
        subject:
          type: string
          description: Email subject
        toEmail:
          type: string
          description: Recipient email address
        toName:
          type: object
          description: Recipient name
      required:
        - html
        - subject
        - toEmail
    ExternalServiceDto:
      type: object
      properties:
        name:
          type: string
          description: Service name
        url:
          type: object
          description: Service URL (if available)
        enabled:
          type: boolean
          description: Whether service is enabled/configured
      required:
        - name
        - url
        - enabled
    DeploymentInfoDto:
      type: object
      properties:
        environment:
          type: string
          description: Environment type
        nodeVersion:
          type: string
          description: Node.js version
        adminPort:
          type: number
          description: Admin port
        serverPort:
          type: number
          description: Server port
        adminUrl:
          type: string
          description: Admin URL
        serverUrl:
          type: string
          description: Server URL
      required:
        - environment
        - nodeVersion
        - adminPort
        - serverPort
        - adminUrl
        - serverUrl
    EnvironmentVariableDto:
      type: object
      properties:
        name:
          type: string
          description: Variable name
        value:
          type: string
          description: Variable value (may be masked if sensitive)
        sensitive:
          type: boolean
          description: Whether the value is sensitive
        category:
          type: string
          description: Category of the variable
      required:
        - name
        - value
        - sensitive
        - category
    SystemConfigResponseDto:
      type: object
      properties:
        externalServices:
          description: External services configuration
          type: array
          items:
            $ref: '#/components/schemas/ExternalServiceDto'
        deployment:
          description: Deployment information
          allOf:
            - $ref: '#/components/schemas/DeploymentInfoDto'
        environmentVariables:
          description: Environment variables grouped by category
          type: array
          items:
            $ref: '#/components/schemas/EnvironmentVariableDto'
      required:
        - externalServices
        - deployment
        - environmentVariables
    EmailTemplateListItemDto:
      type: object
      properties:
        id:
          type: string
          description: Template ID
        name:
          type: string
          description: Template name (e.g., invitation, welcome)
        description:
          type: object
          description: Human-readable description
        isCustomized:
          type: boolean
          description: Whether template has been customized from default
        currentVersionNumber:
          type: object
          description: Current version number
        updatedAt:
          format: date-time
          type: string
          description: Last update timestamp
        updatedBy:
          type: object
          description: User who last updated the template
          properties:
            id:
              type: string
            name:
              type: string
      required:
        - id
        - name
        - isCustomized
        - updatedAt
    ListEmailTemplatesResponseDto:
      type: object
      properties:
        templates:
          type: array
          items:
            $ref: '#/components/schemas/EmailTemplateListItemDto'
      required:
        - templates
    EmailTemplateVersionDto:
      type: object
      properties:
        id:
          type: string
          description: Version ID
        versionNumber:
          type: number
          description: Version number
        createdAt:
          format: date-time
          type: string
          description: When this version was created
        createdBy:
          type: object
          description: User who created this version
          properties:
            id:
              type: string
            name:
              type: string
      required:
        - id
        - versionNumber
        - createdAt
    EmailTemplateDetailDto:
      type: object
      properties:
        id:
          type: string
          description: Template ID
        name:
          type: string
          description: Template name
        description:
          type: object
          description: Human-readable description
        subjectTemplate:
          type: string
          description: Handlebars template for subject line
        mjmlContent:
          type: string
          description: MJML + Handlebars template content
        variables:
          type: array
          description: Template variables definition
          items:
            type: object
            properties:
              name:
                type: string
              type:
                type: string
                enum:
                  - string
                  - url
                  - date
                  - object
              description:
                type: string
              required:
                type: boolean
              defaultValue:
                type: object
        sampleData:
          type: object
          description: Default sample data for preview
        isCustomized:
          type: boolean
          description: Whether template has been customized from default
        currentVersion:
          description: Current version information
          allOf:
            - $ref: '#/components/schemas/EmailTemplateVersionDto'
      required:
        - id
        - name
        - subjectTemplate
        - mjmlContent
        - variables
        - sampleData
        - isCustomized
    UpdateEmailTemplateDto:
      type: object
      properties:
        subjectTemplate:
          type: string
          description: Handlebars template for subject line
        mjmlContent:
          type: string
          description: MJML + Handlebars template content
        sampleData:
          type: object
          description: Sample data for preview
        changeSummary:
          type: string
          description: Description of changes
      required:
        - subjectTemplate
        - mjmlContent
    UpdateEmailTemplateResponseDto:
      type: object
      properties:
        id:
          type: string
          description: Template ID
        versionNumber:
          type: number
          description: New version number
        createdAt:
          format: date-time
          type: string
          description: When the version was created
      required:
        - id
        - versionNumber
        - createdAt
    PreviewEmailTemplateDto:
      type: object
      properties:
        data:
          type: object
          description: Override sample data for preview
    PreviewEmailTemplateResponseDto:
      type: object
      properties:
        html:
          type: string
          description: Rendered HTML content
        text:
          type: object
          description: Plain text version
        subject:
          type: string
          description: Rendered subject line
      required:
        - html
        - subject
    PreviewMjmlDto:
      type: object
      properties:
        mjmlContent:
          type: string
          description: MJML content to render
        subjectTemplate:
          type: string
          description: Subject template to render
        data:
          type: object
          description: Data to inject into templates
      required:
        - mjmlContent
    PreviewMjmlResponseDto:
      type: object
      properties:
        html:
          type: string
          description: Rendered HTML content
        text:
          type: object
          description: Plain text version
        subject:
          type: object
          description: Rendered subject line (if subjectTemplate provided)
      required:
        - html
    EmailTemplateVersionListItemDto:
      type: object
      properties:
        id:
          type: string
          description: Version ID
        versionNumber:
          type: number
          description: Version number
        changeSummary:
          type: object
          description: Description of changes
        createdAt:
          format: date-time
          type: string
          description: When this version was created
        createdBy:
          type: object
          description: User who created this version
          properties:
            id:
              type: string
            name:
              type: string
      required:
        - id
        - versionNumber
        - createdAt
    ListEmailTemplateVersionsResponseDto:
      type: object
      properties:
        versions:
          type: array
          items:
            $ref: '#/components/schemas/EmailTemplateVersionListItemDto'
        total:
          type: number
          description: Total number of versions
        meta:
          $ref: '#/components/schemas/PaginationMetaDto'
      required:
        - versions
        - total
        - meta
    RollbackEmailTemplateDto:
      type: object
      properties:
        versionId:
          type: string
          description: Version ID to rollback to
      required:
        - versionId
    RollbackEmailTemplateResponseDto:
      type: object
      properties:
        id:
          type: string
          description: Template ID
        versionNumber:
          type: number
          description: New version number after rollback
      required:
        - id
        - versionNumber
    ResetEmailTemplateResponseDto:
      type: object
      properties:
        id:
          type: string
          description: Template ID
        versionNumber:
          type: number
          description: New version number after reset
      required:
        - id
        - versionNumber
    EmailTemplateRefinementConversationDto:
      type: object
      properties:
        id:
          type: string
          description: Conversation ID
        templateId:
          type: string
          description: Template ID this conversation is for
        templateName:
          type: string
          description: Template name
        messages:
          description: Messages in the conversation
          type: array
          items:
            type: string
        createdAt:
          format: date-time
          type: string
          description: When the conversation was created
      required:
        - id
        - templateId
        - templateName
        - messages
        - createdAt
    EmailTemplateRefinementMessageDto:
      type: object
      properties:
        content:
          type: string
          description: The message content from the user
        currentMjml:
          type: string
          description: Current MJML content for context (optional)
        currentSubject:
          type: string
          description: Current subject template for context (optional)
      required:
        - content
    ApplyEmailTemplateSuggestionDto:
      type: object
      properties:
        messageId:
          type: string
          description: ID of the message containing the suggestion
        suggestionIndex:
          type: number
          description: Index of the suggestion to apply
        type:
          type: string
          description: Type of suggestion
          enum:
            - mjml_change
            - subject_change
        newContent:
          type: string
          description: New content to apply
        changeSummary:
          type: string
          description: Change summary for version history
      required:
        - messageId
        - suggestionIndex
        - type
        - newContent
    ApplyEmailTemplateSuggestionResultDto:
      type: object
      properties:
        success:
          type: boolean
          description: Whether the suggestion was successfully applied
        error:
          type: string
          description: Error message if failed
        versionNumber:
          type: number
          description: New version number after applying
      required:
        - success
x-tagGroups:
  - name: Health & Auth
    tags:
      - Health
      - Auth
  - name: Organizations & Projects
    tags:
      - Orgs
      - Projects
  - name: Configuration
    tags:
      - Settings
  - name: Content & Ingestion
    tags:
      - Ingestion
      - Documents
      - Chunks
  - name: Search
    tags:
      - Search
  - name: Chat
    tags:
      - Chat
