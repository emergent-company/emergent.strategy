{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://emergent.build/schemas/outputs/value-model-preview.schema.json",
  "title": "Value Model Preview Generator",
  "description": "Input parameters for generating HTML previews of EPF value models",
  "version": "1.0.0",
  "type": "object",

  "definitions": {
    "metadata": {
      "type": "object",
      "description": "Generation metadata tracking source and freshness",
      "required": ["generated_at", "generator", "epf_version"],
      "properties": {
        "generated_at": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of generation"
        },
        "generator": {
          "type": "string",
          "const": "value-model-preview/wizard.instructions.md",
          "description": "Name of the wizard that generated this output"
        },
        "generator_version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$",
          "description": "Semantic version of the generator",
          "default": "1.0.0"
        },
        "epf_version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$",
          "description": "EPF framework version used"
        },
        "source_files": {
          "type": "array",
          "description": "Value model files used for generation",
          "items": {
            "type": "string"
          }
        }
      }
    },

    "output_format": {
      "type": "string",
      "enum": ["single", "portfolio", "comparison"],
      "description": "Output format type. 'single' = one model per file, 'portfolio' = all models combined, 'comparison' = side-by-side tracks"
    },

    "theme": {
      "type": "string",
      "enum": ["auto", "light", "dark"],
      "default": "auto",
      "description": "Color theme for HTML output. 'auto' detects system preference"
    },

    "additional_data_section": {
      "type": "object",
      "description": "Custom data section to inject into the preview",
      "required": ["title", "content"],
      "properties": {
        "title": {
          "type": "string",
          "description": "Section heading",
          "minLength": 1,
          "maxLength": 100
        },
        "content": {
          "type": "string",
          "description": "Section content (supports Markdown)",
          "minLength": 1,
          "maxLength": 10000
        },
        "position": {
          "type": "string",
          "enum": ["before_layers", "after_layers", "sidebar"],
          "default": "after_layers",
          "description": "Where to place this section in the document"
        }
      }
    }
  },

  "required": ["product", "format"],
  "properties": {
    "product": {
      "type": "string",
      "description": "Product name matching EPF instance directory (e.g., 'emergent')",
      "minLength": 1,
      "maxLength": 50,
      "pattern": "^[a-z][a-z0-9-]*$"
    },

    "format": {
      "$ref": "#/definitions/output_format"
    },

    "models": {
      "type": "array",
      "description": "Specific value model files to include. If omitted, auto-discovers all .value_model.yaml files",
      "items": {
        "type": "string",
        "description": "Relative path to value model file within the instance's value_models directory"
      },
      "examples": [
        ["product.emergent-core.value_model.yaml"],
        ["strategy.value_model.yaml", "commercial.value_model.yaml"]
      ]
    },

    "theme": {
      "$ref": "#/definitions/theme"
    },

    "title": {
      "type": "string",
      "description": "Custom title for the HTML document. If omitted, auto-generates from track_name",
      "minLength": 1,
      "maxLength": 200
    },

    "subtitle": {
      "type": "string",
      "description": "Optional subtitle shown below the main title",
      "maxLength": 300
    },

    "show_maturity": {
      "type": "boolean",
      "default": true,
      "description": "Whether to display maturity stage indicators"
    },

    "show_activation_status": {
      "type": "boolean",
      "default": true,
      "description": "Whether to display active/planned/deprecated badges"
    },

    "show_premium_flags": {
      "type": "boolean",
      "default": true,
      "description": "Whether to highlight premium components"
    },

    "collapsible_layers": {
      "type": "boolean",
      "default": true,
      "description": "Whether layers can be collapsed/expanded"
    },

    "include_description": {
      "type": "boolean",
      "default": true,
      "description": "Whether to include the high-level model description"
    },

    "include_solution_steps": {
      "type": "boolean",
      "default": false,
      "description": "Whether to include layer solution_steps sections"
    },

    "additional_data": {
      "type": "array",
      "description": "Custom data sections to inject into the preview",
      "items": {
        "$ref": "#/definitions/additional_data_section"
      }
    },

    "footer_text": {
      "type": "string",
      "description": "Custom footer text. Supports basic HTML",
      "maxLength": 500
    },

    "output_filename": {
      "type": "string",
      "description": "Custom output filename (without .html extension). If omitted, auto-generates",
      "pattern": "^[a-zA-Z0-9_-]+$",
      "maxLength": 100
    }
  }
}
