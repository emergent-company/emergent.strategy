{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Roadmap Recipe Schema",
  "description": "Defines the structure for the track-based roadmap in the ROADMAP phase. The roadmap is organized by four tracks (Product, Strategy, Org/Ops, Commercial) to align with value models. Key Results (KRs) are the lowest level that EPF defines - work packages are the responsibility of spec-driven development tools (Linear, Jira, etc.).",
  "type": "object",
  "properties": {
    "roadmap": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string"
        },
        "strategy_id": {
          "type": "string",
          "description": "Reference to the strategy this roadmap implements"
        },
        "cycle": {
          "type": "integer"
        },
        "timeframe": {
          "type": "string"
        },
        "tracks": {
          "type": "object",
          "description": "Four parallel tracks aligned with value models",
          "properties": {
            "product": {
              "$ref": "#/definitions/track"
            },
            "strategy": {
              "$ref": "#/definitions/track"
            },
            "org_ops": {
              "$ref": "#/definitions/track"
            },
            "commercial": {
              "$ref": "#/definitions/track"
            }
          },
          "required": ["product", "strategy", "org_ops", "commercial"]
        },
        "cross_track_dependencies": {
          "type": "array",
          "description": "Explicit dependencies between key results across tracks",
          "items": {
            "type": "object",
            "properties": {
              "from_kr": {
                "type": "string",
                "description": "Key Result ID (e.g., 'kr-p-001', 'kr-s-001')"
              },
              "to_kr": {
                "type": "string",
                "description": "Key Result ID that depends on from_kr"
              },
              "dependency_type": {
                "type": "string",
                "enum": ["requires", "informs", "enables"]
              },
              "description": {
                "type": "string"
              }
            },
            "required": ["from_kr", "to_kr", "dependency_type"]
          }
        },
        "execution_plan": {
          "type": "object",
          "description": "High-level execution planning at the KR level. Detailed work packages are defined in spec-driven development tools.",
          "properties": {
            "sequencing_rationale": {
              "type": "string"
            },
            "critical_path": {
              "type": "array",
              "description": "Key Result IDs in critical sequence (format: 'track:kr-id')",
              "items": {
                "type": "string"
              }
            },
            "parallel_tracks": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "key_results": {
                    "type": "array",
                    "description": "Key Result IDs that can be pursued in parallel",
                    "items": {
                      "type": "string"
                    }
                  },
                  "timeframe": {
                    "type": "string"
                  },
                  "depends_on": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  }
                },
                "required": ["name", "key_results"]
              }
            },
            "key_milestones": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "date": {
                    "type": "string"
                  },
                  "milestone": {
                    "type": "string"
                  },
                  "key_results": {
                    "type": "array",
                    "description": "Key Results expected to be achieved by this milestone",
                    "items": {
                      "type": "string"
                    }
                  }
                },
                "required": ["milestone", "key_results"]
              }
            }
          },
          "required": ["sequencing_rationale", "critical_path"]
        },
        "status": {
          "type": "string",
          "enum": ["draft", "approved", "active", "completed", "cancelled"]
        },
        "approved_by": {
          "type": ["string", "null"]
        },
        "approval_date": {
          "type": ["string", "null"]
        },
        "start_date": {
          "type": ["string", "null"]
        },
        "target_completion_date": {
          "type": ["string", "null"]
        }
      },
      "required": ["id", "strategy_id", "cycle", "timeframe", "tracks", "execution_plan", "status"]
    }
  },
  "required": ["roadmap"],
  "definitions": {
    "track": {
      "type": "object",
      "description": "A single track (Product, Strategy, Org/Ops, or Commercial) with its own OKRs and assumptions. Key Results are the lowest level - they are handed off to spec-driven development tools which create work packages.",
      "properties": {
        "track_objective": {
          "type": "string",
          "description": "High-level objective for this track"
        },
        "okrs": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "id": {
                "type": "string",
                "pattern": "^okr-[psoc]-\\d+$",
                "description": "OKR ID with track prefix: okr-p-001 (product), okr-s-001 (strategy), okr-o-001 (org_ops), okr-c-001 (commercial)"
              },
              "objective": {
                "type": "string"
              },
              "key_results": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "string",
                      "pattern": "^kr-[psoc]-\\d+$"
                    },
                    "description": {
                      "type": "string"
                    },
                    "target": {
                      "type": "string"
                    },
                    "measurement_method": {
                      "type": "string"
                    },
                    "baseline": {
                      "type": "string"
                    }
                  },
                  "required": ["id", "description", "target"]
                }
              }
            },
            "required": ["id", "objective", "key_results"]
          }
        },
        "riskiest_assumptions": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "id": {
                "type": "string",
                "pattern": "^asm-[psoc]-\\d+$"
              },
              "description": {
                "type": "string"
              },
              "type": {
                "type": "string",
                "enum": ["desirability", "feasibility", "viability", "adaptability"]
              },
              "criticality": {
                "type": "string",
                "enum": ["high", "medium", "low"]
              },
              "confidence": {
                "type": "string",
                "enum": ["low", "medium", "high"]
              },
              "evidence_required": {
                "type": "string"
              },
              "linked_to_kr": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              }
            },
            "required": ["id", "description", "type", "criticality", "confidence"]
          }
        },
        "solution_scaffold": {
          "type": "object",
          "properties": {
            "description": {
              "type": "string"
            },
            "key_components": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "id": {
                    "type": "string",
                    "pattern": "^comp-[psoc]-\\d+$"
                  },
                  "name": {
                    "type": "string"
                  },
                  "purpose": {
                    "type": "string"
                  },
                  "priority": {
                    "type": "string",
                    "enum": ["must-have", "should-have", "could-have"]
                  },
                  "maps_to_value_model": {
                    "type": "string",
                    "description": "Reference to value model component (e.g., PRODUCT-L2-example)"
                  }
                },
                "required": ["id", "name", "purpose", "priority"]
              }
            },
            "architecture_principles": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "technical_constraints": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          },
          "required": ["description", "key_components"]
        }
      },
      "required": ["track_objective", "okrs", "riskiest_assumptions", "solution_scaffold"]
    }
  }
}
