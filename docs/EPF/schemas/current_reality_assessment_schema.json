{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://emergent.company/epf/schemas/current_reality_assessment_schema.json",
  "title": "Living Reality Assessment",
  "description": "Living document that captures and evolves the current state across EPF tracks. Initially populated at bootstrap (Cycle 0), then continuously updated through track health signals each AIM cycle. This is the ground truth about 'where we are now' that informs every READY phase.",
  "$comment": "The Living Reality Assessment (formerly CRA) solves two problems: (1) Cold start - provides initial signal when no prior AIM data exists, and (2) Reality drift - keeps current state accurate as organization evolves. Unlike a one-time snapshot, this document is updated every AIM cycle based on track health signals. Think of it as the 'operating system state' that EPF maintains. Sections evolve at different rates: adoption_context changes slowly (reorg, funding events), track_baselines change each cycle (via THA signals), constraints get validated/invalidated, focus gets rebalanced. The evolution_log tracks all changes, creating an audit trail of organizational emergence.",
  "type": "object",
  "required": [
    "metadata",
    "adoption_context",
    "track_baselines"
  ],
  "properties": {
    "metadata": {
      "type": "object",
      "description": "Lifecycle metadata for this living document",
      "required": ["created_at", "last_updated", "lifecycle_stage", "adoption_level"],
      "properties": {
        "created_at": {
          "type": "string",
          "format": "date-time",
          "description": "When this document was first created (bootstrap)",
          "$comment": "ISO 8601 timestamp. Set once at initial bootstrap, never changes. Use last_updated for most recent modification."
        },
        "last_updated": {
          "type": "string",
          "format": "date-time",
          "description": "When this document was last updated",
          "$comment": "Updated every AIM cycle when track health signals are processed. Also updated on significant adoption context changes."
        },
        "last_updated_by": {
          "type": "string",
          "description": "Person or agent that last updated this document",
          "examples": ["synthesizer-agent", "founder@example.com", "aim-cycle-2025-q1"]
        },
        "lifecycle_stage": {
          "type": "string",
          "enum": ["bootstrap", "maturing", "evolved"],
          "description": "Current lifecycle stage of this document",
          "$comment": "'bootstrap' (Cycle 0) = initial capture, mostly manual input. 'maturing' (Cycle 1-3) = signals starting to enrich, mixed sources. 'evolved' (Cycle 4+) = full emergence, agent-maintained, evidence-based. Stage advances automatically based on cycle count and signal quality."
        },
        "cycles_completed": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of complete READY-FIRE-AIM cycles since bootstrap",
          "$comment": "Incremented after each AIM phase. Used to calculate lifecycle_stage and track document maturity."
        },
        "adoption_level": {
          "type": "integer",
          "minimum": 0,
          "maximum": 3,
          "description": "Current adoption level (0=solo founder, 1=small team 3-5, 2=growing 6-15, 3=product org 15+)",
          "$comment": "May change over time as team grows. Level changes are logged in evolution_log."
        },
        "bootstrap_time_invested": {
          "type": "string",
          "pattern": "^[0-9]+\\s*(min|hour|h|m)$",
          "description": "Time spent on initial bootstrap",
          "examples": ["5 min", "15 min", "45 min"],
          "$comment": "Historical record of initial investment. Helps calibrate progressive disclosure for future bootstraps."
        },
        "bootstrap_type": {
          "type": "string",
          "enum": ["initial_adoption", "major_pivot", "product_line_addition", "team_transition"],
          "default": "initial_adoption",
          "description": "Context for why this document was created",
          "$comment": "Set at bootstrap, becomes historical context. 'initial_adoption' is most common (first EPF use). 'major_pivot' is strategy refresh. 'product_line_addition' adds to existing portfolio. 'team_transition' captures state when leadership changes."
        }
      }
    },
    "adoption_context": {
      "type": "object",
      "description": "Context about where this organization/team is starting from",
      "$comment": "Adoption context helps the Bootstrap wizard and subsequent wizards calibrate expectations. A bootstrapped startup has different needs than a VC-funded scale-up. This context influences which READY artifacts are essential vs optional.",
      "required": ["organization_type", "funding_stage", "team_size"],
      "properties": {
        "organization_type": {
          "type": "string",
          "enum": ["solo_founder", "cofounding_team", "bootstrapped_startup", "funded_startup", "corporate_spinout", "enterprise_division", "agency_project", "open_source"],
          "description": "Type of organization adopting EPF",
          "$comment": "Organization type influences process weight and stakeholder complexity. Solo founders need minimal ceremony; enterprise divisions may have governance requirements."
        },
        "funding_stage": {
          "type": "string",
          "enum": ["pre_seed", "bootstrapped", "seed", "series_a", "series_b_plus", "profitable", "enterprise_budget"],
          "description": "Current funding/resource stage",
          "$comment": "Funding stage correlates with runway pressure, team size expectations, and reporting requirements. Pre-seed may have 6-month runway; Series B+ has different burn rate concerns."
        },
        "team_size": {
          "type": "integer",
          "minimum": 1,
          "description": "Current team size (people, not AI agents)",
          "$comment": "Team size directly maps to adoption level: 1-2=L0, 3-5=L1, 6-15=L2, 15+=L3. Tracked as integer for precise mapping."
        },
        "ai_capability_level": {
          "type": "string",
          "enum": ["manual_only", "ai_assisted", "ai_first", "agentic"],
          "description": "How much AI augmentation is used in execution",
          "$comment": "AI capability level shifts bottleneck from execution to attention. 'manual_only' = traditional human processes. 'ai_assisted' = humans use AI tools. 'ai_first' = AI handles most execution. 'agentic' = AI agents operate autonomously with human oversight. This is a key EPF-Runtime signal.",
          "default": "ai_assisted"
        },
        "primary_bottleneck": {
          "type": "string",
          "enum": ["execution_capacity", "strategic_clarity", "market_validation", "funding", "hiring", "technical_capability", "attention_bandwidth"],
          "description": "What's currently limiting progress most",
          "$comment": "Primary bottleneck influences which track to prioritize. 'execution_capacity' suggests Product focus. 'strategic_clarity' suggests Strategy focus. 'attention_bandwidth' is common in AI-first teams where agents can execute faster than humans can decide."
        },
        "runway_months": {
          "type": "number",
          "minimum": 0,
          "description": "Approximate runway in months (null = profitable/enterprise)",
          "$comment": "Runway creates urgency context. <6 months = high urgency, need lean approach. 12+ months = can invest in foundation. Null/omit for profitable companies or enterprise budgets."
        }
      }
    },
    "track_baselines": {
      "type": "object",
      "description": "Current state snapshot for each EPF track",
      "$comment": "Track baselines capture 'where we are now' for each of the four tracks. Not all tracks need to be active at start (solo founders typically focus on Product only), but understanding baseline helps plan expansion. Each track uses the same maturity model: absent → implicit → explicit → measured → optimized.",
      "properties": {
        "product": {
          "$ref": "#/$defs/track_baseline",
          "description": "Product track baseline (always required)",
          "$comment": "Product is the core track - if you're not building product, you're probably not using EPF. This track covers all product development activity from ideation through delivery."
        },
        "strategy": {
          "$ref": "#/$defs/track_baseline",
          "description": "Strategy track baseline (optional at L0-1)",
          "$comment": "Strategy track covers market positioning, competitive response, strategic narrative. At L0-1, strategy is often implicit ('we're building X for Y'). Becomes explicit as organization grows."
        },
        "org_ops": {
          "$ref": "#/$defs/track_baseline",
          "description": "Org/Ops track baseline (optional at L0-1)",
          "$comment": "Org/Ops covers team structure, processes, culture, hiring. Solo founders don't have org complexity; this track emerges as team grows. Often first to become bottleneck at L1→L2 transition."
        },
        "commercial": {
          "$ref": "#/$defs/track_baseline",
          "description": "Commercial track baseline (optional at L0-1)",
          "$comment": "Commercial covers revenue model, sales process, customer success. May be absent for pre-revenue startups. Becomes critical post-PMF."
        }
      },
      "required": ["product"]
    },
    "existing_assets": {
      "type": "object",
      "description": "Inventory of existing artifacts/assets that EPF should incorporate",
      "$comment": "Organizations rarely start from complete scratch. They may have existing code, documentation, customer relationships, or process artifacts. This section inventories what exists so EPF can build on it rather than ignore it. Assets listed here inform which READY artifacts need creation vs adaptation.",
      "properties": {
        "code_assets": {
          "type": "object",
          "properties": {
            "exists": {
              "type": "boolean",
              "description": "Is there existing code/product?"
            },
            "maturity": {
              "type": "string",
              "enum": ["prototype", "mvp", "production", "scaling"],
              "description": "Product maturity level"
            },
            "tech_stack_summary": {
              "type": "string",
              "maxLength": 200,
              "description": "Brief tech stack description",
              "examples": ["React + Node.js + PostgreSQL", "Python ML stack + FastAPI", "iOS Swift native"]
            }
          }
        },
        "documentation_assets": {
          "type": "object",
          "properties": {
            "exists": {
              "type": "boolean",
              "description": "Is there existing documentation?"
            },
            "types": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": ["product_specs", "technical_docs", "user_guides", "api_docs", "pitch_deck", "business_plan", "market_research"]
              },
              "description": "Types of documentation that exist"
            },
            "quality_assessment": {
              "type": "string",
              "enum": ["outdated", "partial", "adequate", "comprehensive"],
              "description": "Overall documentation quality"
            }
          }
        },
        "customer_assets": {
          "type": "object",
          "properties": {
            "has_users": {
              "type": "boolean",
              "description": "Are there existing users?"
            },
            "user_count_estimate": {
              "type": "string",
              "enum": ["none", "1-10", "10-100", "100-1000", "1000-10000", "10000+"],
              "description": "Approximate user count"
            },
            "paying_customers": {
              "type": "boolean",
              "description": "Are there paying customers?"
            },
            "customer_feedback_exists": {
              "type": "boolean",
              "description": "Is there documented customer feedback?"
            }
          }
        },
        "strategic_assets": {
          "type": "object",
          "properties": {
            "has_positioning": {
              "type": "boolean",
              "description": "Is there defined market positioning?"
            },
            "positioning_documented": {
              "type": "boolean",
              "description": "Is positioning written down somewhere?"
            },
            "competitor_analysis_exists": {
              "type": "boolean",
              "description": "Has competitor analysis been done?"
            },
            "investor_materials_exist": {
              "type": "boolean",
              "description": "Are there investor decks/memos?"
            }
          }
        },
        "process_assets": {
          "type": "object",
          "properties": {
            "has_defined_process": {
              "type": "boolean",
              "description": "Are there defined development/business processes?"
            },
            "process_types": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": ["sprint_planning", "okr_process", "design_system", "ci_cd", "customer_support", "sales_process", "hiring_process"]
              },
              "description": "Types of processes that exist"
            }
          }
        }
      }
    },
    "constraints_and_assumptions": {
      "type": "object",
      "description": "Known constraints and operating assumptions at start",
      "$comment": "Constraints and assumptions shape what's possible in initial cycles. These aren't strategic assumptions to validate (that's roadmap territory) but operational realities that bound planning. Example: 'We have 3 months runway' is a constraint; 'Users will pay for feature X' is a strategic assumption for roadmap.",
      "properties": {
        "hard_constraints": {
          "type": "array",
          "description": "Non-negotiable constraints (timeline, budget, regulatory, etc.)",
          "items": {
            "type": "object",
            "required": ["constraint", "impact"],
            "properties": {
              "constraint": {
                "type": "string",
                "minLength": 10,
                "maxLength": 200,
                "description": "The constraint",
                "examples": ["Must launch by Q2 for SkatteFUNN deadline", "Cannot exceed $50K monthly burn", "Requires SOC2 compliance for enterprise sales"]
              },
              "impact": {
                "type": "string",
                "enum": ["timeline", "budget", "scope", "quality", "team", "regulatory"],
                "description": "Primary area impacted"
              },
              "flexibility": {
                "type": "string",
                "enum": ["none", "negotiable_with_tradeoffs", "soft_preference"],
                "description": "How firm is this constraint?",
                "default": "none"
              }
            }
          }
        },
        "operating_assumptions": {
          "type": "array",
          "description": "Assumptions about how things work (not strategic hypotheses)",
          "items": {
            "type": "object",
            "required": ["assumption"],
            "properties": {
              "assumption": {
                "type": "string",
                "minLength": 10,
                "maxLength": 200,
                "description": "The operating assumption",
                "examples": ["Team can ship 2-3 features per month", "AI agents can handle 80% of code generation", "Customer interviews take 2 weeks to schedule"]
              },
              "confidence": {
                "type": "string",
                "enum": ["high", "medium", "low"],
                "description": "How confident are we in this assumption?"
              },
              "source": {
                "type": "string",
                "maxLength": 100,
                "description": "Where does this assumption come from?",
                "examples": ["past experience", "industry benchmark", "team estimate", "founder intuition"]
              }
            }
          }
        },
        "capability_gaps": {
          "type": "array",
          "description": "Known capability gaps that may need addressing",
          "items": {
            "type": "object",
            "required": ["gap"],
            "properties": {
              "gap": {
                "type": "string",
                "minLength": 10,
                "maxLength": 200,
                "description": "The capability gap",
                "examples": ["No mobile development expertise", "Limited ML/AI experience", "No sales process experience"]
              },
              "track": {
                "type": "string",
                "enum": ["product", "strategy", "org_ops", "commercial"],
                "description": "Which track is affected"
              },
              "mitigation_approach": {
                "type": "string",
                "enum": ["hire", "contractor", "ai_augmentation", "training", "defer", "partner"],
                "description": "Planned approach to address gap"
              },
              "mitigation_status": {
                "type": "string",
                "enum": ["planned", "in_progress", "resolved", "deferred"],
                "description": "Current status of mitigation effort",
                "default": "planned",
                "$comment": "Updated each cycle as gaps are addressed. 'resolved' gaps can be archived in evolution_log."
              }
            }
          }
        }
      }
    },
    "current_focus": {
      "type": "object",
      "description": "Where attention should focus for the current/next cycle",
      "$comment": "Unlike 'initial_focus' which was a bootstrap-only concept, 'current_focus' is updated every AIM cycle to reflect where attention should go next. At bootstrap this is the Cycle 1 plan; after each AIM it becomes the next cycle plan. This section is the 'so what' of the living reality - given current state, where should attention go?",
      "required": ["primary_track", "primary_objective", "cycle_reference"],
      "properties": {
        "cycle_reference": {
          "type": "string",
          "description": "Which cycle this focus applies to",
          "examples": ["cycle-0-bootstrap", "cycle-2025-q1", "cycle-3"],
          "$comment": "Links focus to specific cycle. At bootstrap this is 'cycle-0-bootstrap' or 'cycle-1'. Updated each AIM to reference next cycle."
        },
        "primary_track": {
          "type": "string",
          "enum": ["product", "strategy", "org_ops", "commercial"],
          "description": "Which track should receive primary attention",
          "$comment": "Almost always 'product' for new ventures. Strategy focus is rare unless pivoting. Org/Ops becomes primary when team scaling is the blocker. Commercial focus comes post-PMF. Updated based on coherence assessment each cycle."
        },
        "secondary_track": {
          "type": "string",
          "enum": ["product", "strategy", "org_ops", "commercial", "none"],
          "description": "Optional secondary track for attention",
          "default": "none"
        },
        "primary_objective": {
          "type": "string",
          "minLength": 20,
          "maxLength": 300,
          "description": "The main thing to achieve in Cycle 1",
          "examples": [
            "Validate core value proposition with 10 paying customers",
            "Ship MVP and get first user feedback",
            "Establish product-market fit for enterprise segment",
            "Build foundation for AI-first product development"
          ],
          "$comment": "Primary objective becomes the North Star for Cycle 1 planning. It should be specific enough to guide decisions but not so tactical that it's just a feature."
        },
        "success_signals": {
          "type": "array",
          "description": "How will we know Cycle 1 was successful?",
          "minItems": 1,
          "maxItems": 5,
          "items": {
            "type": "string",
            "minLength": 10,
            "maxLength": 150
          },
          "$comment": "Success signals are early indicators that Cycle 1 is on track. They're simpler than OKRs - just 'what would make us feel good about this cycle'. These often become OKR seed material in Pathfinder."
        },
        "attention_allocation": {
          "type": "object",
          "description": "Rough percentage allocation across tracks",
          "properties": {
            "product": { "type": "integer", "minimum": 0, "maximum": 100 },
            "strategy": { "type": "integer", "minimum": 0, "maximum": 100 },
            "org_ops": { "type": "integer", "minimum": 0, "maximum": 100 },
            "commercial": { "type": "integer", "minimum": 0, "maximum": 100 }
          },
          "$comment": "Should sum to 100. This is about attention/strategic focus, not headcount allocation. A solo founder might be 70% product, 20% commercial, 10% strategy, 0% org_ops."
        }
      }
    },

    "evolution_log": {
      "type": "array",
      "description": "History of changes to this document through emergence cycles",
      "$comment": "This is what makes the CRA a living document. Each cycle that updates the reality assessment should append an entry here. The log enables: (1) understanding how the org has evolved, (2) validating that emergence is happening, (3) informing future recalibrations with historical context.",
      "items": {
        "type": "object",
        "required": ["cycle_reference", "timestamp", "changes"],
        "properties": {
          "cycle_reference": {
            "type": "string",
            "pattern": "^(bootstrap|C[0-9]+)$",
            "description": "Which cycle triggered this update",
            "examples": ["bootstrap", "C1", "C2", "C3"]
          },
          "timestamp": {
            "type": "string",
            "format": "date-time",
            "description": "When this evolution entry was recorded"
          },
          "updated_by": {
            "type": "string",
            "description": "Human or agent that recorded changes",
            "examples": ["founder", "epf-runtime", "cto"]
          },
          "trigger": {
            "type": "string",
            "enum": ["bootstrap_complete", "aim_signals", "external_change", "milestone_reached", "constraint_change", "manual_update"],
            "description": "What triggered this update",
            "$comment": "bootstrap_complete = initial CRA creation, aim_signals = THA signals updated baselines, external_change = market/funding/team change, milestone_reached = significant achievement, constraint_change = budget/timeline/scope change, manual_update = ad-hoc correction"
          },
          "summary": {
            "type": "string",
            "maxLength": 200,
            "description": "Brief summary of what changed",
            "examples": [
              "Strategy track moved from absent to implicit after first pivot",
              "Commercial track signals show degrading quality, added 2 pain points",
              "Team grew from 2 to 5, adoption level updated to 1"
            ]
          },
          "changes": {
            "type": "array",
            "description": "Specific changes made in this update",
            "minItems": 1,
            "items": {
              "type": "object",
              "required": ["section", "field", "change_type"],
              "properties": {
                "section": {
                  "type": "string",
                  "description": "Which top-level section was updated",
                  "enum": ["metadata", "adoption_context", "track_baselines", "existing_assets", "constraints", "capability_gaps", "current_focus"]
                },
                "field": {
                  "type": "string",
                  "description": "Specific field that changed (dot notation for nested)",
                  "examples": [
                    "adoption_context.team_size",
                    "track_baselines.strategy.maturity",
                    "current_focus.primary_track"
                  ]
                },
                "change_type": {
                  "type": "string",
                  "enum": ["created", "updated", "removed"],
                  "description": "Type of change"
                },
                "previous_value": {
                  "description": "What the value was before (omit for 'created')"
                },
                "new_value": {
                  "description": "What the value is now (omit for 'removed')"
                },
                "reason": {
                  "type": "string",
                  "maxLength": 150,
                  "description": "Why this change was made",
                  "examples": [
                    "THA showed slowing velocity for 2 consecutive cycles",
                    "New team member with DevOps expertise"
                  ]
                }
              }
            }
          },
          "signals_snapshot": {
            "type": "object",
            "description": "THA signals that informed this update (when trigger is aim_signals)",
            "$comment": "Optional but recommended when updates come from AIM cycle. Captures the signal state at time of update for audit trail.",
            "properties": {
              "product": {
                "type": "object",
                "properties": {
                  "velocity": { "type": "string", "enum": ["accelerating", "stable", "slowing", "blocked"] },
                  "quality": { "type": "string", "enum": ["excellent", "healthy", "degrading", "critical"] }
                }
              },
              "strategy": {
                "type": "object",
                "properties": {
                  "velocity": { "type": "string", "enum": ["accelerating", "stable", "slowing", "blocked"] },
                  "quality": { "type": "string", "enum": ["excellent", "healthy", "degrading", "critical"] }
                }
              },
              "org_ops": {
                "type": "object",
                "properties": {
                  "velocity": { "type": "string", "enum": ["accelerating", "stable", "slowing", "blocked"] },
                  "quality": { "type": "string", "enum": ["excellent", "healthy", "degrading", "critical"] }
                }
              },
              "commercial": {
                "type": "object",
                "properties": {
                  "velocity": { "type": "string", "enum": ["accelerating", "stable", "slowing", "blocked"] },
                  "quality": { "type": "string", "enum": ["excellent", "healthy", "degrading", "critical"] }
                }
              }
            }
          }
        }
      }
    }
  },
  "$defs": {
    "track_baseline": {
      "type": "object",
      "description": "Baseline assessment for a single track",
      "required": ["maturity", "status"],
      "properties": {
        "maturity": {
          "type": "string",
          "enum": ["absent", "implicit", "explicit", "measured", "optimized"],
          "description": "Track maturity level",
          "$comment": "Maturity progression: 'absent' (track not started, acceptable at early stages), 'implicit' (happening but not structured), 'explicit' (defined structure/process), 'measured' (has metrics and feedback), 'optimized' (continuously improving). Most startups begin with Product at 'implicit' and other tracks at 'absent'."
        },
        "status": {
          "type": "string",
          "enum": ["not_applicable", "not_started", "emerging", "established", "mature"],
          "description": "Current operational status",
          "$comment": "Status describes where the track is NOW, while maturity describes HOW WELL it's operating. 'not_applicable' for tracks that don't make sense yet (e.g., org_ops for solo founder). 'not_started' means relevant but not begun. 'emerging' means early attempts. 'established' means stable operation. 'mature' means well-optimized."
        },
        "description": {
          "type": "string",
          "maxLength": 300,
          "description": "Brief description of current state",
          "examples": [
            "Building MVP, no formal process yet",
            "Weekly sprints, basic Jira workflow",
            "Full CI/CD, design system, sprint reviews"
          ]
        },
        "key_activities": {
          "type": "array",
          "description": "Main activities happening in this track",
          "maxItems": 5,
          "items": {
            "type": "string",
            "maxLength": 100
          }
        },
        "pain_points": {
          "type": "array",
          "description": "Current pain points or challenges",
          "maxItems": 3,
          "items": {
            "type": "string",
            "maxLength": 150
          }
        },
        "strengths": {
          "type": "array",
          "description": "Current strengths or advantages",
          "maxItems": 3,
          "items": {
            "type": "string",
            "maxLength": 150
          }
        }
      }
    }
  }
}
