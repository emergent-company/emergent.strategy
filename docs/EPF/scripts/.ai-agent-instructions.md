# AI Agent Instructions for EPF Repository Operations

**Purpose:** Critical instructions for AI assistants working with the Emergent Product Framework canonical repository.

**Audience:** AI assistants (GitHub Copilot, Claude, ChatGPT, etc.) performing file operations in EPF repositories.

---

## üö® CRITICAL: Syncing Changes to Canonical EPF

If you need to sync changes from a product instance back to the canonical EPF repository:

‚ùå **DO NOT** use manual git commands (`git add`, `git commit`, `git push`)  
‚ùå **DO NOT** try to manually copy files  
‚ùå **DO NOT** use `cp`, `rsync`, or similar tools  

‚úÖ **DO** use `docs/EPF/scripts/sync-repos.sh`  

### Why the Sync Script Exists

The sync script:
1. **Automatically excludes** `_instances/` directory (prevents product data contamination)
2. **Validates version consistency** across all framework files before syncing
3. **Protects canonical purity** - only framework files are synced, never instance data
4. **Uses safe clone-copy-push workflow** to prevent accidental damage

### How to Use Sync Script

```bash
cd /path/to/product/repo
./docs/EPF/scripts/sync-repos.sh
```

The script will:
1. Prompt you for the canonical EPF repo path
2. Run `classify-changes.sh` to categorize your changes
3. Validate that changes are appropriate for canonical (framework updates only)
4. Execute safe sync via clone-copy-push workflow
5. Report what was synced

**If script asks for user input:** Stop and ask the user for required information.

---

## üö® CRITICAL: Canonical Purity Rules

### What Belongs in Canonical EPF

‚úÖ Framework files (schemas, templates, wizards, scripts)  
‚úÖ Documentation about EPF methodology  
‚úÖ Output generator improvements (wizard.instructions.md updates)  
‚úÖ Validation rules (validator.sh enhancements)  

### What Does NOT Belong in Canonical EPF

‚ùå Product instance data (`_instances/{product}/` contents)  
‚ùå Generated outputs (applications, memos, reports)  
‚ùå Product-specific learning documents  
‚ùå Ad-hoc analysis or proposals about specific products  

### Pre-Flight Check Before Creating Files

**Before creating ANY file in `docs/EPF/`, ask yourself:**

1. **Is this a framework improvement?** (schema update, wizard enhancement, new validator rule)
   - YES ‚Üí Can go in canonical (e.g., `docs/EPF/schemas/`, `docs/EPF/outputs/{generator}/`)
   - NO ‚Üí Go to next question

2. **Is this specific to a product instance?** (analysis, proposal, learning document)
   - YES ‚Üí Must go in `docs/EPF/_instances/{product}/ad-hoc-artifacts/`
   - NO ‚Üí Go to next question

3. **Is this a generated output?** (application, memo, report)
   - YES ‚Üí Must go in `docs/EPF/_instances/{product}/outputs/{generator}/`
   - NO ‚Üí Probably canonical, but verify with user

**Example 1: WRONG**
```
docs/EPF/outputs/PROPOSED_AI_IMPROVEMENTS.md
```
‚ùå This is product-specific learning ‚Üí Should be in `_instances/{product}/ad-hoc-artifacts/`

**Example 2: CORRECT**
```
docs/EPF/outputs/AI_INSTRUCTIONS.md
```
‚úÖ This is framework guidance for all products ‚Üí Belongs in canonical

**Example 3: WRONG**
```
docs/EPF/SKATTEFUNN_PREPARATION.md
```
‚ùå This is instance-specific preparation ‚Üí Should be in `_instances/{product}/outputs/skattefunn-application/`

**Example 4: CORRECT**
```
docs/EPF/schemas/skattefunn_application_schema.json
```
‚úÖ This is framework schema used by all instances ‚Üí Belongs in canonical

---

## üö® CRITICAL: Instance File Location Rules

When working in a product instance (`docs/EPF/_instances/{product}/`):

### Instance Root - Keep Clean
The instance root should ONLY contain:
- `_meta.yaml` (instance metadata)
- `README.md` (instance overview)
- `READY/`, `FIRE/`, `AIM/` (strategic artifact directories)

‚ùå **DO NOT** create loose files in instance root:
- No preparation documents
- No quick reference cards
- No analysis documents
- No temporary notes

### Where to Put Instance Files

**Generated outputs** ‚Üí `outputs/{generator}/`
```
docs/EPF/_instances/{product}/outputs/skattefunn-application/
docs/EPF/_instances/{product}/outputs/investor-memo/
```

**Preparation/planning docs** ‚Üí `outputs/{generator}/` (with the output they support)
```
docs/EPF/_instances/{product}/outputs/skattefunn-application/preparation-notes.md
docs/EPF/_instances/{product}/outputs/skattefunn-application/quick-reference.md
```

**Learning documents, proposals, analysis** ‚Üí `ad-hoc-artifacts/`
```
docs/EPF/_instances/{product}/ad-hoc-artifacts/ai-improvements-proposal-2026-01-08.md
docs/EPF/_instances/{product}/ad-hoc-artifacts/trl-analysis.md
```

---

## Decision Tree: Where Should This File Go?

```
Is this file specific to ONE product instance?
‚îÇ
‚îú‚îÄ YES ‚Üí Is it a generated output (application, memo, report)?
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ YES ‚Üí outputs/{generator}/
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ NO ‚Üí Is it preparation/planning for a specific output?
‚îÇ       ‚îÇ
‚îÇ       ‚îú‚îÄ YES ‚Üí outputs/{generator}/
‚îÇ       ‚îÇ
‚îÇ       ‚îî‚îÄ NO ‚Üí ad-hoc-artifacts/
‚îÇ
‚îî‚îÄ NO ‚Üí Is it a framework improvement (schema, template, wizard, validator)?
    ‚îÇ
    ‚îú‚îÄ YES ‚Üí Canonical EPF (docs/EPF/schemas/, docs/EPF/outputs/{generator}/)
    ‚îÇ
    ‚îî‚îÄ NO ‚Üí Ask user for clarification
```

---

## Common Mistakes and How to Avoid Them

### Mistake 1: Creating Custom Generator Scripts

**Wrong approach:**
```python
# generate_application.py
def synthesize_skattefunn_data(epf_data):
    # custom synthesis logic...
```

**Correct approach:**
```
Read and follow docs/EPF/outputs/skattefunn-application/wizard.instructions.md
Execute each phase sequentially
Use the template.md structure
Validate with validator.sh
```

### Mistake 2: Manual Git Sync

**Wrong approach:**
```bash
git add docs/EPF/outputs/AI_INSTRUCTIONS.md
git commit -m "Add AI instructions"
git push
```

**Correct approach:**
```bash
./docs/EPF/scripts/sync-repos.sh
# Follow script prompts
```

### Mistake 3: Wrong Instance File Location

**Wrong approach:**
```
docs/EPF/_instances/product/SKATTEFUNN_PREP.md  # ‚ùå clutters instance root
```

**Correct approach:**
```
docs/EPF/_instances/product/outputs/skattefunn-application/preparation-notes.md  # ‚úÖ
```

### Mistake 4: Canonical Contamination

**Wrong approach:**
```
docs/EPF/outputs/PRODUCT_SPECIFIC_PROPOSAL.md  # ‚ùå product data in canonical
```

**Correct approach:**
```
docs/EPF/_instances/product/ad-hoc-artifacts/proposal.md  # ‚úÖ
```

---

## When to Ask the User

If you are uncertain about:
- Where a file should be located
- Whether to use sync script or manual commands
- Whether something belongs in canonical vs instance
- Whether to create custom code vs follow wizard

**‚Üí STOP and ask the user before proceeding.**

It's better to ask than to create files in wrong locations or bypass EPF procedures.

---

## Success Checklist

Before completing any EPF-related task, verify:

- [ ] If syncing: Used `sync-repos.sh` (not manual git)
- [ ] If generating output: Followed wizard.instructions.md (not custom code)
- [ ] If creating instance files: Used correct subdirectory (outputs/ or ad-hoc-artifacts/)
- [ ] If creating canonical files: Verified framework improvement (not product-specific)
- [ ] No loose files in instance root
- [ ] No product data in canonical EPF directories

---

## Quick Reference

| Task | Tool | Location |
|------|------|----------|
| Sync to canonical | `sync-repos.sh` | Run from product repo root |
| Generate output | Follow `wizard.instructions.md` | Execute phases sequentially |
| Store learning docs | `ad-hoc-artifacts/` | Instance-specific directory |
| Store prep/planning | `outputs/{generator}/` | With related output |
| Update framework | Canonical `docs/EPF/` | Use sync script after |

---

**Last Updated:** 2026-01-08  
**Version:** 1.0.0  
**Related:** `CANONICAL_PURITY_RULES.md`, `outputs/AI_INSTRUCTIONS.md`
