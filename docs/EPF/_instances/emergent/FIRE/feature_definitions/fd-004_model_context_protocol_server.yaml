id: 'fd-004'
name: 'Model Context Protocol Server'
slug: 'mcp-server'
status: 'delivered'

strategic_context:
  contributes_to:
    - 'Product.Layer1LocalTools.EpfCliMcp'
  tracks:
    - 'product'
  assumptions_tested:
    - 'asm-p-007' # MCP enables valuable IDE integrations
    - 'asm-p-008' # Remote KB access via MCP improves LLM accuracy

definition:
  job_to_be_done: |
    When I'm working in Claude Desktop or other MCP-compatible tools,
    I want to access my knowledge base directly from the tool,
    so I can get contextual information without switching applications.

  solution_approach: |
    A Model Context Protocol (MCP) server implementation that:
    - Exposes knowledge base as MCP tools (search, retrieve, create)
    - Integrates with Claude Desktop via stdio transport
    - Provides authenticated remote access with tenant isolation
    - Enables IDE extensions to query organizational knowledge
    - Supports pilot programs with target users

  personas:
    - id: 'ai-developer'
      name: 'Alex Chen'
      role: 'AI Developer'
      description: >
        Expert developer building custom MCP integrations that extend AI assistant
        capabilities with domain-specific tools. Creates seamless workflows between
        knowledge bases and AI assistants for development teams.
      goals:
        - 'Build custom MCP integrations that extend AI assistant capabilities with domain-specific tools'
        - 'Create seamless workflows between knowledge bases and AI assistants for development teams'
        - 'Implement robust error handling and logging for production MCP deployments'
      pain_points:
        - 'Existing AI assistants lack access to proprietary knowledge bases and internal documentation'
        - 'Building custom integrations requires extensive boilerplate code and protocol knowledge'
        - 'Debugging MCP communication issues is difficult without proper tooling and visibility'
      usage_context: >
        Builds MCP tool definitions and server implementations. Tests integrations
        with multiple AI clients. Deploys MCP servers to production environments.
      technical_proficiency: 'expert'
      current_situation: >
        Alex spends hours writing custom API wrappers and prompt engineering to give AI
        assistants access to internal knowledge bases. Each integration is fragile, requiring
        constant maintenance as APIs change, and the team struggles to share these customizations
        across different AI tools and environments. Building a simple knowledge retrieval
        feature requires implementing authentication, rate limiting, and error handling from
        scratch for each AI client, making every integration a multi-week project.
      transformation_moment: >
        When Alex discovers the MCP server, everything clicks into place. A standardized
        protocol means one integration works everywhere - Claude Desktop today, IDE extensions
        tomorrow. The clean tool definitions make it trivial to expose complex knowledge base
        operations to any MCP-compatible client. Alex builds a full knowledge retrieval
        integration in an afternoon instead of weeks, and it works with every AI tool that
        supports MCP without any additional code.
      emotional_resolution: >
        Alex feels empowered knowing that the MCP integrations built today will continue
        working as the AI ecosystem evolves. The team can finally focus on building valuable
        AI experiences instead of maintaining brittle integration code, and sharing tools
        across the organization becomes effortless. The standardized protocol turned AI
        integration from a constant headache into a solved problem.
      demographics:
        age_range: '26-40'
        experience_years: '4-12 years in software development, 2+ years with AI/ML'
        company_size: 'Startups to Enterprise (50-10,000 employees)'
        industry: ['Technology', 'AI/ML', 'SaaS', 'Developer Tools']
        geography: 'Global, concentrated in tech hubs with strong remote presence'
        education: "Bachelor's or Master's in Computer Science or related field"
        reporting_structure: 'Reports to Engineering Manager, AI Platform Lead, or CTO'
      psychographics:
        values:
          [
            'Technical elegance',
            'Developer experience',
            'Automation',
            'Open standards',
          ]
        motivations:
          [
            'Build cutting-edge AI integrations',
            'Eliminate repetitive work',
            'Create tools others can build on',
            'Stay at the forefront of AI development',
          ]
        fears:
          [
            'Building on unstable platforms',
            'Integration lock-in',
            'Maintenance burden',
            'Being left behind as AI evolves',
          ]
        decision_style: 'Evaluates based on technical merit, community adoption, and long-term maintainability'
        information_sources:
          [
            'GitHub repositories',
            'Technical documentation',
            'AI research papers',
            'Developer conferences',
            'Discord/Slack communities',
          ]
        communication_preferences: 'Code examples over prose, technical RFCs, async communication via GitHub issues'

    - id: 'prompt-engineer'
      name: 'Jordan Rivera'
      role: 'Prompt Engineer'
      description: >
        Advanced practitioner designing AI workflows that combine conversational AI
        with structured knowledge retrieval. Creates reusable prompt templates that
        non-technical team members can customize.
      goals:
        - 'Create AI workflows that seamlessly combine conversational AI with structured knowledge retrieval'
        - 'Design prompts that leverage MCP tools effectively for accurate and contextual responses'
        - 'Build reusable AI workflow templates that non-technical team members can customize'
      pain_points:
        - 'AI assistants hallucinate when they lack access to accurate, up-to-date organizational knowledge'
        - 'Copy-pasting context into prompts is tedious and limits the scope of questions that can be answered'
        - 'No standardized way to give AI assistants access to internal documentation and knowledge bases'
      usage_context: >
        Designs prompts and workflows that use MCP tools. Tests AI responses for
        accuracy and grounding. Creates templates for common use cases.
      technical_proficiency: 'advanced'
      current_situation: >
        Jordan manually copies relevant documentation snippets into prompts before each AI
        interaction. This process is slow, error-prone, and severely limits the complexity
        of questions that can be answered. The AI assistant often provides outdated or
        incorrect information because it cannot access the latest organizational knowledge.
        Context window limits mean Jordan must carefully curate which documentation to include,
        often missing relevant information that would improve responses.
      transformation_moment: >
        With MCP tools integrated into Claude Desktop, Jordan can simply ask questions and
        watch the AI automatically search and retrieve relevant knowledge base entries.
        The search_kb tool returns precisely the context needed, and responses become
        dramatically more accurate and grounded in organizational truth. The first complex
        question Jordan asks is answered correctly with citations to internal documentation
        that would have taken 20 minutes to find manually.
      emotional_resolution: >
        Jordan experiences the joy of finally having an AI assistant that truly understands
        the organization. Prompt engineering shifts from wrestling with context windows to
        designing elegant workflows that leverage the full depth of organizational knowledge,
        making every AI interaction more valuable and trustworthy. The quality of AI outputs
        improved so dramatically that stakeholders now trust AI-generated content without
        extensive manual verification.
      demographics:
        age_range: '25-38'
        experience_years: '2-8 years in technical writing, AI/ML, or developer relations'
        company_size: 'Growth-stage to Enterprise (100-5,000 employees)'
        industry:
          ['AI/ML', 'Technology', 'Consulting', 'Content-heavy organizations']
        geography: 'Remote-first, global talent pool'
        education: "Bachelor's in English, Computer Science, Linguistics, or related field; often self-taught in AI"
        reporting_structure: 'Reports to Head of AI, Product Manager, or Director of Content'
      psychographics:
        values:
          ['Clarity', 'Accuracy', 'User experience', 'Continuous improvement']
        motivations:
          [
            'Unlock AI potential',
            'Create reliable AI workflows',
            'Reduce hallucinations',
            'Democratize AI access for non-technical users',
          ]
        fears:
          [
            'AI providing wrong information',
            'Stakeholder distrust of AI outputs',
            'Being replaced by better AI',
            'Context limitations blocking progress',
          ]
        decision_style: 'Iterative experimentation, measures quality through user feedback and output accuracy'
        information_sources:
          [
            'OpenAI/Anthropic documentation',
            'Prompt engineering communities',
            'AI newsletters',
            'Research papers',
            'Internal usage analytics',
          ]
        communication_preferences: 'Structured templates, annotated examples, collaborative documentation'

    - id: 'it-administrator'
      name: 'Sam Patel'
      role: 'IT Administrator'
      description: >
        Infrastructure administrator responsible for deploying and securing AI tool
        integrations across the organization. Manages access permissions and monitors
        system health.
      goals:
        - 'Deploy and configure MCP server connections securely across the organization'
        - 'Manage API keys and access permissions for different teams and use cases'
        - 'Monitor MCP server health and troubleshoot connectivity issues quickly'
      pain_points:
        - 'AI tool integrations often require complex setup processes that are difficult to standardize'
        - 'Security concerns about exposing internal knowledge bases to external AI services'
        - 'Lack of visibility into how AI tools are accessing organizational data and resources'
      usage_context: >
        Deploys MCP servers and manages API keys. Configures network access and
        monitoring. Supports teams with connectivity troubleshooting.
      technical_proficiency: 'intermediate'
      current_situation: >
        Sam struggles to support the growing demand for AI tool integrations across the
        organization. Each team wants different AI assistants connected to internal systems,
        but there is no standardized approach. Security reviews take weeks because each
        integration has unique risks, and troubleshooting connectivity issues is a nightmare
        without consistent logging or monitoring. Sam spends more time saying "no" to
        integration requests than enabling productive AI usage.
      transformation_moment: >
        The MCP server provides a single, well-documented configuration point for AI
        assistant access. Sam can deploy one server with proper API key authentication
        and tenant isolation, knowing that all MCP-compatible clients will work the same
        way. Security reviews become straightforward with clear data flow documentation.
        The first deployment takes 30 minutes, and subsequent teams can self-service their
        connections using the same pattern.
      emotional_resolution: >
        Sam finally feels in control of AI tool access across the organization. The
        standardized configuration means support requests drop significantly, security is
        maintained through proper API key management, and teams can self-service their
        AI integrations within the guardrails that IT has established. Sam transformed
        from a blocker to an enabler of AI adoption.
      demographics:
        age_range: '30-50'
        experience_years: '5-15 years in IT operations or systems administration'
        company_size: 'Mid-market to Enterprise (500-10,000 employees)'
        industry:
          [
            'Technology',
            'Financial Services',
            'Healthcare',
            'Professional Services',
          ]
        geography: 'On-site or hybrid, with some remote administration'
        education: "Bachelor's in IT, Computer Science, or related field; certifications (CCNA, AWS, Azure)"
        reporting_structure: 'Reports to IT Director, VP of Infrastructure, or CIO'
      psychographics:
        values:
          ['Security', 'Stability', 'Standardization', 'Operational efficiency']
        motivations:
          [
            'Maintain secure systems',
            'Enable teams without compromising security',
            'Reduce support burden',
            'Stay current with emerging tech',
          ]
        fears:
          [
            'Security breaches',
            'Shadow IT proliferation',
            'Configuration drift',
            'Being overwhelmed by support requests',
          ]
        decision_style: 'Risk-averse, prefers proven patterns with clear documentation and rollback procedures'
        information_sources:
          [
            'Vendor documentation',
            'IT forums',
            'Security advisories',
            'Internal runbooks',
            'Peer networks',
          ]
        communication_preferences: 'Tickets for tracking, documented procedures, scheduled change windows'

    - id: 'product-manager'
      name: 'Morgan Lee'
      role: 'Product Manager'
      description: >
        Product leader who wants to enable teams to leverage AI assistants with
        access to accurate product knowledge. Configures AI capabilities and
        measures their effectiveness.
      goals:
        - 'Enable product teams to leverage AI assistants with access to accurate product knowledge'
        - 'Configure AI capabilities that help stakeholders get quick answers about product features'
        - 'Measure and improve the effectiveness of AI-assisted knowledge retrieval workflows'
      pain_points:
        - 'Product documentation is scattered and AI assistants cannot provide accurate product information'
        - 'Stakeholders constantly ask questions that could be answered by AI with proper knowledge access'
        - 'No easy way to validate that AI responses are grounded in official product documentation'
      usage_context: >
        Configures MCP knowledge base access for product teams. Demonstrates AI
        capabilities to stakeholders. Reviews usage analytics for improvement.
      technical_proficiency: 'intermediate'
      current_situation: >
        Morgan receives dozens of questions daily from stakeholders about product features,
        roadmap, and technical details. Answering each question requires searching through
        scattered documentation, and AI assistants provide generic responses that miss
        important product-specific context. The team wastes valuable time on repetitive
        information requests that should be self-service. Every "quick question" interrupts
        deep work and delays strategic initiatives.
      transformation_moment: >
        After configuring the MCP server with product knowledge base access, Morgan
        demonstrates to stakeholders how Claude Desktop can now answer product questions
        directly. The AI pulls accurate information from official documentation, and
        stakeholders can self-serve answers to most questions without waiting for product
        team responses. The first stakeholder who tries it gets an accurate answer in
        seconds to a question that would have required a 15-minute call.
      emotional_resolution: >
        Morgan feels liberated from the constant stream of information requests and can
        focus on strategic product work. Stakeholders are happier with faster, more accurate
        answers, and the product team gains valuable insights from seeing which knowledge
        base entries are most frequently accessed through AI queries. The AI became an
        extension of the product team, scaling Morgan's ability to support the organization.
      demographics:
        age_range: '28-45'
        experience_years: '5-15 years in product management or technical roles'
        company_size: 'Growth-stage to Enterprise (100-5,000 employees)'
        industry: ['Technology', 'SaaS', 'B2B Software', 'Platform companies']
        geography: 'Tech hubs with distributed stakeholders'
        education: "Bachelor's or MBA in Business, Computer Science, or Engineering"
        reporting_structure: 'Reports to VP of Product, CPO, or General Manager'
      psychographics:
        values:
          [
            'Customer focus',
            'Strategic impact',
            'Team enablement',
            'Data-driven decisions',
          ]
        motivations:
          [
            'Ship valuable products',
            'Empower stakeholders with self-service',
            'Free up time for strategic work',
            'Measure and improve outcomes',
          ]
        fears:
          [
            'Being a bottleneck',
            'Stakeholders getting wrong information',
            'Losing time to repetitive questions',
            'Misaligned teams',
          ]
        decision_style: 'Outcome-focused, balances speed with quality, validates with data and user feedback'
        information_sources:
          [
            'Customer interviews',
            'Product analytics',
            'Competitive intelligence',
            'Internal documentation',
            'Stakeholder feedback',
          ]
        communication_preferences: 'Async updates in Slack/Notion, structured stakeholder reviews, visual roadmaps'

  capabilities:
    - id: 'cap-019'
      name: 'MCP Tool Definitions'
      description: 'Search, retrieve, and create entities via MCP protocol'

    - id: 'cap-020'
      name: 'Claude Desktop Integration'
      description: "Native integration with Anthropic's Claude Desktop client"

    - id: 'cap-021'
      name: 'Remote KB Access'
      description: 'Secure access to knowledge base from external tools'

    - id: 'cap-022'
      name: 'Tenant Isolation'
      description: 'API key-based authentication with org/project scoping'

implementation:
  design_guidance:
    principles:
      - 'Protocol compliance (strict MCP spec adherence)'
      - 'Security first (all requests authenticated and scoped)'
      - 'Performance (< 500ms tool execution)'
      - 'Error transparency (clear error messages to LLM)'

    inspirations:
      - 'Anthropic MCP documentation'
      - 'GitHub Copilot integration patterns'
      - 'VS Code extension architecture'

  contexts:
    - id: 'ctx-009'
      type: 'integration'
      name: 'Claude Desktop Configuration'
      description: 'User configures MCP server in Claude Desktop'
      key_interactions:
        - 'Edit claude_desktop_config.json to add server'
        - 'Set API key in environment variable'
        - 'Restart Claude Desktop to load configuration'
        - 'Verify tools appear in Claude Desktop interface'
      data_displayed:
        - 'MCP server configuration JSON'
        - 'Available tools list in Claude Desktop'
        - 'Connection status indicator'

    - id: 'ctx-010'
      type: 'api'
      name: 'MCP Tool Execution'
      description: 'Claude calls MCP tools to access knowledge base'
      key_interactions:
        - 'Call search_kb tool with natural language query'
        - 'Call get_entity tool to retrieve full entity details'
        - 'Call create_entity tool to add new entities'
        - 'Receive structured JSON responses'
      data_displayed:
        - 'Search results with entity snippets and scores'
        - 'Entity details with properties and relationships'
        - 'Created entity confirmation with ID'
        - 'Error messages for failed operations'

  scenarios:
    - id: 'scn-012'
      name: 'User configures MCP server in Claude Desktop'
      actor: 'Developer'
      context: 'User wants to access their knowledge base from Claude Desktop'
      trigger: 'User edits claude_desktop_config.json to add the MCP server'
      action: 'Configures server with API key and restarts Claude Desktop'
      outcome: 'MCP tools appear in Claude Desktop and queries return results'
      acceptance_criteria:
        - 'Server starts without errors'
        - 'Tools appear in Claude Desktop'
        - 'Search queries return results'

    - id: 'scn-013'
      name: 'Claude searches knowledge base via MCP'
      actor: 'LLM (Claude)'
      context: 'User asks Claude a question that requires knowledge base lookup'
      trigger: 'Claude decides to call the search_kb tool'
      action: 'Executes search_kb with query and limit parameters'
      outcome: 'Returns top relevant entities with snippets and scores'
      acceptance_criteria:
        - 'Returns top 5 relevant entities'
        - 'Includes snippets and scores'
        - 'Response time < 500ms'

  external_integrations:
    - name: 'Claude Desktop'
      purpose: 'Primary MCP client for user interaction'
      direction: 'inbound'

    - name: '@modelcontextprotocol/sdk'
      purpose: 'MCP protocol implementation library'
      direction: 'outbound'

boundaries:
  non_goals:
    - 'Not an HTTP server (stdio transport only)'
    - 'Not a standalone application (requires MCP client)'
    - 'Not a full CRUD API (limited to search, get, create)'

  constraints:
    - 'Stdio transport only (no HTTP server mode)'
    - 'Read-only tools except create (no entity updates yet)'
    - 'No streaming responses (entire results returned)'
    - 'Limited to 3 tools (search, get, create)'

dependencies:
  requires:
    - id: 'fd-001'
      name: 'Knowledge Graph Engine'
      reason: 'MCP server queries and creates entities in the knowledge graph for external tool access'
    - id: 'fd-007'
      name: 'Authentication and Multi-tenancy'
      reason: 'API key validation and tenant isolation for secure external access to knowledge base'
  enables:
    - id: 'fd-005'
      name: 'IDE Extensions and Integrations'
      reason: 'MCP server provides the backend for IDE extensions to query organizational knowledge'
