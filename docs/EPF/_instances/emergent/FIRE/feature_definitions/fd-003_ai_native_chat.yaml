id: 'fd-003'
name: 'AI-Native Chat Interface'
slug: 'ai-native-chat'
status: 'delivered'

strategic_context:
  contributes_to:
    - 'Product.CoreKnowledgePlatform.KnowledgeAccess.AiChat'
    - 'Product.CoreKnowledgePlatform.KnowledgeAccess.SemanticSearch'
  tracks:
    - 'product'
  assumptions_tested:
    - 'asm-p-005' # Chat is preferred interface for knowledge retrieval
    - 'asm-p-006' # RAG improves answer quality over pure LLM

definition:
  job_to_be_done: |
    When I need to find or understand information from the knowledge base,
    I want to ask natural language questions and get contextual answers with citations,
    so I can quickly get accurate information without manually searching documents.

  solution_approach: |
    A conversational AI interface combining:
    - Natural language question understanding
    - RAG (Retrieval-Augmented Generation) with graph and vector search
    - Multi-turn conversation with context retention
    - Source citations and confidence indicators
    - Streaming responses for perceived performance
    - Agent-based workflows for complex queries
    - Observability via Langfuse integration

  personas:
    - id: 'business-user'
      name: 'Sarah Mitchell'
      role: 'Marketing Manager'
      description: 'Non-technical professional who needs quick answers from company knowledge without learning complex search tools'
      goals:
        - 'Find accurate information quickly without reading through multiple documents'
        - 'Get answers in plain language that can be shared with stakeholders'
        - 'Understand source credibility through visible citations'
      pain_points:
        - 'Traditional search returns too many irrelevant results requiring manual filtering'
        - 'Cannot remember exact keywords or document titles when searching'
        - 'Feels overwhelmed by technical interfaces and query syntax requirements'
      usage_context: 'Desktop browser during business hours, often while multitasking between meetings and preparing presentations'
      technical_proficiency: 'basic'
      current_situation: "Sarah spends 45 minutes each morning hunting through SharePoint folders and Confluence pages for information she needs for client presentations. She often gives up and asks colleagues directly, creating bottlenecks and interrupting their work. Last week she presented outdated pricing information because she couldn't find the latest rate sheet, causing embarrassment in a key client meeting. Her frustration with knowledge management tools has led her to maintain personal folders of 'important documents' that quickly become outdated."
      transformation_moment: "Sarah types 'What are our current enterprise pricing tiers?' into the chat interface and watches as the AI instantly surfaces the answer with a direct link to the source document. She clicks the citation and sees it's from the pricing guide updated just yesterday. Within seconds she has exactly what she needs, verified and current. She realizes she can trust this tool to find information faster than she ever could manually."
      emotional_resolution: "Sarah now approaches each workday with confidence, knowing that any question about company knowledge is just a conversation away. She's become the go-to person on her team for finding information quickly, and her presentations are consistently backed by current, accurate data. The mental load of remembering where everything is stored has lifted, freeing her cognitive energy for the creative and strategic work she actually enjoys."
      demographics:
        age_range: '28-45'
        experience_years: '3-12 years in marketing or business roles'
        company_size: 'Mid-market to Enterprise (200-5,000 employees)'
        industry:
          [
            'Professional Services',
            'Technology',
            'Retail',
            'Financial Services',
          ]
        geography: 'Office-based or hybrid environments in urban centers'
        education: "Bachelor's degree in Marketing, Communications, or Business"
        reporting_structure: 'Reports to Director of Marketing or VP of Marketing'
      psychographics:
        values: ['Professionalism', 'Accuracy', 'Efficiency', 'Collaboration']
        motivations:
          [
            'Deliver polished client presentations',
            'Look competent in meetings',
            'Save time on research',
            'Focus on creative work',
          ]
        fears:
          [
            'Presenting outdated information',
            'Looking unprepared',
            'Wasting time on manual searches',
            'Being a bottleneck for colleagues',
          ]
        decision_style: 'Intuitive with validation needs, prefers trusted sources with clear provenance'
        information_sources:
          [
            'SharePoint',
            'Confluence',
            'Slack channels',
            'Email from colleagues',
            'Industry publications',
          ]
        communication_preferences: 'Quick answers via chat, visual presentations, concise summaries'

    - id: 'power-user'
      name: 'David Chen'
      role: 'Senior Business Analyst'
      description: 'Analytical professional who builds complex queries to extract insights across multiple knowledge domains'
      goals:
        - 'Perform multi-step research involving connected information across documents'
        - 'Compare and contrast information from different sources systematically'
        - 'Export findings in structured formats for reports and analysis'
      pain_points:
        - 'Single-query interfaces cannot handle the complexity of real business questions'
        - 'Manually piecing together information from disparate sources is time-consuming'
        - 'Losing context when switching between search tools and documents'
      usage_context: 'Dual-monitor setup with chat interface alongside spreadsheets and analysis tools, conducting deep research sessions lasting 2-4 hours'
      technical_proficiency: 'advanced'
      current_situation: "David's quarterly market analysis requires synthesizing information from competitive intelligence reports, customer feedback databases, and internal strategy documents. He currently maintains a complex system of bookmarks, notes, and cross-reference spreadsheets that takes days to navigate. Each analysis cycle starts with hours of re-familiarizing himself with where information lives. He's developed workarounds involving multiple browser tabs and manual copy-paste workflows, but the cognitive overhead limits the depth of insights he can extract."
      transformation_moment: "David asks a follow-up question that builds on three previous queries: 'Based on the competitor pricing we discussed and the customer feedback trends, what strategic recommendations appeared in the Q2 board presentation?' The AI maintains full context, connects the dots across conversation history, and surfaces a synthesized answer with citations to all three source domains. David realizes the AI is essentially his research assistant, remembering everything they've discussed."
      emotional_resolution: 'David has transformed from a researcher who dreads the data-gathering phase to one who eagerly explores questions knowing the AI will handle the retrieval complexity. His analysis reports now include insights he never would have discovered manually because he can follow curiosity threads without the friction of searching. Colleagues have noticed his reports contain unexpected connections between datasets, elevating his reputation as someone who sees the bigger picture.'
      demographics:
        age_range: '30-50'
        experience_years: '5-15 years in analytics, research, or strategic planning'
        company_size: 'Mid-market to Enterprise (500-10,000 employees)'
        industry:
          ['Consulting', 'Financial Services', 'Technology', 'Healthcare']
        geography: 'Knowledge-intensive organizations, often in financial centers'
        education: "MBA or Master's in Analytics, Economics, or related quantitative field"
        reporting_structure: 'Reports to VP of Strategy, Chief Analytics Officer, or Managing Director'
      psychographics:
        values:
          [
            'Analytical rigor',
            'Strategic insight',
            'Intellectual depth',
            'Data-driven decisions',
          ]
        motivations:
          [
            'Uncover hidden patterns',
            'Deliver strategic recommendations',
            'Be recognized for insight quality',
            'Master complex domains',
          ]
        fears:
          [
            'Missing critical data',
            'Analysis paralysis',
            'Being outpaced by faster analysts',
            'Losing context across projects',
          ]
        decision_style: 'Systematic and thorough, builds comprehensive evidence base before synthesizing conclusions'
        information_sources:
          [
            'Internal databases',
            'Market research platforms',
            'Industry reports',
            'Academic papers',
            'Expert interviews',
          ]
        communication_preferences: 'Detailed written reports, data visualizations, structured presentations with appendices'

    - id: 'remote-worker'
      name: 'Maya Rodriguez'
      role: 'Customer Success Manager'
      description: 'Field-based professional who needs instant access to product and customer information while away from the office'
      goals:
        - 'Answer customer questions in real-time during calls and meetings'
        - 'Access knowledge base reliably from varying network conditions'
        - 'Get concise answers that can be immediately communicated to customers'
      pain_points:
        - 'Cannot wait for pages to load or searches to complete during live customer calls'
        - 'Mobile interfaces for traditional search tools are frustrating and slow'
        - 'Timezone differences mean internal experts are often unavailable when needed'
      usage_context: 'Laptop and mobile devices during customer calls, often from home office, coffee shops, or customer sites with variable connectivity'
      technical_proficiency: 'intermediate'
      current_situation: "Maya supports customers across three time zones and frequently takes calls outside standard business hours when subject matter experts are unavailable. She's developed the habit of over-preparing for calls, spending hours creating personal cheat sheets for each customer. Despite this preparation, customers regularly ask questions she can't answer immediately, forcing her to say 'I'll get back to you on that' multiple times per call. This erodes customer confidence and extends resolution timelines unnecessarily."
      transformation_moment: 'During a customer call, Maya is asked an unexpected technical question about API rate limits. Instead of promising to follow up, she types the question into the chat interface on her second monitor. The streaming response begins immediately, and she reads the answer aloud to the customer while it generates. The customer is impressed by her instant expertise, and Maya realizes she now has a real-time knowledge partner for every customer interaction.'
      emotional_resolution: "Maya no longer feels anxious before customer calls, even when covering for colleagues or handling unfamiliar accounts. The AI chat has become her safety net, giving her confidence to take on complex customer situations knowing she can access any information instantly. Her customer satisfaction scores have improved, and she's started volunteering for challenging accounts that other CSMs avoid, knowing she has an advantage others don't."
      demographics:
        age_range: '26-40'
        experience_years: '3-10 years in customer success, account management, or support'
        company_size: 'Growth-stage to Enterprise SaaS companies (100-5,000 employees)'
        industry:
          [
            'SaaS',
            'Technology',
            'Professional Services',
            'Financial Technology',
          ]
        geography: 'Distributed teams across multiple time zones, remote-first or hybrid'
        education: "Bachelor's degree in Business, Communications, or related field"
        reporting_structure: 'Reports to Director of Customer Success or VP of Customer Experience'
      psychographics:
        values:
          [
            'Customer advocacy',
            'Responsiveness',
            'Reliability',
            'Relationship building',
          ]
        motivations:
          [
            'Delight customers',
            'Resolve issues quickly',
            'Build long-term relationships',
            'Exceed satisfaction targets',
          ]
        fears:
          [
            'Failing customers in real-time',
            'Looking uninformed',
            'Losing accounts due to slow responses',
            'Being unavailable when needed',
          ]
        decision_style: 'Action-oriented, prefers quick access to verified information over perfect answers'
        information_sources:
          [
            'CRM notes',
            'Product documentation',
            'Slack with product team',
            'Customer tickets',
            'Internal wikis',
          ]
        communication_preferences: 'Real-time chat for urgency, video calls for relationship building, concise written follow-ups'

    - id: 'team-lead'
      name: 'James Okonkwo'
      role: 'Product Team Lead'
      description: 'People manager who delegates research tasks and needs to quickly verify team findings'
      goals:
        - 'Quickly verify information provided by team members without deep diving'
        - 'Provide research starting points when delegating knowledge tasks'
        - 'Maintain awareness of key information across multiple project domains'
      pain_points:
        - 'Not enough hours to personally research every decision that needs informed input'
        - 'Team members sometimes provide incomplete or outdated information'
        - 'Context-switching between projects makes it hard to remember domain details'
      usage_context: 'Brief sessions between meetings, often standing at desk or walking between conference rooms, using both desktop and mobile'
      technical_proficiency: 'intermediate'
      current_situation: "James leads a team of six and is involved in decisions across four major product initiatives. He relies on team members to surface relevant information, but has been burned by outdated data making it into presentations. He doesn't have time to personally verify everything, so he's developed an uncomfortable habit of spot-checking randomly, which sometimes catches errors and sometimes doesn't. The cognitive load of tracking which information he's verified versus what he's taking on faith creates constant low-level anxiety about credibility."
      transformation_moment: "A team member presents competitive analysis in a meeting. James has two minutes before his next call. He types the key claim into the chat interface: 'What does our latest competitive analysis say about CompetitorX pricing strategy?' The AI confirms the claim, cites the source document dated last week, and adds a relevant detail the team member missed. In under a minute, James has verified the information and added value to the conversation. He realizes this tool lets him be an informed leader without being a bottleneck."
      emotional_resolution: "James has reclaimed his role as a strategic leader rather than an information gatekeeper. He delegates research with confidence, knowing he can quickly verify critical claims. Team members appreciate that he engages substantively with their findings rather than just rubber-stamping or requesting more detail. The constant anxiety about what he doesn't know has been replaced by confidence that any knowledge gap is just a question away from being filled."
      demographics:
        age_range: '32-48'
        experience_years: '8-18 years, including 3+ years in leadership roles'
        company_size: 'Mid-market to Enterprise (500-10,000 employees)'
        industry:
          ['Technology', 'Product Development', 'Digital Services', 'Software']
        geography: 'Tech hubs with distributed team members'
        education: "Bachelor's or Master's in Computer Science, Business, or Product Management"
        reporting_structure: 'Reports to VP of Product, Director of Engineering, or C-level executive'
      psychographics:
        values:
          [
            'Team empowerment',
            'Strategic thinking',
            'Quality decisions',
            'Credibility',
          ]
        motivations:
          [
            'Enable team success',
            'Make informed decisions quickly',
            'Maintain credibility with stakeholders',
            'Balance depth with breadth',
          ]
        fears:
          [
            'Being blindsided by bad data',
            'Becoming a bottleneck',
            'Losing team trust',
            'Making decisions on incomplete information',
          ]
        decision_style: 'Verification-focused, trusts but verifies, prefers quick spot-checks over deep dives'
        information_sources:
          [
            'Team updates',
            'Product analytics',
            'Competitive intelligence',
            'Executive briefings',
            'Industry news',
          ]
        communication_preferences: 'Brief Slack updates, structured weekly syncs, executive summaries over detailed reports'

  capabilities:
    - id: 'cap-012'
      name: 'Conversational Question Answering'
      description: 'Natural language Q&A with context from previous messages'

    - id: 'cap-013'
      name: 'RAG Retrieval'
      description: 'Combines vector search, graph traversal, and lexical search for context'

    - id: 'cap-014'
      name: 'Source Citations'
      description: 'Links answers to source documents and chunks with confidence scores'

    - id: 'cap-015'
      name: 'Streaming Responses'
      description: 'Server-sent events deliver tokens as generated for responsive UX'

    - id: 'cap-016'
      name: 'Agent Workflows'
      description: 'Multi-step reasoning for complex queries requiring graph exploration'

    - id: 'cap-017'
      name: 'Conversation Management'
      description: 'Create, list, resume, and organize chat sessions'

    - id: 'cap-018'
      name: 'Observability'
      description: 'Langfuse tracing for debugging RAG pipelines and measuring quality'

implementation:
  design_guidance:
    principles:
      - 'Fast perceived performance (streaming delivery, optimistic UI updates)'
      - 'Transparent sourcing (always cite sources, link to original documents)'
      - 'Graceful degradation (fallback to search results if generation fails)'
      - 'User control (edit queries, regenerate responses, provide explicit feedback)'

    inspirations:
      - 'ChatGPT - Conversational UX with natural back-and-forth flow'
      - 'Perplexity AI - Citation-heavy answers with inline source references'
      - 'GitHub Copilot Chat - IDE integration patterns and context awareness'
      - 'Notion AI - Inline assistance seamlessly integrated into workspace'

    interaction_patterns:
      - 'Streaming Conversation - Tokens appear progressively as generated; user sees thinking in real-time'
      - 'Citation Bubbles - Inline [1], [2] numbers expand to show source document and excerpt'
      - 'Suggested Follow-ups - System proposes related questions based on answer content'
      - 'Conversation Threading - Sidebar shows conversation history; click to resume any thread'

  contexts:
    - id: 'ctx-006'
      type: 'api'
      name: 'Chat API'
      description: 'REST and SSE endpoints for conversational AI interaction'

      key_interactions:
        - 'POST /api/chat/conversations → Create new conversation thread'
        - 'POST /api/chat/conversations/{id}/messages → Send user message, receive SSE stream'
        - 'GET /api/chat/conversations/{id}/messages → Retrieve conversation history'
        - 'DELETE /api/chat/conversations/{id} → Delete conversation thread'

      data_displayed:
        - 'Conversation ID and title'
        - 'Message role (user|assistant) and content'
        - 'Citations array with chunk_id, document_id, similarity score'
        - 'Streaming tokens with event types (token|citation|done|error)'
        - 'Langfuse trace ID for debugging'

    - id: 'ctx-007'
      type: 'ui'
      name: 'Chat Interface (Admin)'
      description: 'Web-based conversational UI in admin panel'

      key_interactions:
        - 'Type question in auto-resizing textarea → Press Enter to send'
        - 'Click citation number [1] → Expand inline to show source excerpt'
        - 'Click suggested follow-up question → Auto-fills as new message'
        - 'Hover over streaming answer → Show regenerate button'
        - 'Click conversation in sidebar → Resume previous thread'

      data_displayed:
        - 'Conversation history (chronological message list)'
        - 'User message bubbles (left-aligned, with timestamp)'
        - 'Assistant response bubbles (right-aligned, streaming)'
        - 'Inline citation links ([1], [2], [3]) with hover previews'
        - 'Typing indicator during generation'
        - 'Feedback buttons (thumbs up/down) on each response'

    - id: 'ctx-008'
      type: 'integration'
      name: 'Chat SDK'
      description: 'JavaScript/TypeScript SDK for embedding chat in third-party apps'

      key_interactions:
        - 'npm install @emergent/chat-sdk → Add package to project'
        - '<ChatWidget projectKey={key} /> → Render embedded chat'
        - 'SDK authenticates via project API key → Maintains tenant isolation'
        - 'Custom theme props → Style widget to match host app'

      data_displayed:
        - 'Chat widget (modal or inline) with minimize/maximize controls'
        - 'Conversation interface matching admin UX patterns'
        - 'Organization and project context visible in UI'
        - 'Error messages if API key invalid or quota exceeded'

  scenarios:
    - id: 'scn-008'
      name: 'Send Chat Message'
      actor: 'Knowledge Worker'
      context: 'User is in the Chat API interface and wants to query the knowledge base for information'
      trigger: "User types 'What are the main risks in Q3 client review?' and presses Enter"

      action: |
        1. User sends POST /api/chat/conversations/123/messages with message content
        2. API creates user message record (role='user') in kb.chat_messages
        3. API initiates RAG pipeline: hybrid search (vector + lexical + graph traversal)
        4. Retrieval returns top 10 chunks with similarity scores (min 0.7 threshold)
        5. API constructs context window (8,000 tokens max) with retrieved chunks
        6. API calls Gemini Pro with generation params (temp=0.7, max_tokens=2048)
        7. API streams response via SSE: token events for each generated word
        8. API extracts citations from answer, sends citation events with chunk IDs
        9. API sends done event when generation completes, stores assistant message

      outcome: |
        - User sees answer streaming token-by-token within 1 second of sending
        - Answer includes 3 inline citations [1], [2], [3] linking to source documents
        - Total generation completes within 5 seconds for typical query
        - Conversation history updates with both user question and assistant answer
        - Langfuse trace created for full pipeline (retrieval → generation → citations)

      acceptance_criteria:
        - 'Time to First Token (TTFT) < 1 second p95'
        - 'Answer generation completes < 5 seconds p95'
        - 'Citations link to verifiable source documents (> 90% accuracy)'
        - 'SSE stream includes token, citation, and done events in correct order'

    - id: 'scn-009'
      name: 'Conversation History Retrieval'
      actor: 'Knowledge Worker'
      context: 'User is in the Chat API interface and wants to retrieve previous conversation history'
      trigger: 'User clicks on previous conversation in sidebar to resume thread'

      action: |
        1. UI sends GET /api/chat/conversations/123/messages
        2. API queries kb.chat_messages WHERE conversation_id=123 ORDER BY created_at
        3. API returns messages array with user and assistant messages interleaved
        4. API paginates if > 50 messages (returns first page with cursor)
        5. UI renders conversation history in chronological order

      outcome: |
        - User sees complete conversation history from previous session
        - Messages display in correct chronological order (oldest to newest)
        - Citations in historical assistant messages remain clickable
        - User can send new message to continue conversation thread

      acceptance_criteria:
        - 'Messages returned in chronological order (created_at ascending)'
        - 'Includes both user messages and assistant responses'
        - 'Citations in historical messages remain valid (chunk IDs resolve)'
        - 'Pagination cursor works for conversations > 50 messages'

    - id: 'scn-010'
      name: 'Ask Question with Streaming Answer'
      actor: 'Knowledge Worker'
      context: 'User is in the Chat Interface (Admin) web UI and wants to ask a question with real-time streaming'
      trigger: 'User types question in chat interface and presses Enter'

      action: |
        1. User types 'Summarize project timeline' in auto-resizing textarea
        2. Textarea grows to fit content (max 5 lines before scrolling)
        3. User presses Enter; UI disables input and shows typing indicator
        4. UI opens SSE connection to /api/chat/conversations/{id}/messages/stream
        5. UI receives token events and appends to answer bubble character-by-character
        6. UI receives citation events and renders inline [1], [2] with hover previews
        7. UI receives done event, hides typing indicator, enables input again
        8. UI shows feedback buttons (thumbs up/down) below completed answer

      outcome: |
        - Answer appears progressively, giving immediate sense of progress
        - Citations appear inline as answer streams (not batched at end)
        - User can click citation number to expand source excerpt
        - Conversation history scrolls to show new messages
        - Input field remains responsive for immediate follow-up question

      acceptance_criteria:
        - 'Textarea expands automatically as user types (max 5 lines)'
        - 'Send button enabled only when text present'
        - 'Answer streams token-by-token with < 100ms latency per token'
        - 'Citations appear as clickable inline links ([1], [2], [3])'
        - 'Conversation history auto-scrolls to newest message'

    - id: 'scn-011'
      name: 'Embed Chat Widget in Third-Party App'
      actor: 'Developer'
      context: 'Developer is building a third-party application and wants to embed the Chat SDK widget'
      trigger: 'Developer wants to add AI chat to their product documentation site'

      action: |
        1. Developer runs: npm install @emergent/chat-sdk
        2. Developer obtains project API key from Emergent admin panel
        3. Developer adds <ChatWidget projectKey="pk_abc123" theme="dark" /> to React app
        4. SDK initializes, authenticates with API key, establishes SSE connection
        5. User in third-party app clicks chat icon, widget slides in from bottom-right
        6. User types question; SDK handles message sending and response streaming
        7. Widget respects tenant isolation (org/project context from API key)

      outcome: |
        - Chat widget renders seamlessly in host application
        - Widget styling matches host app theme (dark mode, brand colors)
        - Questions answered using project-specific knowledge base
        - Tenant isolation prevents cross-project data leakage
        - Widget provides same UX as admin panel chat interface

      acceptance_criteria:
        - 'npm install succeeds with no peer dependency conflicts'
        - 'Widget authenticates via project API key (no user login required)'
        - 'Respects org/project context (queries scoped to correct tenant)'
        - 'Customizable styling via theme prop (colors, fonts, sizing)'
        - 'Widget can be minimized/maximized without losing conversation state'

dependencies:
  requires:
    - id: 'fd-001'
      name: 'Knowledge Graph Engine'
      reason: 'Graph traversal provides entity context for richer retrieval in RAG pipeline'
    - id: 'fd-002'
      name: 'Document Ingestion Pipeline'
      reason: 'Chat searches ingested document chunks and entities for contextual answers'

  enables:
    - id: 'fd-005'
      name: 'Template Packs System'
      reason: 'Chat interface can suggest templates based on conversation context and user needs'
    - id: 'fd-008'
      name: 'Collaboration & Sharing'
      reason: 'Conversations become shareable artifacts for team knowledge transfer'
