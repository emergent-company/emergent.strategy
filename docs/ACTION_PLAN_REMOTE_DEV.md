# Remote Dev Environment Setup - Action Plan

## Current Status ‚úÖ

### Working
- ‚úÖ PostgreSQL accessible on port 5432 (94.130.12.194:5432)
- ‚úÖ Zitadel API accessible on port 8100 (94.130.12.194:8100)
- ‚úÖ All containers running (db: healthy, zitadel: healthy, login: waiting for PAT)
- ‚úÖ Bootstrap PAT auto-generated by Zitadel machine user
- ‚úÖ Remote configuration scripts ready

### Pending
- ‚è≥ DNS wildcard configuration: `*.dev.emergent-company.ai ‚Üí 94.130.12.194`
- ‚è≥ Zitadel organization and project creation
- ‚è≥ Login UI waiting for PAT file (will be resolved by bootstrap)

## Your Next Steps

### Step 1: Configure DNS (Required First)

**At your DNS provider, add ONE of these records:**

**Option A: Wildcard A Record (Recommended)**
```
*.dev.emergent-company.ai  A  94.130.12.194
```

**Option B: Wildcard CNAME**
```
*.dev.emergent-company.ai  CNAME  kucharz.net.
```

**Option C: Individual A Records**
```
zitadel.dev.emergent-company.ai       A  94.130.12.194
login.zitadel.dev.emergent-company.ai A  94.130.12.194
db.dev.emergent-company.ai            A  94.130.12.194
```

**Verify DNS after 5-60 minutes:**
```bash
nslookup zitadel.dev.emergent-company.ai
# Should return: 94.130.12.194
```

### Step 2: Run Remote Bootstrap

Once DNS is configured and verified:

```bash
# From your local machine (no SSH needed!)
cd /Users/mcj/code/spec-server-2
./scripts/bootstrap-remote-zitadel.sh
```

**What this does (all remotely via API):**
- ‚úÖ Retrieves bootstrap PAT from Zitadel
- ‚úÖ Tests authentication
- ‚úÖ Creates organization: "Spec Organization Dev"
- ‚úÖ Creates project: "Spec Server Dev"
- ‚úÖ Saves configuration to `secrets-dev/config.env`
- ‚úÖ Generates complete setup summary

**No server file manipulation needed!**

### Step 3: Update Coolify Environment

After bootstrap completes, it will show you the IDs. Add these to Coolify:

```bash
ZITADEL_DOMAIN=zitadel.dev.emergent-company.ai
ZITADEL_ORG_ID=<from bootstrap output>
ZITADEL_PROJECT_ID=<from bootstrap output>
```

Then restart containers via Coolify UI or SSH:
```bash
ssh root@94.130.12.194
cd /data/coolify/applications/nw0wokswsooooo4g0c0ggok4
docker compose restart
```

### Step 4: Verify Everything Works

```bash
./scripts/verify-dev-services.sh
```

Expected output:
```
‚úÖ DNS Resolution: All domains resolve to 94.130.12.194
‚úÖ PostgreSQL: Port 5432 accessible
‚úÖ Zitadel API: Port 8100 accessible, health check OK
‚úÖ Login UI: Port 8101 accessible
```

## Alternative: Full Bootstrap on Server

If you prefer a complete setup including users and applications:

```bash
# SSH to server
ssh root@94.130.12.194
cd /data/coolify/applications/nw0wokswsooooo4g0c0ggok4

# Run full bootstrap
ZITADEL_DOMAIN=zitadel.dev.emergent-company.ai \
bash scripts/bootstrap-zitadel-fully-automated.sh provision
```

This creates:
- Organization and project
- OAuth OIDC application
- API application
- Two service accounts (CLIENT + API)
- Admin user
- Test user

## Service Architecture

```
Local Machine ‚Üí API Calls ‚Üí Remote Zitadel
                              ‚îú‚îÄ‚îÄ Management API (creates org/project)
                              ‚îú‚îÄ‚îÄ Bootstrap PAT (auto-generated)
                              ‚îî‚îÄ‚îÄ Configuration saved locally
```

**Key Principle:** All configuration done remotely via Zitadel Management API. No direct server file manipulation required!

## What You'll Get

After completing these steps:

### Access URLs (once DNS configured)
- **Zitadel Console:** https://zitadel.dev.emergent-company.ai
- **Login UI:** https://login.zitadel.dev.emergent-company.ai
- **Database:** db.dev.emergent-company.ai:5432
- **API:** https://zitadel.dev.emergent-company.ai/management/v1

### Local Configuration Files
- `secrets-dev/config.env` - Environment variables for Coolify
- `secrets-dev/BOOTSTRAP_SUMMARY.md` - Complete setup summary

### Zitadel Resources
- Organization: "Spec Organization Dev"
- Project: "Spec Server Dev"
- Ready for OAuth app creation
- Ready for service account creation

## Troubleshooting

### If DNS doesn't resolve after 60 minutes
```bash
# Clear local DNS cache
sudo dscacheutil -flushcache
sudo killall -HUP mDNSResponder

# Check propagation globally
https://dnschecker.org
```

### If bootstrap script can't connect
```bash
# Test Zitadel directly via IP
curl http://94.130.12.194:8100/debug/healthz

# Should return: {"status":"ok"}
```

### If PAT not found
```bash
# Check PAT file on server
ssh root@94.130.12.194 \
  'cat /data/coolify/applications/nw0wokswsooooo4g0c0ggok4/secrets/bootstrap/pat.txt'
```

## Timeline Estimate

1. **DNS Configuration:** 5-60 minutes (propagation time)
2. **Bootstrap Script:** 30-60 seconds (remote API calls)
3. **Coolify Update:** 2-3 minutes (environment variables + restart)
4. **Verification:** 30 seconds (health checks)

**Total:** ~10-70 minutes (mostly waiting for DNS)

## Documentation

- **Setup Guide:** `docs/REMOTE_DEV_BOOTSTRAP.md` (created)
- **Verification Script:** `scripts/verify-dev-services.sh` (ready)
- **Bootstrap Script:** `scripts/bootstrap-remote-zitadel.sh` (ready)
- **Full Bootstrap:** `scripts/bootstrap-zitadel-fully-automated.sh` (existing)
- **Zitadel Guide:** `docs/setup/ZITADEL_SETUP_GUIDE.md` (comprehensive)

## Summary

**You have everything ready to go!** Just need to:

1. ‚è≥ **Configure DNS wildcard** (your action at DNS provider)
2. üöÄ **Run bootstrap script** (one command from local machine)
3. ‚öôÔ∏è **Update Coolify env vars** (copy/paste from bootstrap output)
4. ‚úÖ **Verify services** (one command to check everything)

All configuration happens **remotely via API calls** - no server file manipulation needed. This replicates your local Docker setup methodology but executed remotely using external access.

**The bootstrap script is ready to run as soon as your DNS is configured!**
